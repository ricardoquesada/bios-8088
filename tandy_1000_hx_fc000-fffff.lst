bios:C000 ;
bios:C000 ; ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
bios:C000 ; º	  This file is generated by The	Interactive Disassembler (IDA)	      º
bios:C000 ; º	  Copyright (c)	2010 by	Hex-Rays SA, <support@hex-rays.com>	      º
bios:C000 ; º			   Licensed to:	Freeware version		      º
bios:C000 ; ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼
bios:C000 ;
bios:C000 ; Input MD5	: DD99228F2227C358CDC1ECA21614C9EB
bios:C000
bios:C000 ; File Name	: Z:\Users\riq\progs\tandy1000-the-uni-games\misc\bios\tandy_1000_hx_bios.bin
bios:C000 ; Format	: Binary file
bios:C000 ; Base Address: F000h	Range: F0000h -	100000h	Loaded length: 10000h
bios:C000
bios:C000		  .8086
bios:C000		  .model flat
bios:C000
bios:C000 ; ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ
bios:C000
bios:C000 ; Segment type: Pure code
bios:C000 bios		  segment byte public 'CODE'
bios:C000		  assume cs:bios
bios:C000		  ;org 0C000h
bios:C000		  assume es:nothing, ss:nothing, ds:nothing
bios:C000 aBiosRomVersion db '!BIOS ROM version 02.00.00',0Dh,0Ah     ; DATA XREF: POST_init_ints_and_more+3D4o
bios:C000		  db 'Compatibility Software',0Dh,0Ah
bios:C000		  db 'Copyright (C) 1984,1985,1986,1987',0Dh,0Ah
bios:C000		  db 'Phoenix Software Associates Ltd.',0Dh,0Ah
bios:C000		  db 'and Tandy Corporation.',0Dh,0Ah
bios:C000		  db 'All rights reserved.',0Dh,0Ah,'$'
bios:C0A8 charset_128_255 db  1Eh, 33h,3 dup( 60h), 33h, 1Eh, 0Ch, 66h,	  0,4 dup( 66h), 3Bh,	0, 0Ch,	18h, 3Ch
bios:C0A8							      ;	DATA XREF: bios:FF21o
bios:C0A8		  db  66h, 7Eh,	60h, 3Ch,   0, 3Ch,0C3h, 3Ch,	6, 3Eh,	66h, 3Fh,   0, 66h,   0, 3Ch,	6
bios:C0A8		  db  3Eh, 66h,	3Fh,   0, 30h, 18h, 3Ch,   6, 3Eh, 66h,	3Fh,   0, 18h,	 0, 3Ch,   6, 3Eh
bios:C0A8		  db  66h, 3Fh,3 dup(	0), 3Ch, 66h, 60h, 66h,	3Ch, 18h, 3Ch,0C3h, 3Ch, 66h, 7Eh, 60h
bios:C0A8		  db  3Ch,   0,	66h,   0, 3Ch, 66h, 7Eh, 60h, 3Ch,   0,	30h, 18h, 3Ch, 66h, 7Eh, 60h, 3Ch
bios:C0A8		  db	0, 66h,	  0, 38h,3 dup(	18h), 3Ch,   0,	38h,0C6h, 38h,3	dup( 18h), 3Ch,	  0, 30h
bios:C0A8		  db  18h, 38h,3 dup( 18h), 3Ch,   0, 63h, 1Ch,	36h, 63h, 7Fh,2	dup( 63h),   0,2 dup( 1Ch)
bios:C0A8		  db  3Eh, 63h,	7Fh,2 dup( 63h),   0,	6, 0Ch,	7Fh, 31h, 3Ch, 31h, 7Fh,3 dup(	 0), 7Eh
bios:C0A8		  db  1Bh, 7Eh,0D8h, 7Eh,   0, 3Fh, 6Ch,0CCh,0FFh,2 dup(0CCh),0CFh,   0, 3Ch,0C3h, 3Ch
bios:C0A8		  db 3 dup( 66h), 3Ch,	 0, 66h,   0, 3Ch,3 dup( 66h), 3Ch,   0, 30h, 18h, 3Ch,3 dup( 66h)
bios:C0A8		  db  3Ch,   0,	3Ch,0C3h,4 dup(	66h), 3Bh,   0,	30h, 18h,4 dup(	66h), 3Bh,   0,	66h,   0
bios:C0A8		  db 3 dup( 66h), 3Eh,	 6, 7Ch, 63h, 3Eh,4 dup( 63h), 3Eh,   0, 36h,5 dup( 63h), 3Eh
bios:C0A8		  db	0,2 dup( 0Ch), 3Fh,2 dup( 60h),	3Fh,2 dup( 0Ch), 1Ch, 36h, 32h,	78h, 30h, 73h
bios:C0A8		  db  7Eh,   0,2 dup( 66h), 3Ch, 7Eh, 18h, 7Eh,2 dup( 18h),0F8h,2 dup(0CCh),0FAh,0C6h
bios:C0A8		  db 0CFh,0C6h,0C7h, 0Eh,2 dup(	18h), 3Ch,3 dup( 18h), 70h, 0Ch, 18h, 3Ch,   6,	3Eh, 66h
bios:C0A8		  db  3Fh,   0,	18h, 30h, 38h,3	dup( 18h), 3Ch,	  0, 0Ch, 18h, 3Ch,3 dup( 66h),	3Ch,   0
bios:C0A8		  db  0Ch, 18h,4 dup( 66h), 3Bh,   0, 3Bh, 6Fh,	  0, 6Eh,3 dup(	33h),	0, 76h,0DEh, 73h
bios:C0A8		  db  7Bh, 6Fh,	67h, 63h,   0, 3Ch,   6, 3Eh, 66h, 3Bh,	  0,0FFh,   0, 3Ch,3 dup( 66h)
bios:C0A8		  db  3Ch,   0,0FFh,2 dup(   0), 18h,	0, 18h,	30h, 60h, 66h, 3Ch,3 dup(   0),	7Eh,2 dup( 60h)
bios:C0A8		  db 5 dup(   0), 7Eh,2	dup(   6),2 dup(   0),0C3h,0C6h,0CCh,0DEh, 33h,	66h,0CCh, 0Fh
bios:C0A8		  db 0C3h,0C6h,0CCh,0D8h, 37h, 6Fh,0CFh,   3,	0, 18h,	  0,2 dup( 18h),2 dup( 3Ch), 18h
bios:C0A8		  db	0, 33h,	66h,0CCh, 66h, 33h,3 dup(   0),0CCh, 66h, 33h, 66h,0CCh,2 dup(	 0), 22h
bios:C0A8		  db  88h, 22h,	88h, 22h, 88h, 22h, 88h, 55h,0AAh, 55h,0AAh, 55h,0AAh, 55h,0AAh,0DBh, 77h
bios:C0A8		  db 0DBh,0EEh,0DBh, 77h,0DBh,0EEh,0Ch dup( 18h),0F8h,5	dup( 18h),0F8h,	18h,0F8h,3 dup(	18h)
bios:C0A8		  db 4 dup( 36h),0F6h,3	dup( 36h),4 dup(   0),0FEh,3 dup( 36h),2 dup(	0),0F8h, 18h,0F8h
bios:C0A8		  db 3 dup( 18h),2 dup(	36h),0F6h,   6,0F6h,0Bh	dup( 36h),2 dup(   0),0FEh,   6,0F6h,5 dup( 36h)
bios:C0A8		  db 0F6h,   6,0FEh,3 dup(   0),4 dup( 36h),0FEh,3 dup(	  0),2 dup( 18h),0F8h, 18h,0F8h
bios:C0A8		  db 7 dup(   0),0F8h,7	dup( 18h), 1Fh,3 dup(	0),4 dup( 18h),0FFh,7 dup(   0),0FFh,7 dup( 18h)
bios:C0A8		  db  1Fh,3 dup( 18h),4	dup(   0),0FFh,3 dup(	0),4 dup( 18h),0FFh,5 dup( 18h), 1Fh, 18h
bios:C0A8		  db  1Fh,3 dup( 18h),4	dup( 36h), 37h,5 dup( 36h), 37h, 30h, 3Fh,5 dup(   0), 3Fh, 30h
bios:C0A8		  db  37h,5 dup( 36h),0F7h,   0,0FFh,5 dup(   0),0FFh,	 0,0F7h,5 dup( 36h), 37h, 30h
bios:C0A8		  db  37h,3 dup( 36h),2	dup(   0),0FFh,	  0,0FFh,3 dup(	  0),2 dup( 36h),0F7h,	 0,0F7h
bios:C0A8		  db 3 dup( 36h),2 dup(	18h),0FFh,   0,0FFh,3 dup(   0),4 dup( 36h),0FFh,5 dup(	  0),0FFh
bios:C0A8		  db	0,0FFh,3 dup( 18h),4 dup(   0),0FFh,7 dup( 36h), 3Fh,3 dup(   0),2 dup(	18h), 1Fh
bios:C0A8		  db  18h, 1Fh,5 dup(	0), 1Fh, 18h, 1Fh,3 dup( 18h),4	dup(   0), 3Fh,7 dup( 36h),0FFh
bios:C0A8		  db 3 dup( 36h),2 dup(	18h),0FFh, 18h,0FFh,7 dup( 18h),0F8h,7 dup(   0), 1Fh,3	dup( 18h)
bios:C0A8		  db 8 dup(0FFh),4 dup(	  0),4 dup(0FFh),8 dup(0F0h),8 dup( 0Fh),4 dup(0FFh),6 dup(   0)
bios:C0A8		  db  3Bh, 6Eh,	64h, 6Eh, 3Bh,	 0, 3Ch,2 dup( 66h), 7Ch,2 dup(	63h), 6Eh, 60h,	7Fh, 33h
bios:C0A8		  db  31h,3 dup( 30h), 78h,3 dup(   0),	7Fh,3 dup( 36h), 33h,	0, 7Eh,	66h, 30h, 18h
bios:C0A8		  db  30h, 66h,	7Eh,3 dup(   0), 3Fh,3 dup( 66h), 3Ch,3	dup(   0),4 dup( 33h), 3Eh, 60h
bios:C0A8		  db 2 dup(   0), 7Eh, 98h,3 dup( 18h),	  0, 7Eh, 18h, 3Ch,2 dup( 66h),	3Ch, 18h, 7Eh
bios:C0A8		  db  1Ch, 36h,	63h, 7Fh, 63h, 36h, 1Ch,   0, 3Ch, 66h,3 dup(0C3h), 66h,0E7h,	0, 0Eh
bios:C0A8		  db  18h, 0Ch,	3Eh,2 dup( 66h), 3Ch,3 dup(   0), 7Eh,2	dup(0DBh), 7Eh,3 dup(	0),   3
bios:C0A8		  db  3Eh, 67h,	6Bh, 73h, 3Eh, 60h, 1Ch, 30h, 60h, 7Ch,	60h, 30h, 1Ch,	 0, 3Ch,6 dup( 66h)
bios:C0A8		  db 2 dup(   0), 7Eh,	 0, 7Eh,   0, 7Eh,3 dup(   0), 18h, 7Eh, 18h,	0, 7Eh,2 dup(	0)
bios:C0A8		  db  30h, 18h,	0Ch, 18h, 30h, 7Eh,2 dup(   0),	0Ch, 18h, 30h, 18h, 0Ch, 7Eh,2 dup(   0)
bios:C0A8		  db	7,0Ch dup( 0Ch),2 dup( 6Ch), 38h,2 dup(	18h),	0, 7Eh,	  0,2 dup( 18h),2 dup(	 0)
bios:C0A8		  db  3Bh, 6Eh,	  0, 3Bh, 6Eh,2	dup(   0), 1Ch,2 dup( 36h), 1Ch,5 dup(	 0),2 dup( 1Ch)
bios:C0A8		  db 8 dup(   0),2 dup(	18h),3 dup(   0), 0Fh,3	dup( 0Ch),0ECh,	6Ch, 3Ch, 1Ch, 3Ch,4 dup( 36h)
bios:C0A8		  db 3 dup(   0), 38h, 0Ch, 18h, 30h, 3Ch,5 dup(   0),4	dup( 3Ch),0Ah dup(   0)
bios:C4A8
bios:C4A8 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:C4A8
bios:C4A8
bios:C4A8 POST_main	  proc far				      ;	CODE XREF: POST_main+1BCEj
bios:C4A8
bios:C4A8 ; FUNCTION CHUNK AT bios:E05B	SIZE 0000001E BYTES
bios:C4A8
bios:C4A8		  cli					      ;	disable	interrupts
bios:C4A9		  cld					      ;	forward	direction
bios:C4AA		  mov	  cx, 480			      ;	value for delay
bios:C4AD
bios:C4AD loc_FC4AD:						      ;	CODE XREF: POST_main:loc_FC4ADj
bios:C4AD		  loop	  loc_FC4AD			      ;	small delay
bios:C4AF		  mov	  al, 11000b
bios:C4B1		  out	  0A0h,	al			      ;	PIC 2  same as 0020 for	PIC 1
bios:C4B3		  mov	  dx, 378h
bios:C4B6		  out	  dx, al			      ;	Printer	Data Latch:
bios:C4B6							      ;	send byte to printer
bios:C4B7		  in	  al, 62h			      ;	0-2: Not used
bios:C4B7							      ;	3: Fast	Mode: 0=4.77Mhz, 1=7.16Mhz
bios:C4B7							      ;	4: EEPROM data-serial read only
bios:C4B7							      ;	5: 1=Timer 2 channel out
bios:C4B7							      ;	6: Monochrome mode. 0=Color monitor
bios:C4B7							      ;	7: Reserved
bios:C4B9		  or	  al, 1000b			      ;	turn on	7.16Mhz	mode
bios:C4BB		  out	  62h, al			      ;	0-2: Not used
bios:C4BB							      ;	3: Fast	Mode: 0=4.77Mhz, 1=7.16Mhz
bios:C4BB							      ;	4: EEPROM data-serial read only
bios:C4BB							      ;	5: 1=Timer 2 channel out
bios:C4BB							      ;	6: Monochrome mode. 0=Color monitor
bios:C4BB							      ;	7: Reserved
bios:C4BD		  mov	  al, 3
bios:C4BF		  mov	  dx, 3F2h
bios:C4C2		  out	  dx, al			      ;	Floppy:	digital	output reg bits:
bios:C4C2							      ;	0-1: Drive to select 0-3 (AT: bit 1 not	used)
bios:C4C2							      ;	2:   0=reset diskette controller; 1=enable controller
bios:C4C2							      ;	3:   1=enable diskette DMA and interrupts
bios:C4C2							      ;	4-7: drive motor enable.  Set bits to turn drive ON.
bios:C4C2							      ;
bios:C4C3		  mov	  al, 4
bios:C4C5		  dec	  dx
bios:C4C6		  out	  dx, al
bios:C4C7		  mov	  dx, 3DAh
bios:C4CA		  in	  al, dx			      ;	Video status bits:
bios:C4CA							      ;	0: retrace.  1=display is in vert or horiz retrace.
bios:C4CA							      ;	1: 1=light pen is triggered; 0=armed
bios:C4CA							      ;	2: 1=light pen switch is open; 0=closed
bios:C4CA							      ;	3: 1=vertical sync pulse is occurring.
bios:C4CB		  mov	  dl, 0BAh ; 'º'
bios:C4CD		  in	  al, dx			      ;	Video status bits:
bios:C4CD							      ;	0: retrace.  1=display is in vert or horiz retrace.
bios:C4CD							      ;	1: 1=light pen is triggered; 0=armed
bios:C4CD							      ;	2: 1=light pen switch is open; 0=closed
bios:C4CD							      ;	3: 1=vertical sync pulse is occurring.
bios:C4CE		  xor	  al, al
bios:C4D0		  mov	  dl, 0C0h ; 'À'
bios:C4D2		  out	  dx, al			      ;	EGA: palette register: select colors for attribute AL:
bios:C4D2							      ;	0: RED
bios:C4D2							      ;	1: GREEN
bios:C4D2							      ;	2: BLUE
bios:C4D2							      ;	3: blue
bios:C4D2							      ;	4: green
bios:C4D2							      ;	5: red
bios:C4D3		  mov	  al, 100000b
bios:C4D5		  mov	  dx, 3D8h
bios:C4D8		  out	  dx, al			      ;	mode select register
bios:C4D9		  mov	  dx, 3DAh
bios:C4DC		  mov	  al, 3				      ;	select CRT mode	control
bios:C4DE		  out	  dx, al			      ;	Video: bits 0-1	control
bios:C4DE							      ;	Feature	Control	outputs	FC0 and	FC1
bios:C4DF		  mov	  dx, 3DEh
bios:C4E2		  mov	  al, 0
bios:C4E4		  out	  dx, al			      ;	bit 2: enable border
bios:C4E4							      ;	bit 3: set to 1	for 640x200 4 color
bios:C4E4							      ;	bit 4: set to 1	for 16 color modes
bios:C4E4							      ;	bit 5: set to 1	for 640x200 secondary pixel organization?
bios:C4E5		  mov	  dx, 3B8h
bios:C4E8		  mov	  al, 100001b
bios:C4EA		  out	  dx, al
bios:C4EB		  mov	  al, 0
bios:C4ED		  mov	  dx, 3DDh			      ;	Extended RAM page register
bios:C4F0		  out	  dx, al
bios:C4F1		  mov	  dx, 3DBh
bios:C4F4		  out	  dx, al			      ;	Video: light pen latch reset.
bios:C4F4							      ;	Any OUT	clears the latch.
bios:C4F5		  mov	  ax, 0BBE8h
bios:C4F8		  mov	  ds, ax			      ;	ds = 0xbbe8
bios:C4FA		  assume ss:nothing, ds:nothing
bios:C4FA		  mov	  ds:pbbe80.shadow_reset_flag, si     ;	post reset flag
bios:C4FE		  mov	  ds:pbbe80.shadow_caps_numlock, di   ;	keyboard ctlr +	numlock	flag
bios:C502		  mov	  al, 0
bios:C504		  mov	  dx, 3DAh
bios:C507		  out	  dx, al			      ;	Video: bits 0-1	control
bios:C507							      ;	Feature	Control	outputs	FC0 and	FC1
bios:C508		  add	  dx, 4
bios:C50B		  out	  dx, al
bios:C50C		  mov	  dx, 3D9h
bios:C50F		  out	  dx, al			      ;	color select register
bios:C510		  mov	  al, 3
bios:C512		  mov	  dx, 3DAh
bios:C515		  out	  dx, al			      ;	Video: bits 0-1	control
bios:C515							      ;	Feature	Control	outputs	FC0 and	FC1
bios:C516		  xor	  al, al
bios:C518		  mov	  dx, 3DEh
bios:C51B		  out	  dx, al
bios:C51C		  mov	  al, 2
bios:C51E		  mov	  dx, 3DAh
bios:C521		  out	  dx, al			      ;	Video: bits 0-1	control
bios:C521							      ;	Feature	Control	outputs	FC0 and	FC1
bios:C522		  mov	  al, 0
bios:C524		  mov	  dx, 3DEh
bios:C527		  out	  dx, al
bios:C528		  mov	  al, 1
bios:C52A		  mov	  dx, 3DAh
bios:C52D		  out	  dx, al			      ;	Video: bits 0-1	control
bios:C52D							      ;	Feature	Control	outputs	FC0 and	FC1
bios:C52E		  mov	  al, 0FFh
bios:C530		  mov	  dx, 3DEh
bios:C533		  out	  dx, al
bios:C534		  mov	  bl, 10h
bios:C536		  mov	  dx, 3DAh
bios:C539
bios:C539 loc_FC539:						      ;	CODE XREF: POST_main+A0j
bios:C539		  mov	  al, bl
bios:C53B		  out	  dx, al			      ;	Video: bits 0-1	control
bios:C53B							      ;	Feature	Control	outputs	FC0 and	FC1
bios:C53C		  add	  dx, 4
bios:C53F		  out	  dx, al
bios:C540		  sub	  dx, 4
bios:C543		  inc	  bl
bios:C545		  cmp	  bl, 20h ; ' '
bios:C548		  jnz	  short	loc_FC539
bios:C54A		  xor	  al, al
bios:C54C		  out	  dx, al			      ;	Video: bits 0-1	control
bios:C54C							      ;	Feature	Control	outputs	FC0 and	FC1
bios:C54D		  mov	  ax, 0B800h
bios:C550		  mov	  es, ax
bios:C552		  assume es:nothing
bios:C552		  mov	  dx, 3D4h			      ;	6845 index register
bios:C555		  mov	  si, offset video_6845_init_tbl_d    ;	values for ports 3d4 - 3d5 (index 0 to 0xf)
bios:C558		  mov	  di, offset ret_address0	      ;	return address
bios:C55B		  jmp	  init_video
bios:C55E ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C55E
bios:C55E ret_address0:						      ;	DATA XREF: POST_main+B0o
bios:C55E		  mov	  al, 0FFh
bios:C560		  out	  0C0h,	al			      ;	DMA controller,	8237A-5.
bios:C560							      ;	channel	0 base address
bios:C560							      ;	(also sets current address)
bios:C562		  mov	  al, 0BFh ; '¿'
bios:C564		  out	  0C0h,	al			      ;	DMA controller,	8237A-5.
bios:C564							      ;	channel	0 base address
bios:C564							      ;	(also sets current address)
bios:C566		  mov	  al, 0DFh ; 'ß'
bios:C568		  out	  0C0h,	al			      ;	DMA controller,	8237A-5.
bios:C568							      ;	channel	0 base address
bios:C568							      ;	(also sets current address)
bios:C56A		  mov	  al, 9Fh ; 'Ÿ'
bios:C56C		  out	  0C0h,	al			      ;	DMA controller,	8237A-5.
bios:C56C							      ;	channel	0 base address
bios:C56C							      ;	(also sets current address)
bios:C56E		  mov	  al, 11001b
bios:C570		  out	  0A0h,	al			      ;	PIC 2  same as 0020 for	PIC 1
bios:C572		  mov	  dx, 378h
bios:C575		  out	  dx, al			      ;	Printer	Data Latch:
bios:C575							      ;	send byte to printer
bios:C576		  xor	  ax, ax
bios:C578		  mov	  ss, ax
bios:C57A		  assume ss:nothing
bios:C57A		  mov	  dx, 5A5Ah
bios:C57D		  xor	  bx, bx
bios:C57F		  mov	  ax, 0B000h			      ;	Monochrome video address
bios:C582		  mov	  es, ax			      ;	es = b000
bios:C584		  assume es:nothing
bios:C584		  mov	  es:[bx], dx
bios:C587		  jmp	  short	$+2
bios:C589		  mov	  cx, es:[bx]
bios:C58C		  cmp	  cx, dx			      ;	is Monochrome ?
bios:C58E		  jnz	  short	loc_FC595
bios:C590		  mov	  ax, 2
bios:C593		  mov	  ss, ax			      ;	if monochrome ss = 2 (used ahead)
bios:C595		  assume ss:nothing
bios:C595
bios:C595 loc_FC595:						      ;	CODE XREF: POST_main+E6j
bios:C595		  mov	  ax, 0B800h
bios:C598		  mov	  es, ax			      ;	es = b800
bios:C59A		  assume es:nothing
bios:C59A		  mov	  es:[bx], dx
bios:C59D		  jmp	  short	$+2
bios:C59F		  mov	  cx, es:[bx]
bios:C5A2		  cmp	  cx, dx			      ;	is CGA / Tandy / EGA / VGA ?
bios:C5A4		  jnz	  short	loc_FC5AD
bios:C5A6		  mov	  ax, ss
bios:C5A8		  or	  ax, 1
bios:C5AB		  mov	  ss, ax			      ;	if so, ss = ss | 1 (used ahead)
bios:C5AD		  assume ss:nothing
bios:C5AD
bios:C5AD loc_FC5AD:						      ;	CODE XREF: POST_main+FCj
bios:C5AD		  mov	  ax, ss
bios:C5AF		  test	  al, 2
bios:C5B1		  jz	  short	loc_FC5CA
bios:C5B3		  mov	  ax, 0B000h
bios:C5B6		  mov	  es, ax
bios:C5B8		  assume es:nothing
bios:C5B8		  mov	  dx, 3B4h			      ;	6845 index register (Hercules)
bios:C5BB		  mov	  si, offset video_6845_init_tbl_d.init_mode_7 ; BROKEN	OFFSET.	probably because this code never gets executed
bios:C5BE		  mov	  di, offset ret_address1	      ;	return address
bios:C5C1		  jmp	  init_video			      ;	Init video for Hercules
bios:C5C4 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C5C4
bios:C5C4 ret_address1:						      ;	DATA XREF: POST_main+116o
bios:C5C4		  mov	  dx, 3B8h			      ;	6845 Mode Control Register (Hercules)
bios:C5C7		  mov	  al, 101001b
bios:C5C9		  out	  dx, al			      ;	Video: CRT cntrlr addr
bios:C5C9							      ;	horizontal total
bios:C5CA
bios:C5CA loc_FC5CA:						      ;	CODE XREF: POST_main+109j
bios:C5CA		  mov	  ax, ss
bios:C5CC		  test	  al, 1				      ;	is color ? monochrome has ss = 2
bios:C5CE		  jnz	  short	loc_FC5E3
bios:C5D0		  mov	  al, 11000b
bios:C5D2		  out	  0A0h,	al			      ;	PIC 2  same as 0020 for	PIC 1
bios:C5D4		  mov	  dx, 378h
bios:C5D7		  out	  dx, al			      ;	Printer	Data Latch:
bios:C5D7							      ;	send byte to printer
bios:C5D8		  mov	  al, 3Fh ; '?'
bios:C5DA		  mov	  dx, 3DFh			      ;	CRT / CPU page register	(PCJr only)
bios:C5DD		  out	  dx, al
bios:C5DE		  mov	  si, offset video_6845_init_tbl_d    ;	3D4 / 3D5 values
bios:C5E1		  jmp	  short	loc_FC5E6
bios:C5E3 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C5E3
bios:C5E3 loc_FC5E3:						      ;	CODE XREF: POST_main+126j
bios:C5E3		  mov	  si, offset video_6845_init_tbl_a    ;	alternatvie values for 3D4 / 3D5
bios:C5E6
bios:C5E6 loc_FC5E6:						      ;	CODE XREF: POST_main+139j
bios:C5E6		  mov	  ax, 0B800h
bios:C5E9		  mov	  es, ax			      ;	default: color mode. es	= b800h
bios:C5EB		  assume es:nothing
bios:C5EB		  mov	  dx, 3D4h			      ;	6845 Index Register (Color)
bios:C5EE		  mov	  di, offset ret_address2	      ;	return address
bios:C5F1		  jmp	  init_video
bios:C5F4 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C5F4
bios:C5F4 ret_address2:						      ;	DATA XREF: POST_main+146o
bios:C5F4		  mov	  dx, 3DAh
bios:C5F7
bios:C5F7 wait_retrace_finish:					      ;	CODE XREF: POST_main+152j
bios:C5F7		  in	  al, dx			      ;	Video status bits:
bios:C5F7							      ;	0: retrace.  1=display is in vert or horiz retrace.
bios:C5F7							      ;	1: 1=light pen is triggered; 0=armed
bios:C5F7							      ;	2: 1=light pen switch is open; 0=closed
bios:C5F7							      ;	3: 1=vertical sync pulse is occurring.
bios:C5F8		  test	  al, 8
bios:C5FA		  jnz	  short	wait_retrace_finish
bios:C5FC
bios:C5FC wait_retrace_start:					      ;	CODE XREF: POST_main+157j
bios:C5FC		  in	  al, dx			      ;	Video status bits:
bios:C5FC							      ;	0: retrace.  1=display is in vert or horiz retrace.
bios:C5FC							      ;	1: 1=light pen is triggered; 0=armed
bios:C5FC							      ;	2: 1=light pen switch is open; 0=closed
bios:C5FC							      ;	3: 1=vertical sync pulse is occurring.
bios:C5FD		  test	  al, 8
bios:C5FF		  jz	  short	wait_retrace_start
bios:C601		  mov	  al, 28h ; '('
bios:C603		  mov	  dx, 3D8h
bios:C606		  out	  dx, al
bios:C607		  mov	  ax, ss
bios:C609		  test	  al, 2
bios:C60B		  jz	  short	loc_FC618
bios:C60D		  in	  al, 62h			      ;	0-2: Not used
bios:C60D							      ;	3: Fast	Mode: 0=4.77Mhz, 1=7.16Mhz
bios:C60D							      ;	4: EEPROM data-serial read only
bios:C60D							      ;	5: 1=Timer 2 channel out
bios:C60D							      ;	6: Monochrome mode. 0=Color monitor
bios:C60D							      ;	7: Reserved
bios:C60F		  test	  al, 1000000b
bios:C611		  jz	  short	loc_FC618		      ;	color monitor?
bios:C613		  mov	  ax, 0B000h			      ;	it is monochrome
bios:C616		  mov	  es, ax			      ;	es = b000h
bios:C618		  assume es:nothing
bios:C618
bios:C618 loc_FC618:						      ;	CODE XREF: POST_main+163j
bios:C618							      ;	POST_main+169j
bios:C618		  mov	  ax, 0BBE8h
bios:C61B		  mov	  ds, ax			      ;	ds = bbe8h (tmp	place for vars?)
bios:C61D		  mov	  si, ds:pbbe80.shadow_reset_flag
bios:C621		  mov	  bx, ds:pbbe80.shadow_caps_numlock   ;	save values. memory in bbe8 will get destroyed
bios:C625		  mov	  ax, 0
bios:C628
bios:C628 l0:							      ;	CODE XREF: POST_main+1A8j
bios:C628		  mov	  di, 0
bios:C62B
bios:C62B l1:							      ;	CODE XREF: POST_main+18Cj
bios:C62B		  mov	  [di],	ax			      ;	fill with 0 from bbe8:0000 to bbe8:0180	(until 0xbc000)
bios:C62D		  add	  di, 2
bios:C630		  cmp	  di, 180h
bios:C634		  jb	  short	l1
bios:C636		  mov	  cx, 118h
bios:C639
bios:C639 delay:						      ;	CODE XREF: POST_main:delayj
bios:C639		  loop	  delay
bios:C63B		  mov	  di, 0
bios:C63E
bios:C63E l2:							      ;	CODE XREF: POST_main+1A3j
bios:C63E		  mov	  dx, [di]			      ;	verify that memory is working
bios:C640		  cmp	  ax, dx			      ;	ax == dx == 0
bios:C642		  jnz	  short	video_error
bios:C644		  add	  di, 2
bios:C647		  cmp	  di, 180h
bios:C64B		  jb	  short	l2
bios:C64D		  add	  ax, 5555h
bios:C650		  jnb	  short	l0			      ;	do the test a few times
bios:C652		  mov	  ds:pbbe80.shadow_reset_flag, si
bios:C656		  mov	  ds:pbbe80.shadow_caps_numlock, bx   ;	restore	values
bios:C65A		  jmp	  near ptr POST_test_port_0378
bios:C65D ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C65D
bios:C65D video_error:						      ;	CODE XREF: POST_main+19Aj
bios:C65D		  mov	  ss, ax
bios:C65F		  assume ss:nothing
bios:C65F		  mov	  sp, dx
bios:C661		  mov	  ax, di
bios:C663		  mov	  ds, ax
bios:C665		  assume ds:nothing
bios:C665		  mov	  si, offset aVidAddrBaseBbe	      ;	"Vid Addr:   Base:BBE80h Off:  xxxxh"
bios:C668		  mov	  di, 370h
bios:C66B
bios:C66B print_error_msg:					      ;	CODE XREF: POST_main+1CBj
bios:C66B		  lods	  byte ptr cs:[si]
bios:C66D		  or	  al, al			      ;	asciiz
bios:C66F		  jz	  short	loc_FC675
bios:C671		  stosb
bios:C672		  inc	  di
bios:C673		  jmp	  short	print_error_msg
bios:C675 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C675
bios:C675 loc_FC675:						      ;	CODE XREF: POST_main+1C7j
bios:C675		  sub	  di, 0Ah
bios:C678		  mov	  ax, ds
bios:C67A		  mov	  si, offset loc_FC680
bios:C67D		  jmp	  print_number_in_bcd
bios:C680 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C680
bios:C680 loc_FC680:						      ;	DATA XREF: POST_main+1D2o
bios:C680		  mov	  si, offset aDataErrWritten	      ;	"Data Err: Written: xxxxh Read:	xxxxh"
bios:C683		  mov	  di, 3C0h
bios:C686
bios:C686 loc_FC686:						      ;	CODE XREF: POST_main+1E6j
bios:C686		  lods	  byte ptr cs:[si]
bios:C688		  or	  al, al
bios:C68A		  jz	  short	loc_FC690
bios:C68C		  stosb
bios:C68D		  inc	  di
bios:C68E		  jmp	  short	loc_FC686
bios:C690 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C690
bios:C690 loc_FC690:						      ;	CODE XREF: POST_main+1E2j
bios:C690		  sub	  di, 22h ; '"'
bios:C693		  mov	  ax, ss
bios:C695		  mov	  si, offset loc_FC69B		      ;	return address
bios:C698		  jmp	  print_number_in_bcd
bios:C69B ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C69B
bios:C69B loc_FC69B:						      ;	DATA XREF: POST_main+1EDo
bios:C69B		  add	  di, 10h
bios:C69E		  mov	  ax, sp
bios:C6A0		  mov	  si, offset ret_address3	      ;	return address
bios:C6A3		  jmp	  print_number_in_bcd
bios:C6A6 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C6A6
bios:C6A6 ret_address3:						      ;	CODE XREF: POST_main:ret_address3j
bios:C6A6							      ;	DATA XREF: POST_main+1F8o
bios:C6A6		  jmp	  short	ret_address3		      ;	infinite loop
bios:C6A6 POST_main	  endp
bios:C6A6
bios:C6A6 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C6A8 aVidAddrBaseBbe db 'Vid Addr:   Base:BBE80h Off:  xxxxh',0  ; DATA XREF: POST_main+1BDo
bios:C6CC aDataErrWritten db 'Data Err: Written: xxxxh Read: xxxxh',0 ; DATA XREF: POST_main:loc_FC680o
bios:C6F1
bios:C6F1 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:C6F1
bios:C6F1
bios:C6F1 POST_test_port_0378 proc far				      ;	CODE XREF: POST_main+1B2j
bios:C6F1		  mov	  ax, 0BBE8h
bios:C6F4		  mov	  ds, ax			      ;	ds = bbe8
bios:C6F6		  assume ds:nothing
bios:C6F6		  mov	  ax, ss
bios:C6F8		  mov	  ds:pbbe80.tmp_reg6_byte, al
bios:C6FB		  mov	  word ptr ds:pbbe80.tmp_es, es
bios:C6FF		  mov	  ax, 0BBF0h			      ;	use video memory as stack segment
bios:C702		  mov	  ss, ax			      ;	ss = bbf0
bios:C704		  assume ss:nothing
bios:C704		  mov	  sp, 0FEh ; 'ş'                      ; stack: bbf0:00fe
bios:C707		  mov	  dx, 378h
bios:C70A		  in	  al, dx			      ;	Printer	Data Latch:
bios:C70A							      ;	fetch last byte	sent
bios:C70B		  sub	  al, 2
bios:C70D		  and	  al, 0F3h
bios:C70F		  mov	  ds:pbbe80.tmp_reg5_byte, al
bios:C712		  mov	  dx, 378h
bios:C715		  mov	  al, 55h ; 'U'                       ; send char 55h
bios:C717		  out	  dx, al			      ;	Printer	Data Latch:
bios:C717							      ;	send byte to printer
bios:C718		  jmp	  short	$+2
bios:C71A		  in	  al, dx			      ;	Printer	Data Latch:
bios:C71A							      ;	fetch last byte	sent
bios:C71B		  cmp	  al, 55h ; 'U'                       ; make sure last byte sent was 55h
bios:C71D		  jz	  short	near ptr POST_test_pic_8253
bios:C71F		  mov	  si, offset aErrIOOfPort378	      ;	"Err I/O of port 378h"
bios:C722		  mov	  di, 3C0h			      ;	screen offset
bios:C725		  call	  print_asciiz
bios:C728
bios:C728 infinite_loop:					      ;	CODE XREF: POST_test_port_0378:infinite_loopj
bios:C728		  jmp	  short	infinite_loop
bios:C728 POST_test_port_0378 endp
bios:C728
bios:C728 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C72A aErrIOOfPort378 db 'Err I/O of port 378h',0                 ; DATA XREF: POST_test_port_0378+2Eo
bios:C73F
bios:C73F ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:C73F
bios:C73F
bios:C73F POST_test_pic_8253 proc far				      ;	CODE XREF: POST_test_port_0378+2Cj
bios:C73F		  xor	  al, al
bios:C741		  out	  81h, al			      ;	DMA page register 74LS612:
bios:C741							      ;	Channel	2 (diskette DMA)  (address bits	16-23)
bios:C743		  out	  82h, al			      ;	DMA page register 74LS612:
bios:C743							      ;	Channel	3 (hard	disk DMA) (address bits	16-23)
bios:C745		  out	  83h, al			      ;	DMA page register 74LS612:
bios:C745							      ;	Channel	1 (address bits	16-23)
bios:C747		  out	  0Dh, al			      ;	DMA controller,	8237A-5.
bios:C747							      ;	master clear.
bios:C747							      ;	Any OUT	clears the ctrlr (must be re-initialized)
bios:C749		  mov	  cx, 2
bios:C74C
bios:C74C loc_FC74C:						      ;	CODE XREF: POST_test_pic_8253:loc_FC74Cj
bios:C74C		  loop	  loc_FC74C
bios:C74E		  mov	  al, 4
bios:C750		  out	  8, al				      ;	DMA 8237A-5. cmd reg bits:
bios:C750							      ;	0: enable mem-to-mem DMA
bios:C750							      ;	1: enable Ch0 address hold
bios:C750							      ;	2: disable controller
bios:C750							      ;	3: compressed timing mode
bios:C750							      ;	4: enable rotating priority
bios:C750							      ;	5: extended write mode;	0=late write
bios:C750							      ;	6: DRQ sensing - active	high
bios:C750							      ;	7: DACK	sensing	- active high
bios:C752		  mov	  dx, 0
bios:C755		  mov	  ah, 0
bios:C757		  mov	  cx, 1
bios:C75A
bios:C75A loc_FC75A:						      ;	CODE XREF: POST_test_pic_8253+2Ej
bios:C75A		  mov	  al, cl
bios:C75C		  out	  dx, al
bios:C75D		  mov	  al, ah
bios:C75F		  out	  dx, al
bios:C760		  nop
bios:C761		  in	  al, dx
bios:C762		  cmp	  al, cl
bios:C764		  jnz	  short	loc_FC797
bios:C766		  in	  al, dx
bios:C767		  cmp	  al, 0
bios:C769		  jnz	  short	loc_FC797
bios:C76B		  rcl	  cl, 1
bios:C76D		  jnb	  short	loc_FC75A
bios:C76F		  mov	  dx, 0
bios:C772		  xor	  al, al
bios:C774
bios:C774 loc_FC774:						      ;	CODE XREF: POST_test_pic_8253+3Bj
bios:C774		  out	  dx, al
bios:C775		  out	  dx, al
bios:C776		  inc	  dx
bios:C777		  cmp	  dx, 8
bios:C77A		  jnz	  short	loc_FC774
bios:C77C		  mov	  dx, 0Bh
bios:C77F		  mov	  al, 58h ; 'X'
bios:C781		  out	  dx, al			      ;	DMA 8237A-5. mode register bits:
bios:C781							      ;	0-1: channel (00=0; 01=1; 10=2;	11=3)
bios:C781							      ;	2-3: transfer type (00=verify=Nop; 01=write; 10=read)
bios:C781							      ;	4: 1=enable auto-initialization
bios:C781							      ;	5: 1=address increment;	0=address decrement
bios:C781							      ;	6-7: 00=demand mode; 01=single;	10=block; 11=cascade
bios:C782		  mov	  al, 49h ; 'I'
bios:C784		  out	  dx, al			      ;	DMA 8237A-5. mode register bits:
bios:C784							      ;	0-1: channel (00=0; 01=1; 10=2;	11=3)
bios:C784							      ;	2-3: transfer type (00=verify=Nop; 01=write; 10=read)
bios:C784							      ;	4: 1=enable auto-initialization
bios:C784							      ;	5: 1=address increment;	0=address decrement
bios:C784							      ;	6-7: 00=demand mode; 01=single;	10=block; 11=cascade
bios:C785		  mov	  al, 4Ah ; 'J'
bios:C787		  out	  dx, al			      ;	DMA 8237A-5. mode register bits:
bios:C787							      ;	0-1: channel (00=0; 01=1; 10=2;	11=3)
bios:C787							      ;	2-3: transfer type (00=verify=Nop; 01=write; 10=read)
bios:C787							      ;	4: 1=enable auto-initialization
bios:C787							      ;	5: 1=address increment;	0=address decrement
bios:C787							      ;	6-7: 00=demand mode; 01=single;	10=block; 11=cascade
bios:C788		  mov	  al, 4Bh ; 'K'
bios:C78A		  out	  dx, al			      ;	DMA 8237A-5. mode register bits:
bios:C78A							      ;	0-1: channel (00=0; 01=1; 10=2;	11=3)
bios:C78A							      ;	2-3: transfer type (00=verify=Nop; 01=write; 10=read)
bios:C78A							      ;	4: 1=enable auto-initialization
bios:C78A							      ;	5: 1=address increment;	0=address decrement
bios:C78A							      ;	6-7: 00=demand mode; 01=single;	10=block; 11=cascade
bios:C78B		  mov	  al, 0Eh
bios:C78D		  out	  0Fh, al			      ;	DMA controller,	8237A-5.
bios:C78D							      ;	master clear. Clear or mask any	or
bios:C78D							      ;	all of the channels. Bits:
bios:C78D							      ;	0: 1=mask channel 0; 0=enable
bios:C78D							      ;	1: 1=mask channel 1;
bios:C78D							      ;	2: 1=mask channel 2;
bios:C78D							      ;	3: 1=mask channel 3;
bios:C78F		  mov	  al, 0FFh
bios:C791		  out	  1, al				      ;	DMA controller,	8237A-5.
bios:C791							      ;	channel	0 base address and word	count
bios:C793		  mov	  al, 0
bios:C795		  out	  8, al				      ;	DMA 8237A-5. cmd reg bits:
bios:C795							      ;	0: enable mem-to-mem DMA
bios:C795							      ;	1: enable Ch0 address hold
bios:C795							      ;	2: disable controller
bios:C795							      ;	3: compressed timing mode
bios:C795							      ;	4: enable rotating priority
bios:C795							      ;	5: extended write mode;	0=late write
bios:C795							      ;	6: DRQ sensing - active	high
bios:C795							      ;	7: DACK	sensing	- active high
bios:C797
bios:C797 loc_FC797:						      ;	CODE XREF: POST_test_pic_8253+25j
bios:C797							      ;	POST_test_pic_8253+2Aj
bios:C797		  mov	  ch, 0
bios:C799
bios:C799 loc_FC799:						      ;	CODE XREF: POST_test_pic_8253+8Aj
bios:C799							      ;	POST_test_pic_8253+99j
bios:C799		  mov	  al, 10h
bios:C79B		  out	  61h, al			      ;	PC/XT PPI port B bits:
bios:C79B							      ;	0: Tmr 2 gate ÍËÍ OR 03H=spkr ON
bios:C79B							      ;	1: Tmr 2 data Í¼  AND 0fcH=spkr	OFF
bios:C79B							      ;	3: 1=read high switches
bios:C79B							      ;	4: 0=enable RAM	parity checking
bios:C79B							      ;	5: 0=enable I/O	channel	check
bios:C79B							      ;	6: 0=hold keyboard clock low
bios:C79B							      ;	7: 0=enable kbrd
bios:C79D		  mov	  cl, 1
bios:C79F
bios:C79F loc_FC79F:						      ;	CODE XREF: POST_test_pic_8253+85j
bios:C79F		  mov	  al, 0B0h ; '°'
bios:C7A1		  out	  43h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:C7A3		  mov	  al, 0FFh
bios:C7A5		  out	  42h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:C7A7		  mov	  al, cl
bios:C7A9		  out	  42h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:C7AB		  mov	  al, 80h ; '€'
bios:C7AD		  out	  43h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:C7AF		  mov	  al, 0B0h ; '°'
bios:C7B1		  out	  43h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:C7B3		  in	  al, 42h			      ;	Timer 8253-5 (AT: 8254.2).
bios:C7B5		  jmp	  short	$+2
bios:C7B7		  in	  al, 42h			      ;	Timer 8253-5 (AT: 8254.2).
bios:C7B9		  cmp	  ch, 1
bios:C7BC		  jz	  short	loc_FC7C2
bios:C7BE		  cmp	  al, cl
bios:C7C0		  jnz	  short	loc_FC7CD
bios:C7C2
bios:C7C2 loc_FC7C2:						      ;	CODE XREF: POST_test_pic_8253+7Dj
bios:C7C2		  rcl	  cl, 1
bios:C7C4		  jnb	  short	loc_FC79F
bios:C7C6		  cmp	  ch, 1
bios:C7C9		  jz	  short	loc_FC799
bios:C7CB		  jmp	  short	loc_FC7EA
bios:C7CD ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C7CD
bios:C7CD loc_FC7CD:						      ;	CODE XREF: POST_test_pic_8253+81j
bios:C7CD		  mov	  si, offset aErrIOOf8253	      ;	"Err I/O of 8253"
bios:C7D0		  mov	  di, 3C0h
bios:C7D3		  call	  print_asciiz
bios:C7D6		  mov	  ch, 1
bios:C7D8		  jmp	  short	loc_FC799
bios:C7D8 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C7DA aErrIOOf8253	  db 'Err I/O of 8253',0                      ; DATA XREF: POST_test_pic_8253:loc_FC7CDo
bios:C7EA ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C7EA
bios:C7EA loc_FC7EA:						      ;	CODE XREF: POST_test_pic_8253+8Cj
bios:C7EA		  mov	  al, 74h ; 't'
bios:C7EC		  out	  43h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:C7EE		  mov	  al, 12h
bios:C7F0		  out	  41h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:C7F2		  mov	  al, 0
bios:C7F4		  out	  41h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:C7F6		  mov	  cx, 32h ; '2'
bios:C7F9
bios:C7F9 loc_FC7F9:						      ;	CODE XREF: POST_test_pic_8253:loc_FC7F9j
bios:C7F9		  loop	  loc_FC7F9
bios:C7FB		  mov	  al, 30h ; '0'
bios:C7FD		  out	  43h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:C7FF		  mov	  al, 0
bios:C801		  out	  40h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:C803		  jmp	  short	$+2
bios:C805		  out	  40h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:C807		  mov	  al, 0B0h ; '°'
bios:C809		  out	  43h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:C80B		  mov	  al, 0
bios:C80D		  out	  42h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:C80F		  jmp	  short	$+2
bios:C811		  out	  42h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:C813		  mov	  ax, 0
bios:C816		  mov	  es, ax			      ;	es = 0
bios:C818		  assume es:nothing
bios:C818		  xor	  si, si
bios:C81A
bios:C81A loc_FC81A:						      ;	CODE XREF: POST_test_pic_8253+10Aj
bios:C81A		  mov	  ax, es:[si]
bios:C81D		  not	  ax
bios:C81F		  mov	  es:[si], ax			      ;	[es:0000] = ! [es:0000]	???
bios:C822		  mov	  cx, 118h
bios:C825
bios:C825 loc_FC825:						      ;	CODE XREF: POST_test_pic_8253:loc_FC825j
bios:C825		  loop	  loc_FC825			      ;	delay
bios:C827		  cmp	  ax, es:[si]
bios:C82A		  jnz	  short	loc_FC84B
bios:C82C		  not	  ax
bios:C82E		  mov	  es:[si], ax			      ;	[es:0000] = ! [es:0000]
bios:C831		  mov	  cx, 118h
bios:C834
bios:C834 loc_FC834:						      ;	CODE XREF: POST_test_pic_8253:loc_FC834j
bios:C834		  loop	  loc_FC834			      ;	delay
bios:C836		  cmp	  ax, es:[si]
bios:C839		  jnz	  short	loc_FC84B
bios:C83B
bios:C83B loc_FC83B:						      ;	CODE XREF: POST_test_pic_8253+122j
bios:C83B		  mov	  bx, es
bios:C83D		  add	  bx, 1000h			      ;	es += 1000h (+64k)
bios:C841		  mov	  es, bx
bios:C843		  assume es:nothing
bios:C843		  cmp	  bx, 6000h
bios:C847		  jz	  short	loc_FC863
bios:C849		  jmp	  short	loc_FC81A
bios:C84B ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C84B
bios:C84B loc_FC84B:						      ;	CODE XREF: POST_test_pic_8253+EBj
bios:C84B							      ;	POST_test_pic_8253+FAj
bios:C84B		  xor	  ax, es:[si]
bios:C84E		  mov	  bl, 0
bios:C850		  mov	  cx, 11h
bios:C853
bios:C853 loc_FC853:						      ;	CODE XREF: POST_test_pic_8253+119j
bios:C853							      ;	POST_test_pic_8253+11Dj
bios:C853		  dec	  cx
bios:C854		  jcxz	  short	loc_FC85E
bios:C856		  rcl	  ax, 1
bios:C858		  jnb	  short	loc_FC853
bios:C85A		  inc	  bl
bios:C85C		  jmp	  short	loc_FC853
bios:C85E ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C85E
bios:C85E loc_FC85E:						      ;	CODE XREF: POST_test_pic_8253+115j
bios:C85E		  cmp	  bl, 0
bios:C861		  jb	  short	loc_FC83B
bios:C863
bios:C863 loc_FC863:						      ;	CODE XREF: POST_test_pic_8253+108j
bios:C863		  mov	  dx, es
bios:C865		  mov	  bl, dh
bios:C867		  mov	  al, dh
bios:C869		  mov	  cl, 4
bios:C86B		  shr	  al, cl
bios:C86D		  mov	  cl, al
bios:C86F		  add	  al, ds:pbbe80.tmp_reg5_byte
bios:C873		  mov	  bh, al
bios:C875		  mov	  ds:pbbe80, dx
bios:C879		  mov	  ds:pbbe80.tmp_reg5_byte, cl
bios:C87D		  xor	  si, si
bios:C87F		  xor	  di, di
bios:C881		  mov	  ax, 7C00h
bios:C884		  mov	  es, ax			      ;	es = 7c00h (dst)
bios:C886		  assume es:nothing
bios:C886		  mov	  ax, 9C00h
bios:C889		  mov	  ds, ax			      ;	ds = 9c00h (src)
bios:C88B		  assume ds:nothing
bios:C88B		  mov	  cx, 4000h
bios:C88E		  rep movsb				      ;	copy 4k	from 9c00:0000h	to 7c00:0000h
bios:C890		  mov	  ax, 0BBE8h
bios:C893		  mov	  ds, ax			      ;	ds = bbe8h (restore value)
bios:C895		  assume ds:nothing
bios:C895		  or	  bl, bl
bios:C897		  jz	  short	loc_FC89E
bios:C899		  cmp	  bl, 40h ; '@'
bios:C89C		  jnz	  short	loc_FC8A2
bios:C89E
bios:C89E loc_FC89E:						      ;	CODE XREF: POST_test_pic_8253+158j
bios:C89E		  mov	  al, 28h ; '('
bios:C8A0		  jmp	  short	loc_FC8A4
bios:C8A2 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C8A2
bios:C8A2 loc_FC8A2:						      ;	CODE XREF: POST_test_pic_8253+15Dj
bios:C8A2		  mov	  al, 0
bios:C8A4
bios:C8A4 loc_FC8A4:						      ;	CODE XREF: POST_test_pic_8253+161j
bios:C8A4		  mov	  dx, 3DDh			      ;	Extended RAM register
bios:C8A7		  out	  dx, al
bios:C8A8		  mov	  al, bh
bios:C8AA		  out	  0A0h,	al			      ;	PIC 2  same as 0020 for	PIC 1
bios:C8AC		  mov	  es, word ptr ds:pbbe80.tmp_es
bios:C8B0		  assume es:nothing
bios:C8B0		  mov	  si, offset aMemorySizeK	      ;	"Memory	Size =	  k"
bios:C8B3		  mov	  di, 4
bios:C8B6		  call	  print_asciiz
bios:C8B9		  mov	  al, ds:pbbe80.tmp_reg5_byte
bios:C8BC		  mov	  cx, 3
bios:C8BF		  mul	  cl
bios:C8C1		  xor	  ah, ah
bios:C8C3		  mov	  si, ax
bios:C8C5		  mov	  bx, offset aMemoryValues
bios:C8C8		  mov	  di, 20h ; ' '
bios:C8CB
bios:C8CB loc_FC8CB:						      ;	CODE XREF: POST_test_pic_8253+192j
bios:C8CB		  mov	  al, cs:[bx+si]
bios:C8CE		  stosb					      ;	print memory value to screen
bios:C8CF		  inc	  di
bios:C8D0		  inc	  si
bios:C8D1		  loop	  loc_FC8CB
bios:C8D3		  jmp	  short	near ptr POST_test_port_61_kbd
bios:C8D3 POST_test_pic_8253 endp
bios:C8D3
bios:C8D3 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C8D5 aMemorySizeK	  db 'Memory Size =    k',0                   ; DATA XREF: POST_test_pic_8253+171o
bios:C8E8 aMemoryValues	  db  32h, 35h,	36h, 33h, 32h, 30h, 33h, 38h,3 dup( 34h), 38h, 35h, 31h, 32h, 35h, 37h
bios:C8E8							      ;	DATA XREF: POST_test_pic_8253+186o
bios:C8E8		  db 2 dup( 36h), 34h, 30h
bios:C8FD
bios:C8FD ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:C8FD
bios:C8FD
bios:C8FD POST_test_port_61_kbd	proc far			      ;	CODE XREF: POST_test_pic_8253+194j
bios:C8FD							      ;	POST_test_port_61_kbd+1Cj
bios:C8FD		  mov	  cl, 1
bios:C8FF
bios:C8FF loc_FC8FF:						      ;	CODE XREF: POST_test_port_61_kbd+Fj
bios:C8FF		  mov	  al, cl
bios:C901		  out	  61h, al			      ;	PC/XT PPI port B bits:
bios:C901							      ;	0: Tmr 2 gate ÍËÍ OR 03H=spkr ON
bios:C901							      ;	1: Tmr 2 data Í¼  AND 0fcH=spkr	OFF
bios:C901							      ;	3: 1=read high switches
bios:C901							      ;	4: 0=enable RAM	parity checking
bios:C901							      ;	5: 0=enable I/O	channel	check
bios:C901							      ;	6: 0=hold keyboard clock low
bios:C901							      ;	7: 0=enable kbrd
bios:C903		  nop
bios:C904		  in	  al, 61h			      ;	PC/XT PPI port B bits:
bios:C904							      ;	0: Tmr 2 gate ÍËÍ OR 03H=spkr ON
bios:C904							      ;	1: Tmr 2 data Í¼  AND 0fcH=spkr	OFF
bios:C904							      ;	3: 1=read high switches
bios:C904							      ;	4: 0=enable RAM	parity checking
bios:C904							      ;	5: 0=enable I/O	channel	check
bios:C904							      ;	6: 0=hold keyboard clock low
bios:C904							      ;	7: 0=enable kbrd
bios:C906		  cmp	  al, cl
bios:C908		  jnz	  short	loc_FC910
bios:C90A		  rcl	  cl, 1
bios:C90C		  jnb	  short	loc_FC8FF
bios:C90E		  jmp	  short	near ptr POST_test_8259
bios:C910 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C910
bios:C910 loc_FC910:						      ;	CODE XREF: POST_test_port_61_kbd+Bj
bios:C910		  mov	  si, offset aErrIOFromKbdPo	      ;	"Err I/O from kbd port 61h"
bios:C913		  mov	  di, 3C0h
bios:C916		  call	  print_asciiz
bios:C919		  jmp	  short	near ptr POST_test_port_61_kbd
bios:C919 POST_test_port_61_kbd	endp
bios:C919
bios:C919 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C91B aErrIOFromKbdPo db 'Err I/O from kbd port 61h',0            ; DATA XREF: POST_test_port_61_kbd:loc_FC910o
bios:C935
bios:C935 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:C935
bios:C935
bios:C935 POST_test_8259  proc far				      ;	CODE XREF: POST_test_port_61_kbd+11j
bios:C935		  mov	  al, 0C0h ; 'À'
bios:C937		  out	  61h, al			      ;	PC/XT PPI port B bits:
bios:C937							      ;	0: Tmr 2 gate ÍËÍ OR 03H=spkr ON
bios:C937							      ;	1: Tmr 2 data Í¼  AND 0fcH=spkr	OFF
bios:C937							      ;	3: 1=read high switches
bios:C937							      ;	4: 0=enable RAM	parity checking
bios:C937							      ;	5: 0=enable I/O	channel	check
bios:C937							      ;	6: 0=hold keyboard clock low
bios:C937							      ;	7: 0=enable kbrd
bios:C939		  mov	  al, 40h ; '@'
bios:C93B		  out	  61h, al			      ;	PC/XT PPI port B bits:
bios:C93B							      ;	0: Tmr 2 gate ÍËÍ OR 03H=spkr ON
bios:C93B							      ;	1: Tmr 2 data Í¼  AND 0fcH=spkr	OFF
bios:C93B							      ;	3: 1=read high switches
bios:C93B							      ;	4: 0=enable RAM	parity checking
bios:C93B							      ;	5: 0=enable I/O	channel	check
bios:C93B							      ;	6: 0=hold keyboard clock low
bios:C93B							      ;	7: 0=enable kbrd
bios:C93D		  mov	  al, 13h
bios:C93F		  out	  20h, al			      ;	Interrupt controller, 8259A.
bios:C941		  mov	  al, 8
bios:C943		  mov	  dx, 21h ; '!'
bios:C946		  out	  dx, al			      ;	Interrupt controller, 8259A.
bios:C947		  mov	  al, 1
bios:C949		  out	  dx, al			      ;	Interrupt controller, 8259A.
bios:C94A		  mov	  al, 0FFh
bios:C94C		  out	  dx, al			      ;	Interrupt controller, 8259A.
bios:C94D		  mov	  cl, al
bios:C94F		  mov	  al, 40h ; '@'
bios:C951		  out	  20h, al			      ;	Interrupt controller, 8259A.
bios:C953		  in	  al, dx			      ;	Interrupt controller, 8259A.
bios:C954		  cmp	  al, cl
bios:C956		  jnz	  short	loc_FC97B
bios:C958		  mov	  cl, 1
bios:C95A
bios:C95A loc_FC95A:						      ;	CODE XREF: POST_test_8259+2Fj
bios:C95A		  mov	  al, cl
bios:C95C		  out	  dx, al			      ;	Interrupt controller, 8259A.
bios:C95D		  in	  al, dx			      ;	Interrupt controller, 8259A.
bios:C95E		  cmp	  al, cl
bios:C960		  jnz	  short	loc_FC97B
bios:C962		  rcl	  cl, 1
bios:C964		  jnb	  short	loc_FC95A
bios:C966		  mov	  al, 0FDh ; 'ı'
bios:C968		  out	  dx, al			      ;	Interrupt controller, 8259A.
bios:C969		  mov	  cl, al
bios:C96B		  in	  al, dx			      ;	Interrupt controller, 8259A.
bios:C96C		  cmp	  al, cl
bios:C96E		  jnz	  short	loc_FC97B
bios:C970		  mov	  cx, 8
bios:C973
bios:C973 loc_FC973:						      ;	CODE XREF: POST_test_8259+42j
bios:C973		  mov	  al, 20h ; ' '
bios:C975		  out	  20h, al			      ;	Interrupt controller, 8259A.
bios:C977		  loop	  loc_FC973
bios:C979		  jmp	  short	loc_FC998
bios:C97B ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C97B
bios:C97B loc_FC97B:						      ;	CODE XREF: POST_test_8259+21j
bios:C97B							      ;	POST_test_8259+2Bj ...
bios:C97B		  mov	  si, offset aErrIOOf8259	      ;	"Err I/O of 8259"
bios:C97E		  mov	  di, 3C0h
bios:C981		  call	  print_asciiz
bios:C984
bios:C984 loc_FC984:						      ;	CODE XREF: POST_test_8259:loc_FC984j
bios:C984		  jmp	  short	loc_FC984
bios:C984 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C986 aErrIOOf8259	  db 'Err I/O of 8259',0                      ; DATA XREF: POST_test_8259:loc_FC97Bo
bios:C996		  db 0EBh ; ë
bios:C997		  db 0FEh ; ş
bios:C998 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C998
bios:C998 loc_FC998:						      ;	CODE XREF: POST_test_8259+44j
bios:C998		  mov	  al, 0
bios:C99A		  out	  67h, al			      ;	port 67h ???
bios:C99C		  mov	  cx, 11h
bios:C99F
bios:C99F loc_FC99F:						      ;	CODE XREF: POST_test_8259+7Fj
bios:C99F		  xchg	  bx, cx
bios:C9A1		  mov	  al, 0C0h ; 'À'
bios:C9A3		  out	  61h, al			      ;	PC/XT PPI port B bits:
bios:C9A3							      ;	0: Tmr 2 gate ÍËÍ OR 03H=spkr ON
bios:C9A3							      ;	1: Tmr 2 data Í¼  AND 0fcH=spkr	OFF
bios:C9A3							      ;	3: 1=read high switches
bios:C9A3							      ;	4: 0=enable RAM	parity checking
bios:C9A3							      ;	5: 0=enable I/O	channel	check
bios:C9A3							      ;	6: 0=hold keyboard clock low
bios:C9A3							      ;	7: 0=enable kbrd
bios:C9A5		  mov	  al, 20h ; ' '
bios:C9A7		  out	  20h, al			      ;	Interrupt controller, 8259A.
bios:C9A9		  mov	  al, 40h ; '@'
bios:C9AB		  out	  61h, al			      ;	PC/XT PPI port B bits:
bios:C9AB							      ;	0: Tmr 2 gate ÍËÍ OR 03H=spkr ON
bios:C9AB							      ;	1: Tmr 2 data Í¼  AND 0fcH=spkr	OFF
bios:C9AB							      ;	3: 1=read high switches
bios:C9AB							      ;	4: 0=enable RAM	parity checking
bios:C9AB							      ;	5: 0=enable I/O	channel	check
bios:C9AB							      ;	6: 0=hold keyboard clock low
bios:C9AB							      ;	7: 0=enable kbrd
bios:C9AD		  mov	  cx, 0A9h ; '©'
bios:C9B0
bios:C9B0 loc_FC9B0:						      ;	CODE XREF: POST_test_8259:loc_FC9B0j
bios:C9B0		  loop	  loc_FC9B0
bios:C9B2		  xchg	  bx, cx
bios:C9B4		  loop	  loc_FC99F
bios:C9B6		  mov	  ax, 1
bios:C9B9		  mov	  ds:pbbe80.tmp_reg3, ax
bios:C9BC		  xor	  ax, ax
bios:C9BE		  mov	  ds:pbbe80.tmp_reg2, ax
bios:C9C1		  mov	  ax, 7000h			      ;	int 15h, ah=70h. Read from EEPROM
bios:C9C4		  mov	  bl, 1
bios:C9C6		  pushf
bios:C9C7		  push	  cs
bios:C9C8		  mov	  dx, offset loc_FC9CF
bios:C9CB		  push	  dx
bios:C9CC		  jmp	  int_15_handler_bis
bios:C9CF ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C9CF
bios:C9CF loc_FC9CF:						      ;	DATA XREF: POST_test_8259+93o
bios:C9CF		  test	  dl, 20h
bios:C9D2		  jnz	  short	test_memory_ram
bios:C9D4		  cmp	  word ptr ds:pbbe80.shadow_reset_flag,	4321h ;	preserve memory	?
bios:C9DA		  jz	  short	test_memory_ram
bios:C9DC		  jmp	  clean_memory_ram
bios:C9DF ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:C9DF
bios:C9DF test_memory_ram:					      ;	CODE XREF: POST_test_8259+9Dj
bios:C9DF							      ;	POST_test_8259+A5j
bios:C9DF		  mov	  cx, 5A5Ah
bios:C9E2		  mov	  bp, 0
bios:C9E5
bios:C9E5 loc_FC9E5:						      ;	CODE XREF: POST_test_8259+DBj
bios:C9E5							      ;	POST_test_8259+ECj
bios:C9E5		  mov	  bx, 0FFFEh
bios:C9E8
bios:C9E8 loc_FC9E8:						      ;	CODE XREF: POST_test_8259+F1j
bios:C9E8		  mov	  es, bp			      ;	es = 0
bios:C9EA		  mov	  si, 0FFFEh
bios:C9ED
bios:C9ED l0:							      ;	CODE XREF: POST_test_8259+C5j
bios:C9ED		  mov	  ax, bx
bios:C9EF		  xor	  ax, cx
bios:C9F1		  xor	  ax, bp
bios:C9F3		  mov	  es:[bx], ax			      ;	fill chunk of 64k RAM with garbage
bios:C9F6		  dec	  bx
bios:C9F7		  dec	  bx
bios:C9F8		  cmp	  bx, si
bios:C9FA		  jnz	  short	l0
bios:C9FC		  add	  bp, 1000h
bios:CA00		  test	  byte ptr ds:pbbe80.tmp_reg6_byte, 1
bios:CA05		  jz	  short	loc_FCA14
bios:CA07		  mov	  bx, 4000h
bios:CA0A		  add	  bx, ds:pbbe80
bios:CA0E		  cmp	  bx, bp
bios:CA10		  jnz	  short	loc_FC9E5
bios:CA12		  jmp	  short	loc_FCA28
bios:CA14 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CA14
bios:CA14 loc_FCA14:						      ;	CODE XREF: POST_test_8259+D0j
bios:CA14		  mov	  bx, 3000h
bios:CA17		  add	  bx, ds:pbbe80
bios:CA1B		  cmp	  bx, bp
bios:CA1D		  jz	  short	loc_FCA23
bios:CA1F		  jb	  short	loc_FCA28
bios:CA21		  jmp	  short	loc_FC9E5
bios:CA23 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CA23
bios:CA23 loc_FCA23:						      ;	CODE XREF: POST_test_8259+E8j
bios:CA23		  mov	  bx, 0BFFEh
bios:CA26		  jmp	  short	loc_FC9E8
bios:CA28 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CA28
bios:CA28 loc_FCA28:						      ;	CODE XREF: POST_test_8259+DDj
bios:CA28							      ;	POST_test_8259+EAj
bios:CA28		  mov	  bp, 0
bios:CA2B
bios:CA2B loc_FCA2B:						      ;	CODE XREF: POST_test_8259+128j
bios:CA2B							      ;	POST_test_8259+139j
bios:CA2B		  mov	  bx, 0FFFEh
bios:CA2E
bios:CA2E loc_FCA2E:						      ;	CODE XREF: POST_test_8259+112j
bios:CA2E							      ;	POST_test_8259+13Ej
bios:CA2E		  mov	  es, bp
bios:CA30		  mov	  ax, bx
bios:CA32		  xor	  ax, cx
bios:CA34		  xor	  ax, bp
bios:CA36		  mov	  si, ax
bios:CA38		  mov	  di, es:[bx]
bios:CA3B		  cmp	  si, di
bios:CA3D		  jz	  short	loc_FCA42
bios:CA3F		  call	  print_memory_error
bios:CA42
bios:CA42 loc_FCA42:						      ;	CODE XREF: POST_test_8259+108j
bios:CA42		  dec	  bx
bios:CA43		  dec	  bx
bios:CA44		  cmp	  bx, 0FFFEh
bios:CA47		  jnz	  short	loc_FCA2E
bios:CA49		  add	  bp, 1000h
bios:CA4D		  test	  byte ptr ds:0Fh, 1
bios:CA52		  jz	  short	loc_FCA61
bios:CA54		  mov	  bx, 4000h
bios:CA57		  add	  bx, ds:0
bios:CA5B		  cmp	  bx, bp
bios:CA5D		  jnz	  short	loc_FCA2B
bios:CA5F		  jmp	  short	clean_memory_ram
bios:CA61 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CA61
bios:CA61 loc_FCA61:						      ;	CODE XREF: POST_test_8259+11Dj
bios:CA61		  mov	  bx, 3000h
bios:CA64		  add	  bx, ds:0
bios:CA68		  cmp	  bx, bp
bios:CA6A		  jz	  short	loc_FCA70
bios:CA6C		  jb	  short	clean_memory_ram
bios:CA6E		  jmp	  short	loc_FCA2B
bios:CA70 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CA70
bios:CA70 loc_FCA70:						      ;	CODE XREF: POST_test_8259+135j
bios:CA70		  mov	  bx, 0BFFEh
bios:CA73		  jmp	  short	loc_FCA2E
bios:CA75 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CA75
bios:CA75 clean_memory_ram:					      ;	CODE XREF: POST_test_8259+A7j
bios:CA75							      ;	POST_test_8259+12Aj ...
bios:CA75		  mov	  bp, ds:pbbe80
bios:CA79		  mov	  bx, 3000h
bios:CA7C		  add	  bp, bx
bios:CA7E		  xor	  ax, ax
bios:CA80		  mov	  es, ax			      ;	es = 0
bios:CA82
bios:CA82 loc_FCA82:						      ;	CODE XREF: POST_test_8259+163j
bios:CA82		  mov	  cx, 8000h
bios:CA85
bios:CA85 loc_FCA85:						      ;	CODE XREF: POST_test_8259:loc_FCAA7j
bios:CA85		  xor	  ax, ax
bios:CA87		  mov	  di, ax			      ;	di = 0
bios:CA89		  rep stosw				      ;	fill chunk of 64k RAM with 0
bios:CA8B		  mov	  ax, es
bios:CA8D		  add	  ax, 1000h			      ;	next 64k
bios:CA90		  cmp	  ax, bp			      ;	already	filled 192k?
bios:CA92		  mov	  es, ax
bios:CA94		  assume es:nothing
bios:CA94		  jz	  short	loc_FCA9A
bios:CA96		  jnb	  short	loc_FCAA9
bios:CA98		  jmp	  short	loc_FCA82
bios:CA9A ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CA9A
bios:CA9A loc_FCA9A:						      ;	CODE XREF: POST_test_8259+15Fj
bios:CA9A		  mov	  cx, 5FFFh
bios:CA9D		  test	  byte ptr ds:0Fh, 1
bios:CAA2		  jz	  short	loc_FCAA7
bios:CAA4		  mov	  cx, 7F3Fh
bios:CAA7
bios:CAA7 loc_FCAA7:						      ;	CODE XREF: POST_test_8259+16Dj
bios:CAA7		  jmp	  short	loc_FCA85
bios:CAA9 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CAA9
bios:CAA9 loc_FCAA9:						      ;	CODE XREF: POST_test_8259+161j
bios:CAA9		  mov	  ax, ds:4
bios:CAAC		  cmp	  ax, 1
bios:CAAF		  jnz	  short	infinite_loop
bios:CAB1		  jmp	  near ptr POST_init_ints_and_more
bios:CAB4 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CAB4
bios:CAB4 infinite_loop:					      ;	CODE XREF: POST_test_8259+17Aj
bios:CAB4							      ;	POST_test_8259:infinite_loopj
bios:CAB4		  jmp	  short	infinite_loop
bios:CAB4 POST_test_8259  endp
bios:CAB4
bios:CAB4 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CAB6 aMemoryErrInfo  db 'Memory Err Info:',0                     ; DATA XREF: print_memory_error+Eo
bios:CAC7 aWrittenReadBas db 'Written  Read    Base   Offset',0       ; DATA XREF: print_memory_error+17o
bios:CAE6
bios:CAE6 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:CAE6
bios:CAE6
bios:CAE6 print_memory_error proc near				      ;	CODE XREF: POST_test_8259+10Ap
bios:CAE6		  mov	  es, word ptr ds:pbbe80.tmp_es
bios:CAEA		  assume es:nothing
bios:CAEA		  mov	  ds:pbbe80.tmp_reg3, si
bios:CAEE		  mov	  si, di
bios:CAF0		  push	  si
bios:CAF1		  mov	  di, 14Ah
bios:CAF4		  mov	  si, offset aMemoryErrInfo	      ;	"Memory	Err Info:"
bios:CAF7		  call	  print_asciiz
bios:CAFA		  mov	  di, 19Ah
bios:CAFD		  mov	  si, offset aWrittenReadBas	      ;	"Written  Read	  Base	 Offset"
bios:CB00		  call	  print_asciiz
bios:CB03		  pop	  si
bios:CB04		  mov	  ax, ds:pbbe80.tmp_reg2
bios:CB07		  cmp	  al, 0Fh
bios:CB09		  jz	  short	l0
bios:CB0B		  inc	  ax
bios:CB0C		  mov	  ds:pbbe80.tmp_reg2, ax
bios:CB0F
bios:CB0F l0:							      ;	CODE XREF: print_memory_error+23j
bios:CB0F		  mov	  ax, ds:pbbe80.tmp_reg2
bios:CB12		  mov	  ah, 80
bios:CB14		  mul	  ah
bios:CB16		  mov	  di, 1ECh
bios:CB19		  add	  di, ax			      ;	dest: es:1ec
bios:CB1B		  push	  cx
bios:CB1C		  push	  bx
bios:CB1D		  push	  si
bios:CB1E		  mov	  ax, ds:pbbe80.tmp_reg3
bios:CB21		  mov	  si, offset l1
bios:CB24		  jmp	  short	print_number_in_bcd
bios:CB26 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CB26
bios:CB26 l1:							      ;	DATA XREF: print_memory_error+3Bo
bios:CB26		  add	  di, 8
bios:CB29		  pop	  ax
bios:CB2A		  mov	  si, offset l2
bios:CB2D		  jmp	  short	print_number_in_bcd
bios:CB2F ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CB2F
bios:CB2F l2:							      ;	DATA XREF: print_memory_error+44o
bios:CB2F		  add	  di, 8
bios:CB32		  mov	  ax, bp
bios:CB34		  mov	  si, offset l3
bios:CB37		  jmp	  short	print_number_in_bcd
bios:CB39 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CB39
bios:CB39 l3:							      ;	DATA XREF: print_memory_error+4Eo
bios:CB39		  add	  di, 8
bios:CB3C		  pop	  ax
bios:CB3D		  push	  ax
bios:CB3E		  mov	  si, offset l4
bios:CB41		  jmp	  short	print_number_in_bcd
bios:CB43 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CB43
bios:CB43 l4:							      ;	DATA XREF: print_memory_error+58o
bios:CB43		  pop	  bx
bios:CB44		  pop	  cx
bios:CB45		  mov	  si, ds:pbbe80.tmp_reg3
bios:CB49		  retn
bios:CB49 print_memory_error endp
bios:CB49
bios:CB4A
bios:CB4A ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:CB4A
bios:CB4A ;	Entry:
bios:CB4A ;	    AX = number	to write
bios:CB4A ;	    ES:DI = destination	to write
bios:CB4A
bios:CB4A print_number_in_bcd proc near				      ;	CODE XREF: POST_main+1D5j
bios:CB4A							      ;	POST_main+1F0j	...
bios:CB4A		  mov	  dx, ax			      ;	assume AX = '1234'
bios:CB4C		  mov	  cx, 4
bios:CB4F
bios:CB4F l0:							      ;	CODE XREF: print_number_in_bcd+19j
bios:CB4F		  mov	  bx, cx			      ;	tmp: save cx
bios:CB51		  mov	  cl, 4
bios:CB53		  rol	  dx, cl			      ;	dx << 4	= '2341'
bios:CB55		  mov	  cx, bx			      ;	tmp: restore cx
bios:CB57		  mov	  al, dl			      ;	AL = '41'
bios:CB59		  and	  al, 0Fh			      ;	al = ' 1'
bios:CB5B		  add	  al, 90h ; ''                       ; AL = '91'
bios:CB5D		  daa					      ;	AL = '91' ?
bios:CB5E		  adc	  al, 40h ; '@'                       ; AL = '31'
bios:CB60		  daa					      ;	AL = '31'
bios:CB61		  stosb
bios:CB62		  inc	  di
bios:CB63		  loop	  l0
bios:CB65		  jmp	  si
bios:CB65 print_number_in_bcd endp
bios:CB65
bios:CB67
bios:CB67 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:CB67
bios:CB67 ;	Entry:
bios:CB67 ;	    SI = pointer to asciiz
bios:CB67 ;	    ES:DI = where to print it
bios:CB67
bios:CB67 print_asciiz	  proc near				      ;	CODE XREF: POST_test_port_0378+34p
bios:CB67							      ;	POST_test_pic_8253+94p	...
bios:CB67		  lods	  byte ptr cs:[si]
bios:CB69		  or	  al, al
bios:CB6B		  jz	  short	exit
bios:CB6D		  stosb
bios:CB6E		  inc	  di
bios:CB6F		  jmp	  short	print_asciiz
bios:CB71 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CB71
bios:CB71 exit:							      ;	CODE XREF: print_asciiz+4j
bios:CB71		  retn
bios:CB71 print_asciiz	  endp
bios:CB71
bios:CB72
bios:CB72 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:CB72
bios:CB72
bios:CB72 init_video	  proc near				      ;	CODE XREF: POST_main+B3j
bios:CB72							      ;	POST_main+119j	...
bios:CB72		  mov	  bx, di			      ;	di = return address. save it
bios:CB74		  xor	  di, di			      ;	di = 0
bios:CB76		  mov	  cx, 7D0h			      ;	80 * 25	= 2000 = 07d0h
bios:CB79		  mov	  ax, 720h			      ;	20h = space. 07h = attribute
bios:CB7C		  rep stosw				      ;	clear screen
bios:CB7E		  mov	  di, bx			      ;	restore	di (return address)
bios:CB80		  mov	  cx, 10h			      ;	16 registers to	'out'
bios:CB83		  xor	  bx, bx			      ;	bx = 0
bios:CB85
bios:CB85 l0:							      ;	CODE XREF: init_video+1Cj
bios:CB85		  mov	  al, bl			      ;	al = ctrl index. starts	with 0
bios:CB87		  out	  dx, al			      ;	Video: CRT cntrlr addr
bios:CB87							      ;	horizontal total
bios:CB88		  inc	  dx
bios:CB89		  lods	  byte ptr cs:[si]		      ;	si = pointer to	6845 init table
bios:CB8B		  out	  dx, al			      ;	Video: CRT controller internal registers
bios:CB8C		  dec	  dx
bios:CB8D		  inc	  bx				      ;	ctrl index register ++
bios:CB8E		  loop	  l0
bios:CB90		  jmp	  di
bios:CB90 init_video	  endp
bios:CB90
bios:CB92
bios:CB92 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:CB92
bios:CB92
bios:CB92 int_13_main	  proc far				      ;	CODE XREF: int_09_handler:int_13_handlerj
bios:CB92		  call	  push_regs
bios:CB95		  mov	  di, 0Ch
bios:CB98		  nop
bios:CB99		  call	  convert_ah_to_di_idx
bios:CB9C		  jb	  short	loc_FCBDE
bios:CB9E		  test	  byte ptr ds:p400.extra_status, 40h
bios:CBA3		  jz	  short	loc_FCBB0
bios:CBA5		  xor	  dl, 3
bios:CBA8		  cmp	  dl, 3
bios:CBAB		  jnz	  short	loc_FCBB0
bios:CBAD		  and	  dl, 0FCh
bios:CBB0
bios:CBB0 loc_FCBB0:						      ;	CODE XREF: int_13_main+11j
bios:CBB0							      ;	int_13_main+19j
bios:CBB0		  push	  bx
bios:CBB1		  mov	  bx, ds:p400.installed_hardware
bios:CBB5		  test	  bx, 100h			      ;	test for reserved bit
bios:CBB9		  pop	  bx
bios:CBBA		  jz	  short	loc_FCBC1
bios:CBBC		  jmp	  word ptr cs:jump_tbl_b[di]
bios:CBC1 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CBC1
bios:CBC1 loc_FCBC1:						      ;	CODE XREF: int_13_main+28j
bios:CBC1		  jmp	  word ptr cs:jump_tbl_a[di]
bios:CBC1 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CBC6 jump_tbl_a:						      ;	DATA XREF: int_13_main:loc_FCBC1r
bios:CBC6		  dw offset int_13_00_handler
bios:CBC8		  dw offset int_13_01_handler
bios:CBCA		  dw offset int_13_02_handler
bios:CBCC		  dw offset int_13_03_handler
bios:CBCE		  dw offset int_13_04_handler
bios:CBD0		  dw offset int_13_05_handler
bios:CBD2 jump_tbl_b:						      ;	DATA XREF: int_13_main+2Ar
bios:CBD2		  dw offset int_13_00_handler
bios:CBD4		  dw offset int_13_01_handler
bios:CBD6		  dw offset int_13_02_alt_handler
bios:CBD8		  dw offset int_13_03_alt_handler
bios:CBDA		  dw offset int_13_04_alt_handler
bios:CBDC		  dw offset int_13_05_alt_handler
bios:CBDE ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CBDE
bios:CBDE loc_FCBDE:						      ;	CODE XREF: int_13_main+Aj
bios:CBDE		  mov	  byte ptr ds:p400.diskette_last_status, 1
bios:CBE3		  mov	  ah, 1
bios:CBE5		  jmp	  near ptr int_13_pop_and_exit
bios:CBE5 int_13_main	  endp
bios:CBE5
bios:CBE8
bios:CBE8 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:CBE8
bios:CBE8 ;
bios:CBE8 ;	Resets the fixed disk or diskette controller and drive,	forcing
bios:CBE8 ;	recalibration of the read/write	head.
bios:CBE8 ;
bios:CBE8 ;	   Call	with:	  AH	     00h
bios:CBE8 ;			  DL	     Drive number
bios:CBE8 ;
bios:CBE8 ;	   Returns:	  AH	     Status of operation (See Service 01h)
bios:CBE8 ;			  CF	     Set if error, cleared otherwise
bios:CBE8
bios:CBE8 int_13_00_handler proc far				      ;	CODE XREF: int_13_main+2Aj
bios:CBE8							      ;	int_13_main:loc_FCBC1j
bios:CBE8							      ;	DATA XREF: ...
bios:CBE8		  mov	  byte ptr ds:p400.diskette_last_status, 0
bios:CBED		  and	  byte ptr ds:p400.diskette_recalibrate_status,	70h
bios:CBF2		  cli
bios:CBF3		  mov	  dl, ds:3Fh
bios:CBF7		  mov	  al, 3
bios:CBF9		  test	  dl, 8
bios:CBFC		  jnz	  short	loc_FCC0E
bios:CBFE		  mov	  al, 2
bios:CC00		  test	  dl, 4
bios:CC03		  jnz	  short	loc_FCC0E
bios:CC05		  mov	  al, 1
bios:CC07		  test	  dl, 2
bios:CC0A		  jnz	  short	loc_FCC0E
bios:CC0C		  xor	  al, al
bios:CC0E
bios:CC0E loc_FCC0E:						      ;	CODE XREF: int_13_00_handler+14j
bios:CC0E							      ;	int_13_00_handler+1Bj ...
bios:CC0E		  mov	  cl, 4
bios:CC10		  shl	  dl, cl
bios:CC12		  cmp	  dl, 40h ; '@'
bios:CC15		  jnz	  short	loc_FCC19
bios:CC17		  mov	  dl, 10h
bios:CC19
bios:CC19 loc_FCC19:						      ;	CODE XREF: int_13_00_handler+2Dj
bios:CC19		  and	  dl, 0F0h
bios:CC1C		  or	  al, dl
bios:CC1E		  or	  al, 8
bios:CC20		  test	  al, 30h
bios:CC22		  jnz	  short	loc_FCC26
bios:CC24		  or	  al, 3
bios:CC26
bios:CC26 loc_FCC26:						      ;	CODE XREF: int_13_00_handler+3Aj
bios:CC26		  mov	  dx, 3F2h
bios:CC29		  out	  dx, al			      ;	Floppy:	digital	output reg bits:
bios:CC29							      ;	0-1: Drive to select 0-3 (AT: bit 1 not	used)
bios:CC29							      ;	2:   0=reset diskette controller; 1=enable controller
bios:CC29							      ;	3:   1=enable diskette DMA and interrupts
bios:CC29							      ;	4-7: drive motor enable.  Set bits to turn drive ON.
bios:CC29							      ;
bios:CC2A		  or	  al, 4
bios:CC2C		  out	  dx, al			      ;	Floppy:	digital	output reg bits:
bios:CC2C							      ;	0-1: Drive to select 0-3 (AT: bit 1 not	used)
bios:CC2C							      ;	2:   0=reset diskette controller; 1=enable controller
bios:CC2C							      ;	3:   1=enable diskette DMA and interrupts
bios:CC2C							      ;	4-7: drive motor enable.  Set bits to turn drive ON.
bios:CC2C							      ;
bios:CC2D		  sti
bios:CC2E		  call	  sub_FD031
bios:CC31		  call	  sub_FD2AD
bios:CC34		  jb	  short	loc_FCC69
bios:CC36		  test	  ah, 8
bios:CC39		  jz	  short	loc_FCC42
bios:CC3B		  or	  byte ptr ds:p400.diskette_last_status, 20h
bios:CC40		  jmp	  short	loc_FCC69
bios:CC42 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CC42
bios:CC42 loc_FCC42:						      ;	CODE XREF: int_13_00_handler+51j
bios:CC42		  mov	  al, 3
bios:CC44		  call	  sub_FD118
bios:CC47		  jb	  short	loc_FCC69
bios:CC49		  xor	  bx, bx
bios:CC4B		  mov	  cx, 2
bios:CC4E		  mov	  ax, ds:p400.installed_hardware
bios:CC51		  test	  ax, 100h			      ;	test for reserved bit
bios:CC54		  jz	  short	loc_FCC5B
bios:CC56		  call	  sub_FD344
bios:CC59		  jmp	  short	loc_FCC5E
bios:CC5B ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CC5B
bios:CC5B loc_FCC5B:						      ;	CODE XREF: int_13_00_handler+6Cj
bios:CC5B		  call	  sub_FD317
bios:CC5E
bios:CC5E loc_FCC5E:						      ;	CODE XREF: int_13_00_handler+71j
bios:CC5E		  jb	  short	loc_FCC69
bios:CC60		  xor	  ax, ax
bios:CC62		  mov	  ds:p400.diskette_last_status,	al
bios:CC65		  clc
bios:CC66		  jmp	  near ptr int_13_pop_and_exit
bios:CC69 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CC69
bios:CC69 loc_FCC69:						      ;	CODE XREF: int_13_00_handler+4Cj
bios:CC69							      ;	int_13_00_handler+58j ...
bios:CC69		  xor	  al, al
bios:CC6B		  mov	  ah, ds:p400.diskette_last_status
bios:CC6F		  stc
bios:CC70		  jmp	  near ptr int_13_pop_and_exit
bios:CC70 int_13_00_handler endp
bios:CC70
bios:CC73
bios:CC73 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:CC73
bios:CC73 ;	Returns	status information about the most recent fixed or floppy disk
bios:CC73 ;	operation.
bios:CC73 ;
bios:CC73 ;	   On entry:	  AH	     01h
bios:CC73 ;			  DL	     Drive number
bios:CC73 ;
bios:CC73 ;	   Returns:	  AH	     Status of operation (see below)
bios:CC73 ;			  CF	     Set if error, otherwise cleared
bios:CC73 ;
bios:CC73
bios:CC73 int_13_01_handler proc far				      ;	CODE XREF: int_13_main+2Aj
bios:CC73							      ;	int_13_main:loc_FCBC1j
bios:CC73							      ;	DATA XREF: ...
bios:CC73		  mov	  ah, ds:p400.diskette_last_status
bios:CC77		  mov	  al, ah
bios:CC79		  cmp	  ah, 0
bios:CC7C		  jz	  short	loc_FCC82
bios:CC7E		  stc
bios:CC7F		  jmp	  near ptr int_13_pop_and_exit
bios:CC82 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CC82
bios:CC82 loc_FCC82:						      ;	CODE XREF: int_13_01_handler+9j
bios:CC82		  clc
bios:CC83		  jmp	  near ptr int_13_pop_and_exit
bios:CC83 int_13_01_handler endp
bios:CC83
bios:CC86
bios:CC86 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:CC86
bios:CC86 ;
bios:CC86 ;	Reads one or more sectors from a fixed or floppy disk into memory.
bios:CC86 ;
bios:CC86 ;	   On entry:	  AH	     02h
bios:CC86 ;			  AL	     Number of sectors to read
bios:CC86 ;			  CH	     Cylinder number (10 bit value; upper 2 bits
bios:CC86 ;				     in	CL)
bios:CC86 ;			  CL	     Starting sector number
bios:CC86 ;			  DH	     Head number
bios:CC86 ;			  DL	     Drive number
bios:CC86 ;			  ES:BX	     Address of	memory buffer
bios:CC86 ;
bios:CC86 ;	   Returns:	  AH	     Status of operation (See Service 01h)
bios:CC86 ;			  AL	     Number of sectors read
bios:CC86 ;			  CF	     Set if error, else	cleared
bios:CC86
bios:CC86 int_13_02_handler proc far				      ;	CODE XREF: int_13_main:loc_FCBC1j
bios:CC86							      ;	DATA XREF: int_13_main+38o
bios:CC86
bios:CC86 ; FUNCTION CHUNK AT bios:CC9F	SIZE 00000080 BYTES
bios:CC86
bios:CC86		  mov	  ah, 46h ; 'F'
bios:CC88		  call	  sub_FD089
bios:CC8B		  mov	  al, 0E6h ; 'æ'
bios:CC8D		  jmp	  short	loc_FCC9F
bios:CC8D int_13_02_handler endp
bios:CC8D
bios:CC8F
bios:CC8F ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:CC8F
bios:CC8F ;
bios:CC8F ;	Writes one or more sectors from	memory to a fixed or floppy disk.
bios:CC8F ;
bios:CC8F ;	   On entry:	  AH	     03h
bios:CC8F ;			  AL	     Number of sectors to write
bios:CC8F ;			  CH	     Cylinder number (10-bit value; upper 2 bits
bios:CC8F ;				     in	CL)
bios:CC8F ;			  CL	     Starting sector number
bios:CC8F ;			  DH	     Head number
bios:CC8F ;			  DL	     Drive number
bios:CC8F ;			  ES:BX	     Address of	memory buffer
bios:CC8F ;
bios:CC8F ;	   Returns:	  AH	     Status of operation (See Service 01h)
bios:CC8F ;			  AL	     Number of sectors written
bios:CC8F ;			  CF	     Set if error, else	cleared
bios:CC8F ;
bios:CC8F
bios:CC8F int_13_03_handler proc far				      ;	CODE XREF: int_13_main:loc_FCBC1j
bios:CC8F							      ;	DATA XREF: int_13_main+3Ao
bios:CC8F		  mov	  ah, 4Ah ; 'J'
bios:CC91		  call	  sub_FD089
bios:CC94		  mov	  al, 0C5h ; 'Å'
bios:CC96		  jmp	  short	loc_FCC9F
bios:CC96 int_13_03_handler endp
bios:CC96
bios:CC98
bios:CC98 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:CC98
bios:CC98 ;
bios:CC98 ;	Verifies one or	more fixed disk	or diskette sectors.
bios:CC98 ;
bios:CC98 ;	   On entry:	  AH	     04h
bios:CC98 ;			  AL	     Number of sectors to verify
bios:CC98 ;			  CH	     Cylinder number (10-bit value; upper 2 bits
bios:CC98 ;				     in	CL)
bios:CC98 ;			  CL	     Starting sector number
bios:CC98 ;			  DH	     Head number
bios:CC98 ;			  DL	     Drive number
bios:CC98 ;
bios:CC98 ;	   Returns:	  AH	     Status of operation (See Service 01h)
bios:CC98 ;			  AL	     Number of sectors verified
bios:CC98 ;			  CF	     Set if error, cleared otherwise
bios:CC98 ;
bios:CC98
bios:CC98 int_13_04_handler proc far				      ;	CODE XREF: int_13_main:loc_FCBC1j
bios:CC98							      ;	DATA XREF: int_13_main+3Co
bios:CC98		  mov	  ah, 42h ; 'B'
bios:CC9A		  call	  sub_FD089
bios:CC9D		  mov	  al, 0E6h ; 'æ'
bios:CC9D int_13_04_handler endp
bios:CC9D
bios:CC9F ; START OF FUNCTION CHUNK FOR	int_13_02_handler
bios:CC9F
bios:CC9F loc_FCC9F:						      ;	CODE XREF: int_13_02_handler+7j
bios:CC9F							      ;	int_13_03_handler+7j
bios:CC9F		  jnb	  short	loc_FCCA3
bios:CCA1		  jmp	  short	loc_FCD0C
bios:CCA3 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CCA3
bios:CCA3 loc_FCCA3:						      ;	CODE XREF: int_13_02_handler:loc_FCC9Fj
bios:CCA3		  push	  cx
bios:CCA4		  cmp	  dl, 4
bios:CCA7		  jb	  short	loc_FCCB0
bios:CCA9		  mov	  byte ptr ds:41h, 1
bios:CCAE
bios:CCAE loc_FCCAE:						      ;	CODE XREF: int_13_02_handler+35j
bios:CCAE							      ;	int_13_02_handler+3Aj ...
bios:CCAE		  jmp	  short	loc_FCD0B
bios:CCB0 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CCB0
bios:CCB0 loc_FCCB0:						      ;	CODE XREF: int_13_02_handler+21j
bios:CCB0		  mov	  byte ptr ds:41h, 0
bios:CCB5		  call	  get_diskette_params_addr
bios:CCB8		  call	  sub_FD1C4
bios:CCBB		  jb	  short	loc_FCCAE
bios:CCBD		  call	  sub_FD118
bios:CCC0		  jb	  short	loc_FCCAE
bios:CCC2		  mov	  al, dl
bios:CCC4		  and	  al, 3
bios:CCC6		  push	  dx
bios:CCC7		  shl	  dh, 1
bios:CCC9		  shl	  dh, 1
bios:CCCB		  or	  al, dh
bios:CCCD		  pop	  dx
bios:CCCE		  call	  sub_FD118
bios:CCD1		  jb	  short	loc_FCCAE
bios:CCD3		  mov	  al, ch
bios:CCD5		  call	  sub_FD118
bios:CCD8		  jb	  short	loc_FCCAE
bios:CCDA		  mov	  al, dh
bios:CCDC		  call	  sub_FD118
bios:CCDF		  jb	  short	loc_FCD0B
bios:CCE1		  mov	  al, cl
bios:CCE3		  call	  sub_FD118
bios:CCE6		  jb	  short	loc_FCD0B
bios:CCE8		  mov	  bx, 3
bios:CCEB		  mov	  cx, 4
bios:CCEE		  call	  sub_FD317
bios:CCF1		  jb	  short	loc_FCD0B
bios:CCF3		  call	  sub_FD031
bios:CCF6		  jb	  short	loc_FCD0B
bios:CCF8		  mov	  cx, 7
bios:CCFB		  call	  sub_FD170
bios:CCFE		  jb	  short	loc_FCD0B
bios:CD00		  pop	  cx
bios:CD01		  test	  ah, 0C0h
bios:CD04		  jz	  short	loc_FCD0C
bios:CD06		  call	  sub_FD2D4
bios:CD09		  jmp	  short	loc_FCD0C
bios:CD0B ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CD0B
bios:CD0B loc_FCD0B:						      ;	CODE XREF: int_13_02_handler:loc_FCCAEj
bios:CD0B							      ;	int_13_02_handler+59j ...
bios:CD0B		  pop	  cx
bios:CD0C
bios:CD0C loc_FCD0C:						      ;	CODE XREF: int_13_02_handler+1Bj
bios:CD0C							      ;	int_13_02_handler+7Ej ...
bios:CD0C		  xor	  al, al
bios:CD0E		  mov	  ah, ds:41h
bios:CD12		  cmp	  ah, 0
bios:CD15		  jz	  short	loc_FCD1B
bios:CD17		  stc
bios:CD18		  jmp	  near ptr int_13_pop_and_exit
bios:CD1B ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CD1B
bios:CD1B loc_FCD1B:						      ;	CODE XREF: int_13_02_handler+8Fj
bios:CD1B		  clc
bios:CD1C		  jmp	  near ptr int_13_pop_and_exit
bios:CD1C ; END	OF FUNCTION CHUNK FOR int_13_02_handler
bios:CD1F
bios:CD1F ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:CD1F
bios:CD1F ;
bios:CD1F ;	Reads one or more sectors from a fixed or floppy disk into memory.
bios:CD1F ;
bios:CD1F ;	   On entry:	  AH	     02h
bios:CD1F ;			  AL	     Number of sectors to read
bios:CD1F ;			  CH	     Cylinder number (10 bit value; upper 2 bits
bios:CD1F ;				     in	CL)
bios:CD1F ;			  CL	     Starting sector number
bios:CD1F ;			  DH	     Head number
bios:CD1F ;			  DL	     Drive number
bios:CD1F ;			  ES:BX	     Address of	memory buffer
bios:CD1F ;
bios:CD1F ;	   Returns:	  AH	     Status of operation (See Service 01h)
bios:CD1F ;			  AL	     Number of sectors read
bios:CD1F ;			  CF	     Set if error, else	cleared
bios:CD1F
bios:CD1F int_13_02_alt_handler	proc far			      ;	CODE XREF: int_13_main+2Aj
bios:CD1F							      ;	int_13_main:loc_FCBC1j
bios:CD1F							      ;	DATA XREF: ...
bios:CD1F
bios:CD1F ; FUNCTION CHUNK AT bios:CD3B	SIZE 00000100 BYTES
bios:CD1F ; FUNCTION CHUNK AT bios:CE3C	SIZE 00000047 BYTES
bios:CD1F
bios:CD1F		  push	  cx
bios:CD20		  push	  ax
bios:CD21		  call	  sub_FCE83
bios:CD24		  push	  ax
bios:CD25		  mov	  al, 0E6h ; 'æ'
bios:CD27		  jmp	  short	loc_FCD3B
bios:CD27 int_13_02_alt_handler	endp
bios:CD27
bios:CD29
bios:CD29 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:CD29
bios:CD29 ;
bios:CD29 ;	Writes one or more sectors from	memory to a fixed or floppy disk.
bios:CD29 ;
bios:CD29 ;	   On entry:	  AH	     03h
bios:CD29 ;			  AL	     Number of sectors to write
bios:CD29 ;			  CH	     Cylinder number (10-bit value; upper 2 bits
bios:CD29 ;				     in	CL)
bios:CD29 ;			  CL	     Starting sector number
bios:CD29 ;			  DH	     Head number
bios:CD29 ;			  DL	     Drive number
bios:CD29 ;			  ES:BX	     Address of	memory buffer
bios:CD29 ;
bios:CD29 ;	   Returns:	  AH	     Status of operation (See Service 01h)
bios:CD29 ;			  AL	     Number of sectors written
bios:CD29 ;			  CF	     Set if error, else	cleared
bios:CD29
bios:CD29 int_13_03_alt_handler	proc far			      ;	CODE XREF: int_13_main+2Aj
bios:CD29							      ;	int_13_main:loc_FCBC1j
bios:CD29							      ;	DATA XREF: ...
bios:CD29		  push	  cx
bios:CD2A		  push	  ax
bios:CD2B		  call	  sub_FCE83
bios:CD2E		  push	  ax
bios:CD2F		  mov	  al, 0C5h ; 'Å'
bios:CD31		  jmp	  short	loc_FCD3B
bios:CD31 int_13_03_alt_handler	endp
bios:CD31
bios:CD33
bios:CD33 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:CD33
bios:CD33 ;
bios:CD33 ;	Verifies one or	more fixed disk	or diskette sectors.
bios:CD33 ;
bios:CD33 ;	   On entry:	  AH	     04h
bios:CD33 ;			  AL	     Number of sectors to verify
bios:CD33 ;			  CH	     Cylinder number (10-bit value; upper 2 bits
bios:CD33 ;				     in	CL)
bios:CD33 ;			  CL	     Starting sector number
bios:CD33 ;			  DH	     Head number
bios:CD33 ;			  DL	     Drive number
bios:CD33 ;
bios:CD33 ;	   Returns:	  AH	     Status of operation (See Service 01h)
bios:CD33 ;			  AL	     Number of sectors verified
bios:CD33 ;			  CF	     Set if error, cleared otherwise
bios:CD33 ;
bios:CD33
bios:CD33 int_13_04_alt_handler	proc far			      ;	CODE XREF: int_13_main+2Aj
bios:CD33							      ;	int_13_main:loc_FCBC1j
bios:CD33							      ;	DATA XREF: ...
bios:CD33		  push	  cx
bios:CD34		  push	  ax
bios:CD35		  call	  sub_FCE83
bios:CD38		  push	  ax
bios:CD39		  mov	  al, 0E6h ; 'æ'
bios:CD39 int_13_04_alt_handler	endp
bios:CD39
bios:CD3B ; START OF FUNCTION CHUNK FOR	int_13_02_alt_handler
bios:CD3B
bios:CD3B loc_FCD3B:						      ;	CODE XREF: int_13_02_alt_handler+8j
bios:CD3B							      ;	int_13_03_alt_handler+8j
bios:CD3B		  jnb	  short	loc_FCD40
bios:CD3D		  jmp	  loc_FCE6D
bios:CD40 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CD40
bios:CD40 loc_FCD40:						      ;	CODE XREF: int_13_02_alt_handler:loc_FCD3Bj
bios:CD40		  push	  es
bios:CD41		  push	  bx
bios:CD42		  cmp	  dl, 4
bios:CD45		  jb	  short	loc_FCD4F
bios:CD47		  mov	  byte ptr ds:p400.diskette_last_status, 1
bios:CD4C
bios:CD4C loc_FCD4C:						      ;	CODE XREF: int_13_02_alt_handler+3Bj
bios:CD4C							      ;	int_13_02_alt_handler+40j ...
bios:CD4C		  jmp	  loc_FCE6B
bios:CD4F ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CD4F
bios:CD4F loc_FCD4F:						      ;	CODE XREF: int_13_02_alt_handler+26j
bios:CD4F		  mov	  byte ptr ds:p400.diskette_last_status, 0
bios:CD54		  call	  get_diskette_params_addr
bios:CD57		  call	  sub_FD1C4
bios:CD5A		  jb	  short	loc_FCD4C
bios:CD5C		  call	  sub_FD118
bios:CD5F		  jb	  short	loc_FCD4C
bios:CD61		  mov	  al, dl
bios:CD63		  and	  al, 3
bios:CD65		  push	  dx
bios:CD66		  shl	  dh, 1
bios:CD68		  shl	  dh, 1
bios:CD6A		  or	  al, dh
bios:CD6C		  pop	  dx
bios:CD6D		  call	  sub_FD118
bios:CD70		  jb	  short	loc_FCD4C
bios:CD72		  mov	  al, ch
bios:CD74		  call	  sub_FD118
bios:CD77		  jb	  short	loc_FCD4C
bios:CD79		  mov	  al, dh
bios:CD7B		  call	  sub_FD118
bios:CD7E		  jb	  short	loc_FCD4C
bios:CD80		  mov	  al, cl
bios:CD82		  call	  sub_FD118
bios:CD85		  jb	  short	loc_FCD4C
bios:CD87		  mov	  bx, 3
bios:CD8A		  mov	  cx, 4
bios:CD8D		  call	  sub_FD329
bios:CD90		  jb	  short	loc_FCD4C
bios:CD92		  mov	  al, ds:3Fh
bios:CD95		  mov	  cl, 4
bios:CD97		  shl	  al, cl
bios:CD99		  cmp	  al, 40h ; '@'
bios:CD9B		  jnz	  short	loc_FCD9F
bios:CD9D		  mov	  al, 10h
bios:CD9F
bios:CD9F loc_FCD9F:						      ;	CODE XREF: int_13_02_alt_handler+7Cj
bios:CD9F		  or	  al, 4Ch
bios:CDA1		  or	  al, dl
bios:CDA3		  mov	  dl, al
bios:CDA5		  pop	  bx
bios:CDA6		  pop	  es
bios:CDA7		  pop	  cx
bios:CDA8		  pop	  ax
bios:CDA9		  push	  dx
bios:CDAA		  mov	  di, bx
bios:CDAC		  mov	  si, bx
bios:CDAE		  mov	  bh, 20h ; ' '
bios:CDB0		  cmp	  ah, 4
bios:CDB3		  jnz	  short	loc_FCDB7
bios:CDB5		  jmp	  short	loc_FCE1A
bios:CDB7 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CDB7
bios:CDB7 loc_FCDB7:						      ;	CODE XREF: int_13_02_alt_handler+94j
bios:CDB7		  cmp	  ah, 3
bios:CDBA		  jz	  short	loc_FCDEC
bios:CDBC		  mov	  al, dh
bios:CDBE		  mov	  dx, 3F5h
bios:CDC1		  cli
bios:CDC2		  out	  dx, al			      ;	Floppy:	FDC command/data register.
bios:CDC3		  mov	  dx, 3F4h
bios:CDC6		  mov	  ah, 80h ; '€'
bios:CDC8		  jmp	  short	loc_FCDD4
bios:CDCA ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CDCA
bios:CDCA loc_FCDCA:						      ;	CODE XREF: int_13_02_alt_handler+BBj
bios:CDCA		  loop	  loc_FCDD7
bios:CDCC		  or	  byte ptr ds:p400.diskette_last_status, 80h
bios:CDD1		  jmp	  loc_FCE66
bios:CDD4 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CDD4
bios:CDD4 loc_FCDD4:						      ;	CODE XREF: int_13_02_alt_handler+A9j
bios:CDD4							      ;	int_13_02_alt_handler+C6j
bios:CDD4		  push	  cx
bios:CDD5		  xor	  cx, cx
bios:CDD7
bios:CDD7 loc_FCDD7:						      ;	CODE XREF: int_13_02_alt_handler:loc_FCDCAj
bios:CDD7		  in	  al, dx			      ;	Floppy:	main status reg	bits:
bios:CDD7							      ;	0-3: diskette busy
bios:CDD7							      ;	4: 1=cntrlr busy
bios:CDD7							      ;	5: 1=non-DMA mode
bios:CDD7							      ;	6: Data	dir: 1=cntrlr to CPU
bios:CDD7							      ;	7: 1=OK	to snd/rcv cmd or data
bios:CDD8		  test	  al, ah
bios:CDDA		  jz	  short	loc_FCDCA
bios:CDDC		  test	  al, bh
bios:CDDE		  jz	  short	loc_FCDE9
bios:CDE0		  inc	  dx
bios:CDE1		  in	  al, dx			      ;	Floppy:	FDC command/data register.
bios:CDE2		  stosb
bios:CDE3		  pop	  cx
bios:CDE4		  dec	  dx
bios:CDE5		  loop	  loc_FCDD4
bios:CDE7		  jmp	  short	loc_FCE45
bios:CDE9 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CDE9
bios:CDE9 loc_FCDE9:						      ;	CODE XREF: int_13_02_alt_handler+BFj
bios:CDE9		  pop	  cx
bios:CDEA		  jmp	  short	loc_FCE45
bios:CDEC ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CDEC
bios:CDEC loc_FCDEC:						      ;	CODE XREF: int_13_02_alt_handler+9Bj
bios:CDEC		  mov	  al, dh
bios:CDEE		  mov	  dx, 3F5h
bios:CDF1		  cli
bios:CDF2		  out	  dx, al			      ;	Floppy:	FDC command/data register.
bios:CDF3		  dec	  dx
bios:CDF4		  mov	  ah, 80h ; '€'
bios:CDF6		  jmp	  short	loc_FCE01
bios:CDF8 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CDF8
bios:CDF8 loc_FCDF8:						      ;	CODE XREF: int_13_02_alt_handler+E8j
bios:CDF8		  loop	  loc_FCE04
bios:CDFA		  or	  byte ptr ds:p400.diskette_last_status, 80h
bios:CDFF		  jmp	  short	loc_FCE66
bios:CE01 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CE01
bios:CE01 loc_FCE01:						      ;	CODE XREF: int_13_02_alt_handler+D7j
bios:CE01							      ;	int_13_02_alt_handler+F4j
bios:CE01		  push	  cx
bios:CE02		  xor	  cx, cx
bios:CE04
bios:CE04 loc_FCE04:						      ;	CODE XREF: int_13_02_alt_handler:loc_FCDF8j
bios:CE04		  in	  al, dx			      ;	Floppy:	main status reg	bits:
bios:CE04							      ;	0-3: diskette busy
bios:CE04							      ;	4: 1=cntrlr busy
bios:CE04							      ;	5: 1=non-DMA mode
bios:CE04							      ;	6: Data	dir: 1=cntrlr to CPU
bios:CE04							      ;	7: 1=OK	to snd/rcv cmd or data
bios:CE05		  test	  al, ah
bios:CE07		  jz	  short	loc_FCDF8
bios:CE09		  test	  al, bh
bios:CE0B		  jz	  short	loc_FCE17
bios:CE0D		  lods	  byte ptr es:[si]
bios:CE0F		  inc	  dx
bios:CE10		  out	  dx, al			      ;	Floppy:	FDC command/data register.
bios:CE11		  pop	  cx
bios:CE12		  dec	  dx
bios:CE13		  loop	  loc_FCE01
bios:CE15		  jmp	  short	loc_FCE45
bios:CE17 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CE17
bios:CE17 loc_FCE17:						      ;	CODE XREF: int_13_02_alt_handler+ECj
bios:CE17		  pop	  cx
bios:CE18		  jmp	  short	loc_FCE45
bios:CE1A ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CE1A
bios:CE1A loc_FCE1A:						      ;	CODE XREF: int_13_02_alt_handler+96j
bios:CE1A		  mov	  al, dh
bios:CE1C		  mov	  dx, 3F5h
bios:CE1F		  cli
bios:CE20		  out	  dx, al			      ;	Floppy:	FDC command/data register.
bios:CE21		  mov	  ah, 80h ; '€'
bios:CE23		  dec	  dx
bios:CE24
bios:CE24 loc_FCE24:						      ;	CODE XREF: int_13_02_alt_handler+121j
bios:CE24		  push	  cx
bios:CE25		  xor	  cx, cx
bios:CE27
bios:CE27 loc_FCE27:						      ;	CODE XREF: int_13_02_alt_handler+10Dj
bios:CE27		  in	  al, dx			      ;	Floppy:	main status reg	bits:
bios:CE27							      ;	0-3: diskette busy
bios:CE27							      ;	4: 1=cntrlr busy
bios:CE27							      ;	5: 1=non-DMA mode
bios:CE27							      ;	6: Data	dir: 1=cntrlr to CPU
bios:CE27							      ;	7: 1=OK	to snd/rcv cmd or data
bios:CE28		  test	  al, 80h
bios:CE2A		  jnz	  short	loc_FCE35
bios:CE2C		  loop	  loc_FCE27
bios:CE2E		  or	  byte ptr ds:p400.diskette_last_status, 80h
bios:CE33		  jmp	  short	loc_FCE66
bios:CE35 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CE35
bios:CE35 loc_FCE35:						      ;	CODE XREF: int_13_02_alt_handler+10Bj
bios:CE35		  test	  al, bh
bios:CE37		  jnz	  short	loc_FCE3C
bios:CE39		  jmp	  short	loc_FCE44
bios:CE39 ; END	OF FUNCTION CHUNK FOR int_13_02_alt_handler
bios:CE3B ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CE3B		  nop
bios:CE3C ; START OF FUNCTION CHUNK FOR	int_13_02_alt_handler
bios:CE3C
bios:CE3C loc_FCE3C:						      ;	CODE XREF: int_13_02_alt_handler+118j
bios:CE3C		  inc	  dx
bios:CE3D		  in	  al, dx			      ;	Floppy:	FDC command/data register.
bios:CE3E		  pop	  cx
bios:CE3F		  dec	  dx
bios:CE40		  loop	  loc_FCE24
bios:CE42		  jmp	  short	loc_FCE45
bios:CE44 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CE44
bios:CE44 loc_FCE44:						      ;	CODE XREF: int_13_02_alt_handler+11Aj
bios:CE44		  pop	  cx
bios:CE45
bios:CE45 loc_FCE45:						      ;	CODE XREF: int_13_02_alt_handler+C8j
bios:CE45							      ;	int_13_02_alt_handler+CBj ...
bios:CE45		  pop	  ax
bios:CE46		  mov	  dx, 3F2h
bios:CE49		  out	  dx, al			      ;	Floppy:	digital	output reg bits:
bios:CE49							      ;	0-1: Drive to select 0-3 (AT: bit 1 not	used)
bios:CE49							      ;	2:   0=reset diskette controller; 1=enable controller
bios:CE49							      ;	3:   1=enable diskette DMA and interrupts
bios:CE49							      ;	4-7: drive motor enable.  Set bits to turn drive ON.
bios:CE49							      ;
bios:CE4A		  and	  al, 0BFh
bios:CE4C		  out	  dx, al			      ;	Floppy:	digital	output reg bits:
bios:CE4C							      ;	0-1: Drive to select 0-3 (AT: bit 1 not	used)
bios:CE4C							      ;	2:   0=reset diskette controller; 1=enable controller
bios:CE4C							      ;	3:   1=enable diskette DMA and interrupts
bios:CE4C							      ;	4-7: drive motor enable.  Set bits to turn drive ON.
bios:CE4C							      ;
bios:CE4D		  sti
bios:CE4E		  call	  sub_FD056
bios:CE51		  jb	  short	loc_FCE68
bios:CE53		  mov	  cx, 7
bios:CE56		  call	  sub_FD170
bios:CE59		  jb	  short	loc_FCE68
bios:CE5B		  pop	  cx
bios:CE5C		  test	  ah, 0C0h
bios:CE5F		  jz	  short	loc_FCE70
bios:CE61		  call	  sub_FD2D4
bios:CE64		  jmp	  short	loc_FCE70
bios:CE66 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CE66
bios:CE66 loc_FCE66:						      ;	CODE XREF: int_13_02_alt_handler+B2j
bios:CE66							      ;	int_13_02_alt_handler+E0j ...
bios:CE66		  pop	  cx
bios:CE67		  pop	  dx
bios:CE68
bios:CE68 loc_FCE68:						      ;	CODE XREF: int_13_02_alt_handler+132j
bios:CE68							      ;	int_13_02_alt_handler+13Aj
bios:CE68		  pop	  cx
bios:CE69		  jmp	  short	loc_FCE70
bios:CE6B ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CE6B
bios:CE6B loc_FCE6B:						      ;	CODE XREF: int_13_02_alt_handler:loc_FCD4Cj
bios:CE6B		  pop	  bx
bios:CE6C		  pop	  es
bios:CE6D
bios:CE6D loc_FCE6D:						      ;	CODE XREF: int_13_02_alt_handler+1Ej
bios:CE6D		  pop	  ax
bios:CE6E		  pop	  ax
bios:CE6F		  pop	  cx
bios:CE70
bios:CE70 loc_FCE70:						      ;	CODE XREF: int_13_02_alt_handler+140j
bios:CE70							      ;	int_13_02_alt_handler+145j ...
bios:CE70		  xor	  al, al
bios:CE72		  mov	  ah, ds:p400.diskette_last_status
bios:CE76		  cmp	  ah, 0
bios:CE79		  jz	  short	loc_FCE7F
bios:CE7B		  stc
bios:CE7C		  jmp	  near ptr int_13_pop_and_exit
bios:CE7F ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CE7F
bios:CE7F loc_FCE7F:						      ;	CODE XREF: int_13_02_alt_handler+15Aj
bios:CE7F		  clc
bios:CE80		  jmp	  near ptr int_13_pop_and_exit
bios:CE80 ; END	OF FUNCTION CHUNK FOR int_13_02_alt_handler
bios:CE83
bios:CE83 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:CE83
bios:CE83 ; Attributes:	bp-based frame
bios:CE83
bios:CE83 sub_FCE83	  proc near				      ;	CODE XREF: int_13_02_alt_handler+2p
bios:CE83							      ;	int_13_03_alt_handler+2p ...
bios:CE83		  push	  cx
bios:CE84		  push	  dx
bios:CE85		  push	  es
bios:CE86		  push	  bx
bios:CE87		  push	  ax
bios:CE88		  mov	  al, 6
bios:CE8A		  out	  0Fh, al			      ;	DMA controller,	8237A-5.
bios:CE8A							      ;	master clear. Clear or mask any	or
bios:CE8A							      ;	all of the channels. Bits:
bios:CE8A							      ;	0: 1=mask channel 0; 0=enable
bios:CE8A							      ;	1: 1=mask channel 1;
bios:CE8A							      ;	2: 1=mask channel 2;
bios:CE8A							      ;	3: 1=mask channel 3;
bios:CE8C		  mov	  bp, sp
bios:CE8E		  call	  get_diskette_params_addr
bios:CE91		  mov	  cl, es:[si+3]
bios:CE95		  mov	  dx, 80h ; '€'
bios:CE98		  shl	  dx, cl
bios:CE9A		  mov	  ax, [bp+0]
bios:CE9D		  xor	  ah, ah
bios:CE9F		  mul	  dx
bios:CEA1		  cmp	  dx, 0
bios:CEA4		  jnz	  short	loc_FCEDB
bios:CEA6		  mov	  dx, bx
bios:CEA8		  add	  bx, ax
bios:CEAA		  jb	  short	loc_FCEAF
bios:CEAC		  clc
bios:CEAD		  jmp	  short	loc_FCEE1
bios:CEAF ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CEAF
bios:CEAF loc_FCEAF:						      ;	CODE XREF: sub_FCE83+27j
bios:CEAF		  mov	  bx, dx
bios:CEB1		  and	  bx, 0Fh
bios:CEB5		  add	  bx, ax
bios:CEB7		  jb	  short	loc_FCEE1
bios:CEB9		  pop	  cx
bios:CEBA		  pop	  cx
bios:CEBB		  pop	  es
bios:CEBC		  mov	  bx, dx
bios:CEBE		  mov	  cl, 4
bios:CEC0		  shr	  bx, cl
bios:CEC2		  mov	  cx, es
bios:CEC4		  add	  cx, bx
bios:CEC6		  jb	  short	loc_FCED4
bios:CEC8		  mov	  es, cx
bios:CECA		  mov	  bx, dx
bios:CECC		  and	  bx, 0Fh
bios:CED0		  clc
bios:CED1
bios:CED1 loc_FCED1:						      ;	CODE XREF: sub_FCE83+56j
bios:CED1		  pop	  dx
bios:CED2		  pop	  cx
bios:CED3		  retn
bios:CED4 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CED4
bios:CED4 loc_FCED4:						      ;	CODE XREF: sub_FCE83+43j
bios:CED4		  mov	  byte ptr ds:p400.diskette_last_status, 9
bios:CED9		  jmp	  short	loc_FCED1
bios:CEDB ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CEDB
bios:CEDB loc_FCEDB:						      ;	CODE XREF: sub_FCE83+21j
bios:CEDB		  stc
bios:CEDC		  mov	  byte ptr ds:p400.diskette_last_status, 9
bios:CEE1
bios:CEE1 loc_FCEE1:						      ;	CODE XREF: sub_FCE83+2Aj
bios:CEE1							      ;	sub_FCE83+34j
bios:CEE1		  pop	  bx
bios:CEE2		  pop	  bx
bios:CEE3		  pop	  es
bios:CEE4		  pop	  dx
bios:CEE5		  pop	  cx
bios:CEE6		  retn
bios:CEE6 sub_FCE83	  endp
bios:CEE6
bios:CEE7
bios:CEE7 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:CEE7
bios:CEE7 ;
bios:CEE7 ;	Initializes each sector	on a specified cylinder	with sector address
bios:CEE7 ;	and size information.
bios:CEE7 ;
bios:CEE7 ;	   On entry:	  AH	     05h
bios:CEE7 ;			  AL	     Number of sectors to format (diskette) or
bios:CEE7 ;				     Interleave	(XT)
bios:CEE7 ;			  CH	     Cylinder number (10-bit value; upper 2 bits
bios:CEE7 ;				     in	CL)
bios:CEE7 ;			  DH	     Head number
bios:CEE7 ;			  DL	     Drive number
bios:CEE7 ;			  ES:BX	     Pointer to	address	field list (See	below)
bios:CEE7 ;
bios:CEE7 ;	   Returns:	  AH	     Status of operation (See Service 01h)
bios:CEE7 ;			  CF	     Set if error, cleared otherwise
bios:CEE7 ;
bios:CEE7
bios:CEE7 int_13_05_alt_handler	proc far			      ;	CODE XREF: int_13_main+2Aj
bios:CEE7							      ;	int_13_main:loc_FCBC1j
bios:CEE7							      ;	DATA XREF: ...
bios:CEE7		  cmp	  dl, 4
bios:CEEA		  jb	  short	loc_FCEF4
bios:CEEC		  mov	  byte ptr ds:p400.diskette_last_status, 1
bios:CEF1		  jmp	  loc_FCF7B
bios:CEF4 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CEF4
bios:CEF4 loc_FCEF4:						      ;	CODE XREF: int_13_05_alt_handler+3j
bios:CEF4		  mov	  byte ptr ds:p400.diskette_last_status, 0
bios:CEF9		  call	  sub_FCE83
bios:CEFC		  push	  ax
bios:CEFD		  push	  es
bios:CEFE		  push	  bx
bios:CEFF		  jnb	  short	loc_FCF04
bios:CF01
bios:CF01 loc_FCF01:						      ;	CODE XREF: int_13_05_alt_handler+23j
bios:CF01							      ;	int_13_05_alt_handler+2Aj
bios:CF01		  jmp	  short	loc_FCF82
bios:CF03 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CF03		  nop
bios:CF04
bios:CF04 loc_FCF04:						      ;	CODE XREF: int_13_05_alt_handler+18j
bios:CF04		  call	  get_diskette_params_addr
bios:CF07		  call	  sub_FD1C4
bios:CF0A		  jb	  short	loc_FCF01
bios:CF0C		  mov	  al, 4Dh ; 'M'
bios:CF0E		  call	  sub_FD118
bios:CF11		  jb	  short	loc_FCF01
bios:CF13		  mov	  al, dl
bios:CF15		  and	  al, 3
bios:CF17		  shl	  dh, 1
bios:CF19		  shl	  dh, 1
bios:CF1B		  or	  al, dh
bios:CF1D		  call	  sub_FD118
bios:CF20		  jb	  short	loc_FCF82
bios:CF22		  mov	  bx, 3
bios:CF25		  mov	  cx, 2
bios:CF28		  call	  sub_FD317
bios:CF2B		  jb	  short	loc_FCF82
bios:CF2D		  dec	  bx
bios:CF2E		  mov	  dl, es:[bx+si]
bios:CF31		  cli
bios:CF32		  mov	  bx, 7
bios:CF35		  call	  sub_FD329
bios:CF38		  jb	  short	loc_FCF82
bios:CF3A		  pop	  bx
bios:CF3B		  pop	  es
bios:CF3C		  pop	  cx
bios:CF3D		  mov	  al, 4
bios:CF3F		  mul	  dl
bios:CF41		  mov	  cx, ax
bios:CF43		  mov	  al, dh
bios:CF45		  mov	  ah, 80h ; '€'
bios:CF47		  mov	  dx, 3F5h
bios:CF4A		  out	  dx, al			      ;	Floppy:	FDC command/data register.
bios:CF4B
bios:CF4B loc_FCF4B:						      ;	CODE XREF: int_13_05_alt_handler+7Dj
bios:CF4B		  push	  cx
bios:CF4C		  xor	  cx, cx
bios:CF4E		  dec	  dx
bios:CF4F
bios:CF4F loc_FCF4F:						      ;	CODE XREF: int_13_05_alt_handler+6Dj
bios:CF4F		  in	  al, dx			      ;	Floppy:	main status reg	bits:
bios:CF4F							      ;	0-3: diskette busy
bios:CF4F							      ;	4: 1=cntrlr busy
bios:CF4F							      ;	5: 1=non-DMA mode
bios:CF4F							      ;	6: Data	dir: 1=cntrlr to CPU
bios:CF4F							      ;	7: 1=OK	to snd/rcv cmd or data
bios:CF50		  test	  al, ah
bios:CF52		  jnz	  short	loc_FCF5D
bios:CF54		  loop	  loc_FCF4F
bios:CF56		  or	  byte ptr ds:p400.diskette_last_status, 80h
bios:CF5B		  jmp	  short	loc_FCF84
bios:CF5D ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CF5D
bios:CF5D loc_FCF5D:						      ;	CODE XREF: int_13_05_alt_handler+6Bj
bios:CF5D		  mov	  al, es:[bx]
bios:CF60		  inc	  dx
bios:CF61		  out	  dx, al			      ;	Floppy:	FDC command/data register.
bios:CF62		  inc	  bx
bios:CF63		  pop	  cx
bios:CF64		  loop	  loc_FCF4B
bios:CF66		  call	  sub_FD056
bios:CF69		  mov	  cx, 7
bios:CF6C		  call	  sub_FD170
bios:CF6F		  jb	  short	loc_FCF85
bios:CF71		  test	  ah, 0C0h
bios:CF74		  jz	  short	loc_FCFEE
bios:CF76		  call	  sub_FD2D4
bios:CF79		  jmp	  short	loc_FCF85
bios:CF7B ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CF7B
bios:CF7B loc_FCF7B:						      ;	CODE XREF: int_13_05_alt_handler+Aj
bios:CF7B		  mov	  ah, ds:p400.diskette_last_status
bios:CF7F		  clc
bios:CF80		  jmp	  short	near ptr int_13_pop_and_exit
bios:CF82 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CF82
bios:CF82 loc_FCF82:						      ;	CODE XREF: int_13_05_alt_handler:loc_FCF01j
bios:CF82							      ;	int_13_05_alt_handler+39j ...
bios:CF82		  pop	  bx
bios:CF83		  pop	  es
bios:CF84
bios:CF84 loc_FCF84:						      ;	CODE XREF: int_13_05_alt_handler+74j
bios:CF84		  pop	  ax
bios:CF85
bios:CF85 loc_FCF85:						      ;	CODE XREF: int_13_05_alt_handler+88j
bios:CF85							      ;	int_13_05_alt_handler+92j
bios:CF85		  mov	  ah, ds:p400.diskette_last_status
bios:CF89		  stc
bios:CF8A		  jmp	  short	near ptr int_13_pop_and_exit
bios:CF8A int_13_05_alt_handler	endp
bios:CF8A
bios:CF8C
bios:CF8C ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:CF8C
bios:CF8C ;
bios:CF8C ;	Initializes each sector	on a specified cylinder	with sector address
bios:CF8C ;	and size information.
bios:CF8C ;
bios:CF8C ;	   On entry:	  AH	     05h
bios:CF8C ;			  AL	     Number of sectors to format (diskette) or
bios:CF8C ;				     Interleave	(XT)
bios:CF8C ;			  CH	     Cylinder number (10-bit value; upper 2 bits
bios:CF8C ;				     in	CL)
bios:CF8C ;			  DH	     Head number
bios:CF8C ;			  DL	     Drive number
bios:CF8C ;			  ES:BX	     Pointer to	address	field list (See	below)
bios:CF8C ;
bios:CF8C ;	   Returns:	  AH	     Status of operation (See Service 01h)
bios:CF8C ;			  CF	     Set if error, cleared otherwise
bios:CF8C ;
bios:CF8C
bios:CF8C int_13_05_handler proc far				      ;	CODE XREF: int_13_main:loc_FCBC1j
bios:CF8C							      ;	DATA XREF: int_13_main+3Eo
bios:CF8C		  cmp	  dl, 4
bios:CF8F		  jb	  short	loc_FCF98
bios:CF91		  mov	  byte ptr ds:p400.diskette_last_status, 1
bios:CF96		  jmp	  short	loc_FCFEE
bios:CF98 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CF98
bios:CF98 loc_FCF98:						      ;	CODE XREF: int_13_05_handler+3j
bios:CF98		  mov	  byte ptr ds:p400.diskette_last_status, 0
bios:CF9D		  mov	  ah, 4Ah ; 'J'
bios:CF9F		  call	  sub_FD089
bios:CFA2		  jnb	  short	loc_FCFA6
bios:CFA4		  jmp	  short	loc_FCFF5
bios:CFA6 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CFA6
bios:CFA6 loc_FCFA6:						      ;	CODE XREF: int_13_05_handler+16j
bios:CFA6		  call	  get_diskette_params_addr
bios:CFA9		  call	  sub_FD1C4
bios:CFAC		  jb	  short	loc_FCFF5
bios:CFAE		  mov	  al, 4Dh ; 'M'
bios:CFB0		  call	  sub_FD118
bios:CFB3		  jb	  short	loc_FCFF5
bios:CFB5		  mov	  al, dl
bios:CFB7		  and	  al, 3
bios:CFB9		  shl	  dh, 1
bios:CFBB		  shl	  dh, 1
bios:CFBD		  or	  al, dh
bios:CFBF		  call	  sub_FD118
bios:CFC2		  jb	  short	loc_FCFF5
bios:CFC4		  mov	  bx, 3
bios:CFC7		  mov	  cx, 2
bios:CFCA		  call	  sub_FD317
bios:CFCD		  jb	  short	loc_FCFF5
bios:CFCF		  mov	  bx, 7
bios:CFD2		  call	  sub_FD317
bios:CFD5		  jb	  short	loc_FCFF5
bios:CFD7		  call	  sub_FD031
bios:CFDA		  jb	  short	loc_FCFF5
bios:CFDC		  mov	  cx, 7
bios:CFDF		  call	  sub_FD170
bios:CFE2		  jb	  short	loc_FCFF5
bios:CFE4		  test	  ah, 0C0h
bios:CFE7		  jz	  short	loc_FCFEE
bios:CFE9		  call	  sub_FD2D4
bios:CFEC		  jmp	  short	loc_FCFF5
bios:CFEE ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CFEE
bios:CFEE loc_FCFEE:						      ;	CODE XREF: int_13_05_alt_handler+8Dj
bios:CFEE							      ;	int_13_05_handler+Aj ...
bios:CFEE		  mov	  ah, ds:p400.diskette_last_status
bios:CFF2		  clc
bios:CFF3		  jmp	  short	near ptr int_13_pop_and_exit
bios:CFF5 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:CFF5
bios:CFF5 loc_FCFF5:						      ;	CODE XREF: int_13_05_handler+18j
bios:CFF5							      ;	int_13_05_handler+20j ...
bios:CFF5		  mov	  ah, ds:p400.diskette_last_status
bios:CFF9		  stc
bios:CFF9 int_13_05_handler endp
bios:CFF9
bios:CFFA
bios:CFFA ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:CFFA
bios:CFFA
bios:CFFA int_13_pop_and_exit proc far				      ;	CODE XREF: int_13_main+53j
bios:CFFA							      ;	int_13_00_handler+7Ej ...
bios:CFFA		  pushf
bios:CFFB		  push	  ax
bios:CFFC		  call	  get_diskette_params_addr
bios:CFFF		  mov	  al, es:[si+2]
bios:D003		  cli
bios:D004		  mov	  ds:p400.diskette_motor_off_timeout, al
bios:D007		  sti
bios:D008		  pop	  ax
bios:D009		  and	  byte ptr ds:p400.diskette_recalibrate_status,	7Fh
bios:D00E		  popf
bios:D00F		  pop	  es
bios:D010		  pop	  ds
bios:D011		  assume ds:nothing
bios:D011		  pop	  bp
bios:D012		  pop	  di
bios:D013		  pop	  si
bios:D014		  pop	  dx
bios:D015		  pop	  cx
bios:D016		  pop	  bx
bios:D017		  retf	  2
bios:D017 int_13_pop_and_exit endp ; sp	=  10h
bios:D017
bios:D01A
bios:D01A ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D01A
bios:D01A
bios:D01A int_0e_handler  proc far				      ;	DATA XREF: bios:FEFFo
bios:D01A		  push	  ax
bios:D01B		  push	  dx
bios:D01C		  push	  ds
bios:D01D		  mov	  ax, 40h ; '@'
bios:D020		  mov	  ds, ax
bios:D022		  assume ds:nothing
bios:D022		  or	  byte ptr ds:p400.diskette_recalibrate_status,	80h
bios:D027		  mov	  al, 20h ; ' '
bios:D029		  mov	  dx, 20h ; ' '
bios:D02C		  out	  dx, al			      ;	Interrupt controller, 8259A.
bios:D02D		  pop	  ds
bios:D02E		  assume ds:nothing
bios:D02E		  pop	  dx
bios:D02F		  pop	  ax
bios:D030		  iret
bios:D030 int_0e_handler  endp
bios:D030
bios:D031
bios:D031 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D031
bios:D031
bios:D031 sub_FD031	  proc near				      ;	CODE XREF: int_13_00_handler+46p
bios:D031							      ;	int_13_02_handler+6Dp ...
bios:D031		  push	  cx
bios:D032		  mov	  cx, 3
bios:D035		  xor	  bx, bx
bios:D037
bios:D037 loc_FD037:						      ;	CODE XREF: sub_FD031+11j
bios:D037							      ;	sub_FD031+13j
bios:D037		  test	  byte ptr ds:p400.diskette_recalibrate_status,	80h
bios:D03C		  jnz	  short	loc_FD04E
bios:D03E		  dec	  bx
bios:D03F		  cmp	  bx, 0
bios:D042		  jnz	  short	loc_FD037
bios:D044		  loop	  loc_FD037
bios:D046		  or	  byte ptr ds:p400.diskette_last_status, 80h
bios:D04B		  stc
bios:D04C		  jmp	  short	loc_FD054
bios:D04E ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D04E
bios:D04E loc_FD04E:						      ;	CODE XREF: sub_FD031+Bj
bios:D04E		  and	  byte ptr ds:p400.diskette_recalibrate_status,	7Fh
bios:D053		  clc
bios:D054
bios:D054 loc_FD054:						      ;	CODE XREF: sub_FD031+1Bj
bios:D054		  pop	  cx
bios:D055		  retn
bios:D055 sub_FD031	  endp
bios:D055
bios:D056
bios:D056 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D056
bios:D056
bios:D056 sub_FD056	  proc near				      ;	CODE XREF: int_13_02_alt_handler+12Fp
bios:D056							      ;	int_13_05_alt_handler+7Fp
bios:D056		  push	  dx
bios:D057		  push	  ax
bios:D058		  push	  cx
bios:D059		  mov	  cx, 3
bios:D05C		  xor	  bx, bx
bios:D05E		  mov	  dx, 3F4h
bios:D061
bios:D061 loc_FD061:						      ;	CODE XREF: sub_FD056+14j
bios:D061							      ;	sub_FD056+16j ...
bios:D061		  in	  al, dx			      ;	Floppy:	main status reg	bits:
bios:D061							      ;	0-3: diskette busy
bios:D061							      ;	4: 1=cntrlr busy
bios:D061							      ;	5: 1=non-DMA mode
bios:D061							      ;	6: Data	dir: 1=cntrlr to CPU
bios:D061							      ;	7: 1=OK	to snd/rcv cmd or data
bios:D062		  test	  al, 80h
bios:D064		  jnz	  short	loc_FD076
bios:D066		  dec	  bx
bios:D067		  cmp	  bx, 0
bios:D06A		  jnz	  short	loc_FD061
bios:D06C		  loop	  loc_FD061
bios:D06E		  or	  byte ptr ds:p400.diskette_last_status, 80h
bios:D073		  stc
bios:D074		  jmp	  short	loc_FD085
bios:D076 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D076
bios:D076 loc_FD076:						      ;	CODE XREF: sub_FD056+Ej
bios:D076		  test	  al, 20h
bios:D078		  jz	  short	loc_FD07F
bios:D07A		  inc	  dx
bios:D07B		  in	  al, dx			      ;	Floppy:	FDC command/data register.
bios:D07C		  dec	  dx
bios:D07D		  jmp	  short	loc_FD061
bios:D07F ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D07F
bios:D07F loc_FD07F:						      ;	CODE XREF: sub_FD056+22j
bios:D07F		  and	  byte ptr ds:p400.diskette_recalibrate_status,	7Fh
bios:D084		  clc
bios:D085
bios:D085 loc_FD085:						      ;	CODE XREF: sub_FD056+1Ej
bios:D085		  pop	  cx
bios:D086		  pop	  ax
bios:D087		  pop	  dx
bios:D088		  retn
bios:D088 sub_FD056	  endp
bios:D088
bios:D089
bios:D089 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D089
bios:D089 ; Attributes:	bp-based frame
bios:D089
bios:D089 sub_FD089	  proc near				      ;	CODE XREF: int_13_02_handler+2p
bios:D089							      ;	int_13_03_handler+2p ...
bios:D089		  push	  cx
bios:D08A		  push	  dx
bios:D08B		  push	  es
bios:D08C		  push	  bx
bios:D08D		  push	  ax
bios:D08E		  mov	  bp, sp
bios:D090		  call	  get_diskette_params_addr
bios:D093		  mov	  cl, es:[si+3]
bios:D097		  mov	  dx, 80h ; '€'
bios:D09A		  shl	  dx, cl
bios:D09C		  mov	  ax, [bp+0]
bios:D09F		  xor	  ah, ah
bios:D0A1		  mul	  dx
bios:D0A3		  cmp	  dx, 0
bios:D0A6		  jnz	  short	loc_FD109
bios:D0A8		  pop	  cx
bios:D0A9		  pop	  bx
bios:D0AA		  pop	  es
bios:D0AB		  push	  es
bios:D0AC		  push	  bx
bios:D0AD		  push	  cx
bios:D0AE		  mov	  dx, ax
bios:D0B0		  mov	  ax, es
bios:D0B2		  mov	  cl, 4
bios:D0B4		  shl	  ax, cl
bios:D0B6		  add	  bx, ax
bios:D0B8		  mov	  ax, dx
bios:D0BA		  dec	  dx
bios:D0BB		  add	  bx, dx
bios:D0BD		  jb	  short	loc_FD109
bios:D0BF		  dec	  ax
bios:D0C0		  cli
bios:D0C1		  mov	  dx, 0Ch
bios:D0C4		  out	  dx, al			      ;	DMA controller,	8237A-5.
bios:D0C4							      ;	clear byte pointer flip-flop.
bios:D0C5		  mov	  dx, 5
bios:D0C8		  out	  dx, al			      ;	DMA controller,	8237A-5.
bios:D0C8							      ;	channel	2 base address and word	count
bios:D0C9		  xchg	  ah, al
bios:D0CB		  out	  dx, al			      ;	DMA controller,	8237A-5.
bios:D0CB							      ;	channel	2 base address and word	count
bios:D0CC		  pop	  ax
bios:D0CD		  xchg	  ah, al
bios:D0CF		  mov	  dx, 0Bh
bios:D0D2		  out	  dx, al			      ;	DMA 8237A-5. mode register bits:
bios:D0D2							      ;	0-1: channel (00=0; 01=1; 10=2;	11=3)
bios:D0D2							      ;	2-3: transfer type (00=verify=Nop; 01=write; 10=read)
bios:D0D2							      ;	4: 1=enable auto-initialization
bios:D0D2							      ;	5: 1=address increment;	0=address decrement
bios:D0D2							      ;	6-7: 00=demand mode; 01=single;	10=block; 11=cascade
bios:D0D3		  pop	  bx
bios:D0D4		  pop	  es
bios:D0D5		  mov	  ax, es
bios:D0D7		  mov	  cl, 4
bios:D0D9		  shl	  ax, cl
bios:D0DB		  add	  ax, bx
bios:D0DD		  mov	  bx, 0
bios:D0E0		  jnb	  short	loc_FD0E5
bios:D0E2		  mov	  bx, 1
bios:D0E5
bios:D0E5 loc_FD0E5:						      ;	CODE XREF: sub_FD089+57j
bios:D0E5		  mov	  dx, 4
bios:D0E8		  out	  dx, al			      ;	DMA controller,	8237A-5.
bios:D0E8							      ;	channel	2 base address
bios:D0E8							      ;	(also sets current address)
bios:D0E9		  xchg	  ah, al
bios:D0EB		  out	  dx, al			      ;	DMA controller,	8237A-5.
bios:D0EB							      ;	channel	2 base address
bios:D0EB							      ;	(also sets current address)
bios:D0EC		  mov	  ax, es
bios:D0EE		  and	  ax, 0F000h
bios:D0F1		  mov	  cl, 0Ch
bios:D0F3		  shr	  ax, cl
bios:D0F5		  cmp	  bx, 0
bios:D0F8		  jz	  short	loc_FD0FC
bios:D0FA		  inc	  al
bios:D0FC
bios:D0FC loc_FD0FC:						      ;	CODE XREF: sub_FD089+6Fj
bios:D0FC		  mov	  dx, 81h ; ''
bios:D0FF		  out	  dx, al			      ;	DMA page register 74LS612:
bios:D0FF							      ;	Channel	2 (diskette DMA)  (address bits	16-23)
bios:D100		  sti
bios:D101		  mov	  dx, 0Ah
bios:D104		  mov	  al, 2
bios:D106		  out	  dx, al			      ;	DMA controller,	8237A-5.
bios:D106							      ;	single mask bit	register
bios:D106							      ;	0-1: select channel (00=0; 01=1; 10=2; 11=3)
bios:D106							      ;	2: 1=set mask for channel; 0=clear mask	(enable)
bios:D107		  jmp	  short	loc_FD114
bios:D109 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D109
bios:D109 loc_FD109:						      ;	CODE XREF: sub_FD089+1Dj
bios:D109							      ;	sub_FD089+34j
bios:D109		  stc
bios:D10A		  mov	  byte ptr ds:p400.diskette_last_status, 9
bios:D10F		  pop	  ax
bios:D110		  pop	  bx
bios:D111		  pop	  es
bios:D112		  jmp	  short	loc_FD115
bios:D114 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D114
bios:D114 loc_FD114:						      ;	CODE XREF: sub_FD089+7Ej
bios:D114		  clc
bios:D115
bios:D115 loc_FD115:						      ;	CODE XREF: sub_FD089+89j
bios:D115		  pop	  dx
bios:D116		  pop	  cx
bios:D117		  retn
bios:D117 sub_FD089	  endp
bios:D117
bios:D118
bios:D118 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D118
bios:D118
bios:D118 sub_FD118	  proc near				      ;	CODE XREF: int_13_00_handler+5Cp
bios:D118							      ;	int_13_02_handler+37p ...
bios:D118		  push	  cx
bios:D119		  push	  dx
bios:D11A		  mov	  ah, al
bios:D11C		  mov	  dx, 3F4h
bios:D11F		  xor	  cx, cx
bios:D121
bios:D121 loc_FD121:						      ;	CODE XREF: sub_FD118+Ej
bios:D121		  in	  al, dx			      ;	Floppy:	main status reg	bits:
bios:D121							      ;	0-3: diskette busy
bios:D121							      ;	4: 1=cntrlr busy
bios:D121							      ;	5: 1=non-DMA mode
bios:D121							      ;	6: Data	dir: 1=cntrlr to CPU
bios:D121							      ;	7: 1=OK	to snd/rcv cmd or data
bios:D122		  test	  al, 80h
bios:D124		  jnz	  short	loc_FD12F
bios:D126		  loop	  loc_FD121
bios:D128		  or	  byte ptr ds:p400.diskette_last_status, 80h
bios:D12D		  jmp	  short	loc_FD144
bios:D12F ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D12F
bios:D12F loc_FD12F:						      ;	CODE XREF: sub_FD118+Cj
bios:D12F		  in	  al, dx			      ;	Floppy:	main status reg	bits:
bios:D12F							      ;	0-3: diskette busy
bios:D12F							      ;	4: 1=cntrlr busy
bios:D12F							      ;	5: 1=non-DMA mode
bios:D12F							      ;	6: Data	dir: 1=cntrlr to CPU
bios:D12F							      ;	7: 1=OK	to snd/rcv cmd or data
bios:D130		  test	  al, 40h
bios:D132		  jz	  short	loc_FD13B
bios:D134		  or	  byte ptr ds:p400.diskette_last_status, 20h
bios:D139		  jmp	  short	loc_FD144
bios:D13B ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D13B
bios:D13B loc_FD13B:						      ;	CODE XREF: sub_FD118+1Aj
bios:D13B		  mov	  dx, 3F5h
bios:D13E		  mov	  al, ah
bios:D140		  out	  dx, al			      ;	Floppy:	FDC command/data register.
bios:D141		  clc
bios:D142		  jmp	  short	loc_FD145
bios:D144 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D144
bios:D144 loc_FD144:						      ;	CODE XREF: sub_FD118+15j
bios:D144							      ;	sub_FD118+21j
bios:D144		  stc
bios:D145
bios:D145 loc_FD145:						      ;	CODE XREF: sub_FD118+2Aj
bios:D145		  pop	  dx
bios:D146		  pop	  cx
bios:D147		  retn
bios:D147 sub_FD118	  endp
bios:D147
bios:D148
bios:D148 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D148
bios:D148
bios:D148 sub_FD148	  proc near				      ;	CODE XREF: sub_FD329+11p
bios:D148		  push	  cx
bios:D149		  push	  dx
bios:D14A		  mov	  dx, 3F4h
bios:D14D		  xor	  cx, cx
bios:D14F
bios:D14F loc_FD14F:						      ;	CODE XREF: sub_FD148+Cj
bios:D14F		  in	  al, dx			      ;	Floppy:	main status reg	bits:
bios:D14F							      ;	0-3: diskette busy
bios:D14F							      ;	4: 1=cntrlr busy
bios:D14F							      ;	5: 1=non-DMA mode
bios:D14F							      ;	6: Data	dir: 1=cntrlr to CPU
bios:D14F							      ;	7: 1=OK	to snd/rcv cmd or data
bios:D150		  test	  al, 80h
bios:D152		  jnz	  short	loc_FD15D
bios:D154		  loop	  loc_FD14F
bios:D156		  or	  byte ptr ds:p400.diskette_last_status, 80h
bios:D15B		  jmp	  short	loc_FD16C
bios:D15D ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D15D
bios:D15D loc_FD15D:						      ;	CODE XREF: sub_FD148+Aj
bios:D15D		  in	  al, dx			      ;	Floppy:	main status reg	bits:
bios:D15D							      ;	0-3: diskette busy
bios:D15D							      ;	4: 1=cntrlr busy
bios:D15D							      ;	5: 1=non-DMA mode
bios:D15D							      ;	6: Data	dir: 1=cntrlr to CPU
bios:D15D							      ;	7: 1=OK	to snd/rcv cmd or data
bios:D15E		  test	  al, 40h
bios:D160		  jz	  short	loc_FD169
bios:D162		  or	  byte ptr ds:p400.diskette_last_status, 20h
bios:D167		  jmp	  short	loc_FD16C
bios:D169 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D169
bios:D169 loc_FD169:						      ;	CODE XREF: sub_FD148+18j
bios:D169		  clc
bios:D16A		  jmp	  short	loc_FD16D
bios:D16C ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D16C
bios:D16C loc_FD16C:						      ;	CODE XREF: sub_FD148+13j
bios:D16C							      ;	sub_FD148+1Fj
bios:D16C		  stc
bios:D16D
bios:D16D loc_FD16D:						      ;	CODE XREF: sub_FD148+22j
bios:D16D		  pop	  dx
bios:D16E		  pop	  cx
bios:D16F		  retn
bios:D16F sub_FD148	  endp
bios:D16F
bios:D170
bios:D170 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D170
bios:D170
bios:D170 sub_FD170	  proc near				      ;	CODE XREF: int_13_02_handler+75p
bios:D170							      ;	int_13_02_alt_handler+137p ...
bios:D170		  push	  dx
bios:D171		  push	  es
bios:D172		  mov	  ax, ds
bios:D174		  mov	  es, ax
bios:D176		  lea	  di, ds:p400.diskette_command_bytes
bios:D17A		  mov	  dx, 3F4h
bios:D17D		  xor	  bx, bx
bios:D17F
bios:D17F loc_FD17F:						      ;	CODE XREF: sub_FD170+15j
bios:D17F		  in	  al, dx			      ;	Floppy:	main status reg	bits:
bios:D17F							      ;	0-3: diskette busy
bios:D17F							      ;	4: 1=cntrlr busy
bios:D17F							      ;	5: 1=non-DMA mode
bios:D17F							      ;	6: Data	dir: 1=cntrlr to CPU
bios:D17F							      ;	7: 1=OK	to snd/rcv cmd or data
bios:D180		  test	  al, 80h
bios:D182		  jnz	  short	loc_FD18E
bios:D184		  dec	  bx
bios:D185		  jnz	  short	loc_FD17F
bios:D187		  or	  byte ptr ds:p400.diskette_last_status, 80h
bios:D18C		  jmp	  short	loc_FD1C0
bios:D18E ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D18E
bios:D18E loc_FD18E:						      ;	CODE XREF: sub_FD170+12j
bios:D18E		  in	  al, dx			      ;	Floppy:	main status reg	bits:
bios:D18E							      ;	0-3: diskette busy
bios:D18E							      ;	4: 1=cntrlr busy
bios:D18E							      ;	5: 1=non-DMA mode
bios:D18E							      ;	6: Data	dir: 1=cntrlr to CPU
bios:D18E							      ;	7: 1=OK	to snd/rcv cmd or data
bios:D18F		  test	  al, 40h
bios:D191		  jnz	  short	loc_FD19A
bios:D193		  or	  byte ptr ds:p400.diskette_last_status, 20h
bios:D198		  jmp	  short	loc_FD1C0
bios:D19A ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D19A
bios:D19A loc_FD19A:						      ;	CODE XREF: sub_FD170+21j
bios:D19A							      ;	sub_FD170+3Ej
bios:D19A		  mov	  dx, 3F5h
bios:D19D		  in	  al, dx			      ;	Floppy:	FDC command/data register.
bios:D19E		  stosb
bios:D19F		  push	  cx
bios:D1A0		  mov	  cx, 8
bios:D1A3
bios:D1A3 loc_FD1A3:						      ;	CODE XREF: sub_FD170:loc_FD1A3j
bios:D1A3		  loop	  loc_FD1A3
bios:D1A5		  pop	  cx
bios:D1A6		  mov	  dx, 3F4h
bios:D1A9		  in	  al, dx			      ;	Floppy:	main status reg	bits:
bios:D1A9							      ;	0-3: diskette busy
bios:D1A9							      ;	4: 1=cntrlr busy
bios:D1A9							      ;	5: 1=non-DMA mode
bios:D1A9							      ;	6: Data	dir: 1=cntrlr to CPU
bios:D1A9							      ;	7: 1=OK	to snd/rcv cmd or data
bios:D1AA		  test	  al, 10h
bios:D1AC		  jz	  short	loc_FD1B7
bios:D1AE		  loop	  loc_FD19A
bios:D1B0		  or	  byte ptr ds:p400.diskette_last_status, 20h
bios:D1B5		  jmp	  short	loc_FD1C0
bios:D1B7 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D1B7
bios:D1B7 loc_FD1B7:						      ;	CODE XREF: sub_FD170+3Cj
bios:D1B7		  lea	  di, ds:p400.diskette_command_bytes
bios:D1BB		  mov	  ah, [di]
bios:D1BD		  clc
bios:D1BE		  jmp	  short	loc_FD1C1
bios:D1C0 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D1C0
bios:D1C0 loc_FD1C0:						      ;	CODE XREF: sub_FD170+1Cj
bios:D1C0							      ;	sub_FD170+28j ...
bios:D1C0		  stc
bios:D1C1
bios:D1C1 loc_FD1C1:						      ;	CODE XREF: sub_FD170+4Ej
bios:D1C1		  pop	  es
bios:D1C2		  pop	  dx
bios:D1C3		  retn
bios:D1C3 sub_FD170	  endp
bios:D1C3
bios:D1C4
bios:D1C4 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D1C4
bios:D1C4
bios:D1C4 sub_FD1C4	  proc near				      ;	CODE XREF: int_13_02_handler+32p
bios:D1C4							      ;	int_13_02_alt_handler+38p ...
bios:D1C4		  push	  ax
bios:D1C5		  push	  cx
bios:D1C6		  push	  dx
bios:D1C7		  mov	  al, 1
bios:D1C9		  mov	  cl, dl
bios:D1CB		  shl	  al, cl
bios:D1CD		  mov	  ah, al
bios:D1CF		  cli
bios:D1D0		  test	  ds:p400.diskette_motor_status, ah
bios:D1D4		  jnz	  short	loc_FD209
bios:D1D6		  cmp	  al, 4
bios:D1D8		  jnz	  short	loc_FD1DC
bios:D1DA		  mov	  al, 1
bios:D1DC
bios:D1DC loc_FD1DC:						      ;	CODE XREF: sub_FD1C4+14j
bios:D1DC		  mov	  cl, 4
bios:D1DE		  shl	  al, cl
bios:D1E0		  or	  al, 0Ch
bios:D1E2		  or	  al, dl
bios:D1E4		  mov	  dx, 3F2h
bios:D1E7		  out	  dx, al			      ;	Floppy:	digital	output reg bits:
bios:D1E7							      ;	0-1: Drive to select 0-3 (AT: bit 1 not	used)
bios:D1E7							      ;	2:   0=reset diskette controller; 1=enable controller
bios:D1E7							      ;	3:   1=enable diskette DMA and interrupts
bios:D1E7							      ;	4-7: drive motor enable.  Set bits to turn drive ON.
bios:D1E7							      ;
bios:D1E8		  and	  byte ptr ds:p400.diskette_motor_status, 0F0h
bios:D1ED		  or	  ds:p400.diskette_motor_status, ah
bios:D1F1		  mov	  al, es:[si+0Ah]
bios:D1F5		  cmp	  al, 0
bios:D1F7		  jz	  short	loc_FD209
bios:D1F9		  xor	  cx, cx
bios:D1FB		  mov	  byte ptr ds:p400.diskette_motor_off_timeout, 0
bios:D200		  sti
bios:D201
bios:D201 loc_FD201:						      ;	CODE XREF: sub_FD1C4:loc_FD201j
bios:D201							      ;	sub_FD1C4+43j
bios:D201		  loop	  loc_FD201
bios:D203		  dec	  al
bios:D205		  cmp	  al, 0
bios:D207		  jnz	  short	loc_FD201
bios:D209
bios:D209 loc_FD209:						      ;	CODE XREF: sub_FD1C4+10j
bios:D209							      ;	sub_FD1C4+33j
bios:D209		  mov	  byte ptr ds:p400.diskette_motor_off_timeout, 0FFh
bios:D20E		  sti
bios:D20F		  pop	  dx
bios:D210		  pop	  cx
bios:D211		  push	  cx
bios:D212		  push	  dx
bios:D213		  mov	  al, 1
bios:D215		  mov	  cl, dl
bios:D217		  shl	  al, cl
bios:D219		  mov	  cl, al
bios:D21B		  test	  ds:3Eh, al
bios:D21F		  jnz	  short	loc_FD25E
bios:D221		  mov	  al, 7
bios:D223		  call	  sub_FD118
bios:D226		  jb	  short	loc_FD2A0
bios:D228		  mov	  al, dl
bios:D22A		  and	  al, 3
bios:D22C		  call	  sub_FD118
bios:D22F		  jb	  short	loc_FD2A0
bios:D231		  call	  sub_FD031
bios:D234		  jb	  short	loc_FD2A0
bios:D236		  call	  sub_FD2AD
bios:D239		  jb	  short	loc_FD2A0
bios:D23B		  mov	  al, 7
bios:D23D		  call	  sub_FD118
bios:D240		  jb	  short	loc_FD2A0
bios:D242		  mov	  al, dl
bios:D244		  and	  al, 3
bios:D246		  call	  sub_FD118
bios:D249		  jb	  short	loc_FD2A0
bios:D24B		  call	  sub_FD031
bios:D24E		  jb	  short	loc_FD2A0
bios:D250		  call	  sub_FD2AD
bios:D253		  jb	  short	loc_FD2A0
bios:D255		  test	  ah, 0C0h
bios:D258		  jnz	  short	loc_FD2A0
bios:D25A		  or	  ds:3Eh, cl
bios:D25E
bios:D25E loc_FD25E:						      ;	CODE XREF: sub_FD1C4+5Bj
bios:D25E		  mov	  al, 0Fh
bios:D260		  call	  sub_FD118
bios:D263		  jb	  short	loc_FD2A0
bios:D265		  mov	  al, dl
bios:D267		  and	  al, 3
bios:D269		  shl	  dh, 1
bios:D26B		  shl	  dh, 1
bios:D26D		  or	  al, dh
bios:D26F		  call	  sub_FD118
bios:D272		  jb	  short	loc_FD2A0
bios:D274		  mov	  al, ch
bios:D276		  call	  sub_FD118
bios:D279		  jb	  short	loc_FD2A0
bios:D27B		  call	  sub_FD031
bios:D27E		  jb	  short	loc_FD2A0
bios:D280		  call	  sub_FD2AD
bios:D283		  jb	  short	loc_FD2A0
bios:D285		  test	  ah, 0C0h
bios:D288		  jnz	  short	loc_FD2A0
bios:D28A		  mov	  al, es:[si+9]
bios:D28E		  cmp	  al, 0
bios:D290		  jz	  short	loc_FD29D
bios:D292
bios:D292 loc_FD292:						      ;	CODE XREF: sub_FD1C4+D7j
bios:D292		  mov	  cx, 442h
bios:D295
bios:D295 loc_FD295:						      ;	CODE XREF: sub_FD1C4:loc_FD295j
bios:D295		  loop	  loc_FD295
bios:D297		  dec	  al
bios:D299		  cmp	  al, 0
bios:D29B		  jnz	  short	loc_FD292
bios:D29D
bios:D29D loc_FD29D:						      ;	CODE XREF: sub_FD1C4+CCj
bios:D29D		  clc
bios:D29E		  jmp	  short	loc_FD2A9
bios:D2A0 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D2A0
bios:D2A0 loc_FD2A0:						      ;	CODE XREF: sub_FD1C4+62j
bios:D2A0							      ;	sub_FD1C4+6Bj ...
bios:D2A0		  or	  byte ptr ds:p400.diskette_last_status, 40h
bios:D2A5		  call	  sub_FD2D4
bios:D2A8		  stc
bios:D2A9
bios:D2A9 loc_FD2A9:						      ;	CODE XREF: sub_FD1C4+DAj
bios:D2A9		  pop	  dx
bios:D2AA		  pop	  cx
bios:D2AB		  pop	  ax
bios:D2AC		  retn
bios:D2AC sub_FD1C4	  endp
bios:D2AC
bios:D2AD
bios:D2AD ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D2AD
bios:D2AD
bios:D2AD sub_FD2AD	  proc near				      ;	CODE XREF: int_13_00_handler+49p
bios:D2AD							      ;	sub_FD1C4+72p ...
bios:D2AD		  push	  cx
bios:D2AE		  push	  si
bios:D2AF		  lea	  si, ds:p400.diskette_command_bytes
bios:D2B3		  mov	  ax, [si]
bios:D2B5		  push	  ax
bios:D2B6		  mov	  al, 8
bios:D2B8		  call	  sub_FD118
bios:D2BB		  jb	  short	loc_FD2CF
bios:D2BD		  mov	  cx, 2
bios:D2C0		  call	  sub_FD170
bios:D2C3		  jb	  short	loc_FD2CF
bios:D2C5		  mov	  ax, [si]
bios:D2C7		  xchg	  ah, al
bios:D2C9		  pop	  bx
bios:D2CA		  mov	  [si],	bx
bios:D2CC		  clc
bios:D2CD		  jmp	  short	loc_FD2D1
bios:D2CF ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D2CF
bios:D2CF loc_FD2CF:						      ;	CODE XREF: sub_FD2AD+Ej
bios:D2CF							      ;	sub_FD2AD+16j
bios:D2CF		  pop	  bx
bios:D2D0		  stc
bios:D2D1
bios:D2D1 loc_FD2D1:						      ;	CODE XREF: sub_FD2AD+20j
bios:D2D1		  pop	  si
bios:D2D2		  pop	  cx
bios:D2D3		  retn
bios:D2D3 sub_FD2AD	  endp
bios:D2D3
bios:D2D4
bios:D2D4 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D2D4
bios:D2D4
bios:D2D4 sub_FD2D4	  proc near				      ;	CODE XREF: int_13_02_handler+80p
bios:D2D4							      ;	int_13_02_alt_handler+142p ...
bios:D2D4		  lea	  si, ds:p400.diskette_command_bytes
bios:D2D8		  mov	  al, [si+1]
bios:D2DB		  or	  al, [si+2]
bios:D2DE		  mov	  cx, 8
bios:D2E1		  xor	  bx, bx
bios:D2E3		  and	  al, 0B7h
bios:D2E5
bios:D2E5 loc_FD2E5:						      ;	CODE XREF: sub_FD2D4+18j
bios:D2E5		  test	  al, 1
bios:D2E7		  jnz	  short	loc_FD2F0
bios:D2E9		  inc	  bx
bios:D2EA		  ror	  al, 1
bios:D2EC		  loop	  loc_FD2E5
bios:D2EE		  jmp	  short	locret_FD2F9
bios:D2F0 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D2F0
bios:D2F0 loc_FD2F0:						      ;	CODE XREF: sub_FD2D4+13j
bios:D2F0		  mov	  al, cs:diskette_something[bx]
bios:D2F5		  or	  ds:p400.diskette_last_status,	al
bios:D2F9
bios:D2F9 locret_FD2F9:						      ;	CODE XREF: sub_FD2D4+1Aj
bios:D2F9		  retn
bios:D2F9 sub_FD2D4	  endp
bios:D2F9
bios:D2F9 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D2FA diskette_something db	2				      ;	DATA XREF: sub_FD2D4:loc_FD2F0r
bios:D2FB		  db	3
bios:D2FC		  db	4
bios:D2FD		  db	0
bios:D2FE		  db	8
bios:D2FF		  db  10h
bios:D300		  db	0
bios:D301		  db	4
bios:D302
bios:D302 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D302
bios:D302
bios:D302 get_diskette_params_addr proc	near			      ;	CODE XREF: int_13_02_handler+2Fp
bios:D302							      ;	int_13_02_alt_handler+35p ...
bios:D302		  push	  ax
bios:D303		  xor	  ax, ax
bios:D305		  mov	  es, ax
bios:D307		  push	  bx
bios:D308		  mov	  bx, 78h ; 'x'
bios:D30B		  mov	  si, es:[bx]			      ;	int 1e low
bios:D30E		  mov	  ax, es:[bx+2]			      ;	int 1e hi
bios:D312		  mov	  es, ax
bios:D314		  pop	  bx
bios:D315		  pop	  ax
bios:D316		  retn
bios:D316 get_diskette_params_addr endp
bios:D316
bios:D317
bios:D317 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D317
bios:D317
bios:D317 sub_FD317	  proc near				      ;	CODE XREF: int_13_00_handler:loc_FCC5Bp
bios:D317							      ;	int_13_02_handler+68p ...
bios:D317		  push	  cx
bios:D318		  call	  get_diskette_params_addr
bios:D31B
bios:D31B loc_FD31B:						      ;	CODE XREF: sub_FD317+Dj
bios:D31B		  mov	  al, es:[bx+si]
bios:D31E		  call	  sub_FD118
bios:D321		  jb	  short	loc_FD327
bios:D323		  inc	  bx
bios:D324		  loop	  loc_FD31B
bios:D326		  clc
bios:D327
bios:D327 loc_FD327:						      ;	CODE XREF: sub_FD317+Aj
bios:D327		  pop	  cx
bios:D328		  retn
bios:D328 sub_FD317	  endp
bios:D328
bios:D329
bios:D329 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D329
bios:D329
bios:D329 sub_FD329	  proc near				      ;	CODE XREF: int_13_02_alt_handler+6Ep
bios:D329							      ;	int_13_05_alt_handler+4Ep
bios:D329		  push	  cx
bios:D32A		  call	  get_diskette_params_addr
bios:D32D		  dec	  cx
bios:D32E
bios:D32E loc_FD32E:						      ;	CODE XREF: sub_FD329+Ej
bios:D32E		  mov	  al, es:[bx+si]
bios:D331		  call	  sub_FD118
bios:D334		  jb	  short	loc_FD342
bios:D336		  inc	  bx
bios:D337		  loop	  loc_FD32E
bios:D339		  clc
bios:D33A		  call	  sub_FD148
bios:D33D		  jb	  short	loc_FD342
bios:D33F		  mov	  dh, es:[bx+si]
bios:D342
bios:D342 loc_FD342:						      ;	CODE XREF: sub_FD329+Bj
bios:D342							      ;	sub_FD329+14j
bios:D342		  pop	  cx
bios:D343		  retn
bios:D343 sub_FD329	  endp
bios:D343
bios:D344
bios:D344 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D344
bios:D344
bios:D344 sub_FD344	  proc near				      ;	CODE XREF: int_13_00_handler+6Ep
bios:D344		  push	  cx
bios:D345		  call	  get_diskette_params_addr
bios:D348		  mov	  al, es:[bx+si]
bios:D34B		  call	  sub_FD118
bios:D34E		  jb	  short	loc_FD35C
bios:D350		  inc	  bx
bios:D351		  mov	  al, es:[bx+si]
bios:D354		  or	  al, 1
bios:D356		  call	  sub_FD118
bios:D359		  jb	  short	loc_FD35C
bios:D35B		  clc
bios:D35C
bios:D35C loc_FD35C:						      ;	CODE XREF: sub_FD344+Aj
bios:D35C							      ;	sub_FD344+15j
bios:D35C		  pop	  cx
bios:D35D		  retn
bios:D35D sub_FD344	  endp
bios:D35D
bios:D35D ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D35E value_b000	  dw 0B000h				      ;	DATA XREF: scroll_graphics_up_or_downr
bios:D35E							      ;	gfx_get_ascii_value_for_row_col+15r ...
bios:D360
bios:D360 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D360
bios:D360 ;	Scrolls	a specified window upward/downward a specified number of lines.
bios:D360 ;
bios:D360 ;	   On entry:	  AH	     06h
bios:D360 ;			  AL	     Number of lines to	scroll (if 0, clear entire
bios:D360 ;				     window)
bios:D360 ;			  BH	     Attribute (alpha modes) or	color (graphics	modes) to be used on blank line
bios:D360 ;			  CH	     Row number	of upper left corner
bios:D360 ;			  CL	     Column number of upper left corner
bios:D360 ;			  DH	     Row number	of lower right corner
bios:D360 ;			  DL	     Column number of lower right corner
bios:D360 ;			  [BP+0]     Direction:	0=Upwards. 1=Downwards
bios:D360 ;
bios:D360 ;	   Returns:	  None
bios:D360 ; Attributes:	bp-based frame
bios:D360
bios:D360 scroll_graphics_up_or_down proc near			      ;	CODE XREF: scroll_up_or_down+1Dj
bios:D360
bios:D360 var_orig_di	  = word ptr -4
bios:D360 var_orig_si	  = word ptr -2
bios:D360 arg_scroll_direction=	word ptr  4
bios:D360 arg_row_bottom  = byte ptr  11h
bios:D360 arg_row_top	  = byte ptr  13h
bios:D360 arg_color	  = byte ptr  15h
bios:D360
bios:D360		  mov	  es, cs:value_b000		      ;	es = 0xb000 (graphics segment)
bios:D365		  assume es:nothing
bios:D365		  cmp	  word ptr [bp+0], 0		      ;	0=scroll up, 1=	scroll down
bios:D369		  jz	  short	s0
bios:D36B		  mov	  dh, ch
bios:D36D
bios:D36D s0:							      ;	CODE XREF: scroll_graphics_up_or_down+9j
bios:D36D		  inc	  dl
bios:D36F		  push	  ax
bios:D370		  mov	  ax, ds:p400.crt_nr_cols
bios:D373		  mov	  ch, al
bios:D375		  pop	  ax
bios:D376		  cmp	  dl, ch
bios:D378		  jnz	  short	s1
bios:D37A		  inc	  dh
bios:D37C		  xor	  dl, dl
bios:D37E		  call	  multiply_dl_dh_by_8_bis	      ;	cx = dl	* 8; dx	= dh * 8
bios:D381		  jmp	  short	s2
bios:D383 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D383
bios:D383 s1:							      ;	CODE XREF: scroll_graphics_up_or_down+18j
bios:D383		  call	  multiply_dl_dh_by_8_bis
bios:D386		  add	  bx, 0F0h ; 'ğ'
bios:D38A		  cmp	  byte ptr ds:p400.crt_mode, 9
bios:D38F		  jb	  short	s2
bios:D391		  sub	  bx, 50h ; 'P'
bios:D394
bios:D394 s2:							      ;	CODE XREF: scroll_graphics_up_or_down+21j
bios:D394							      ;	scroll_graphics_up_or_down+2Fj
bios:D394		  add	  bh, 20h ; ' '
bios:D397		  cmp	  byte ptr ds:p400.crt_mode, 9
bios:D39C		  jb	  short	s3
bios:D39E		  add	  bh, 40h ; '@'
bios:D3A1
bios:D3A1 s3:							      ;	CODE XREF: scroll_graphics_up_or_down+3Cj
bios:D3A1		  push	  bx				      ;	sp += 2
bios:D3A2		  mov	  bp, sp			      ;	bp = sp
bios:D3A4		  xor	  ch, ch
bios:D3A6		  cmp	  [bp+arg_scroll_direction], 0
bios:D3AA		  jz	  short	s4
bios:D3AC		  mov	  ch, [bp+arg_row_bottom]
bios:D3AF		  sub	  ch, [bp+arg_row_top]
bios:D3B2
bios:D3B2 s4:							      ;	CODE XREF: scroll_graphics_up_or_down+4Aj
bios:D3B2		  mov	  dx, [bp+12h]
bios:D3B5		  add	  dh, ch
bios:D3B7		  push	  cx
bios:D3B8		  call	  multiply_dl_dh_by_8_bis
bios:D3BB		  mov	  di, bx
bios:D3BD		  pop	  cx
bios:D3BE		  mov	  dh, [bp+arg_row_bottom]
bios:D3C1		  sub	  dh, [bp+arg_row_top]
bios:D3C4		  cmp	  dh, 0
bios:D3C7		  jnz	  short	s5
bios:D3C9		  jmp	  l1
bios:D3CC ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D3CC
bios:D3CC s5:							      ;	CODE XREF: scroll_graphics_up_or_down+67j
bios:D3CC		  mov	  dx, [bp+12h]
bios:D3CF		  add	  dh, ch
bios:D3D1		  cmp	  [bp+arg_scroll_direction], 0
bios:D3D5		  jnz	  short	s6
bios:D3D7		  add	  dh, al
bios:D3D9		  jmp	  short	s7
bios:D3DB ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D3DB
bios:D3DB s6:							      ;	CODE XREF: scroll_graphics_up_or_down+75j
bios:D3DB		  sub	  dh, al
bios:D3DD
bios:D3DD s7:							      ;	CODE XREF: scroll_graphics_up_or_down+79j
bios:D3DD		  call	  multiply_dl_dh_by_8_bis
bios:D3E0		  mov	  si, bx
bios:D3E2		  xor	  cx, cx
bios:D3E4		  cmp	  al, 0
bios:D3E6		  jnz	  short	l0
bios:D3E8		  jmp	  l1
bios:D3EB ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D3EB
bios:D3EB l0:							      ;	CODE XREF: scroll_graphics_up_or_down+86j
bios:D3EB							      ;	scroll_graphics_up_or_down+12Cj
bios:D3EB		  push	  si
bios:D3EC		  push	  di
bios:D3ED		  push	  ds
bios:D3EE		  xor	  bx, bx
bios:D3F0		  mov	  cl, ah
bios:D3F2		  cmp	  byte ptr ds:p400.crt_mode, 6
bios:D3F7		  jz	  short	s10
bios:D3F9		  cmp	  byte ptr ds:p400.crt_mode, 8
bios:D3FE		  jb	  short	s9
bios:D400		  cmp	  byte ptr ds:p400.crt_mode, 0Ah
bios:D405		  jnb	  short	s9
bios:D407		  shl	  cl, 1
bios:D409
bios:D409 s9:							      ;	CODE XREF: scroll_graphics_up_or_down+9Ej
bios:D409							      ;	scroll_graphics_up_or_down+A5j
bios:D409		  shl	  cl, 1
bios:D40B
bios:D40B s10:							      ;	CODE XREF: scroll_graphics_up_or_down+97j
bios:D40B		  mov	  dh, ds:p400.crt_mode
bios:D40F		  push	  ax
bios:D410		  mov	  ax, es
bios:D412		  mov	  ds, ax
bios:D414		  assume ds:nothing
bios:D414		  pop	  ax
bios:D415		  mov	  dl, 4
bios:D417		  cmp	  dh, 9
bios:D41A		  jb	  short	s11
bios:D41C		  mov	  dl, 2
bios:D41E
bios:D41E s11:							      ;	CODE XREF: scroll_graphics_up_or_down+BAj
bios:D41E							      ;	scroll_graphics_up_or_down+11Fj
bios:D41E		  mov	  si, [bp+var_orig_si]		      ;	do the scroll (copy lines from one place to another)
bios:D421		  mov	  di, [bp+var_orig_di]
bios:D424		  add	  si, bx
bios:D426		  add	  di, bx
bios:D428		  push	  cx
bios:D429		  rep movsb
bios:D42B		  pop	  cx
bios:D42C		  mov	  si, [bp+var_orig_si]
bios:D42F		  mov	  di, [bp+var_orig_di]
bios:D432		  add	  si, 2000h
bios:D436		  add	  di, 2000h
bios:D43A		  add	  si, bx
bios:D43C		  add	  di, bx
bios:D43E		  push	  cx
bios:D43F		  rep movsb
bios:D441		  pop	  cx
bios:D442		  cmp	  dh, 9
bios:D445		  jb	  short	s12
bios:D447		  mov	  si, [bp+var_orig_si]
bios:D44A		  mov	  di, [bp+var_orig_di]
bios:D44D		  add	  si, 4000h
bios:D451		  add	  di, 4000h
bios:D455		  add	  si, bx
bios:D457		  add	  di, bx
bios:D459		  push	  cx
bios:D45A		  rep movsb
bios:D45C		  pop	  cx
bios:D45D		  mov	  si, [bp+var_orig_si]
bios:D460		  mov	  di, [bp+var_orig_di]
bios:D463		  add	  si, 6000h
bios:D467		  add	  di, 6000h
bios:D46B		  add	  si, bx
bios:D46D		  add	  di, bx
bios:D46F		  push	  cx
bios:D470		  rep movsb
bios:D472		  pop	  cx
bios:D473		  add	  bx, 0A0h ; ' '
bios:D477		  jmp	  short	s13
bios:D479 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D479		  nop
bios:D47A
bios:D47A s12:							      ;	CODE XREF: scroll_graphics_up_or_down+E5j
bios:D47A		  add	  bx, 50h ; 'P'
bios:D47D
bios:D47D s13:							      ;	CODE XREF: scroll_graphics_up_or_down+117j
bios:D47D		  dec	  dl
bios:D47F		  jnz	  short	s11
bios:D481		  pop	  ds
bios:D482		  assume ds:nothing
bios:D482		  cmp	  si, [bp+0]
bios:D485		  jz	  short	s14
bios:D487		  pop	  di
bios:D488		  pop	  si
bios:D489		  call	  add_or_sub_320
bios:D48C		  jmp	  l0
bios:D48F ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D48F
bios:D48F s14:							      ;	CODE XREF: scroll_graphics_up_or_down+125j
bios:D48F		  pop	  di
bios:D490		  pop	  si
bios:D491		  call	  add_or_sub_320
bios:D494
bios:D494 l1:							      ;	CODE XREF: scroll_graphics_up_or_down+69j
bios:D494							      ;	scroll_graphics_up_or_down+88j	...
bios:D494		  push	  di
bios:D495		  mov	  al, [bp+arg_color]
bios:D498		  xor	  bx, bx
bios:D49A		  mov	  cl, ah
bios:D49C		  mov	  dx, 4
bios:D49F		  cmp	  byte ptr ds:p400.crt_mode, 9
bios:D4A4		  jb	  short	s15
bios:D4A6		  mov	  dx, 2
bios:D4A9
bios:D4A9 s15:							      ;	CODE XREF: scroll_graphics_up_or_down+144j
bios:D4A9		  cmp	  byte ptr ds:p400.crt_mode, 6
bios:D4AE		  jz	  short	l2
bios:D4B0		  cmp	  byte ptr ds:p400.crt_mode, 8
bios:D4B5		  jb	  short	s16
bios:D4B7		  cmp	  byte ptr ds:p400.crt_mode, 0Ah
bios:D4BC		  jnb	  short	s16
bios:D4BE		  shl	  cl, 1
bios:D4C0
bios:D4C0 s16:							      ;	CODE XREF: scroll_graphics_up_or_down+155j
bios:D4C0							      ;	scroll_graphics_up_or_down+15Cj
bios:D4C0		  shl	  cl, 1
bios:D4C2
bios:D4C2 l2:							      ;	CODE XREF: scroll_graphics_up_or_down+14Ej
bios:D4C2							      ;	scroll_graphics_up_or_down+1A4j
bios:D4C2		  mov	  di, [bp+var_orig_si]		      ;	clean the new lines
bios:D4C5		  add	  di, bx
bios:D4C7		  push	  cx
bios:D4C8		  rep stosb
bios:D4CA		  pop	  cx
bios:D4CB		  mov	  di, [bp+var_orig_si]
bios:D4CE		  add	  di, 2000h
bios:D4D2		  add	  di, bx
bios:D4D4		  push	  cx
bios:D4D5		  rep stosb
bios:D4D7		  pop	  cx
bios:D4D8		  cmp	  byte ptr ds:p400.crt_mode, 9
bios:D4DD		  jb	  short	s17
bios:D4DF		  mov	  di, [bp+var_orig_si]
bios:D4E2		  add	  di, 4000h
bios:D4E6		  add	  di, bx
bios:D4E8		  push	  cx
bios:D4E9		  rep stosb
bios:D4EB		  pop	  cx
bios:D4EC		  mov	  di, [bp+var_orig_si]
bios:D4EF		  add	  di, 6000h
bios:D4F3		  add	  di, bx
bios:D4F5		  push	  cx
bios:D4F6		  rep stosb
bios:D4F8		  pop	  cx
bios:D4F9		  add	  bx, 0A0h ; ' '
bios:D4FD		  jmp	  short	s18
bios:D4FF ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D4FF		  nop
bios:D500
bios:D500 s17:							      ;	CODE XREF: scroll_graphics_up_or_down+17Dj
bios:D500		  add	  bx, 50h ; 'P'
bios:D503
bios:D503 s18:							      ;	CODE XREF: scroll_graphics_up_or_down+19Dj
bios:D503		  dec	  dx
bios:D504		  jnz	  short	l2
bios:D506		  cmp	  di, [bp+0]
bios:D509		  jz	  short	exit
bios:D50B		  pop	  di
bios:D50C		  call	  add_or_sub_320
bios:D50F		  jmp	  short	l1
bios:D511 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D511
bios:D511 exit:							      ;	CODE XREF: scroll_graphics_up_or_down+1A9j
bios:D511		  pop	  di
bios:D512		  pop	  bx
bios:D513		  retn
bios:D513 scroll_graphics_up_or_down endp
bios:D513
bios:D514
bios:D514 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D514
bios:D514
bios:D514 gfx_get_ascii_value_for_row_col proc near		      ;	CODE XREF: int_10_08_handler+Ap
bios:D514		  call	  multiply_dl_dh_by_8_bis
bios:D517		  sub	  sp, 0Ah
bios:D51A		  mov	  bp, sp
bios:D51C		  push	  bx
bios:D51D		  xor	  bx, bx
bios:D51F		  mov	  cx, 8
bios:D522		  xor	  dl, dl
bios:D524
bios:D524 loc_FD524:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col:loc_FD61Bj
bios:D524		  pop	  si
bios:D525		  push	  si
bios:D526		  add	  si, bx
bios:D528		  push	  es
bios:D529		  mov	  es, cs:value_b000
bios:D52E		  cmp	  byte ptr ds:p400.crt_mode, 6
bios:D533		  jnz	  short	loc_FD538
bios:D535		  jmp	  loc_FD5E5
bios:D538 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D538
bios:D538 loc_FD538:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+1Fj
bios:D538		  cmp	  byte ptr ds:p400.crt_mode, 0Ah
bios:D53D		  jnz	  short	loc_FD542
bios:D53F		  jmp	  loc_FD5CA
bios:D542 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D542
bios:D542 loc_FD542:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+29j
bios:D542		  cmp	  byte ptr ds:p400.crt_mode, 8
bios:D547		  jnb	  short	loc_FD57D
bios:D549		  mov	  ax, es:[si]
bios:D54C		  inc	  si
bios:D54D		  inc	  si
bios:D54E		  xchg	  ah, al
bios:D550		  push	  bx
bios:D551		  push	  cx
bios:D552		  mov	  cx, 8
bios:D555		  xor	  dh, dh
bios:D557
bios:D557 loc_FD557:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col:loc_FD575j
bios:D557		  xor	  bl, bl
bios:D559		  shl	  dh, 1
bios:D55B		  shl	  ax, 1
bios:D55D		  jnb	  short	loc_FD564
bios:D55F		  or	  dl, 2
bios:D562		  mov	  bl, 1
bios:D564
bios:D564 loc_FD564:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+49j
bios:D564		  shl	  ax, 1
bios:D566		  jnb	  short	loc_FD56D
bios:D568		  or	  dl, 1
bios:D56B		  mov	  bl, 1
bios:D56D
bios:D56D loc_FD56D:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+52j
bios:D56D		  cmp	  bl, 0
bios:D570		  jz	  short	loc_FD575
bios:D572		  or	  dh, 1
bios:D575
bios:D575 loc_FD575:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+5Cj
bios:D575		  loop	  loc_FD557
bios:D577		  pop	  cx
bios:D578		  pop	  bx
bios:D579		  mov	  al, dh
bios:D57B		  jmp	  short	loc_FD5EF
bios:D57D ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D57D
bios:D57D loc_FD57D:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+33j
bios:D57D		  push	  bx
bios:D57E		  push	  cx
bios:D57F		  xor	  dh, dh
bios:D581		  mov	  cx, 2
bios:D584
bios:D584 loc_FD584:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+AEj
bios:D584		  push	  cx
bios:D585		  mov	  cx, 4
bios:D588		  mov	  ax, es:[si]
bios:D58B		  inc	  si
bios:D58C		  inc	  si
bios:D58D		  xchg	  ah, al
bios:D58F
bios:D58F loc_FD58F:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col:loc_FD5BFj
bios:D58F		  xor	  bl, bl
bios:D591		  shl	  dh, 1
bios:D593		  shl	  ax, 1
bios:D595		  jnb	  short	loc_FD59C
bios:D597		  or	  dl, 8
bios:D59A		  mov	  bl, 1
bios:D59C
bios:D59C loc_FD59C:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+81j
bios:D59C		  shl	  ax, 1
bios:D59E		  jnb	  short	loc_FD5A5
bios:D5A0		  or	  dl, 4
bios:D5A3		  mov	  bl, 1
bios:D5A5
bios:D5A5 loc_FD5A5:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+8Aj
bios:D5A5		  shl	  ax, 1
bios:D5A7		  jnb	  short	loc_FD5AE
bios:D5A9		  or	  dl, 2
bios:D5AC		  mov	  bl, 1
bios:D5AE
bios:D5AE loc_FD5AE:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+93j
bios:D5AE		  shl	  ax, 1
bios:D5B0		  jnb	  short	loc_FD5B7
bios:D5B2		  or	  dl, 1
bios:D5B5		  mov	  bl, 1
bios:D5B7
bios:D5B7 loc_FD5B7:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+9Cj
bios:D5B7		  cmp	  bl, 0
bios:D5BA		  jz	  short	loc_FD5BF
bios:D5BC		  or	  dh, 1
bios:D5BF
bios:D5BF loc_FD5BF:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+A6j
bios:D5BF		  loop	  loc_FD58F
bios:D5C1		  pop	  cx
bios:D5C2		  loop	  loc_FD584
bios:D5C4		  pop	  cx
bios:D5C5		  pop	  bx
bios:D5C6		  mov	  al, dh
bios:D5C8		  jmp	  short	loc_FD5EF
bios:D5CA ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D5CA
bios:D5CA loc_FD5CA:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+2Bj
bios:D5CA		  mov	  al, es:[si]
bios:D5CD		  cmp	  al, 0
bios:D5CF		  jz	  short	loc_FD5D4
bios:D5D1		  or	  dl, 1
bios:D5D4
bios:D5D4 loc_FD5D4:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+BBj
bios:D5D4		  mov	  ah, es:[si+1]
bios:D5D8		  cmp	  ah, 0
bios:D5DB		  jz	  short	loc_FD5E0
bios:D5DD		  or	  dl, 2
bios:D5E0
bios:D5E0 loc_FD5E0:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+C7j
bios:D5E0		  or	  al, ah
bios:D5E2		  jmp	  short	loc_FD5EF
bios:D5E4 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D5E4		  nop
bios:D5E5
bios:D5E5 loc_FD5E5:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+21j
bios:D5E5		  mov	  al, es:[si]
bios:D5E8		  inc	  si
bios:D5E9		  cmp	  al, 0
bios:D5EB		  jz	  short	loc_FD5EF
bios:D5ED		  mov	  dl, 1
bios:D5EF
bios:D5EF loc_FD5EF:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+67j
bios:D5EF							      ;	gfx_get_ascii_value_for_row_col+B4j ...
bios:D5EF		  pop	  es
bios:D5F0		  assume es:nothing
bios:D5F0		  cmp	  byte ptr ds:p400.crt_mode, 9
bios:D5F5		  jb	  short	loc_FD603
bios:D5F7		  cmp	  cx, 5
bios:D5FA		  jnz	  short	loc_FD609
bios:D5FC		  sub	  bx, 5F60h
bios:D600		  jmp	  short	loc_FD612
bios:D602 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D602		  nop
bios:D603
bios:D603 loc_FD603:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+E1j
bios:D603		  test	  cx, 1
bios:D607		  jnz	  short	loc_FD60E
bios:D609
bios:D609 loc_FD609:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+E6j
bios:D609		  add	  bh, 20h ; ' '
bios:D60C		  jmp	  short	loc_FD612
bios:D60E ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D60E
bios:D60E loc_FD60E:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+F3j
bios:D60E		  sub	  bx, 1FB0h
bios:D612
bios:D612 loc_FD612:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+ECj
bios:D612							      ;	gfx_get_ascii_value_for_row_col+F8j
bios:D612		  mov	  [bp+0], al
bios:D615		  inc	  bp
bios:D616		  loop	  loc_FD61B
bios:D618		  jmp	  short	loc_FD61E
bios:D61A ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D61A		  nop
bios:D61B
bios:D61B loc_FD61B:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+102j
bios:D61B		  jmp	  loc_FD524
bios:D61E ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D61E
bios:D61E loc_FD61E:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+104j
bios:D61E		  sub	  bp, 8
bios:D621		  mov	  [bp+8], dl
bios:D624		  xor	  ax, ax
bios:D626		  mov	  es, ax
bios:D628		  mov	  bx, 110h			      ;	0000:0110 = int	44 (charset 0-127)
bios:D62B		  mov	  di, es:[bx]			      ;	int 44 low
bios:D62E		  mov	  ax, es:[bx+2]			      ;	int 44 hi
bios:D632		  mov	  es, ax
bios:D634		  xor	  cx, cx
bios:D636		  push	  ds
bios:D637		  mov	  ax, ss
bios:D639		  mov	  ds, ax
bios:D63B		  assume ds:nothing
bios:D63B		  xor	  ax, ax
bios:D63D		  jmp	  short	loc_FD645
bios:D63F ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D63F
bios:D63F loc_FD63F:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+13Ej
bios:D63F							      ;	gfx_get_ascii_value_for_row_col+143j
bios:D63F		  inc	  ax
bios:D640		  cmp	  ax, 7Fh ; ''                       ; char is 0x80 or bigger ?
bios:D643		  ja	  short	loc_FD65B
bios:D645
bios:D645 loc_FD645:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+129j
bios:D645		  mov	  si, bp
bios:D647		  mov	  cx, 4
bios:D64A		  repe cmpsw
bios:D64C		  jz	  short	loc_FD654
bios:D64E		  add	  di, cx
bios:D650		  add	  di, cx
bios:D652		  jmp	  short	loc_FD63F
bios:D654 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D654
bios:D654 loc_FD654:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+138j
bios:D654		  cmp	  cx, 0
bios:D657		  jnz	  short	loc_FD63F
bios:D659		  jmp	  short	loc_FD699
bios:D65B ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D65B
bios:D65B loc_FD65B:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+12Fj
bios:D65B		  xor	  ax, ax
bios:D65D		  mov	  es, ax
bios:D65F		  mov	  bx, 7Ch ; '|'                       ; 0000:007c int 1f (charset 128-255)
bios:D662		  mov	  di, es:[bx]
bios:D665		  mov	  ax, es:[bx+2]
bios:D669		  mov	  es, ax
bios:D66B		  xor	  cx, cx
bios:D66D		  mov	  ax, ss
bios:D66F		  mov	  ds, ax
bios:D671		  xor	  ax, ax
bios:D673		  jmp	  short	loc_FD67B
bios:D675 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D675
bios:D675 loc_FD675:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+174j
bios:D675							      ;	gfx_get_ascii_value_for_row_col+179j
bios:D675		  inc	  ax
bios:D676		  cmp	  ax, 7Fh ; ''
bios:D679		  ja	  short	loc_FD694
bios:D67B
bios:D67B loc_FD67B:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+15Fj
bios:D67B		  mov	  si, bp
bios:D67D		  mov	  cx, 4
bios:D680		  repe cmpsw
bios:D682		  jz	  short	loc_FD68A
bios:D684		  add	  di, cx
bios:D686		  add	  di, cx
bios:D688		  jmp	  short	loc_FD675
bios:D68A ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D68A
bios:D68A loc_FD68A:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+16Ej
bios:D68A		  cmp	  cx, 0
bios:D68D		  jnz	  short	loc_FD675
bios:D68F		  add	  ax, 80h ; '€'
bios:D692		  jmp	  short	loc_FD699
bios:D694 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D694
bios:D694 loc_FD694:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+165j
bios:D694		  pop	  ds
bios:D695		  assume ds:nothing
bios:D695		  xor	  ax, ax
bios:D697		  jmp	  short	loc_FD69D
bios:D699 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D699
bios:D699 loc_FD699:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+145j
bios:D699							      ;	gfx_get_ascii_value_for_row_col+17Ej
bios:D699		  pop	  ds
bios:D69A		  mov	  ah, [bp+8]
bios:D69D
bios:D69D loc_FD69D:						      ;	CODE XREF: gfx_get_ascii_value_for_row_col+183j
bios:D69D		  add	  sp, 0Ah
bios:D6A0		  pop	  bx
bios:D6A1		  retn
bios:D6A1 gfx_get_ascii_value_for_row_col endp
bios:D6A1
bios:D6A2
bios:D6A2 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D6A2
bios:D6A2
bios:D6A2 gfx_print_char  proc near				      ;	CODE XREF: int_10_0a_handler+12p
bios:D6A2
bios:D6A2 ; FUNCTION CHUNK AT bios:D869	SIZE 00000003 BYTES
bios:D6A2
bios:D6A2		  mov	  bx, cx
bios:D6A4		  call	  multiply_dl_dh_by_8
bios:D6A7		  push	  cx
bios:D6A8		  push	  dx
bios:D6A9		  push	  bx
bios:D6AA		  push	  ax
bios:D6AB		  cmp	  al, 7Fh ; ''                       ; char to print is between 0-127?
bios:D6AD		  jbe	  short	get_charset_0_127
bios:D6AF		  pop	  ax
bios:D6B0		  sub	  al, 80h ; '€'
bios:D6B2		  push	  ax
bios:D6B3		  xor	  ax, ax
bios:D6B5		  mov	  es, ax
bios:D6B7		  mov	  bx, 7Ch ; '|'                       ; int 1f (charset 128-255)
bios:D6BA		  mov	  si, es:[bx]
bios:D6BD		  mov	  ax, es:[bx+2]
bios:D6C1		  mov	  es, ax			      ;	es:si ptr to charset
bios:D6C3		  jmp	  short	calc_offset_and_print
bios:D6C5 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D6C5
bios:D6C5 get_charset_0_127:					      ;	CODE XREF: gfx_print_char+Bj
bios:D6C5		  xor	  ax, ax
bios:D6C7		  mov	  es, ax
bios:D6C9		  mov	  bx, 110h			      ;	int 44 (charset	0-127)
bios:D6CC		  mov	  si, es:[bx]
bios:D6CF		  mov	  ax, es:[bx+2]
bios:D6D3		  mov	  es, ax			      ;	es:si ptr to charset
bios:D6D5
bios:D6D5 calc_offset_and_print:				      ;	CODE XREF: gfx_print_char+21j
bios:D6D5		  pop	  ax
bios:D6D6		  xor	  bh, bh
bios:D6D8		  mov	  bl, al
bios:D6DA		  shl	  bx, 1
bios:D6DC		  shl	  bx, 1
bios:D6DE		  shl	  bx, 1				      ;	char * 8.  es:si ptr to	charset[char]
bios:D6E0		  add	  si, bx
bios:D6E2		  jmp	  short	print_char_at_offset
bios:D6E4 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D6E4
bios:D6E4 something_with_screen_width:				      ;	CODE XREF: gfx_print_char:loc_FD7BAj
bios:D6E4		  mov	  bp, cx
bios:D6E6		  pop	  dx
bios:D6E7		  pop	  cx
bios:D6E8		  sub	  si, 8
bios:D6EB		  mov	  bx, 160
bios:D6EE		  cmp	  byte ptr ds:p400.crt_mode, 8
bios:D6F3		  jz	  short	loc_FD709
bios:D6F5		  mov	  bx, 320
bios:D6F8		  cmp	  byte ptr ds:p400.crt_mode, 9
bios:D6FD		  jz	  short	loc_FD709
bios:D6FF		  cmp	  byte ptr ds:p400.crt_mode, 6
bios:D704		  jb	  short	loc_FD709
bios:D706		  mov	  bx, 640
bios:D709
bios:D709 loc_FD709:						      ;	CODE XREF: gfx_print_char+51j
bios:D709							      ;	gfx_print_char+5Bj ...
bios:D709		  add	  cx, 8
bios:D70C		  cmp	  cx, bx
bios:D70E		  jnz	  short	loc_FD71C
bios:D710		  add	  dx, 8
bios:D713		  xor	  cx, cx
bios:D715		  cmp	  dx, 200
bios:D719		  jnz	  short	loc_FD71C
bios:D71B		  retn
bios:D71C ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D71C
bios:D71C loc_FD71C:						      ;	CODE XREF: gfx_print_char+6Cj
bios:D71C							      ;	gfx_print_char+77j
bios:D71C		  push	  cx
bios:D71D		  push	  dx
bios:D71E		  push	  bp
bios:D71F
bios:D71F print_char_at_offset:					      ;	CODE XREF: gfx_print_char+40j
bios:D71F		  call	  get_address_for_pixel
bios:D722		  mov	  di, bx
bios:D724		  push	  di
bios:D725		  mov	  bp, sp
bios:D727		  xor	  bx, bx
bios:D729		  mov	  cx, 8
bios:D72C		  cmp	  byte ptr ds:p400.crt_mode, 8
bios:D731		  jnz	  short	loc_FD736
bios:D733		  jmp	  do_video_mode_8_9
bios:D736 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D736
bios:D736 loc_FD736:						      ;	CODE XREF: gfx_print_char+8Fj
bios:D736		  cmp	  byte ptr ds:p400.crt_mode, 9
bios:D73B		  jnz	  short	loc_FD740
bios:D73D		  jmp	  short	do_video_mode_8_9
bios:D73F ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D73F		  nop
bios:D740
bios:D740 loc_FD740:						      ;	CODE XREF: gfx_print_char+99j
bios:D740		  cmp	  byte ptr ds:p400.crt_mode, 0Ah
bios:D745		  jnz	  short	loc_FD74A
bios:D747		  jmp	  do_video_mode_a
bios:D74A ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D74A
bios:D74A loc_FD74A:						      ;	CODE XREF: gfx_print_char+A3j
bios:D74A							      ;	gfx_print_char:loc_FD7B1j
bios:D74A		  mov	  dl, es:[si]
bios:D74D		  inc	  si
bios:D74E		  cmp	  byte ptr ds:p400.crt_mode, 6
bios:D753		  jz	  short	do_video_mode_6
bios:D755		  push	  cx
bios:D756		  mov	  cx, 8
bios:D759		  mov	  al, dl
bios:D75B		  xor	  dx, dx
bios:D75D
bios:D75D loc_FD75D:						      ;	CODE XREF: gfx_print_char:loc_FD76Cj
bios:D75D		  shl	  dx, 1
bios:D75F		  shl	  dx, 1
bios:D761		  shl	  al, 1
bios:D763		  jnb	  short	loc_FD76C
bios:D765		  push	  ax
bios:D766		  and	  ah, 3
bios:D769		  or	  dl, ah
bios:D76B		  pop	  ax
bios:D76C
bios:D76C loc_FD76C:						      ;	CODE XREF: gfx_print_char+C1j
bios:D76C		  loop	  loc_FD75D
bios:D76E		  pop	  cx
bios:D76F
bios:D76F do_video_mode_6:					      ;	CODE XREF: gfx_print_char+B1j
bios:D76F		  push	  es
bios:D770		  mov	  es, cs:value_b000
bios:D775		  assume es:nothing
bios:D775		  push	  ax
bios:D776		  xchg	  ax, dx
bios:D777		  mov	  di, [bp+0]
bios:D77A		  add	  di, bx
bios:D77C		  cmp	  byte ptr ds:p400.crt_mode, 6
bios:D781		  jz	  short	loc_FD794
bios:D783		  xchg	  ah, al
bios:D785		  test	  dh, 80h
bios:D788		  jz	  short	loc_FD791
bios:D78A		  xor	  es:[di], ax
bios:D78D		  inc	  di
bios:D78E		  inc	  di
bios:D78F		  jmp	  short	loc_FD7A0
bios:D791 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D791
bios:D791 loc_FD791:						      ;	CODE XREF: gfx_print_char+E6j
bios:D791		  stosw
bios:D792		  jmp	  short	loc_FD7A0
bios:D794 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D794
bios:D794 loc_FD794:						      ;	CODE XREF: gfx_print_char+DFj
bios:D794		  test	  dh, 80h
bios:D797		  jz	  short	loc_FD79F
bios:D799		  xor	  es:[di], al
bios:D79C		  inc	  di
bios:D79D		  jmp	  short	loc_FD7A0
bios:D79F ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D79F
bios:D79F loc_FD79F:						      ;	CODE XREF: gfx_print_char+F5j
bios:D79F		  stosb
bios:D7A0
bios:D7A0 loc_FD7A0:						      ;	CODE XREF: gfx_print_char+EDj
bios:D7A0							      ;	gfx_print_char+F0j ...
bios:D7A0		  pop	  ax
bios:D7A1		  pop	  es
bios:D7A2		  assume es:nothing
bios:D7A2		  test	  cx, 1
bios:D7A6		  jnz	  short	loc_FD7AD
bios:D7A8		  add	  bh, 20h ; ' '
bios:D7AB		  jmp	  short	loc_FD7B1
bios:D7AD ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D7AD
bios:D7AD loc_FD7AD:						      ;	CODE XREF: gfx_print_char+104j
bios:D7AD		  sub	  bx, 1FB0h
bios:D7B1
bios:D7B1 loc_FD7B1:						      ;	CODE XREF: gfx_print_char+109j
bios:D7B1		  loop	  loc_FD74A
bios:D7B3
bios:D7B3 loc_FD7B3:						      ;	CODE XREF: gfx_print_char+198j
bios:D7B3		  pop	  di
bios:D7B4		  pop	  cx
bios:D7B5		  loop	  loc_FD7BA
bios:D7B7		  pop	  dx
bios:D7B8		  pop	  cx
bios:D7B9		  retn
bios:D7BA ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D7BA
bios:D7BA loc_FD7BA:						      ;	CODE XREF: gfx_print_char+113j
bios:D7BA		  jmp	  something_with_screen_width
bios:D7BD ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D7BD
bios:D7BD do_video_mode_8_9:					      ;	CODE XREF: gfx_print_char+91j
bios:D7BD							      ;	gfx_print_char+9Bj ...
bios:D7BD		  mov	  cx, 8
bios:D7C0
bios:D7C0 loc_FD7C0:						      ;	CODE XREF: gfx_print_char:loc_FD838j
bios:D7C0		  push	  cx
bios:D7C1		  mov	  dl, es:[si]
bios:D7C4		  inc	  si
bios:D7C5		  mov	  al, dl
bios:D7C7		  push	  es
bios:D7C8		  push	  bx
bios:D7C9		  mov	  es, cs:value_b000
bios:D7CE		  assume es:nothing
bios:D7CE		  mov	  di, [bp+0]
bios:D7D1		  add	  di, bx
bios:D7D3		  cmp	  byte ptr ds:p400.crt_mode, 0Ah
bios:D7D8		  jnz	  short	loc_FD7FD
bios:D7DA		  xchg	  ax, dx
bios:D7DB		  mov	  ah, al
bios:D7DD		  test	  dh, 1
bios:D7E0		  jnz	  short	loc_FD7E4
bios:D7E2		  mov	  al, 0
bios:D7E4
bios:D7E4 loc_FD7E4:						      ;	CODE XREF: gfx_print_char+13Ej
bios:D7E4		  test	  dh, 2
bios:D7E7		  jnz	  short	loc_FD7EB
bios:D7E9		  mov	  ah, 0
bios:D7EB
bios:D7EB loc_FD7EB:						      ;	CODE XREF: gfx_print_char+145j
bios:D7EB		  test	  dh, 80h
bios:D7EE		  jz	  short	loc_FD7F8
bios:D7F0		  xor	  es:[di], ax
bios:D7F3		  inc	  di
bios:D7F4		  inc	  di
bios:D7F5		  jmp	  short	loc_FD7F9
bios:D7F7 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D7F7		  nop
bios:D7F8
bios:D7F8 loc_FD7F8:						      ;	CODE XREF: gfx_print_char+14Cj
bios:D7F8		  stosw
bios:D7F9
bios:D7F9 loc_FD7F9:						      ;	CODE XREF: gfx_print_char+153j
bios:D7F9		  xchg	  ax, dx
bios:D7FA		  jmp	  short	loc_FD81E
bios:D7FC ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D7FC		  nop
bios:D7FD
bios:D7FD loc_FD7FD:						      ;	CODE XREF: gfx_print_char+136j
bios:D7FD		  call	  sub_FD84E
bios:D800		  mov	  dx, bx
bios:D802		  call	  sub_FD84E
bios:D805		  mov	  cx, 2
bios:D808
bios:D808 loc_FD808:						      ;	CODE XREF: gfx_print_char+17Aj
bios:D808		  xchg	  ax, dx
bios:D809		  xchg	  ah, al
bios:D80B		  test	  dh, 80h
bios:D80E		  jz	  short	loc_FD818
bios:D810		  xor	  es:[di], ax
bios:D813		  inc	  di
bios:D814		  inc	  di
bios:D815		  jmp	  short	loc_FD819
bios:D817 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D817		  nop
bios:D818
bios:D818 loc_FD818:						      ;	CODE XREF: gfx_print_char+16Cj
bios:D818		  stosw
bios:D819
bios:D819 loc_FD819:						      ;	CODE XREF: gfx_print_char+173j
bios:D819		  xchg	  ax, dx
bios:D81A		  mov	  dx, bx
bios:D81C		  loop	  loc_FD808
bios:D81E
bios:D81E loc_FD81E:						      ;	CODE XREF: gfx_print_char+158j
bios:D81E		  pop	  bx
bios:D81F		  pop	  es
bios:D820		  assume es:nothing
bios:D820		  pop	  cx
bios:D821		  cmp	  byte ptr ds:p400.crt_mode, 8
bios:D826		  jnz	  short	loc_FD83D
bios:D828		  test	  cx, 1
bios:D82C		  jnz	  short	loc_FD834
bios:D82E		  add	  bh, 20h ; ' '
bios:D831		  jmp	  short	loc_FD838
bios:D833 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D833		  nop
bios:D834
bios:D834 loc_FD834:						      ;	CODE XREF: gfx_print_char+18Aj
bios:D834		  sub	  bx, 1FB0h
bios:D838
bios:D838 loc_FD838:						      ;	CODE XREF: gfx_print_char+18Fj
bios:D838							      ;	gfx_print_char:loc_FD84Cj
bios:D838		  loop	  loc_FD7C0
bios:D83A		  jmp	  loc_FD7B3
bios:D83D ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D83D
bios:D83D loc_FD83D:						      ;	CODE XREF: gfx_print_char+184j
bios:D83D		  cmp	  cx, 5
bios:D840		  jnz	  short	loc_FD849
bios:D842		  sub	  bx, 5F60h
bios:D846		  jmp	  short	loc_FD84C
bios:D848 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D848		  nop
bios:D849
bios:D849 loc_FD849:						      ;	CODE XREF: gfx_print_char+19Ej
bios:D849		  add	  bh, 20h ; ' '
bios:D84C
bios:D84C loc_FD84C:						      ;	CODE XREF: gfx_print_char+1A4j
bios:D84C		  jmp	  short	loc_FD838
bios:D84C gfx_print_char  endp
bios:D84C
bios:D84E
bios:D84E ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D84E
bios:D84E ; Entry:
bios:D84E ;    AL = ?
bios:D84E ;    AH = ?
bios:D84E ; Returns:
bios:D84E ;    BX = ?
bios:D84E
bios:D84E sub_FD84E	  proc near				      ;	CODE XREF: gfx_print_char:loc_FD7FDp
bios:D84E							      ;	gfx_print_char+160p
bios:D84E		  xor	  bx, bx
bios:D850		  mov	  cx, 4
bios:D853
bios:D853 l0:							      ;	CODE XREF: sub_FD84E:l1j
bios:D853		  shl	  bx, 1
bios:D855		  shl	  bx, 1
bios:D857		  shl	  bx, 1
bios:D859		  shl	  bx, 1
bios:D85B		  shl	  al, 1
bios:D85D		  jnb	  short	l1
bios:D85F		  push	  ax
bios:D860		  and	  ah, 0Fh
bios:D863		  or	  bl, ah
bios:D865		  pop	  ax
bios:D866
bios:D866 l1:							      ;	CODE XREF: sub_FD84E+Fj
bios:D866		  loop	  l0
bios:D868		  retn
bios:D868 sub_FD84E	  endp
bios:D868
bios:D869 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D869 ; START OF FUNCTION CHUNK FOR	gfx_print_char
bios:D869
bios:D869 do_video_mode_a:					      ;	CODE XREF: gfx_print_char+A5j
bios:D869		  jmp	  do_video_mode_8_9
bios:D869 ; END	OF FUNCTION CHUNK FOR gfx_print_char
bios:D86C
bios:D86C ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D86C
bios:D86C ;	   On entry:	  BH	     Active page
bios:D86C ;			  BL	     0=Use DX for Row/Column
bios:D86C ;				     1=Use current cursor Row/Column
bios:D86C ;			  DH	     Row
bios:D86C ;			  DL	     Column
bios:D86C ;	   Returns:	  ES	     Screen segment
bios:D86C ;			  BX	     Screen offset of Row/Column
bios:D86C
bios:D86C get_screen_offset proc near				      ;	CODE XREF: scroll_up_or_down+2Ep
bios:D86C							      ;	scroll_up_or_down+4Fp ...
bios:D86C		  push	  ax
bios:D86D		  push	  dx
bios:D86E		  push	  di
bios:D86F		  mov	  ax, ds:p400.installed_hardware
bios:D872		  and	  al, 110000b			      ;	80x25 mono ?
bios:D874		  cmp	  al, 110000b
bios:D876		  mov	  ax, 0B000h			      ;	value for es. segment for mono
bios:D879		  jz	  short	is_mono
bios:D87B		  cmp	  byte ptr ds:p400.crt_mode, 7	      ;	mono ?
bios:D880		  jnz	  short	is_color
bios:D882
bios:D882 is_mono:						      ;	CODE XREF: get_screen_offset+Dj
bios:D882		  xor	  bh, bh			      ;	active page = 0	?
bios:D884		  mov	  es, ax			      ;	es = 0xb000
bios:D886		  assume es:nothing
bios:D886		  jmp	  short	s0
bios:D888 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D888
bios:D888 is_color:						      ;	CODE XREF: get_screen_offset+14j
bios:D888		  add	  ah, 8				      ;	ax = 0xb800
bios:D88B		  mov	  es, ax			      ;	es = 0xb800 (segment for color)
bios:D88D		  assume es:nothing
bios:D88D		  cmp	  byte ptr ds:p400.crt_mode, 4	      ;	text modes ? (0-3)
bios:D892		  jl	  short	s0
bios:D894		  xor	  bh, bh			      ;	active page = 0
bios:D896
bios:D896 s0:							      ;	CODE XREF: get_screen_offset+1Aj
bios:D896							      ;	get_screen_offset+26j
bios:D896		  cmp	  bl, 0
bios:D899		  jz	  short	s1
bios:D89B		  mov	  bl, bh			      ;	page number
bios:D89D		  call	  get_cursor_row_col_for_page	      ;	dh/dl =	(row/column) cursor position
bios:D8A0
bios:D8A0 s1:							      ;	CODE XREF: get_screen_offset+2Dj
bios:D8A0		  xor	  di, di			      ;	di = 0
bios:D8A2		  cmp	  byte ptr ds:p400.crt_mode, 7	      ;	skip page len for mono (assuming there is only page?)
bios:D8A7		  jz	  short	s2
bios:D8A9		  push	  dx
bios:D8AA		  mov	  ax, ds:p400.crt_page_len	      ;	ax = page len
bios:D8AD		  mov	  bl, bh
bios:D8AF		  xor	  bh, bh			      ;	bx = page number
bios:D8B1		  mul	  bx				      ;	ax = page len *	page number
bios:D8B3		  add	  di, ax			      ;	di += ax (offset to the	page)
bios:D8B5		  pop	  dx
bios:D8B6
bios:D8B6 s2:							      ;	CODE XREF: get_screen_offset+3Bj
bios:D8B6		  xor	  ah, ah
bios:D8B8		  mov	  al, dh			      ;	ax = row number
bios:D8BA		  mul	  byte ptr ds:p400.crt_nr_cols	      ;	ax = row number	* nro of columns
bios:D8BE		  shl	  ax, 1				      ;	ax *= 2	(includes attribute byte)
bios:D8C0		  xor	  dh, dh
bios:D8C2		  shl	  dx, 1				      ;	dx = column * 2	(includes attribute byte)
bios:D8C4		  add	  ax, dx
bios:D8C6		  mov	  bx, ax			      ;	bx = offset for	row/column including attribute byte
bios:D8C8		  add	  bx, di			      ;	bx += page offset
bios:D8CA		  pop	  di
bios:D8CB		  pop	  dx
bios:D8CC		  pop	  ax
bios:D8CD		  retn
bios:D8CD get_screen_offset endp
bios:D8CD
bios:D8CE
bios:D8CE ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D8CE
bios:D8CE
bios:D8CE multiply_dl_dh_by_8_bis proc near			      ;	CODE XREF: scroll_graphics_up_or_down+1Ep
bios:D8CE							      ;	scroll_graphics_up_or_down:s1p	...
bios:D8CE		  call	  multiply_dl_dh_by_8
bios:D8CE multiply_dl_dh_by_8_bis endp
bios:D8CE
bios:D8D1
bios:D8D1 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D8D1
bios:D8D1 ;	Entry:
bios:D8D1 ;	    cx = pixel horizontal position
bios:D8D1 ;	    dx = pixel vertical	position
bios:D8D1 ;
bios:D8D1 ;	Returns:
bios:D8D1 ;	    bx = address for pixel
bios:D8D1 ;	    cx = horizontal byte offset
bios:D8D1 ;	    dx = horizontal bit	offset
bios:D8D1
bios:D8D1 get_address_for_pixel	proc near			      ;	CODE XREF: gfx_print_char:print_char_at_offsetp
bios:D8D1							      ;	get_pixel_addr_and_mask:s0p ...
bios:D8D1		  push	  ax
bios:D8D2		  push	  cx
bios:D8D3		  push	  dx
bios:D8D4		  cmp	  byte ptr ds:p400.crt_mode, 8	      ;	160x200	16 colors
bios:D8D9		  jnz	  short	test_video_modes_4_5_6_9_a
bios:D8DB		  jmp	  short	do_video_mode_8
bios:D8DD ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D8DD		  nop
bios:D8DE
bios:D8DE test_video_modes_4_5_6_9_a:				      ;	CODE XREF: get_address_for_pixel+8j
bios:D8DE		  cmp	  byte ptr ds:p400.crt_mode, 9	      ;	320x200	16 colors
bios:D8E3		  jnz	  short	test_video_modes_4_5_6_a
bios:D8E5		  jmp	  do_video_mode_9
bios:D8E8 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D8E8
bios:D8E8 test_video_modes_4_5_6_a:				      ;	CODE XREF: get_address_for_pixel+12j
bios:D8E8		  cmp	  byte ptr ds:p400.crt_mode, 0Ah      ;	640x200	4 colors
bios:D8ED		  jnz	  short	do_video_mode_4_5_6
bios:D8EF		  jmp	  do_video_mode_a
bios:D8F2 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D8F2
bios:D8F2 do_video_mode_4_5_6:					      ;	CODE XREF: get_address_for_pixel+1Cj
bios:D8F2		  mov	  ax, 40
bios:D8F5		  and	  dx, 1111111111111110b		      ;	calculate for even value
bios:D8F9		  mul	  dx				      ;	ax:dx =	vertical pos * 40 (40 bytes per	row)
bios:D8FB		  shr	  cx, 1
bios:D8FD		  shr	  cx, 1				      ;	cx = horizotal pixel / 4
bios:D8FF		  cmp	  byte ptr ds:p400.crt_mode, 6
bios:D904		  jnz	  short	s0
bios:D906		  shr	  cx, 1				      ;	cx = horizontal	pixel /	8 (only	for 640x200)
bios:D908
bios:D908 s0:							      ;	CODE XREF: get_address_for_pixel+33j
bios:D908		  add	  ax, cx			      ;	ax = y * 40 + x	/ bits_per_byte
bios:D90A		  add	  ah, 80h ; '€'                       ; modes 4,5,6 uses b000:8000 first byte
bios:D90D		  pop	  bx				      ;	orignal	vertical pos in	pixels
bios:D90E		  test	  bx, 1
bios:D912		  jz	  short	s1
bios:D914		  add	  ah, 20h ; ' '                       ; if odd, add 0x2000 (second band for CGA graphics)
bios:D917
bios:D917 s1:							      ;	CODE XREF: get_address_for_pixel+41j
bios:D917		  mov	  bx, ax			      ;	bx = final value
bios:D919		  pop	  ax				      ;	original horizontal pos	in pixels
bios:D91A		  cmp	  byte ptr ds:p400.crt_mode, 6
bios:D91F		  jnz	  short	epilog_modes_4_5
bios:D921		  mov	  cx, 8				      ;	mode 6 only
bios:D924		  div	  cx				      ;	ax = byte offset
bios:D926		  mov	  cl, 7
bios:D928		  sub	  cl, dl			      ;	cx = bit offset
bios:D92A		  jmp	  short	exit
bios:D92C ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D92C
bios:D92C epilog_modes_4_5:					      ;	CODE XREF: get_address_for_pixel+4Ej
bios:D92C		  mov	  cx, 4
bios:D92F		  div	  cx				      ;	ax = dx:ax / cx,  dx = dx:ax % cx
bios:D931		  shl	  dx, 1				      ;	dx *= 2
bios:D933		  mov	  cl, 6
bios:D935		  sub	  cl, dl
bios:D937
bios:D937 exit:							      ;	CODE XREF: get_address_for_pixel+59j
bios:D937							      ;	get_address_for_pixel:loc_FD965j ...
bios:D937		  pop	  ax
bios:D938		  retn
bios:D939 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D939
bios:D939 do_video_mode_8:					      ;	CODE XREF: get_address_for_pixel+Aj
bios:D939		  mov	  ax, 40
bios:D93C		  and	  dx, 1111111111111110b
bios:D940		  mul	  dx
bios:D942		  shr	  cx, 1
bios:D944		  add	  ax, cx
bios:D946		  add	  ah, 80h ; '€'
bios:D949		  pop	  bx				      ;	vertical pos
bios:D94A		  test	  bx, 1
bios:D94E		  jz	  short	loc_FD953
bios:D950		  add	  ah, 20h ; ' '
bios:D953
bios:D953 loc_FD953:						      ;	CODE XREF: get_address_for_pixel+7Dj
bios:D953		  mov	  bx, ax
bios:D955		  pop	  ax				      ;	horizontal pos
bios:D956		  mov	  cx, 2
bios:D959		  div	  cx
bios:D95B		  mov	  cx, 4
bios:D95E		  and	  dl, dl
bios:D960		  jz	  short	loc_FD965
bios:D962		  mov	  cx, 0
bios:D965
bios:D965 loc_FD965:						      ;	CODE XREF: get_address_for_pixel+8Fj
bios:D965		  jmp	  short	exit
bios:D967 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D967
bios:D967 do_video_mode_9:					      ;	CODE XREF: get_address_for_pixel+14j
bios:D967		  mov	  ax, 80			      ;	ax = cols(80) *	(y&1)
bios:D96A		  and	  dx, 0FFFCh
bios:D96E		  shr	  dx, 1
bios:D970		  mul	  dx
bios:D972		  shr	  cx, 1				      ;	x = x /	2 (i guess because 2 bits per color)
bios:D974		  add	  ax, cx			      ;	ax += x
bios:D976		  add	  ah, 128			      ;	ax += 128 (why)
bios:D979		  pop	  bx				      ;	vertical position
bios:D97A		  and	  bx, 3				      ;	which band: 0, 1, 2 or 3 ?
bios:D97E		  cmp	  bx, 3
bios:D981		  jb	  short	loc_FD986
bios:D983		  add	  ah, 20h ; ' '                       ; ax += 0x2000
bios:D986
bios:D986 loc_FD986:						      ;	CODE XREF: get_address_for_pixel+B0j
bios:D986		  cmp	  bx, 2
bios:D989		  jb	  short	loc_FD98E
bios:D98B		  add	  ah, 20h ; ' '                       ; ax += 0x2000
bios:D98E
bios:D98E loc_FD98E:						      ;	CODE XREF: get_address_for_pixel+B8j
bios:D98E		  cmp	  bx, 1
bios:D991		  jb	  short	loc_FD996
bios:D993		  add	  ah, 20h ; ' '                       ; ax += 0x2000
bios:D996
bios:D996 loc_FD996:						      ;	CODE XREF: get_address_for_pixel+C0j
bios:D996		  mov	  bx, ax
bios:D998		  pop	  ax
bios:D999		  mov	  cx, 2
bios:D99C		  div	  cx
bios:D99E		  mov	  cx, 4
bios:D9A1		  and	  dl, dl
bios:D9A3		  jz	  short	loc_FD9A8
bios:D9A5		  mov	  cx, 0
bios:D9A8
bios:D9A8 loc_FD9A8:						      ;	CODE XREF: get_address_for_pixel+D2j
bios:D9A8		  jmp	  short	exit
bios:D9AA ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:D9AA
bios:D9AA do_video_mode_a:					      ;	CODE XREF: get_address_for_pixel+1Ej
bios:D9AA		  mov	  ax, 80
bios:D9AD		  and	  dx, 1111111111111100b
bios:D9B1		  shr	  dx, 1
bios:D9B3		  mul	  dx
bios:D9B5		  shr	  cx, 1
bios:D9B7		  shr	  cx, 1
bios:D9B9		  and	  cx, 1111111111111110b
bios:D9BD		  add	  ax, cx
bios:D9BF		  add	  ah, 80h ; '€'
bios:D9C2		  pop	  bx
bios:D9C3		  and	  bx, 3
bios:D9C7		  cmp	  bx, 3
bios:D9CA		  jb	  short	loc_FD9CF
bios:D9CC		  add	  ah, 20h ; ' '
bios:D9CF
bios:D9CF loc_FD9CF:						      ;	CODE XREF: get_address_for_pixel+F9j
bios:D9CF		  cmp	  bx, 2
bios:D9D2		  jb	  short	loc_FD9D7
bios:D9D4		  add	  ah, 20h ; ' '
bios:D9D7
bios:D9D7 loc_FD9D7:						      ;	CODE XREF: get_address_for_pixel+101j
bios:D9D7		  cmp	  bx, 1
bios:D9DA		  jb	  short	loc_FD9DF
bios:D9DC		  add	  ah, 20h ; ' '
bios:D9DF
bios:D9DF loc_FD9DF:						      ;	CODE XREF: get_address_for_pixel+109j
bios:D9DF		  mov	  bx, ax
bios:D9E1		  pop	  ax
bios:D9E2		  mov	  cx, 8
bios:D9E5		  div	  cx
bios:D9E7		  mov	  cx, 7
bios:D9EA		  sub	  cx, dx
bios:D9EC		  jmp	  exit
bios:D9EC get_address_for_pixel	endp
bios:D9EC
bios:D9EF
bios:D9EF ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:D9EF
bios:D9EF ; return
bios:D9EF ;    cx = dl * 8
bios:D9EF ;    dx = dh * 8
bios:D9EF
bios:D9EF multiply_dl_dh_by_8 proc near				      ;	CODE XREF: gfx_print_char+2p
bios:D9EF							      ;	multiply_dl_dh_by_8_bisp
bios:D9EF		  xor	  ch, ch			      ;	cx = 0
bios:D9F1		  mov	  cl, dl
bios:D9F3		  shl	  cx, 1
bios:D9F5		  shl	  cx, 1
bios:D9F7		  shl	  cx, 1				      ;	cx = dl	* 8
bios:D9F9		  mov	  dl, dh
bios:D9FB		  xor	  dh, dh			      ;	dh = 0
bios:D9FD		  shl	  dx, 1
bios:D9FF		  shl	  dx, 1
bios:DA01		  shl	  dx, 1				      ;	dx = dh	* 8
bios:DA03		  retn
bios:DA03 multiply_dl_dh_by_8 endp
bios:DA03
bios:DA04
bios:DA04 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DA04
bios:DA04 ; entry:
bios:DA04 ;   bl = page	to query
bios:DA04 ; returns:
bios:DA04 ;   dx = cursor position (row/column)
bios:DA04
bios:DA04 get_cursor_row_col_for_page proc near			      ;	CODE XREF: get_screen_offset+31p
bios:DA04							      ;	int_10_03_handler+Bp ...
bios:DA04		  push	  bx
bios:DA05		  xor	  bh, bh
bios:DA07		  shl	  bx, 1				      ;	bl = page
bios:DA09		  mov	  dx, [bx+p400.cursor_row_col_in_pages]
bios:DA0D		  pop	  bx
bios:DA0E		  retn
bios:DA0E get_cursor_row_col_for_page endp
bios:DA0E
bios:DA0F
bios:DA0F ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DA0F
bios:DA0F ;	Add/Sub	number of bytes	per row	to SI and DI
bios:DA0F ;
bios:DA0F ;	   On entry:	  [BP+4] (arg 0)  0=Add. 1=Sub
bios:DA0F ;
bios:DA0F ;	   Returns:	  DI	     +/- Bytes per row
bios:DA0F ;			  SI	     +/- Bytes per row
bios:DA0F ; Attributes:	bp-based frame
bios:DA0F
bios:DA0F add_or_sub_bytes_per_row proc	near			      ;	CODE XREF: scroll_up_or_down+A2p
bios:DA0F							      ;	scroll_up_or_down+A9p ...
bios:DA0F
bios:DA0F arg_add_sub	  = word ptr  4
bios:DA0F
bios:DA0F		  push	  dx
bios:DA10		  mov	  dx, ds:p400.crt_nr_cols	      ;	columns	on screen
bios:DA14		  shl	  dx, 1				      ;	columns	* 2 (includes attribute	byte)
bios:DA16		  cmp	  [bp+arg_add_sub], 0
bios:DA1A		  jnz	  short	do_sub
bios:DA1C
bios:DA1C do_add:
bios:DA1C		  add	  si, dx
bios:DA1E		  add	  di, dx
bios:DA20		  jmp	  short	exit
bios:DA22 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DA22		  nop
bios:DA23
bios:DA23 do_sub:						      ;	CODE XREF: add_or_sub_bytes_per_row+Bj
bios:DA23		  sub	  si, dx
bios:DA25		  sub	  di, dx
bios:DA27
bios:DA27 exit:							      ;	CODE XREF: add_or_sub_bytes_per_row+11j
bios:DA27		  pop	  dx
bios:DA28		  retn
bios:DA28 add_or_sub_bytes_per_row endp
bios:DA28
bios:DA29
bios:DA29 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DA29
bios:DA29
bios:DA29 add_or_sub_320  proc near				      ;	CODE XREF: scroll_graphics_up_or_down+129p
bios:DA29							      ;	scroll_graphics_up_or_down+131p ...
bios:DA29		  push	  ax
bios:DA2A		  mov	  ax, 320
bios:DA2D		  cmp	  word ptr [bp+4], 0		      ;	direction: 0=scroll up,	1=scroll down
bios:DA31		  jz	  short	s0
bios:DA33		  neg	  ax
bios:DA35
bios:DA35 s0:							      ;	CODE XREF: add_or_sub_320+8j
bios:DA35		  add	  si, ax
bios:DA37		  add	  di, ax
bios:DA39		  pop	  ax
bios:DA3A		  retn
bios:DA3A add_or_sub_320  endp
bios:DA3A
bios:DA3B
bios:DA3B ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DA3B
bios:DA3B
bios:DA3B disable_video_in_80x25_mode proc near			      ;	CODE XREF: scroll_up_or_down+84p
bios:DA3B		  push	  ax
bios:DA3C		  push	  dx
bios:DA3D		  call	  is_80x25_text_mode
bios:DA40		  jnb	  short	exit
bios:DA42		  mov	  dx, 3DAh
bios:DA45		  cli
bios:DA46
bios:DA46 wait_retrace:						      ;	CODE XREF: disable_video_in_80x25_mode+Ej
bios:DA46		  in	  al, dx			      ;	Video status bits:
bios:DA46							      ;	0: retrace.  1=display is in vert or horiz retrace.
bios:DA46							      ;	1: 1=light pen is triggered; 0=armed
bios:DA46							      ;	2: 1=light pen switch is open; 0=closed
bios:DA46							      ;	3: 1=vertical sync pulse is occurring.
bios:DA47		  test	  al, 8
bios:DA49		  jz	  short	wait_retrace
bios:DA4B		  sti
bios:DA4C		  mov	  dx, 3D8h
bios:DA4F		  mov	  al, ds:p400.crt_mode_set
bios:DA52		  and	  al, 110111b			      ;	disable	video
bios:DA54		  out	  dx, al
bios:DA55
bios:DA55 exit:							      ;	CODE XREF: disable_video_in_80x25_mode+5j
bios:DA55		  pop	  dx
bios:DA56		  pop	  ax
bios:DA57		  retn
bios:DA57 disable_video_in_80x25_mode endp
bios:DA57
bios:DA58
bios:DA58 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DA58
bios:DA58
bios:DA58 enable_video_in_80x25_mode proc near			      ;	CODE XREF: scroll_up_or_down+CEp
bios:DA58		  call	  is_80x25_text_mode
bios:DA5B		  jnb	  short	exit
bios:DA5D		  mov	  dx, 3D8h
bios:DA60		  mov	  al, ds:p400.crt_mode_set
bios:DA63		  out	  dx, al
bios:DA64
bios:DA64 exit:							      ;	CODE XREF: enable_video_in_80x25_mode+3j
bios:DA64		  retn
bios:DA64 enable_video_in_80x25_mode endp
bios:DA64
bios:DA65
bios:DA65 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DA65
bios:DA65
bios:DA65 play_bell_sound proc near				      ;	CODE XREF: POST_init_ints_and_more:loc_FE1F4p
bios:DA65							      ;	int_09_handler+25p ...
bios:DA65		  push	  ax
bios:DA66		  push	  cx
bios:DA67		  mov	  al, 10110110b
bios:DA69		  out	  43h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:DA6B		  mov	  ax, 700h
bios:DA6E		  out	  42h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:DA70		  mov	  al, ah
bios:DA72		  out	  42h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:DA74		  in	  al, 61h			      ;	PC/XT PPI port B bits:
bios:DA74							      ;	0: Tmr 2 gate ÍËÍ OR 03H=spkr ON
bios:DA74							      ;	1: Tmr 2 data Í¼  AND 0fcH=spkr	OFF
bios:DA74							      ;	3: 1=read high switches
bios:DA74							      ;	4: 0=enable RAM	parity checking
bios:DA74							      ;	5: 0=enable I/O	channel	check
bios:DA74							      ;	6: 0=hold keyboard clock low
bios:DA74							      ;	7: 0=enable kbrd
bios:DA76		  mov	  ah, al
bios:DA78		  or	  al, 3
bios:DA7A		  out	  61h, al			      ;	PC/XT PPI port B bits:
bios:DA7A							      ;	0: Tmr 2 gate ÍËÍ OR 03H=spkr ON
bios:DA7A							      ;	1: Tmr 2 data Í¼  AND 0fcH=spkr	OFF
bios:DA7A							      ;	3: 1=read high switches
bios:DA7A							      ;	4: 0=enable RAM	parity checking
bios:DA7A							      ;	5: 0=enable I/O	channel	check
bios:DA7A							      ;	6: 0=hold keyboard clock low
bios:DA7A							      ;	7: 0=enable kbrd
bios:DA7C		  mov	  cx, 4000h
bios:DA7F
bios:DA7F delay0:						      ;	CODE XREF: play_bell_sound:delay0j
bios:DA7F		  loop	  delay0			      ;	delay
bios:DA81		  mov	  al, ah
bios:DA83		  out	  61h, al			      ;	PC/XT PPI port B bits:
bios:DA83							      ;	0: Tmr 2 gate ÍËÍ OR 03H=spkr ON
bios:DA83							      ;	1: Tmr 2 data Í¼  AND 0fcH=spkr	OFF
bios:DA83							      ;	3: 1=read high switches
bios:DA83							      ;	4: 0=enable RAM	parity checking
bios:DA83							      ;	5: 0=enable I/O	channel	check
bios:DA83							      ;	6: 0=hold keyboard clock low
bios:DA83							      ;	7: 0=enable kbrd
bios:DA85		  pop	  cx
bios:DA86		  pop	  ax
bios:DA87		  retn
bios:DA87 play_bell_sound endp
bios:DA87
bios:DA88
bios:DA88 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DA88
bios:DA88 ;	Returns:
bios:DA88 ;	    Carry: Set = Graphics mode
bios:DA88 ;		   Clear = Text	mode
bios:DA88
bios:DA88 is_80x25_text_mode proc near				      ;	CODE XREF: disable_video_in_80x25_mode+2p
bios:DA88							      ;	enable_video_in_80x25_modep ...
bios:DA88		  cmp	  byte ptr ds:p400.crt_mode, 2
bios:DA8D		  jl	  short	is_not_80x25
bios:DA8F		  cmp	  byte ptr ds:p400.crt_mode, 3
bios:DA94		  jg	  short	is_not_80x25
bios:DA96		  stc
bios:DA97		  retn
bios:DA98 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DA98
bios:DA98 is_not_80x25:						      ;	CODE XREF: is_80x25_text_mode+5j
bios:DA98							      ;	is_80x25_text_mode+Cj
bios:DA98		  clc
bios:DA99		  retn
bios:DA99 is_80x25_text_mode endp
bios:DA99
bios:DA9A
bios:DA9A ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DA9A
bios:DA9A
bios:DA9A int_1a_main	  proc far				      ;	CODE XREF: bios:int_1a_handlerj
bios:DA9A		  push	  ds
bios:DA9B		  mov	  ds, cs:segment_40		      ;	ds = 040h
bios:DAA0		  assume ds:nothing
bios:DAA0		  or	  ah, ah
bios:DAA2		  jz	  short	int_1a_00_handler
bios:DAA4		  dec	  ah
bios:DAA6		  jz	  short	int_1a_01_handler
bios:DAA8		  jmp	  short	exit
bios:DAAA ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DAAA
bios:DAAA int_1a_00_handler:					      ;	CODE XREF: int_1a_main+8j
bios:DAAA		  mov	  dx, ds:p400.timer_ticks_since_midnight
bios:DAAE		  mov	  cx, ds:p400.timer_ticks_since_midnight+2
bios:DAB2		  mov	  al, ds:p400.timer_overflow
bios:DAB5		  mov	  byte ptr ds:p400.timer_overflow, 0
bios:DABA		  jmp	  short	exit
bios:DABC ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DABC
bios:DABC int_1a_01_handler:					      ;	CODE XREF: int_1a_main+Cj
bios:DABC		  mov	  byte ptr ds:p400.timer_overflow, 0
bios:DAC1		  mov	  ds:p400.timer_ticks_since_midnight, dx
bios:DAC5		  mov	  ds:p400.timer_ticks_since_midnight+2,	cx
bios:DAC9		  xor	  ah, ah
bios:DACB
bios:DACB exit:							      ;	CODE XREF: int_1a_main+Ej
bios:DACB							      ;	int_1a_main+20j
bios:DACB		  pop	  ds
bios:DACC		  assume ds:nothing
bios:DACC		  iret
bios:DACC int_1a_main	  endp
bios:DACC
bios:DACD
bios:DACD ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DACD
bios:DACD ;	This interrupt is a hardware interrupt (IRQ 0) activated by the	system
bios:DACD ;	timer 18.2 times per second (every 55 ms). The default handler does
bios:DACD ;	the following:
bios:DACD ;
bios:DACD ;	     .	 Keeps a count of the number of	timer ticks at memory location
bios:DACD ;		 0:46Ch	(System	Timer Counter--long integer). After 24 hours of
bios:DACD ;		 operation, a flag is set at memory location 0:470h to signal
bios:DACD ;		 this condition	and the	System Timer Counter (0:46Ch) is reset to
bios:DACD ;		 0.
bios:DACD ;
bios:DACD ;	     .	 Decrements the	Diskette Drive Motor Off Counter at memory
bios:DACD ;		 location 0:440h if it is not 0. When this location reaches 0,
bios:DACD ;		 the diskette drive motor is turned off	and the	Diskette Drive
bios:DACD ;		 Motor Status byte at memory location 0:43Fh is	updated	to
bios:DACD ;		 reflect that the motor	has been turned	off.
bios:DACD ;
bios:DACD ;	     .	 Generates INT 1Ch.
bios:DACD ;
bios:DACD ;	     .	 For the PC Convertible, generates INT 4Ah if an alarm interrupt
bios:DACD ;		 occurs.
bios:DACD ;
bios:DACD
bios:DACD int_08_main	  proc far				      ;	CODE XREF: bios:int_08_handlerj
bios:DACD		  push	  ax
bios:DACE		  push	  dx
bios:DACF		  push	  ds
bios:DAD0		  xor	  dx, dx
bios:DAD2		  mov	  ds, cs:segment_40		      ;	ds = 40h
bios:DAD7		  assume ds:nothing
bios:DAD7		  inc	  word ptr ds:p400.timer_ticks_since_midnight
bios:DADB		  jnz	  short	loc_FDAE1
bios:DADD		  inc	  word ptr ds:p400.timer_ticks_since_midnight+2
bios:DAE1
bios:DAE1 loc_FDAE1:						      ;	CODE XREF: int_08_main+Ej
bios:DAE1		  cmp	  word ptr ds:p400.timer_ticks_since_midnight, 0B0h ; '°'
bios:DAE7		  jnz	  short	loc_FDAFC
bios:DAE9		  cmp	  word ptr ds:p400.timer_ticks_since_midnight+2, 18h
bios:DAEE		  jnz	  short	loc_FDAFC
bios:DAF0		  inc	  byte ptr ds:p400.timer_overflow
bios:DAF4		  mov	  ds:p400.timer_ticks_since_midnight, dx
bios:DAF8		  mov	  ds:p400.timer_ticks_since_midnight+2,	dx
bios:DAFC
bios:DAFC loc_FDAFC:						      ;	CODE XREF: int_08_main+1Aj
bios:DAFC							      ;	int_08_main+21j
bios:DAFC		  dec	  byte ptr ds:p400.diskette_motor_off_timeout
bios:DB00		  jnz	  short	loc_FDB0D
bios:DB02		  mov	  dx, 3F2h
bios:DB05		  mov	  al, 0Fh
bios:DB07		  out	  dx, al			      ;	Floppy:	digital	output reg bits:
bios:DB07							      ;	0-1: Drive to select 0-3 (AT: bit 1 not	used)
bios:DB07							      ;	2:   0=reset diskette controller; 1=enable controller
bios:DB07							      ;	3:   1=enable diskette DMA and interrupts
bios:DB07							      ;	4-7: drive motor enable.  Set bits to turn drive ON.
bios:DB07							      ;
bios:DB08		  and	  byte ptr ds:p400.diskette_motor_status, 0F0h
bios:DB0D
bios:DB0D loc_FDB0D:						      ;	CODE XREF: int_08_main+33j
bios:DB0D		  int	  1Ch				      ;	CLOCK TICK
bios:DB0F		  mov	  al, 20h ; ' '
bios:DB11		  out	  20h, al			      ;	Interrupt controller, 8259A.
bios:DB13		  pop	  ds
bios:DB14		  assume ds:nothing
bios:DB14		  pop	  dx
bios:DB15		  pop	  ax
bios:DB16		  iret
bios:DB16 int_08_main	  endp
bios:DB16
bios:DB16 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DB17 value_0040_00b0 dd 4000B0h				      ;	DATA XREF: perhaps_obsolete_function+Ar
bios:DB1B
bios:DB1B ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DB1B
bios:DB1B ; It seems that nobody is calling this function.
bios:DB1B ; And	also, this function treats the 0040:00b0 as a table.
bios:DB1B ; While in the Keyboard handler (0EAF3h), it is being	treated	as a jump address.
bios:DB1B ; Perhaps this code is deprecated and	someone	forgot to delete it ?
bios:DB1B ; Attributes:	bp-based frame
bios:DB1B
bios:DB1B perhaps_obsolete_function proc far
bios:DB1B		  push	  ax
bios:DB1C		  push	  cx
bios:DB1D		  push	  bp
bios:DB1E		  mov	  bp, sp
bios:DB20		  push	  bx
bios:DB21		  push	  dx
bios:DB22		  push	  di
bios:DB23		  push	  ds
bios:DB24		  push	  es
bios:DB25		  lds	  di, cs:value_0040_00b0	      ;	address	0040:00b0 == 04b0
bios:DB2A		  lds	  di, [di]			      ;	load ds:di with	intl_support address
bios:DB2C		  push	  ds
bios:DB2D		  pop	  es
bios:DB2E		  assume es:nothing
bios:DB2E		  mov	  al, ds:25h
bios:DB31		  mov	  ah, al
bios:DB33		  mov	  dx, cx
bios:DB35		  test	  ch, 8
bios:DB38		  jnz	  short	loc_FDB74
bios:DB3A		  cmp	  byte ptr ds:24h, 0FFh
bios:DB3F		  jnz	  short	loc_FDB74
bios:DB41		  mov	  di, 0
bios:DB44		  cmp	  ah, 3Bh ; ';'
bios:DB47		  jz	  short	loc_FDB59
bios:DB49		  mov	  di, 0FFh
bios:DB4C		  cmp	  ah, 3Ch ; '<'
bios:DB4F		  jz	  short	loc_FDB59
bios:DB51		  mov	  di, 0FFFFh
bios:DB54		  cmp	  ah, 3Dh ; '='
bios:DB57		  jnz	  short	loc_FDB60
bios:DB59
bios:DB59 loc_FDB59:						      ;	CODE XREF: perhaps_obsolete_function+2Cj
bios:DB59							      ;	perhaps_obsolete_function+34j
bios:DB59		  mov	  ds:2,	di
bios:DB5D
bios:DB5D loc_FDB5D:						      ;	CODE XREF: perhaps_obsolete_function+52j
bios:DB5D		  jmp	  loc_FDC10
bios:DB60 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DB60
bios:DB60 loc_FDB60:						      ;	CODE XREF: perhaps_obsolete_function+3Cj
bios:DB60		  cmp	  byte ptr ds:2, 0FFh
bios:DB65		  jnz	  short	loc_FDB71
bios:DB67		  mov	  di, 8
bios:DB6A		  call	  sub_FDC20
bios:DB6D		  jb	  short	loc_FDB5D
bios:DB6F		  jmp	  short	loc_FDBC6
bios:DB71 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DB71
bios:DB71 loc_FDB71:						      ;	CODE XREF: perhaps_obsolete_function+4Aj
bios:DB71							      ;	perhaps_obsolete_function+5Ej
bios:DB71		  jmp	  loc_FDC16
bios:DB74 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DB74
bios:DB74 loc_FDB74:						      ;	CODE XREF: perhaps_obsolete_function+1Dj
bios:DB74							      ;	perhaps_obsolete_function+24j
bios:DB74		  cmp	  byte ptr ds:2, 0FFh
bios:DB79		  jnz	  short	loc_FDB71
bios:DB7B		  mov	  di, 0Ch
bios:DB7E		  test	  dh, 8
bios:DB81		  jnz	  short	loc_FDBAB
bios:DB83		  mov	  di, 10h
bios:DB86		  test	  dh, 4
bios:DB89		  jnz	  short	loc_FDBAB
bios:DB8B		  mov	  di, 14h
bios:DB8E		  mov	  bx, 18h
bios:DB91		  test	  dh, 40h
bios:DB94		  jz	  short	loc_FDBA4
bios:DB96		  push	  ax
bios:DB97		  push	  di
bios:DB98		  mov	  di, 1Ch
bios:DB9B		  call	  sub_FDC20
bios:DB9E		  pop	  di
bios:DB9F		  pop	  ax
bios:DBA0		  jb	  short	loc_FDBA4
bios:DBA2		  xchg	  di, bx
bios:DBA4
bios:DBA4 loc_FDBA4:						      ;	CODE XREF: perhaps_obsolete_function+79j
bios:DBA4							      ;	perhaps_obsolete_function+85j
bios:DBA4		  test	  dh, 3
bios:DBA7		  jnz	  short	loc_FDBAB
bios:DBA9		  xchg	  di, bx
bios:DBAB
bios:DBAB loc_FDBAB:						      ;	CODE XREF: perhaps_obsolete_function+66j
bios:DBAB							      ;	perhaps_obsolete_function+6Ej ...
bios:DBAB		  call	  sub_FDC20
bios:DBAE		  jb	  short	loc_FDBC6
bios:DBB0		  cmp	  al, 0FFh
bios:DBB2		  jz	  short	loc_FDC10
bios:DBB4		  test	  dh, 8
bios:DBB7		  jnz	  short	loc_FDBC2
bios:DBB9		  test	  dh, 4
bios:DBBC		  jz	  short	loc_FDBC6
bios:DBBE		  cmp	  al, 80h ; '€'
bios:DBC0		  jb	  short	loc_FDBC6
bios:DBC2
bios:DBC2 loc_FDBC2:						      ;	CODE XREF: perhaps_obsolete_function+9Cj
bios:DBC2		  mov	  ah, al
bios:DBC4		  xor	  al, al
bios:DBC6
bios:DBC6 loc_FDBC6:						      ;	CODE XREF: perhaps_obsolete_function+54j
bios:DBC6							      ;	perhaps_obsolete_function+93j ...
bios:DBC6		  mov	  cx, ds:20h
bios:DBCA		  jcxz	  short	loc_FDBFD
bios:DBCC		  mov	  di, ds:22h
bios:DBD0		  cld
bios:DBD1
bios:DBD1 loc_FDBD1:						      ;	CODE XREF: perhaps_obsolete_function+BCj
bios:DBD1		  scasw
bios:DBD2		  jz	  short	loc_FDC09
bios:DBD4		  add	  di, 4
bios:DBD7		  loop	  loc_FDBD1
bios:DBD9		  cmp	  word ptr ds:4, 0
bios:DBDE		  jz	  short	loc_FDBFD
bios:DBE0		  cmp	  al, 20h ; ' '
bios:DBE2		  jnz	  short	loc_FDBE9
bios:DBE4		  mov	  ax, ds:4
bios:DBE7		  jmp	  short	loc_FDBF7
bios:DBE9 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DBE9
bios:DBE9 loc_FDBE9:						      ;	CODE XREF: perhaps_obsolete_function+C7j
bios:DBE9		  mov	  [bp+4], ax
bios:DBEC		  mov	  di, ds:6
bios:DBF0		  call	  sub_FDC20
bios:DBF3		  jb	  short	loc_FDBF7
bios:DBF5		  sub	  ah, ah
bios:DBF7
bios:DBF7 loc_FDBF7:						      ;	CODE XREF: perhaps_obsolete_function+CCj
bios:DBF7							      ;	perhaps_obsolete_function+D8j
bios:DBF7		  mov	  word ptr ds:4, 0
bios:DBFD
bios:DBFD loc_FDBFD:						      ;	CODE XREF: perhaps_obsolete_function+AFj
bios:DBFD							      ;	perhaps_obsolete_function+C3j
bios:DBFD		  cmp	  byte ptr ds:3, 0FFh
bios:DC02		  jnz	  short	loc_FDC13
bios:DC04		  call	  convert_something_2
bios:DC07		  jmp	  short	loc_FDC13
bios:DC09 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DC09
bios:DC09 loc_FDC09:						      ;	CODE XREF: perhaps_obsolete_function+B7j
bios:DC09		  mov	  ds:4,	ax
bios:DC0C		  mov	  ds:6,	di
bios:DC10
bios:DC10 loc_FDC10:						      ;	CODE XREF: perhaps_obsolete_function:loc_FDB5Dj
bios:DC10							      ;	perhaps_obsolete_function+97j
bios:DC10		  stc
bios:DC11		  jmp	  short	loc_FDC17
bios:DC13 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DC13
bios:DC13 loc_FDC13:						      ;	CODE XREF: perhaps_obsolete_function+E7j
bios:DC13							      ;	perhaps_obsolete_function+ECj
bios:DC13		  mov	  [bp+4], ax
bios:DC16
bios:DC16 loc_FDC16:						      ;	CODE XREF: perhaps_obsolete_function:loc_FDB71j
bios:DC16		  clc
bios:DC17
bios:DC17 loc_FDC17:						      ;	CODE XREF: perhaps_obsolete_function+F6j
bios:DC17		  pop	  es
bios:DC18		  pop	  ds
bios:DC19		  pop	  di
bios:DC1A		  pop	  dx
bios:DC1B		  pop	  bx
bios:DC1C		  pop	  bp
bios:DC1D		  pop	  cx
bios:DC1E		  pop	  ax
bios:DC1F		  retf
bios:DC1F perhaps_obsolete_function endp
bios:DC1F
bios:DC20
bios:DC20 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DC20
bios:DC20
bios:DC20 sub_FDC20	  proc near				      ;	CODE XREF: perhaps_obsolete_function+4Fp
bios:DC20							      ;	perhaps_obsolete_function+80p ...
bios:DC20		  mov	  cx, [di]
bios:DC22		  jcxz	  short	loc_FDC36
bios:DC24		  push	  cx
bios:DC25		  mov	  di, [di+2]
bios:DC28		  cld
bios:DC29		  repne	scasb
bios:DC2B		  pop	  cx
bios:DC2C		  jnz	  short	loc_FDC36
bios:DC2E		  add	  di, cx
bios:DC30		  dec	  di
bios:DC31		  mov	  al, [di]
bios:DC33		  clc
bios:DC34		  jmp	  short	locret_FDC3A
bios:DC36 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DC36
bios:DC36 loc_FDC36:						      ;	CODE XREF: sub_FDC20+2j
bios:DC36							      ;	sub_FDC20+Cj
bios:DC36		  mov	  ax, [bp+4]
bios:DC39		  stc
bios:DC3A
bios:DC3A locret_FDC3A:						      ;	CODE XREF: sub_FDC20+14j
bios:DC3A		  retn
bios:DC3A sub_FDC20	  endp
bios:DC3A
bios:DC3B
bios:DC3B ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DC3B
bios:DC3B
bios:DC3B convert_something_2 proc near				      ;	CODE XREF: perhaps_obsolete_function+E9p
bios:DC3B		  cmp	  ah, 0
bios:DC3E		  jz	  short	exit
bios:DC40		  cmp	  al, 0
bios:DC42		  jz	  short	exit
bios:DC44		  jl	  short	loc_FDC69
bios:DC46		  push	  cs
bios:DC47		  pop	  ds
bios:DC48		  assume ds:nothing
bios:DC48		  push	  cs
bios:DC49		  pop	  es
bios:DC4A		  assume es:nothing
bios:DC4A		  cmp	  ah, 47h ; 'G'
bios:DC4D		  jl	  short	loc_FDC6D
bios:DC4F		  cmp	  ah, 57h ; 'W'
bios:DC52		  jg	  short	loc_FDC6D
bios:DC54		  mov	  cx, 9
bios:DC57		  nop
bios:DC58		  lea	  di, some_kind_of_table
bios:DC5C		  cld
bios:DC5D
bios:DC5D loc_FDC5D:						      ;	CODE XREF: convert_something_2+26j
bios:DC5D		  scasb
bios:DC5E		  jz	  short	loc_FDC65
bios:DC60		  inc	  di
bios:DC61		  loop	  loc_FDC5D
bios:DC63		  jmp	  short	loc_FDC67
bios:DC65 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DC65
bios:DC65 loc_FDC65:						      ;	CODE XREF: convert_something_2+23j
bios:DC65		  mov	  ah, [di]
bios:DC67
bios:DC67 loc_FDC67:						      ;	CODE XREF: convert_something_2+28j
bios:DC67		  jmp	  short	exit
bios:DC69 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DC69
bios:DC69 loc_FDC69:						      ;	CODE XREF: convert_something_2+9j
bios:DC69		  xor	  ah, ah
bios:DC6B		  jmp	  short	exit
bios:DC6D ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DC6D
bios:DC6D loc_FDC6D:						      ;	CODE XREF: convert_something_2+12j
bios:DC6D							      ;	convert_something_2+17j
bios:DC6D		  cmp	  ah, 1
bios:DC70		  jz	  short	exit
bios:DC72		  cmp	  ah, 0Eh
bios:DC75		  jz	  short	exit
bios:DC77		  cmp	  ah, 0Fh
bios:DC7A		  jz	  short	exit
bios:DC7C		  cmp	  ah, 1Ch
bios:DC7F		  jz	  short	exit
bios:DC81		  lea	  bx, sort_of_abc_to_scancode_tbl
bios:DC85		  mov	  ah, al
bios:DC87		  xlat					      ;	al = [ds:bx + al]
bios:DC88		  xchg	  ah, al
bios:DC8A
bios:DC8A exit:							      ;	CODE XREF: convert_something_2+3j
bios:DC8A							      ;	convert_something_2+7j	...
bios:DC8A		  retn
bios:DC8A convert_something_2 endp
bios:DC8A
bios:DC8A ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DC8B some_kind_of_table db	 5Ch, 2Bh, 7Eh,	29h, 7Ch, 2Bh, 60h, 29h, 2Dh
bios:DC8B							      ;	DATA XREF: convert_something_2+1Do
bios:DC94		  db  4Ah ; J
bios:DC95		  db  2Bh ; +
bios:DC96		  db  4Eh ; N
bios:DC97		  db  2Eh ; .
bios:DC98		  db  53h ; S
bios:DC99		  db  0Dh
bios:DC9A		  db  1Ch
bios:DC9B		  db  0Ah
bios:DC9C		  db  1Ch
bios:DC9D sort_of_abc_to_scancode_tbl db    3, 1Eh, 30h, 2Eh, 20h, 12h,	21h, 22h, 23h, 17h, 24h, 25h, 26h, 32h,	31h, 18h, 19h
bios:DC9D							      ;	DATA XREF: convert_something_2+46o
bios:DC9D		  db  10h, 13h,	1Fh, 14h, 16h, 2Fh, 11h, 2Dh, 15h, 2Ch,	1Ah, 2Bh, 1Bh,	 7, 0Ch, 39h,	2
bios:DC9D		  db  28h,   4,	  5,   6,   8, 28h, 0Ah, 0Bh,	9, 0Dh,	33h, 0Ch, 34h, 35h, 0Bh,   2,	3
bios:DC9D		  db	4,   5,	  6,   7,   8,	 9, 0Ah,2 dup( 27h), 33h, 0Dh, 34h, 35h,   3, 1Eh, 30h
bios:DC9D		  db  2Eh, 20h,	12h, 21h, 22h, 23h, 17h, 24h, 25h, 26h,	32h, 31h, 18h, 19h, 10h, 13h, 1Fh
bios:DC9D		  db  14h, 16h,	2Fh, 11h, 2Dh, 15h, 2Ch, 1Ah, 2Bh, 1Bh,	  7, 0Ch, 29h, 1Eh, 30h, 2Eh, 20h
bios:DC9D		  db  12h, 21h,	22h, 23h, 17h, 24h, 25h, 26h, 32h, 31h,	18h, 19h, 10h, 13h, 1Fh, 14h, 16h
bios:DC9D		  db  2Fh, 11h,	2Dh, 15h, 2Ch, 1Ah, 2Bh, 1Bh, 29h, 0Eh
bios:DD1D
bios:DD1D ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DD1D
bios:DD1D
bios:DD1D int_15_handler  proc far				      ;	DATA XREF: bios:FF0Do
bios:DD1D		  sti					      ;	read / write to	EEPROM ?
bios:DD1E
bios:DD1E int_15_handler_bis:					      ;	CODE XREF: POST_test_8259+97j
bios:DD1E		  cmp	  ah, 70h ; 'p'
bios:DD21		  jz	  short	loc_FDD29
bios:DD23
bios:DD23 exit_with_error:					      ;	CODE XREF: int_15_handler+1Aj
bios:DD23		  mov	  ah, 86h ; '†'
bios:DD25		  stc
bios:DD26
bios:DD26 exit:							      ;	CODE XREF: int_15_handler+20j
bios:DD26		  retf	  2
bios:DD29 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DD29
bios:DD29 loc_FDD29:						      ;	CODE XREF: int_15_handler+4j
bios:DD29		  push	  ax
bios:DD2A		  push	  bx
bios:DD2B		  push	  cx
bios:DD2C		  or	  al, al
bios:DD2E		  jz	  short	near ptr int_15_00_handler
bios:DD30		  dec	  al
bios:DD32		  jz	  short	near ptr int_15_01_handler
bios:DD34		  pop	  cx
bios:DD35		  pop	  bx
bios:DD36		  pop	  ax
bios:DD37		  jmp	  short	exit_with_error
bios:DD39 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DD39
bios:DD39 pop_and_exit:						      ;	CODE XREF: int_15_00_handler+16j
bios:DD39							      ;	int_15_01_handler+21j
bios:DD39		  clc
bios:DD3A		  pop	  cx
bios:DD3B		  pop	  bx
bios:DD3C		  pop	  ax
bios:DD3D		  jmp	  short	exit
bios:DD3D int_15_handler  endp
bios:DD3D
bios:DD3F
bios:DD3F ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DD3F
bios:DD3F ; Read From EEROM
bios:DD3F ;
bios:DD3F ; Read the 16	bit value from the indicated EEROM word.
bios:DD3F ; Entry Conditions:
bios:DD3F ;   AH = 70H
bios:DD3F ;   AL = 0
bios:DD3F ;   BL = word	number to read (0 -15)
bios:DD3F ;
bios:DD3F ; Exit Conditions:
bios:DD3F ;   DX = word	value
bios:DD3F ;   Carry Flag set indicates EEROM call not supported, system	is not a 1000HX
bios:DD3F
bios:DD3F int_15_00_handler proc far				      ;	CODE XREF: int_15_handler+11j
bios:DD3F		  mov	  dx, 37Ch			      ;	EEPROM port
bios:DD42		  mov	  ah, bl			      ;	word number to read (0-15)
bios:DD44		  and	  ah, 0Fh
bios:DD47		  or	  ah, 80h
bios:DD4A		  call	  EEPROM_init_1?
bios:DD4D		  call	  EEPROM_read
bios:DD50		  mov	  al, 0
bios:DD52		  out	  dx, al
bios:DD53		  mov	  dx, bx			      ;	EEPROM value in	dx
bios:DD55		  jmp	  short	pop_and_exit
bios:DD55 int_15_00_handler endp
bios:DD55
bios:DD57
bios:DD57 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DD57
bios:DD57 ; Write To EEROM
bios:DD57 ;
bios:DD57 ; Write a 16 bit value to the	indicated EEROM	word
bios:DD57 ;
bios:DD57 ; Entry Conditions:
bios:DD57 ;   AH = 70H
bios:DD57 ;   AL = 1
bios:DD57 ;   BL = word	number to write	(0-15)
bios:DD57 ;   DX = word	value to write
bios:DD57 ;
bios:DD57 ; Exit Conditions:
bios:DD57 ;   Carry Flag set indicates EEROM call not supported, system	is not a 1000HX
bios:DD57
bios:DD57 int_15_01_handler proc far				      ;	CODE XREF: int_15_handler+15j
bios:DD57		  push	  dx				      ;	EEPROM value to	write in dx
bios:DD58		  push	  dx
bios:DD59		  mov	  dx, 37Ch			      ;	EEPROM port
bios:DD5C		  call	  EEPROM_init_3?
bios:DD5F		  call	  EEPROM_init_2?
bios:DD62		  mov	  ah, bl
bios:DD64		  and	  ah, 0Fh
bios:DD67		  or	  ah, 40h
bios:DD6A		  call	  EEPROM_init_1?
bios:DD6D		  pop	  bx				      ;	bx has value to	write to EEPROM
bios:DD6E		  call	  EEPROM_write_word
bios:DD71		  call	  EEPROM_write_finish_1?
bios:DD74		  call	  EEPROM_write_finish_2?
bios:DD77		  pop	  dx
bios:DD78		  jmp	  short	pop_and_exit
bios:DD78 int_15_01_handler endp
bios:DD78
bios:DD7A
bios:DD7A ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DD7A
bios:DD7A
bios:DD7A EEPROM_out_something proc near			      ;	CODE XREF: EEPROM_init_1?+5p
bios:DD7A							      ;	EEPROM_init_1?+Ap ...
bios:DD7A		  out	  dx, al
bios:DD7B		  or	  al, 4
bios:DD7D		  out	  dx, al
bios:DD7E		  retn
bios:DD7E EEPROM_out_something endp
bios:DD7E
bios:DD7F
bios:DD7F ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DD7F
bios:DD7F
bios:DD7F EEPROM_write_finish_2? proc near			      ;	CODE XREF: int_15_01_handler+1Dp
bios:DD7F							      ;	EEPROM_init_3?+11p
bios:DD7F		  mov	  ah, 0
bios:DD81		  call	  EEPROM_init_1?
bios:DD84		  mov	  al, 0
bios:DD86		  out	  dx, al
bios:DD87		  retn
bios:DD87 EEPROM_write_finish_2? endp
bios:DD87
bios:DD88
bios:DD88 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DD88
bios:DD88
bios:DD88 EEPROM_init_2?  proc near				      ;	CODE XREF: int_15_01_handler+8p
bios:DD88							      ;	EEPROM_init_3?p
bios:DD88		  mov	  ah, 30h ; '0'
bios:DD8A		  call	  EEPROM_init_1?
bios:DD8D		  mov	  al, 0
bios:DD8F		  out	  dx, al
bios:DD90		  retn
bios:DD90 EEPROM_init_2?  endp
bios:DD90
bios:DD91
bios:DD91 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DD91
bios:DD91
bios:DD91 EEPROM_init_3?  proc near				      ;	CODE XREF: int_15_01_handler+5p
bios:DD91		  call	  EEPROM_init_2?
bios:DD94		  mov	  ah, bl
bios:DD96		  and	  ah, 0Fh
bios:DD99		  or	  ah, 0C0h
bios:DD9C		  call	  EEPROM_init_1?
bios:DD9F		  call	  EEPROM_write_finish_1?
bios:DDA2		  call	  EEPROM_write_finish_2?
bios:DDA5		  retn
bios:DDA5 EEPROM_init_3?  endp
bios:DDA5
bios:DDA6
bios:DDA6 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DDA6
bios:DDA6
bios:DDA6 EEPROM_read_bit proc near				      ;	CODE XREF: EEPROM_readp
bios:DDA6							      ;	EEPROM_read+Ap
bios:DDA6		  mov	  al, 2
bios:DDA8		  out	  dx, al			      ;	dx = 37c
bios:DDA9		  in	  al, 62h			      ;	0-2: Not Used
bios:DDA9							      ;	3: CPU Clock Rate
bios:DDA9							      ;	    0 =	4.77 MHz (PC Compatible	Rate)
bios:DDA9							      ;	    1 =	7.16 MHz (Default by Boot ROM)
bios:DDA9							      ;	4: EEPROM Serial Data Read
bios:DDA9							      ;	5: 8253	Out #2
bios:DDA9							      ;	6: Monochrome Mode
bios:DDA9							      ;	    0 =	Color Monitor
bios:DDA9							      ;	    1 =	Not supported
bios:DDA9							      ;	7: 0 = Reserved
bios:DDAB		  and	  al, 10000b			      ;	interested in bit 4 only
bios:DDAD		  shr	  al, 1
bios:DDAF		  shr	  al, 1
bios:DDB1		  shr	  al, 1
bios:DDB3		  shr	  al, 1				      ;	move bit 4 to bit 0
bios:DDB5		  mov	  ah, al			      ;	copy al	to ah
bios:DDB7		  mov	  al, 6
bios:DDB9		  out	  dx, al			      ;	dx = 37c
bios:DDBA		  retn
bios:DDBA EEPROM_read_bit endp
bios:DDBA
bios:DDBB
bios:DDBB ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DDBB
bios:DDBB
bios:DDBB EEPROM_read	  proc near				      ;	CODE XREF: int_15_00_handler+Ep
bios:DDBB		  call	  EEPROM_read_bit
bios:DDBE		  xor	  bx, bx			      ;	first bit discarded ?
bios:DDC0		  mov	  cx, 10h
bios:DDC3
bios:DDC3 loc_FDDC3:						      ;	CODE XREF: EEPROM_read+Fj
bios:DDC3		  rol	  bx, 1
bios:DDC5		  call	  EEPROM_read_bit
bios:DDC8		  or	  bl, ah
bios:DDCA		  loop	  loc_FDDC3			      ;	repeat 16 times	(read a	word)
bios:DDCC		  retn
bios:DDCC EEPROM_read	  endp
bios:DDCC
bios:DDCD
bios:DDCD ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DDCD
bios:DDCD
bios:DDCD EEPROM_init_1?  proc near				      ;	CODE XREF: int_15_00_handler+Bp
bios:DDCD							      ;	int_15_01_handler+13p ...
bios:DDCD		  mov	  cx, 8
bios:DDD0		  mov	  al, 0
bios:DDD2		  call	  EEPROM_out_something
bios:DDD5		  mov	  al, 2
bios:DDD7		  call	  EEPROM_out_something
bios:DDDA		  mov	  al, 3
bios:DDDC		  call	  EEPROM_out_something
bios:DDDF
bios:DDDF l0:							      ;	CODE XREF: EEPROM_init_1?+1Dj
bios:DDDF		  rol	  ah, 1				      ;	ah = bl	| 80h.	ah 'rols' once per loop
bios:DDE1		  mov	  al, ah
bios:DDE3		  and	  al, 1
bios:DDE5		  or	  al, 2
bios:DDE7		  call	  EEPROM_out_something
bios:DDEA		  loop	  l0				      ;	repeat 8 times
bios:DDEC		  retn
bios:DDEC EEPROM_init_1?  endp
bios:DDEC
bios:DDED
bios:DDED ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DDED
bios:DDED
bios:DDED EEPROM_write_word proc near				      ;	CODE XREF: int_15_01_handler+17p
bios:DDED		  mov	  cx, 10h
bios:DDF0
bios:DDF0 l0:							      ;	CODE XREF: EEPROM_write_word+Ej
bios:DDF0		  rol	  bx, 1
bios:DDF2		  mov	  al, bl
bios:DDF4		  and	  al, 1				      ;	0: bit to write
bios:DDF4							      ;	1: 1=means write ?
bios:DDF4							      ;	2-7: should be 0?
bios:DDF6		  or	  al, 2
bios:DDF8		  call	  EEPROM_out_something
bios:DDFB		  loop	  l0				      ;	repeat 16 times	(write 16 bits)
bios:DDFD		  retn
bios:DDFD EEPROM_write_word endp
bios:DDFD
bios:DDFE
bios:DDFE ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:DDFE
bios:DDFE
bios:DDFE EEPROM_write_finish_1? proc near			      ;	CODE XREF: int_15_01_handler+1Ap
bios:DDFE							      ;	EEPROM_init_3?+Ep
bios:DDFE		  mov	  al, 0				      ;	1-7: 0=init ?
bios:DE00		  out	  dx, al
bios:DE01		  mov	  al, 4
bios:DE03		  out	  dx, al
bios:DE04		  mov	  cx, 3840h
bios:DE07
bios:DE07 delay:						      ;	CODE XREF: EEPROM_write_finish_1?:delayj
bios:DE07		  loop	  delay				      ;	delay
bios:DE09		  mov	  al, 0				      ;	1-7: 0=init ?
bios:DE0B		  out	  dx, al
bios:DE0C		  retn
bios:DE0C EEPROM_write_finish_1? endp
bios:DE0C
bios:DE0C ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:DE0D		  db 103h dup(0FFh)
bios:DF10 video_6845_init_tbl_a	db 38h,	28h, 2Dh, 0Ah, 1Fh, 6, 19h, 1Ch, 2, 7, 6, 7, 4 dup(0); init_modes_0_1
bios:DF10							      ;	DATA XREF: POST_main:loc_FC5E3o
bios:DF10							      ;	int_10_00_handler+10Do
bios:DF10		  db 71h, 50h, 5Ah, 0Ah, 1Fh, 6, 19h, 1Ch, 2, 7, 6, 7, 4 dup(0); init_modes_2_3	; 3d5 values for index 0-15
bios:DF10		  db 38h, 28h, 2Dh, 0Ah, 7Fh, 6, 64h, 70h, 2, 1, 6, 7, 4 dup(0); init_modes_4_5_6_8
bios:DF10		  db 61h, 50h, 52h, 0Fh, 19h, 6, 2 dup(19h), 2,	0Dh, 0Bh, 0Ch, 4 dup(0); init_mode_7
bios:DF10		  db 71h, 50h, 5Ah, 0Eh, 3Fh, 6, 32h, 38h, 2, 3, 6, 7, 4 dup(0); init_modes_9_a
bios:DF60 video_6845_init_tbl_b	db 38h,	28h, 2Dh, 8, 21h, 7, 19h, 1Dh, 2, 8, 6,	7, 4 dup(0); init_modes_0_1
bios:DF60							      ;	DATA XREF: POST_init_ints_and_more+387o
bios:DF60		  db 71h, 50h, 59h, 10h, 21h, 7, 19h, 1Dh, 2, 8, 6, 7, 4 dup(0); init_modes_2_3
bios:DF60		  db 38h, 28h, 2Dh, 8, 9Bh, 1, 64h, 7Ch, 2, 1, 6, 7, 4 dup(0); init_modes_4_5_6_8
bios:DF60		  db 61h, 50h, 52h, 0Fh, 19h, 6, 2 dup(19h), 2,	0Dh, 0Bh, 0Ch, 4 dup(0); init_mode_7
bios:DF60		  db 71h, 50h, 59h, 10h, 4Dh, 1, 32h, 3Eh, 2, 3, 6, 7, 4 dup(0); init_modes_9_a
bios:DFB0 video_6845_init_tbl_c	db 38h,	28h, 2Dh, 8, 26h, 1, 19h, 1Fh, 2, 7, 6,	7, 4 dup(0); init_modes_0_1
bios:DFB0							      ;	DATA XREF: POST_init_ints_and_more+39Eo
bios:DFB0		  db 71h, 50h, 59h, 10h, 26h, 1, 19h, 1Fh, 2, 7, 6, 7, 4 dup(0); init_modes_2_3
bios:DFB0		  db 38h, 28h, 2Dh, 8, 9Bh, 1, 64h, 7Ch, 2, 1, 6, 7, 4 dup(0); init_modes_4_5_6_8
bios:DFB0		  db 61h, 50h, 52h, 0Fh, 19h, 6, 2 dup(19h), 2,	0Dh, 0Bh, 0Ch, 4 dup(0); init_mode_7
bios:DFB0		  db 71h, 50h, 59h, 10h, 4Dh, 1, 32h, 3Eh, 2, 3, 6, 7, 4 dup(0); init_modes_9_a
bios:E000 video_6845_init_tbl_d	db 38h,	28h, 2Dh, 8, 1Ch, 1, 19h, 1Ah, 2, 8, 6,	7, 4 dup(0); init_modes_0_1
bios:E000							      ;	DATA XREF: POST_main+ADo
bios:E000							      ;	POST_main+136o	...
bios:E000		  db 71h, 50h, 59h, 10h, 1Ch, 1, 19h, 1Ah, 2, 8, 6, 7, 4 dup(0); init_modes_2_3	; value	for 3d5. index 0-15
bios:E000		  db 38h, 28h, 2Dh, 8, 7Fh, 6, 64h, 70h, 2, 1, 6, 7, 4 dup(0); init_modes_4_5_6_8
bios:E000		  db 61h, 50h, 52h, 0Fh, 19h, 6, 2 dup(19h), 2,	0Dh, 0Bh, 0Ch, 4 dup(0); init_mode_7
bios:E000		  db 71h, 50h, 59h, 10h, 3Fh, 6, 32h, 38h, 2, 3, 6, 7, 4 dup(0); init_modes_9_a
bios:E050		  db  4Ch ; L
bios:E051		  db  49h ; I
bios:E052		  db 0E9h ; é
bios:E053		  db 0C6h ; Æ
bios:E054		  db 0FAh ; ú
bios:E055		  db 0FFh
bios:E056		  db 0FFh
bios:E057		  db 0FFh
bios:E058		  db 0FFh
bios:E059		  db 0FFh
bios:E05A		  db 0FFh
bios:E05B ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E05B ; START OF FUNCTION CHUNK FOR	POST_main
bios:E05B
bios:E05B POST_entry:						      ;	CODE XREF: POST_init_ints_and_more+40Fj
bios:E05B							      ;	bios:reset_vectorJ
bios:E05B		  mov	  ax, 40h ; '@'
bios:E05E		  mov	  ds, ax			      ;	ds = 40h
bios:E060		  assume es:nothing, ds:nothing
bios:E060		  xor	  di, di
bios:E062		  cmp	  word ptr ds:p400.POST_reset_flag, 1234h ; requested by Ctrl+Alt+Del?
bios:E068		  jnz	  short	loc_FE072
bios:E06A		  mov	  di, ds:p400.keyb_status_flags_1     ;	417 = keyboard status flags
bios:E06E		  and	  di, 110000001100000b		      ;	caps or	numlock	pressed	or locked ?
bios:E072
bios:E072 loc_FE072:						      ;	CODE XREF: POST_main+1BC0j
bios:E072		  mov	  si, ds:p400.POST_reset_flag
bios:E076		  jmp	  near ptr POST_main
bios:E076 ; END	OF FUNCTION CHUNK FOR POST_main
bios:E079
bios:E079 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E079
bios:E079
bios:E079 POST_init_ints_and_more proc far			      ;	CODE XREF: POST_test_8259+17Cj
bios:E079		  mov	  ax, 40h ; '@'
bios:E07C		  mov	  ds, ax			      ;	ds = 40h
bios:E07E		  mov	  ax, 0BBE8h
bios:E081		  mov	  es, ax			      ;	es = bbe8h
bios:E083		  assume es:nothing
bios:E083		  cmp	  word ptr es:pbbe80.shadow_reset_flag,	1234h ;	bbe8:0008 = bbe88: somewhere video in addr
bios:E08A		  jnz	  short	loc_FE093
bios:E08C		  mov	  ax, es:pbbe80.shadow_caps_numlock
bios:E090
bios:E090 loc_FE090:						      ;	keyboard status	flags?
bios:E090		  mov	  ds:p400.keyb_status_flags_1, ax
bios:E093
bios:E093 loc_FE093:						      ;	CODE XREF: POST_init_ints_and_more+11j
bios:E093		  cli
bios:E094		  cld
bios:E095		  mov	  ax, 36h ; '6'
bios:E098		  mov	  dx, 43h ; 'C'
bios:E09B		  out	  dx, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:E09C		  jmp	  short	$+2
bios:E09E		  mov	  dx, 40h ; '@'
bios:E0A1		  mov	  al, 0
bios:E0A3		  out	  dx, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:E0A4		  jmp	  short	$+2
bios:E0A6		  out	  dx, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:E0A7		  jmp	  short	$+2
bios:E0A9		  mov	  al, 0B6h ; '¶'
bios:E0AB		  out	  43h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:E0AD		  jmp	  short	$+2
bios:E0AF		  xor	  al, al
bios:E0B1		  out	  42h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:E0B3		  jmp	  short	$+2
bios:E0B5		  mov	  al, 5
bios:E0B7		  out	  42h, al			      ;	Timer 8253-5 (AT: 8254.2).
bios:E0B9		  xor	  ax, ax			      ;	es:si =	zero page
bios:E0BB		  mov	  es, ax			      ;	es = 0
bios:E0BD		  assume es:nothing
bios:E0BD		  mov	  ax, 30h ; '0'
bios:E0C0		  mov	  ss, ax
bios:E0C2		  assume ss:nothing
bios:E0C2		  mov	  ax, 100h			      ;	setup stack tmp	at 0100:0000 (0x1000)
bios:E0C5		  mov	  sp, ax
bios:E0C7		  mov	  ax, cs			      ;	setup interrupt	table
bios:E0C9		  mov	  ds, ax
bios:E0CB		  assume ds:nothing
bios:E0CB		  mov	  si, offset int_00_07_table
bios:E0CE		  xor	  di, di			      ;	ptr to Int 0 vector table
bios:E0D0		  mov	  cx, 8				      ;	copy first 8 interrupts
bios:E0D3		  call	  copy_to_vector_tbl
bios:E0D6		  mov	  si, offset int_08_1f_table
bios:E0D9		  mov	  di, 20h ; ' '                       ; Interrupt ptr to int 8 vector table
bios:E0DC		  mov	  cx, 18h			      ;	copy first 24 interrupts
bios:E0DF		  call	  copy_to_vector_tbl
bios:E0E2		  mov	  si, offset int_44_44_table
bios:E0E5		  mov	  di, 110h			      ;	Interrupt 0x44 (68)
bios:E0E8		  mov	  cx, 1
bios:E0EB		  call	  copy_to_vector_tbl
bios:E0EE		  mov	  ax, 0BBE8h
bios:E0F1		  mov	  es, ax			      ;	es = bbe8h
bios:E0F3		  assume es:nothing
bios:E0F3		  mov	  ax, 40h ; '@'
bios:E0F6		  mov	  ds, ax			      ;	ds = 40h
bios:E0F8		  assume ds:nothing
bios:E0F8		  mov	  al, 0FFh
bios:E0FA		  out	  21h, al			      ;	Interrupt controller, 8259A.
bios:E0FC		  in	  al, 61h			      ;	PC/XT PPI port B bits:
bios:E0FC							      ;	0: Tmr 2 gate ÍËÍ OR 03H=spkr ON
bios:E0FC							      ;	1: Tmr 2 data Í¼  AND 0fcH=spkr	OFF
bios:E0FC							      ;	3: 1=read high switches
bios:E0FC							      ;	4: 0=enable RAM	parity checking
bios:E0FC							      ;	5: 0=enable I/O	channel	check
bios:E0FC							      ;	6: 0=hold keyboard clock low
bios:E0FC							      ;	7: 0=enable kbrd
bios:E0FE		  or	  al, 1
bios:E100		  out	  61h, al			      ;	PC/XT PPI port B bits:
bios:E100							      ;	0: Tmr 2 gate ÍËÍ OR 03H=spkr ON
bios:E100							      ;	1: Tmr 2 data Í¼  AND 0fcH=spkr	OFF
bios:E100							      ;	3: 1=read high switches
bios:E100							      ;	4: 0=enable RAM	parity checking
bios:E100							      ;	5: 0=enable I/O	channel	check
bios:E100							      ;	6: 0=hold keyboard clock low
bios:E100							      ;	7: 0=enable kbrd
bios:E102		  and	  al, 0EEh
bios:E104		  out	  61h, al			      ;	PC/XT PPI port B bits:
bios:E104							      ;	0: Tmr 2 gate ÍËÍ OR 03H=spkr ON
bios:E104							      ;	1: Tmr 2 data Í¼  AND 0fcH=spkr	OFF
bios:E104							      ;	3: 1=read high switches
bios:E104							      ;	4: 0=enable RAM	parity checking
bios:E104							      ;	5: 0=enable I/O	channel	check
bios:E104							      ;	6: 0=hold keyboard clock low
bios:E104							      ;	7: 0=enable kbrd
bios:E106		  mov	  dx, 213h
bios:E109		  mov	  al, 1
bios:E10B		  out	  dx, al			      ;	XT Expansion chassis enable
bios:E10C		  nop
bios:E10D		  mov	  al, es:0Fh
bios:E111		  xor	  ah, ah
bios:E113		  mov	  cl, 4
bios:E115		  shl	  ax, cl
bios:E117		  or	  al, 8
bios:E119		  mov	  ds:0B5h, ax
bios:E11C		  mov	  bx, 1000000101101b		      ;	default	values:
bios:E11C							      ;	1 diskette installed
bios:E11C							      ;	0 math copro
bios:E11C							      ;	11 number of 64k banks
bios:E11C							      ;	10 initial video mode (80x25 color)
bios:E11C							      ;	00 number of diskette drives
bios:E11C							      ;	0 dma present
bios:E11C							      ;	000 number of rs232
bios:E11C							      ;	1 game i/o attached
bios:E11C							      ;	0 serial printer installed
bios:E11C							      ;	00 number of printers
bios:E11C							      ;
bios:E11F		  in	  al, 62h			      ;	0-2: Not used
bios:E11F							      ;	3: Fast	Mode: 0=4.77Mhz, 1=7.16Mhz
bios:E11F							      ;	4: EEPROM data-serial read only
bios:E11F							      ;	5: 1=Timer 2 channel out
bios:E11F							      ;	6: Monochrome mode. 0=Color monitor
bios:E11F							      ;	7: Reserved
bios:E121		  test	  al, 1000000b			      ;	color mode?
bios:E123		  jz	  short	loc_FE131		      ;	yes, is	color
bios:E125		  test	  word ptr ds:p400.extra_status, 20h
bios:E12B		  jz	  short	loc_FE131
bios:E12D		  or	  bx, 110000b			      ;	initial	video mode = 80x25 mono
bios:E131
bios:E131 loc_FE131:						      ;	CODE XREF: POST_init_ints_and_more+AAj
bios:E131							      ;	POST_init_ints_and_more+B2j
bios:E131		  mov	  ds:p400.installed_hardware, bx      ;	set installed hardware
bios:E135		  mov	  bx, es:0
bios:E13A		  mov	  cl, 6
bios:E13C		  shr	  bx, cl
bios:E13E		  add	  bx, 256			      ;	256k base memory
bios:E142		  mov	  ds:p400.IO_channel_RAM_size, bx
bios:E146		  mov	  ds:p400.base_mem_kb, bx	      ;	base memory size in Kb
bios:E14A		  mov	  cl, 6
bios:E14C		  shr	  bx, cl
bios:E14E		  sub	  bx, 2
bios:E151		  or	  bl, 10h
bios:E154		  mov	  al, bl
bios:E156		  or	  al, 1
bios:E158		  out	  0A0h,	al			      ;	PIC 2  same as 0020 for	PIC 1
bios:E15A		  push	  bx
bios:E15B		  push	  ds
bios:E15C		  push	  es
bios:E15D		  mov	  ax, 0C000h			      ;	ROM cartridge at c000h ?
bios:E160		  mov	  ds, ax			      ;	ds = c000h
bios:E162		  assume ds:nothing
bios:E162		  mov	  cx, 10h
bios:E165		  call	  run_boot_sector_if_valid
bios:E168		  pop	  es
bios:E169		  assume es:nothing
bios:E169		  pop	  ds
bios:E16A		  assume ds:nothing
bios:E16A		  test	  byte ptr ds:p400.extra_status, 10h
bios:E16F		  jnz	  short	loc_FE175
bios:E171		  pop	  ax
bios:E172		  push	  ax
bios:E173		  out	  0A0h,	al			      ;	PIC 2  same as 0020 for	PIC 1
bios:E175
bios:E175 loc_FE175:						      ;	CODE XREF: POST_init_ints_and_more+F6j
bios:E175		  mov	  ah, 12h
bios:E177		  mov	  bl, 10h
bios:E179		  int	  10h				      ;	- VIDEO	- ALTERNATE FUNCTION SELECT (PS, EGA, VGA, MCGA) - GET EGA INFO
bios:E179							      ;	Return:	BH = 00h color mode in effect CH = feature bits, CL = switch settings
bios:E17B		  pop	  cx
bios:E17C		  cmp	  bl, 10h
bios:E17F		  jz	  short	loc_FE1A1
bios:E181		  or	  bh, bh
bios:E183		  jnz	  short	loc_FE19C
bios:E185		  or	  byte ptr ds:p400.extra_status, 10h
bios:E18A		  mov	  al, cl
bios:E18C		  out	  0A0h,	al			      ;	PIC 2  same as 0020 for	PIC 1
bios:E18E		  xor	  al, al
bios:E190		  mov	  dx, 3D8h
bios:E193		  out	  dx, al
bios:E194		  mov	  al, cl
bios:E196		  or	  al, 1
bios:E198		  out	  0A0h,	al			      ;	PIC 2  same as 0020 for	PIC 1
bios:E19A		  jmp	  short	loc_FE1A1
bios:E19C ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E19C
bios:E19C loc_FE19C:						      ;	CODE XREF: POST_init_ints_and_more+10Aj
bios:E19C		  or	  byte ptr ds:p400.extra_status, 20h
bios:E1A1
bios:E1A1 loc_FE1A1:						      ;	CODE XREF: POST_init_ints_and_more+106j
bios:E1A1							      ;	POST_init_ints_and_more+121j
bios:E1A1		  test	  word ptr ds:p400.extra_status, 10h
bios:E1A7		  jnz	  short	loc_FE1AE
bios:E1A9		  sub	  word ptr ds:p400.base_mem_kb,	10h   ;	base memory size in Kb
bios:E1AE
bios:E1AE loc_FE1AE:						      ;	CODE XREF: POST_init_ints_and_more+12Ej
bios:E1AE		  mov	  ax, 1Eh
bios:E1B1		  mov	  ds:p400.keyb_buffer_head_ptr,	ax
bios:E1B4		  mov	  ds:p400.keyb_buffer_tail_ptr,	ax
bios:E1B7		  mov	  ds:p400.keyb_buffer_start_offset_ptr,	ax
bios:E1BA		  add	  ax, 20h ; ' '
bios:E1BD		  mov	  ds:p400.keyb_buffer_end_offset_ptr, ax
bios:E1C0		  mov	  byte ptr ds:p400.video_page_data, 3Fh	; '?'
bios:E1C5		  mov	  al, 0Eh
bios:E1C7		  out	  0Fh, al			      ;	DMA controller,	8237A-5.
bios:E1C7							      ;	master clear. Clear or mask any	or
bios:E1C7							      ;	all of the channels. Bits:
bios:E1C7							      ;	0: 1=mask channel 0; 0=enable
bios:E1C7							      ;	1: 1=mask channel 1;
bios:E1C7							      ;	2: 1=mask channel 2;
bios:E1C7							      ;	3: 1=mask channel 3;
bios:E1C9		  out	  0Ch, al			      ;	DMA controller,	8237A-5.
bios:E1C9							      ;	clear byte pointer flip-flop.
bios:E1CB		  mov	  dx, 4
bios:E1CE
bios:E1CE loc_FE1CE:						      ;	CODE XREF: POST_init_ints_and_more+171j
bios:E1CE		  mov	  cx, 1
bios:E1D1
bios:E1D1 loc_FE1D1:						      ;	CODE XREF: POST_init_ints_and_more+16Bj
bios:E1D1		  mov	  ax, cx
bios:E1D3		  out	  dx, al			      ;	DMA controller,	8237A-5.
bios:E1D3							      ;	channel	2 base address
bios:E1D3							      ;	(also sets current address)
bios:E1D4		  mov	  al, ah
bios:E1D6		  out	  dx, al			      ;	DMA controller,	8237A-5.
bios:E1D6							      ;	channel	2 base address
bios:E1D6							      ;	(also sets current address)
bios:E1D7		  nop
bios:E1D8		  in	  al, dx			      ;	DMA controller,	8237A-5.
bios:E1D8							      ;	channel	2 current address
bios:E1D9		  mov	  ah, al
bios:E1DB		  in	  al, dx			      ;	DMA controller,	8237A-5.
bios:E1DB							      ;	channel	2 current address
bios:E1DC		  xchg	  ah, al
bios:E1DE		  cmp	  ax, cx
bios:E1E0		  jnz	  short	loc_FE1EE
bios:E1E2		  rcl	  cx, 1
bios:E1E4		  jnb	  short	loc_FE1D1
bios:E1E6		  inc	  dx
bios:E1E7		  cmp	  dx, 6
bios:E1EA		  jnz	  short	loc_FE1CE
bios:E1EC		  jmp	  short	loc_FE1F4
bios:E1EE ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E1EE
bios:E1EE loc_FE1EE:						      ;	CODE XREF: POST_init_ints_and_more+167j
bios:E1EE		  or	  word ptr ds:p400.installed_hardware, 100h ; XXX reserved bit... what could it	be?
bios:E1F4
bios:E1F4 loc_FE1F4:						      ;	CODE XREF: POST_init_ints_and_more+173j
bios:E1F4		  call	  play_bell_sound
bios:E1F7		  mov	  ax, 7000h
bios:E1FA		  mov	  bl, 2
bios:E1FC		  int	  15h				      ;	read EEPROM
bios:E1FE		  mov	  al, dl
bios:E200		  ror	  al, 1
bios:E202		  ror	  al, 1
bios:E204		  and	  al, 11000000b
bios:E206		  and	  byte ptr ds:p400.installed_hardware, 111111b ; set number of diskettes to 0
bios:E20B		  or	  ds:p400.installed_hardware, al
bios:E20F		  mov	  al, dl
bios:E211		  and	  al, 0F0h
bios:E213		  cmp	  al, 30h ; '0'
bios:E215		  jnz	  short	loc_FE21C
bios:E217		  or	  byte ptr ds:p400.extra_status, 1    ;	drive A	is 3 1/2
bios:E21C
bios:E21C loc_FE21C:						      ;	CODE XREF: POST_init_ints_and_more+19Cj
bios:E21C		  mov	  al, dh
bios:E21E		  and	  al, 0Fh
bios:E220		  cmp	  al, 3
bios:E222		  jnz	  short	loc_FE229
bios:E224		  or	  byte ptr ds:p400.extra_status, 2    ;	drive B	is 3 1/2
bios:E229
bios:E229 loc_FE229:						      ;	CODE XREF: POST_init_ints_and_more+1A9j
bios:E229		  mov	  al, dh
bios:E22B		  and	  al, 0F0h
bios:E22D		  cmp	  al, 30h ; '0'
bios:E22F		  jnz	  short	loc_FE236
bios:E231		  or	  byte ptr ds:p400.extra_status_2, 1  ;	drive C	is 3 1/2
bios:E236
bios:E236 loc_FE236:						      ;	CODE XREF: POST_init_ints_and_more+1B6j
bios:E236		  test	  word ptr ds:p400.installed_hardware, 11000000b ; number of diskettes
bios:E23C		  jnz	  short	loc_FE24C
bios:E23E		  test	  word ptr ds:p400.extra_status, 1    ;	is drive A 3 1/2?
bios:E244		  jz	  short	loc_FE24C
bios:E246		  or	  word ptr ds:p400.extra_status, 2    ;	drive B	is 3 1/2
bios:E24C
bios:E24C loc_FE24C:						      ;	CODE XREF: POST_init_ints_and_more+1C3j
bios:E24C							      ;	POST_init_ints_and_more+1CBj
bios:E24C		  mov	  bx, p400.lpt0_base_addr
bios:E24F		  mov	  dx, 3BCh
bios:E252		  mov	  al, 0A5h ; '¥'
bios:E254		  out	  dx, al			      ;	Printer	Data Latch:
bios:E254							      ;	send byte to printer
bios:E255		  jmp	  short	$+2
bios:E257		  in	  al, dx			      ;	Printer	Data Latch:
bios:E257							      ;	fetch last byte	sent
bios:E258		  cmp	  al, 0A5h ; '¥'
bios:E25A		  jnz	  short	loc_FE266
bios:E25C		  mov	  [bx],	dx			      ;	base addresss for lpt0
bios:E25E		  inc	  bx
bios:E25F		  inc	  bx
bios:E260		  add	  word ptr ds:p400.installed_hardware, 4000h ; printer installed + 1
bios:E266
bios:E266 loc_FE266:						      ;	CODE XREF: POST_init_ints_and_more+1E1j
bios:E266		  mov	  dx, 378h
bios:E269		  mov	  al, 0A5h ; '¥'
bios:E26B		  out	  dx, al			      ;	Printer	Data Latch:
bios:E26B							      ;	send byte to printer
bios:E26C		  jmp	  short	$+2
bios:E26E		  in	  al, dx			      ;	Printer	Data Latch:
bios:E26E							      ;	fetch last byte	sent
bios:E26F		  cmp	  al, 0A5h ; '¥'
bios:E271		  jnz	  short	loc_FE27D
bios:E273		  mov	  [bx],	dx			      ;	base address for lpt1
bios:E275		  inc	  bx
bios:E276		  inc	  bx
bios:E277		  add	  word ptr ds:p400.installed_hardware, 4000h ; printer installed + 1
bios:E27D
bios:E27D loc_FE27D:						      ;	CODE XREF: POST_init_ints_and_more+1F8j
bios:E27D		  mov	  dx, 278h
bios:E280		  mov	  al, 0A5h ; '¥'
bios:E282		  out	  dx, al			      ;	Printer	Data Latch:
bios:E282							      ;	send byte to printer
bios:E283		  jmp	  short	$+2
bios:E285		  in	  al, dx			      ;	Printer	Data Latch:
bios:E285							      ;	fetch last byte	sent
bios:E286		  cmp	  al, 0A5h ; '¥'
bios:E288		  jnz	  short	loc_FE292
bios:E28A		  mov	  [bx],	dx			      ;	base address for lpt2
bios:E28C		  add	  word ptr ds:p400.installed_hardware, 4000h ; printer installed + 1
bios:E292
bios:E292 loc_FE292:						      ;	CODE XREF: POST_init_ints_and_more+20Fj
bios:E292		  mov	  bx, p400.lpt0_timeout
bios:E295		  mov	  word ptr [bx], 1414h		      ;	timeout	14h for	all four lpt
bios:E299		  mov	  word ptr [bx+2], 1414h
bios:E29E		  mov	  bx, p400
bios:E2A1		  mov	  dx, 3FBh
bios:E2A4		  mov	  al, 80h ; '€'
bios:E2A6		  out	  dx, al			      ;	COM: line control register bits:
bios:E2A6							      ;	0-1: word length: 00=5,	01=6, 10=7, 11=8
bios:E2A6							      ;	2:   stop bits:	0=1,1=2
bios:E2A6							      ;	3-4: parity: x0=None, 01=Odd, 11=Even
bios:E2A6							      ;	5:   stuck parity
bios:E2A6							      ;	6:   enable break control. 1=start sending 0s (spaces)
bios:E2A6							      ;	7:   DLAB (Divisor Latch Access	Bit)
bios:E2A7		  mov	  dx, 3F8h
bios:E2AA		  mov	  al, 0AAh ; 'ª'
bios:E2AC		  out	  dx, al			      ;	COM: transmitter holding register
bios:E2AC							      ;	or (when DLAB=1) divisor latch low byte.
bios:E2AD		  jmp	  short	$+2
bios:E2AF		  in	  al, dx			      ;	COM: receiver buffer register.
bios:E2AF							      ;	8 bits of character received.
bios:E2B0		  cmp	  al, 0AAh ; 'ª'
bios:E2B2		  jnz	  short	loc_FE2BE
bios:E2B4		  mov	  [bx],	dx			      ;	com0 base address
bios:E2B6		  inc	  bx
bios:E2B7		  inc	  bx
bios:E2B8		  add	  word ptr ds:p400.installed_hardware, 200h ; number of	RS232 ports + 1
bios:E2BE
bios:E2BE loc_FE2BE:						      ;	CODE XREF: POST_init_ints_and_more+239j
bios:E2BE		  mov	  dx, 2FBh
bios:E2C1		  mov	  al, 80h ; '€'
bios:E2C3		  out	  dx, al			      ;	COM: line control register bits:
bios:E2C3							      ;	0-1: word length: 00=5,	01=6, 10=7, 11=8
bios:E2C3							      ;	2:   stop bits:	0=1,1=2
bios:E2C3							      ;	3-4: parity: x0=None, 01=Odd, 11=Even
bios:E2C3							      ;	5:   stuck parity
bios:E2C3							      ;	6:   enable break control. 1=start sending 0s (spaces)
bios:E2C3							      ;	7:   DLAB (Divisor Latch Access	Bit)
bios:E2C4		  mov	  dx, 2F8h
bios:E2C7		  mov	  al, 0AAh ; 'ª'
bios:E2C9		  out	  dx, al			      ;	COM: transmitter holding register
bios:E2C9							      ;	or (when DLAB=1) divisor latch low byte.
bios:E2CA		  jmp	  short	$+2
bios:E2CC		  in	  al, dx			      ;	COM: receiver buffer register.
bios:E2CC							      ;	8 bits of character received.
bios:E2CD		  cmp	  al, 0AAh ; 'ª'
bios:E2CF		  jnz	  short	loc_FE2D9
bios:E2D1		  mov	  [bx],	dx			      ;	comm1 base address
bios:E2D3		  add	  word ptr ds:p400.installed_hardware, 200h ; number of	RS232 ports + 1
bios:E2D9
bios:E2D9 loc_FE2D9:						      ;	CODE XREF: POST_init_ints_and_more+256j
bios:E2D9		  mov	  bx, p400.comm_0_timeout
bios:E2DC		  mov	  word ptr [bx], 101h		      ;	01h timeout for	all four comms
bios:E2E0		  mov	  word ptr [bx+2], 101h
bios:E2E5		  xor	  ax, ax
bios:E2E7		  mov	  ds:p400.POST_entry_point_offset, ax
bios:E2EA		  finit					      ;	test math coprocessor
bios:E2ED		  wait
bios:E2EE		  fstcw	  word ptr ds:p400.POST_entry_point_offset
bios:E2F3		  wait
bios:E2F4		  cmp	  ax, ds:p400.POST_entry_point_offset
bios:E2F8		  jz	  short	loc_FE2FF
bios:E2FA		  or	  byte ptr ds:p400.installed_hardware, 2 ; math	coprocessor installed
bios:E2FF
bios:E2FF loc_FE2FF:						      ;	CODE XREF: POST_init_ints_and_more+27Fj
bios:E2FF		  mov	  ax, 0C800h			      ;	ROM cartridge at c800h ?
bios:E302		  mov	  ds, ax			      ;	ds = c800h
bios:E304		  assume ds:nothing
bios:E304		  mov	  cx, 58h ; 'X'
bios:E307		  call	  run_boot_sector_if_valid
bios:E30A		  mov	  ah, 8
bios:E30C		  mov	  dl, 80h ; '€'
bios:E30E		  int	  13h				      ;	DISK - DISK - GET CURRENT DRIVE	PARAMETERS (XT,AT,XT286,CONV,PS)
bios:E30E							      ;	DL = drive number
bios:E30E							      ;	Return:	CF set on error, AH = status code, BL =	drive type
bios:E30E							      ;	DL = number of consecutive drives
bios:E30E							      ;	DH = maximum value for head number, ES:DI -> drive parameter
bios:E310		  jb	  short	loc_FE332
bios:E312		  mov	  cl, dl
bios:E314		  xor	  ch, ch
bios:E316		  jcxz	  short	loc_FE332
bios:E318		  push	  cs
bios:E319		  pop	  es
bios:E31A		  assume es:nothing
bios:E31A		  mov	  bx, 0C000h
bios:E31D
bios:E31D loc_FE31D:						      ;	CODE XREF: POST_init_ints_and_more+2B7j
bios:E31D		  mov	  dx, cx
bios:E31F		  add	  dl, 7Fh ; ''
bios:E322		  push	  cx
bios:E323		  xor	  ah, ah
bios:E325		  int	  13h				      ;	DISK - RESET DISK SYSTEM
bios:E325							      ;	DL = drive (if bit 7 is	set both hard disks and	floppy disks reset)
bios:E327		  mov	  ax, 201h
bios:E32A		  mov	  cx, 501h
bios:E32D		  int	  13h				      ;	DISK - READ SECTORS INTO MEMORY
bios:E32D							      ;	AL = number of sectors to read,	CH = track, CL = sector
bios:E32D							      ;	DH = head, DL =	drive, ES:BX ->	buffer to fill
bios:E32D							      ;	Return:	CF set on error, AH = status, AL = number of sectors read
bios:E32F		  pop	  cx
bios:E330		  loop	  loc_FE31D
bios:E332
bios:E332 loc_FE332:						      ;	CODE XREF: POST_init_ints_and_more+297j
bios:E332							      ;	POST_init_ints_and_more+29Dj
bios:E332		  mov	  ax, 40h ; '@'
bios:E335		  mov	  ds, ax
bios:E337		  assume ds:nothing
bios:E337		  mov	  ax, 7000h
bios:E33A		  mov	  bl, 1
bios:E33C		  int	  15h				      ;	read EEPROM
bios:E33E		  test	  dl, 1
bios:E341		  jz	  short	loc_FE348
bios:E343		  mov	  byte ptr ds:p400.monochrome_monitor, 0FFh
bios:E348
bios:E348 loc_FE348:						      ;	CODE XREF: POST_init_ints_and_more+2C8j
bios:E348		  test	  dl, 2
bios:E34B		  jz	  short	loc_FE367
bios:E34D		  and	  byte ptr ds:p400.installed_hardware, 11001111b ; turn	off video modes	bits
bios:E352		  or	  byte ptr ds:p400.installed_hardware, 10000b ;	initial	video mode = 40x25 color
bios:E357		  xor	  ax, ax
bios:E359		  mov	  es, ax			      ;	es = 0
bios:E35B		  assume es:nothing
bios:E35B		  mov	  word ptr es:74h, offset video_6845_init_tbl_e	; int 1d
bios:E362		  mov	  word ptr es:76h, cs
bios:E367
bios:E367 loc_FE367:						      ;	CODE XREF: POST_init_ints_and_more+2D2j
bios:E367		  push	  dx
bios:E368		  mov	  ax, 7000h
bios:E36B		  mov	  bl, 0
bios:E36D		  int	  15h				      ;	read EEPROM
bios:E36F		  mov	  bh, dl
bios:E371		  pop	  dx
bios:E372		  and	  bh, 3
bios:E375		  cmp	  bh, 3
bios:E378		  jz	  short	loc_FE384
bios:E37A		  cmp	  bh, 1
bios:E37D		  jz	  short	loc_FE3A2
bios:E37F		  test	  dl, 4
bios:E382		  jz	  short	loc_FE3A2
bios:E384
bios:E384 loc_FE384:						      ;	CODE XREF: POST_init_ints_and_more+2FFj
bios:E384		  push	  dx
bios:E385		  mov	  dx, 3F1h
bios:E388		  mov	  al, 6
bios:E38A		  out	  dx, al
bios:E38B		  pop	  dx
bios:E38C		  mov	  al, ds:p400.extra_status
bios:E38F		  and	  al, 3
bios:E391		  ror	  al, 1
bios:E393		  jnb	  short	loc_FE397
bios:E395		  or	  al, 2
bios:E397
bios:E397 loc_FE397:						      ;	CODE XREF: POST_init_ints_and_more+31Aj
bios:E397		  and	  al, 3
bios:E399		  and	  byte ptr ds:p400.extra_status, 11111100b ; drives A, B are 5 1/4
bios:E39E		  or	  ds:p400.extra_status,	al
bios:E3A2
bios:E3A2 loc_FE3A2:						      ;	CODE XREF: POST_init_ints_and_more+304j
bios:E3A2							      ;	POST_init_ints_and_more+309j
bios:E3A2		  test	  dl, 8
bios:E3A5		  jz	  short	loc_FE3B2
bios:E3A7		  in	  al, 62h			      ;	0-2: Not used
bios:E3A7							      ;	3: Fast	Mode: 0=4.77Mhz, 1=7.16Mhz
bios:E3A7							      ;	4: EEPROM data-serial read only
bios:E3A7							      ;	5: 1=Timer 2 channel out
bios:E3A7							      ;	6: Monochrome mode. 0=Color monitor
bios:E3A7							      ;	7: Reserved
bios:E3A9		  and	  al, 11110111b			      ;	switch to 4.77Mhz (slow	mode)
bios:E3AB		  out	  62h, al			      ;	0-2: Not used
bios:E3AB							      ;	3: Fast	Mode: 0=4.77Mhz, 1=7.16Mhz
bios:E3AB							      ;	4: EEPROM data-serial read only
bios:E3AB							      ;	5: 1=Timer 2 channel out
bios:E3AB							      ;	6: Monochrome mode. 0=Color monitor
bios:E3AB							      ;	7: Reserved
bios:E3AD		  and	  byte ptr ds:p400.extra_status, 11110111b ; slow CPU
bios:E3B2
bios:E3B2 loc_FE3B2:						      ;	CODE XREF: POST_init_ints_and_more+32Cj
bios:E3B2		  mov	  ax, 7000h
bios:E3B5		  mov	  bl, 2
bios:E3B7		  int	  15h				      ;	read EEPROM
bios:E3B9		  test	  dh, 11110000b
bios:E3BC		  jz	  short	loc_FE3E1
bios:E3BE		  or	  byte ptr ds:p400.extra_status, 1000000b
bios:E3C3		  mov	  ax, ds:p400.extra_status
bios:E3C6		  and	  ah, 0FEh
bios:E3C9		  test	  byte ptr ds:p400.extra_status, 10b
bios:E3CE		  jz	  short	loc_FE3D3
bios:E3D0		  or	  ah, 1
bios:E3D3
bios:E3D3 loc_FE3D3:						      ;	CODE XREF: POST_init_ints_and_more+355j
bios:E3D3		  or	  al, 2
bios:E3D5		  test	  byte ptr ds:p400.extra_status_2, 1
bios:E3DA		  jnz	  short	loc_FE3DE
bios:E3DC		  and	  al, 0FDh
bios:E3DE
bios:E3DE loc_FE3DE:						      ;	CODE XREF: POST_init_ints_and_more+361j
bios:E3DE		  mov	  ds:p400.extra_status,	ax
bios:E3E1
bios:E3E1 loc_FE3E1:						      ;	CODE XREF: POST_init_ints_and_more+343j
bios:E3E1		  mov	  ax, 7000h
bios:E3E4		  mov	  bl, 3
bios:E3E6		  int	  15h				      ;	read EEPROM
bios:E3E8		  and	  dl, 18h
bios:E3EB		  cmp	  dl, 10h
bios:E3EE		  jnz	  short	loc_FE42D
bios:E3F0		  mov	  ax, 7000h
bios:E3F3		  mov	  bl, 1
bios:E3F5		  int	  15h				      ;	read EEPROM
bios:E3F7		  test	  dl, 1
bios:E3FA		  jz	  short	loc_FE40E
bios:E3FC		  xor	  ax, ax			      ;	es = 0
bios:E3FE		  mov	  es, ax
bios:E400		  mov	  word ptr es:74h, offset video_6845_init_tbl_b	; int 1dh
bios:E407		  mov	  word ptr es:76h, cs
bios:E40C		  jmp	  short	loc_FE42D
bios:E40E ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E40E
bios:E40E loc_FE40E:						      ;	CODE XREF: POST_init_ints_and_more+381j
bios:E40E		  test	  dl, 2
bios:E411		  jz	  short	loc_FE42D
bios:E413		  xor	  ax, ax
bios:E415		  mov	  es, ax			      ;	es = 0
bios:E417		  mov	  word ptr es:74h, offset video_6845_init_tbl_c	; int 1dh
bios:E41E		  mov	  word ptr es:76h, cs
bios:E423		  and	  byte ptr ds:p400.installed_hardware, 11001111b
bios:E428		  or	  byte ptr ds:p400.installed_hardware, 10000b ;	initial	video mode: 40x25 color
bios:E42D
bios:E42D loc_FE42D:						      ;	CODE XREF: POST_init_ints_and_more+375j
bios:E42D							      ;	POST_init_ints_and_more+393j ...
bios:E42D		  xor	  ax, ax
bios:E42F		  mov	  bx, ds:p400.installed_hardware      ;	installed hardware
bios:E433		  and	  bx, 110000b
bios:E437		  mov	  al, 7				      ;	monochrome 80x25 text mode
bios:E439		  cmp	  bl, 110000b			      ;	is 80x25 mono ?
bios:E43C		  jz	  short	loc_FE447
bios:E43E		  mov	  al, 3				      ;	color 80x25 text mode
bios:E440		  cmp	  bl, 100000b			      ;	is 80x25 color ?
bios:E443		  jz	  short	loc_FE447
bios:E445		  mov	  al, 1
bios:E447
bios:E447 loc_FE447:						      ;	CODE XREF: POST_init_ints_and_more+3C3j
bios:E447							      ;	POST_init_ints_and_more+3CAj
bios:E447		  int	  10h				      ;	- VIDEO	- SET VIDEO MODE
bios:E447							      ;	AL = mode
bios:E449		  mov	  al, 0BCh ; '¼'
bios:E44B		  out	  21h, al			      ;	Interrupt controller, 8259A.
bios:E44D		  mov	  si, (offset aBiosRomVersion+1)
bios:E450		  call	  print_on_screen
bios:E453		  mov	  ax, 7000h
bios:E456		  mov	  bl, 0
bios:E458		  int	  15h				      ;	read EEPROM
bios:E45A		  mov	  cx, dx
bios:E45C		  and	  dl, 0FCh
bios:E45F		  mov	  al, 1
bios:E461		  int	  15h				      ;	write EEPROM
bios:E463		  test	  cl, 1
bios:E466		  jz	  short	loc_FE477
bios:E468		  mov	  al, 4
bios:E46A		  test	  cl, 2
bios:E46D		  jz	  short	loc_FE471
bios:E46F		  mov	  al, 6
bios:E471
bios:E471 loc_FE471:						      ;	CODE XREF: POST_init_ints_and_more+3F4j
bios:E471		  mov	  dx, 3F1h
bios:E474		  out	  dx, al
bios:E475		  jmp	  short	loc_FE486
bios:E477 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E477
bios:E477 loc_FE477:						      ;	CODE XREF: POST_init_ints_and_more+3EDj
bios:E477		  mov	  ax, 7000h
bios:E47A		  mov	  bl, 1
bios:E47C		  int	  15h				      ;	read EEPROM
bios:E47E		  test	  dx, 10h
bios:E482		  jz	  short	loc_FE486
bios:E484		  int	  18h				      ;	TRANSFER TO ROM	BASIC
bios:E484							      ;	causes transfer	to ROM-based BASIC (IBM-PC)
bios:E484							      ;	often reboots a	compatible; often has no effect	at all
bios:E486
bios:E486 loc_FE486:						      ;	CODE XREF: POST_init_ints_and_more+3FCj
bios:E486							      ;	POST_init_ints_and_more+409j
bios:E486		  int	  19h				      ;	DISK BOOT
bios:E486							      ;	causes reboot of disk system
bios:E488		  jmp	  POST_entry
bios:E488 POST_init_ints_and_more endp
bios:E488
bios:E48B
bios:E48B ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E48B
bios:E48B ;	Entry:
bios:E48B ;	    DS:SI = source
bios:E48B ;	    ES:DI = destination
bios:E48B
bios:E48B copy_to_vector_tbl proc near				      ;	CODE XREF: POST_init_ints_and_more+5Ap
bios:E48B							      ;	POST_init_ints_and_more+66p ...
bios:E48B		  movsw					      ;	di++, si++
bios:E48C		  stosw					      ;	di++
bios:E48D		  loop	  copy_to_vector_tbl
bios:E48F		  retn
bios:E48F copy_to_vector_tbl endp
bios:E48F
bios:E490
bios:E490 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E490
bios:E490
bios:E490 int_18_handler  proc near				      ;	DATA XREF: bios:FF13o
bios:E490		  add	  sp, 6
bios:E493
bios:E493 loop:							      ;	CODE XREF: int_18_handler+Fj
bios:E493		  mov	  si, offset aInsertSystemDisketteAndSt	; "\n\rInsert System Diskette and\n\rStrike an"...
bios:E496		  call	  print_on_screen
bios:E499		  xor	  ah, ah
bios:E49B		  int	  16h				      ;	KEYBOARD - READ	CHAR FROM BUFFER, WAIT IF EMPTY
bios:E49B							      ;	Return:	AH = scan code,	AL = character
bios:E49D		  int	  19h				      ;	DISK BOOT
bios:E49D							      ;	causes reboot of disk system
bios:E49F		  jmp	  short	loop
bios:E49F int_18_handler  endp
bios:E49F
bios:E49F ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E4A1 aInsertSystemDisketteAndSt db	0Ah			      ;	DATA XREF: int_18_handler:loopo
bios:E4A1		  db 0Dh,'Insert System Diskette and',0Ah
bios:E4A1		  db 0Dh,'Strike any key when ready',0Ah
bios:E4A1		  db 0Dh,'$'
bios:E4DB
bios:E4DB ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E4DB
bios:E4DB ;	Entry:
bios:E4DB ;	    SI = pointer to the	string to print. '$' terminated
bios:E4DB
bios:E4DB print_on_screen proc near				      ;	CODE XREF: POST_init_ints_and_more+3D7p
bios:E4DB							      ;	int_18_handler+6p ...
bios:E4DB		  mov	  al, cs:[si]
bios:E4DE		  cmp	  al, 24h ; '$'                       ; strings are '$' terminated
bios:E4E0		  jz	  short	locret_FE4ED
bios:E4E2		  push	  si
bios:E4E3		  mov	  ah, 0Eh
bios:E4E5		  mov	  bl, 7
bios:E4E7		  int	  10h				      ;	- VIDEO	- WRITE	CHARACTER AND ADVANCE CURSOR (TTY WRITE)
bios:E4E7							      ;	AL = character,	BH = display page (alpha modes)
bios:E4E7							      ;	BL = foreground	color (graphics	modes)
bios:E4E9		  pop	  si
bios:E4EA		  inc	  si
bios:E4EB		  jmp	  short	print_on_screen
bios:E4ED ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E4ED
bios:E4ED locret_FE4ED:						      ;	CODE XREF: print_on_screen+5j
bios:E4ED		  retn
bios:E4ED print_on_screen endp
bios:E4ED
bios:E4EE
bios:E4EE ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E4EE
bios:E4EE
bios:E4EE int_unexpected_handler proc far			      ;	DATA XREF: bios:FEF7o
bios:E4EE							      ;	bios:FEF9o ...
bios:E4EE		  push	  ax				      ;	used by	other interrupts as well: 0xa, 0xb, 0xd, 0xd and 0xf
bios:E4EF		  push	  ds
bios:E4F0		  mov	  ax, 40h ; '@'
bios:E4F3		  mov	  ds, ax			      ;	ds = 40h
bios:E4F5		  mov	  al, 0Bh
bios:E4F7		  out	  20h, al			      ;	Interrupt controller, 8259A.
bios:E4F9		  in	  al, 20h			      ;	Interrupt controller, 8259A.
bios:E4FB		  or	  al, al
bios:E4FD		  jz	  short	l0
bios:E4FF		  mov	  ah, al
bios:E501		  in	  al, 21h			      ;	Interrupt controller, 8259A.
bios:E503		  or	  al, ah
bios:E505		  out	  21h, al			      ;	Interrupt controller, 8259A.
bios:E507		  mov	  al, 20h ; ' '
bios:E509		  out	  20h, al			      ;	Interrupt controller, 8259A.
bios:E50B		  jmp	  short	l1
bios:E50D ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E50D
bios:E50D l0:							      ;	CODE XREF: int_unexpected_handler+Fj
bios:E50D		  mov	  ah, 0FFh
bios:E50F
bios:E50F l1:							      ;	CODE XREF: int_unexpected_handler+1Dj
bios:E50F		  mov	  ds:p400.POST_last_unexpected_int, ah
bios:E513		  pop	  ds
bios:E514		  assume ds:nothing
bios:E514		  pop	  ax
bios:E515		  iret
bios:E515 int_unexpected_handler endp
bios:E515
bios:E516
bios:E516 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E516
bios:E516
bios:E516 run_boot_sector_if_valid proc	near			      ;	CODE XREF: POST_init_ints_and_more+ECp
bios:E516							      ;	POST_init_ints_and_more+28Ep ...
bios:E516		  xor	  si, si
bios:E518		  cmp	  word ptr [si], 0AA55h		      ;	valid boot / cartridge ROM ?
bios:E51C		  jnz	  short	l2
bios:E51E		  push	  cx
bios:E51F		  mov	  cl, 0
bios:E521		  mov	  ch, [si+2]			      ;	length
bios:E524		  add	  cx, cx			      ;	length * 2
bios:E526		  mov	  al, 0
bios:E528
bios:E528 l0:							      ;	CODE XREF: run_boot_sector_if_valid+15j
bios:E528		  add	  al, [si]
bios:E52A		  inc	  si
bios:E52B		  loop	  l0				      ;	calculate checksum ?
bios:E52D		  or	  al, al
bios:E52F		  jnz	  short	l1
bios:E531		  mov	  ax, 40h ; '@'
bios:E534		  mov	  es, ax			      ;	es = 40h
bios:E536		  assume es:nothing
bios:E536		  mov	  word ptr es:p400.POST_entry_point_offset, 3 ;	POST re-entry after certain resets
bios:E53D		  mov	  word ptr es:p400.POST_entry_point_seg, ds ; c800 / c000 : 0003: ROM cartridge	address
bios:E542		  push	  ds
bios:E543		  call	  dword	ptr es:p400.POST_entry_point_offset
bios:E548		  pop	  ds
bios:E549
bios:E549 l1:							      ;	CODE XREF: run_boot_sector_if_valid+19j
bios:E549		  pop	  cx
bios:E54A
bios:E54A l2:							      ;	CODE XREF: run_boot_sector_if_valid+6j
bios:E54A		  mov	  ax, ds
bios:E54C		  add	  ax, 80h ; '€'
bios:E54F		  mov	  ds, ax			      ;	ds += 80h (go to next block of 0x8000)
bios:E551		  assume ds:nothing
bios:E551		  loop	  run_boot_sector_if_valid
bios:E553		  retn
bios:E553 run_boot_sector_if_valid endp
bios:E553
bios:E553 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E554		  db  62h ; b
bios:E555		  db  79h ; y
bios:E556		  db  20h
bios:E557		  db  4Ch ; L
bios:E558		  db  53h ; S
bios:E559		  db  44h ; D
bios:E55A
bios:E55A ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E55A
bios:E55A
bios:E55A video_init_palette proc near				      ;	CODE XREF: int_10_00_handler+1B9p
bios:E55A		  mov	  bl, 10h			      ;	palette	register
bios:E55C		  mov	  cx, 10h			      ;	number of colors
bios:E55F		  mov	  dx, 3DAh
bios:E562		  xor	  ah, ah
bios:E564
bios:E564 l0:							      ;	CODE XREF: video_init_palette+1Aj
bios:E564		  mov	  al, bl
bios:E566		  out	  dx, al			      ;	0x3da: select register (palette	register)
bios:E567		  add	  dx, 4
bios:E56A		  mov	  al, ah
bios:E56C		  out	  dx, al			      ;	0x3de: palette
bios:E56D		  inc	  bl				      ;	palette	idx 0 =	color 0
bios:E56D							      ;	palette	idx 1 =	color 1
bios:E56D							      ;	...
bios:E56F		  inc	  ah
bios:E571		  sub	  dx, 4
bios:E574		  loop	  l0
bios:E576		  cmp	  byte ptr ds:p400.crt_mode, 0Ah      ;	640x200	4 colors mode ?
bios:E57B		  jnz	  short	skip_redefine_colors
bios:E57D		  mov	  al, 11h			      ;	select palette idx 1
bios:E57F		  out	  dx, al			      ;	3da
bios:E580		  mov	  al, 3
bios:E582		  add	  dx, 4
bios:E585		  out	  dx, al			      ;	palette	idx 1 =	color 3
bios:E586		  sub	  dx, 4
bios:E589		  mov	  al, 12h			      ;	select palette idx 2
bios:E58B		  out	  dx, al			      ;	Video: bits 0-1	control
bios:E58B							      ;	Feature	Control	outputs	FC0 and	FC1
bios:E58C		  mov	  al, 5				      ;	color 5
bios:E58E		  add	  dx, 4
bios:E591		  out	  dx, al			      ;	palette	idx 2 =	color 5
bios:E592		  sub	  dx, 4
bios:E595		  mov	  al, 13h			      ;	select palette idx 3
bios:E597		  out	  dx, al			      ;	Video: bits 0-1	control
bios:E597							      ;	Feature	Control	outputs	FC0 and	FC1
bios:E598		  mov	  al, 0Fh			      ;	color f
bios:E59A		  add	  dx, 4
bios:E59D		  out	  dx, al			      ;	palette	idx 3 =	color 0xf
bios:E59E		  sub	  dx, 4
bios:E5A1
bios:E5A1 skip_redefine_colors:					      ;	CODE XREF: video_init_palette+21j
bios:E5A1		  mov	  al, 1
bios:E5A3		  out	  dx, al			      ;	select palette mask
bios:E5A4		  add	  dx, 4
bios:E5A7		  mov	  al, 0Fh
bios:E5A9		  out	  dx, al			      ;	mask for palette = 0xf (no mask)
bios:E5AA		  sub	  dx, 4
bios:E5AD		  mov	  al, 2
bios:E5AF		  out	  dx, al			      ;	select border color
bios:E5B0		  add	  dx, 4
bios:E5B3		  xor	  al, al
bios:E5B5		  out	  dx, al			      ;	color is 0 for border
bios:E5B6		  sub	  dx, 4
bios:E5B9		  mov	  al, 3				      ;	select mode control
bios:E5BB		  out	  dx, al			      ;	Video: bits 0-1	control
bios:E5BB							      ;	Feature	Control	outputs	FC0 and	FC1
bios:E5BC		  add	  dx, 4
bios:E5BF		  mov	  al, 0				      ;	modes 0-6: no border color, nothing
bios:E5C1		  cmp	  byte ptr ds:p400.crt_mode, 6
bios:E5C6		  jle	  short	s0
bios:E5C8		  mov	  al, 100b			      ;	mode >=	8: enable border color
bios:E5CA		  cmp	  byte ptr ds:p400.crt_mode, 8
bios:E5CF		  jnz	  short	s0
bios:E5D1		  mov	  al, 10100b			      ;	mode 8:	enables	border color + 16 color	mode
bios:E5D3		  jmp	  short	s2
bios:E5D5 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E5D5
bios:E5D5 s0:							      ;	CODE XREF: video_init_palette+6Cj
bios:E5D5							      ;	video_init_palette+75j
bios:E5D5		  cmp	  byte ptr ds:p400.crt_mode, 9
bios:E5DA		  jnz	  short	s1
bios:E5DC		  mov	  al, 10100b			      ;	mode 9:	enables	border color + 16 color	mode
bios:E5DE		  jmp	  short	s2
bios:E5E0 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E5E0
bios:E5E0 s1:							      ;	CODE XREF: video_init_palette+80j
bios:E5E0		  cmp	  byte ptr ds:p400.crt_mode, 0Ah
bios:E5E5		  jnz	  short	s2
bios:E5E7		  mov	  al, 1100b			      ;	mode a:	enables	border color + 640x200 4 color mode
bios:E5E9
bios:E5E9 s2:							      ;	CODE XREF: video_init_palette+79j
bios:E5E9							      ;	video_init_palette+84j	...
bios:E5E9		  out	  dx, al
bios:E5EA		  cmp	  byte ptr ds:p400.monochrome_monitor, 0FFh ; monochrome installed?
bios:E5EF		  jnz	  short	s3			      ;	skip if	not installed (means internal color video)
bios:E5F1		  mov	  ah, 10h			      ;	palette	registers
bios:E5F3		  mov	  si, offset tbl_3de_mono_palette_values
bios:E5F6		  mov	  cx, 10h
bios:E5F9		  nop
bios:E5FA		  mov	  dx, 3DAh
bios:E5FD
bios:E5FD l1:							      ;	CODE XREF: video_init_palette+B3j
bios:E5FD		  mov	  al, ah
bios:E5FF		  out	  dx, al			      ;	Video: bits 0-1	control
bios:E5FF							      ;	Feature	Control	outputs	FC0 and	FC1
bios:E600		  add	  dx, 4
bios:E603		  mov	  al, cs:[si]
bios:E606		  out	  dx, al
bios:E607		  sub	  dx, 4
bios:E60A		  inc	  si
bios:E60B		  inc	  ah
bios:E60D		  loop	  l1
bios:E60F
bios:E60F s3:							      ;	CODE XREF: video_init_palette+95j
bios:E60F		  mov	  dx, 3DAh
bios:E612		  xor	  al, al
bios:E614		  out	  dx, al			      ;	3da = 0? reset ?
bios:E615		  retn
bios:E615 video_init_palette endp
bios:E615
bios:E616
bios:E616 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E616
bios:E616 ;	Entry:
bios:E616 ;	    bl = palette idx to	set (0-15)
bios:E616 ;	    bh = color
bios:E616
bios:E616 set_palette_color proc near				      ;	CODE XREF: int_10_0b_handler+26p
bios:E616							      ;	int_10_0b_handler+78p ...
bios:E616		  mov	  dx, 3DAh
bios:E619		  mov	  al, bl
bios:E61B		  cmp	  al, 10h
bios:E61D		  jnb	  short	error
bios:E61F		  push	  ax
bios:E620		  push	  dx
bios:E621		  mov	  dx, 3DAh
bios:E624
bios:E624 wait_retrace_finish:					      ;	CODE XREF: set_palette_color+11j
bios:E624		  in	  al, dx			      ;	Video status bits:
bios:E624							      ;	0: retrace.  1=display is in vert or horiz retrace.
bios:E624							      ;	1: 1=light pen is triggered; 0=armed
bios:E624							      ;	2: 1=light pen switch is open; 0=closed
bios:E624							      ;	3: 1=vertical sync pulse is occurring.
bios:E625		  test	  al, 8
bios:E627		  jnz	  short	wait_retrace_finish
bios:E629		  cli
bios:E62A
bios:E62A wait_retrace_start:					      ;	CODE XREF: set_palette_color+17j
bios:E62A		  in	  al, dx			      ;	Video status bits:
bios:E62A							      ;	0: retrace.  1=display is in vert or horiz retrace.
bios:E62A							      ;	1: 1=light pen is triggered; 0=armed
bios:E62A							      ;	2: 1=light pen switch is open; 0=closed
bios:E62A							      ;	3: 1=vertical sync pulse is occurring.
bios:E62B		  test	  al, 8
bios:E62D		  jz	  short	wait_retrace_start
bios:E62F		  pop	  dx
bios:E630		  pop	  ax
bios:E631		  add	  al, 10h			      ;	al = palette color idx + 10h
bios:E633		  out	  dx, al			      ;	out 3da, 10h + palette_idx
bios:E634		  add	  dx, 4
bios:E637		  mov	  al, bh
bios:E639		  out	  dx, al			      ;	out 3de, color_value
bios:E63A		  sti
bios:E63B		  clc
bios:E63C		  retn
bios:E63D ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E63D
bios:E63D error:						      ;	CODE XREF: set_palette_color+7j
bios:E63D		  stc
bios:E63E		  retn
bios:E63E set_palette_color endp
bios:E63E
bios:E63F
bios:E63F ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E63F
bios:E63F ; Entry:
bios:E63F ;    bh = 1st	register to select
bios:E63F ;    ch = value for 1st register
bios:E63F ;    bl = 2nd	register to select
bios:E63F ;    cl = value for 2nd register
bios:E63F
bios:E63F set_pair_value_in_6845 proc near			      ;	CODE XREF: int_10_01_handler+4p
bios:E63F							      ;	update_cursor_offset+17j ...
bios:E63F		  mov	  dx, ds:p400.addr_6845		      ;	either 3d4 (color) or 3b4 (mono)
bios:E643		  mov	  al, bh			      ;	bh = register to set
bios:E645		  out	  dx, al
bios:E646		  inc	  dx
bios:E647		  mov	  al, ch			      ;	ch = value for register	bh
bios:E649		  out	  dx, al
bios:E64A		  dec	  dx
bios:E64B		  mov	  al, bl			      ;	bl = register to set
bios:E64D		  out	  dx, al
bios:E64E		  inc	  dx
bios:E64F		  mov	  al, cl			      ;	cl = value for register	bl
bios:E651		  out	  dx, al
bios:E652		  retn
bios:E652 set_pair_value_in_6845 endp
bios:E652
bios:E653
bios:E653 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E653
bios:E653 ;	Entry:
bios:E653 ;	    cx = horizontal position
bios:E653 ;	    dx = vertical position
bios:E653 ;	    bh = display page number
bios:E653 ;
bios:E653 ;	Returns:
bios:E653 ;	    ah = bits for mask ?
bios:E653 ;	    bx = pixel address
bios:E653 ;	    cx = horizontal byte offset
bios:E653 ;	    dx = mask
bios:E653 ;	    carry = clear: Ok. set: error
bios:E653 ;
bios:E653
bios:E653 get_pixel_addr_and_mask proc near			      ;	CODE XREF: int_10_0c_handlerp
bios:E653							      ;	int_10_0d_handlerp
bios:E653		  push	  ax
bios:E654		  mov	  ax, 0B000h
bios:E657		  mov	  es, ax			      ;	es = b000h (mono segment)
bios:E659		  assume es:nothing
bios:E659		  pop	  ax
bios:E65A		  cmp	  dx, 199			      ;	vertical position of the pixel
bios:E65E		  ja	  short	error
bios:E660		  mov	  ah, ds:p400.crt_mode		      ;	current	video mode
bios:E664		  cmp	  ah, 4				      ;	320x200x4?
bios:E667		  jz	  short	test_320_200_mode
bios:E669		  cmp	  ah, 5				      ;	320x200x4 gray?
bios:E66C		  jz	  short	test_320_200_mode
bios:E66E		  cmp	  ah, 6				      ;	640x200x2?
bios:E671		  jz	  short	test_640_200_mode
bios:E673		  cmp	  ah, 8				      ;	160x200x16?
bios:E676		  jz	  short	test_160_200_mode
bios:E678		  cmp	  ah, 9				      ;	320x200x16?
bios:E67B		  jz	  short	test_320_200_mode
bios:E67D		  cmp	  ah, 0Ah			      ;	640x200x4?
bios:E680		  jz	  short	test_640_200_mode
bios:E682
bios:E682 error:						      ;	CODE XREF: get_pixel_addr_and_mask+Bj
bios:E682							      ;	get_pixel_addr_and_mask+36j ...
bios:E682		  stc
bios:E683		  jmp	  short	exit
bios:E685 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E685
bios:E685 test_160_200_mode:					      ;	CODE XREF: get_pixel_addr_and_mask+23j
bios:E685		  cmp	  cx, 159			      ;	horizontal: not	>= 160,	else error
bios:E689		  ja	  short	error
bios:E68B		  jmp	  short	s0
bios:E68D ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E68D
bios:E68D test_320_200_mode:					      ;	CODE XREF: get_pixel_addr_and_mask+14j
bios:E68D							      ;	get_pixel_addr_and_mask+19j ...
bios:E68D		  cmp	  cx, 319			      ;	horizontal: not	>= 320,	else error
bios:E691		  ja	  short	error
bios:E693
bios:E693 s0:							      ;	CODE XREF: get_pixel_addr_and_mask+38j
bios:E693		  call	  get_address_for_pixel
bios:E696		  mov	  ah, 3				      ;	mask. value is 2 LSB bits
bios:E698		  mov	  dx, 1111110000000011b
bios:E69B		  jmp	  short	exit_ok
bios:E69D ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E69D
bios:E69D test_640_200_mode:					      ;	CODE XREF: get_pixel_addr_and_mask+1Ej
bios:E69D							      ;	get_pixel_addr_and_mask+2Dj
bios:E69D		  cmp	  cx, 639			      ;	horizontal: not	>= 640,	else error
bios:E6A1		  ja	  short	error
bios:E6A3		  call	  get_address_for_pixel
bios:E6A6		  mov	  ah, 1				      ;	mask. value is 1 LSB bit
bios:E6A8		  mov	  dx, 1111111000000001b
bios:E6AB
bios:E6AB exit_ok:						      ;	CODE XREF: get_pixel_addr_and_mask+48j
bios:E6AB		  clc
bios:E6AC
bios:E6AC exit:							      ;	CODE XREF: get_pixel_addr_and_mask+30j
bios:E6AC		  retn
bios:E6AC get_pixel_addr_and_mask endp
bios:E6AC
bios:E6AC ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E6AD tbl_3de_mono_palette_values db    0			      ;	DATA XREF: video_init_palette+99o
bios:E6AD							      ;	value for 03deh	when 03dah=0
bios:E6AE		  db	7				      ;	value for 03deh	when 03dah=1
bios:E6AF		  db	7				      ;	value for 03deh	when 03dah=2
bios:E6B0		  db	7				      ;	value for 03deh	when 03dah=3
bios:E6B1		  db	7				      ;	value for 03deh	when 03dah=4
bios:E6B2		  db	7				      ;	value for 03deh	when 03dah=5
bios:E6B3		  db	7				      ;	value for 03deh	when 03dah=6
bios:E6B4		  db	7				      ;	value for 03deh	when 03dah=7
bios:E6B5		  db	8				      ;	value for 03deh	when 03dah=8
bios:E6B6		  db  0Fh				      ;	value for 03deh	when 03dah=9
bios:E6B7		  db  0Fh				      ;	value for 03deh	when 03dah=a
bios:E6B8		  db  0Fh				      ;	value for 03deh	when 03dah=b
bios:E6B9		  db  0Fh				      ;	value for 03deh	when 03dah=c
bios:E6BA		  db  0Fh				      ;	value for 03deh	when 03dah=d
bios:E6BB		  db  0Fh				      ;	value for 03deh	when 03dah=e
bios:E6BC		  db  0Fh				      ;	value for 03deh	when 03dah=f
bios:E6BD		  db 35h dup(0FFh)
bios:E6F2
bios:E6F2 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E6F2
bios:E6F2
bios:E6F2 int_19_handler  proc near				      ;	DATA XREF: bios:FF15o
bios:E6F2		  add	  sp, 6
bios:E6F5
bios:E6F5 loc_FE6F5:						      ;	CODE XREF: int_19_handler+29j
bios:E6F5		  mov	  cx, 5
bios:E6F8
bios:E6F8 loc_FE6F8:						      ;	CODE XREF: int_19_handler+25j
bios:E6F8		  sti
bios:E6F9		  push	  cx
bios:E6FA		  mov	  ah, 0
bios:E6FC		  mov	  dl, 0
bios:E6FE		  int	  13h				      ;	DISK - RESET DISK SYSTEM
bios:E6FE							      ;	DL = drive (if bit 7 is	set both hard disks and	floppy disks reset)
bios:E700		  mov	  ax, 201h
bios:E703		  les	  bx, cs:addr_for_booting_code	      ;	buffer in 0000:7c00
bios:E708		  assume es:nothing
bios:E708		  mov	  cx, 1
bios:E70B		  xor	  dx, dx
bios:E70D		  int	  13h				      ;	DISK - READ SECTORS INTO MEMORY
bios:E70D							      ;	AL = number of sectors to read,	CH = track, CL = sector
bios:E70D							      ;	DH = head, DL =	drive, ES:BX ->	buffer to fill
bios:E70D							      ;	Return:	CF set on error, AH = status, AL = number of sectors read
bios:E70F		  pop	  cx
bios:E710		  jnb	  short	loc_FE71D
bios:E712		  cmp	  ah, 80h ; '€'
bios:E715		  jz	  short	loc_FE719
bios:E717		  loop	  loc_FE6F8
bios:E719
bios:E719 loc_FE719:						      ;	CODE XREF: int_19_handler+23j
bios:E719		  int	  18h				      ;	TRANSFER TO ROM	BASIC
bios:E719							      ;	causes transfer	to ROM-based BASIC (IBM-PC)
bios:E719							      ;	often reboots a	compatible; often has no effect	at all
bios:E71B		  jmp	  short	loc_FE6F5
bios:E71D ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E71D
bios:E71D loc_FE71D:						      ;	CODE XREF: int_19_handler+1Ej
bios:E71D		  jmp	  cs:addr_for_booting_code
bios:E71D int_19_handler  endp
bios:E71D
bios:E71D ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E722 addr_for_booting_code	dd 7C00h			      ;	DATA XREF: int_19_handler+11r
bios:E722							      ;	int_19_handler:loc_FE71Dr
bios:E726		  db 0FFh
bios:E727		  db 0FFh
bios:E728		  db 0FFh
bios:E729 comm_parameters dw 417h				      ;	DATA XREF: int_14_00_handler+15r
bios:E72B		  dw 300h
bios:E72D		  dw 180h
bios:E72F		  dw 0C0h
bios:E731		  dw 60h
bios:E733		  dw 30h
bios:E735		  dw 18h
bios:E737		  dw 0Ch
bios:E739
bios:E739 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E739
bios:E739
bios:E739 int_14_handler  proc far				      ;	DATA XREF: bios:FF0Bo
bios:E739		  call	  push_regs
bios:E73C		  mov	  di, 8
bios:E73F		  nop
bios:E740		  call	  convert_ah_to_di_idx
bios:E743		  jb	  short	error
bios:E745		  mov	  bx, dx
bios:E747		  xor	  cx, cx
bios:E749		  mov	  cl, [bx+p400.comm_0_timeout]	      ;	comm timeout
bios:E74D		  shl	  bx, 1
bios:E74F		  mov	  dx, [bx+p400.comm_0_base_addr]      ;	comm address
bios:E753		  or	  dx, dx
bios:E755		  jnz	  short	jump_to_subsrv
bios:E757		  xor	  ah, ah
bios:E759		  jmp	  int_14_pop_and_iret
bios:E75C ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E75C
bios:E75C jump_to_subsrv:					      ;	CODE XREF: int_14_handler+1Cj
bios:E75C		  jmp	  word ptr cs:jump_table[di]
bios:E75C ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E761 jump_table:						      ;	DATA XREF: int_14_handler:jump_to_subsrvr
bios:E761		  dw offset int_14_00_handler
bios:E763		  dw offset int_14_01_handler
bios:E765		  dw offset int_14_02_handler
bios:E767		  dw offset int_14_03_handler
bios:E769 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E769
bios:E769 error:						      ;	CODE XREF: int_14_handler+Aj
bios:E769		  jmp	  int_14_pop_and_iret
bios:E769 int_14_handler  endp
bios:E769
bios:E76C
bios:E76C ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E76C
bios:E76C ;	Initializes the	baud rate, parity, stop-bit, and word length
bios:E76C ;	parameters for a serial	port, and returns the status for the port.
bios:E76C ;
bios:E76C ;	   On entry:	  AH	     00h
bios:E76C ;			  AL	     Communications parameters
bios:E76C ;			  DX	     Serial port number	(0 - COM1, 1 - COM2, etc.)
bios:E76C ;
bios:E76C ;	   Returns:	  AX	     Line and modem status (see	Service	03h)
bios:E76C ;
bios:E76C
bios:E76C int_14_00_handler proc far				      ;	CODE XREF: int_14_handler:jump_to_subsrvj
bios:E76C							      ;	DATA XREF: int_14_handler:jump_tableo
bios:E76C		  mov	  ah, al
bios:E76E		  mov	  al, 80h ; '€'
bios:E770		  add	  dx, 3
bios:E773		  out	  dx, al			      ;	out comm_addr+3, ??
bios:E774		  dec	  dx
bios:E775		  dec	  dx
bios:E776		  mov	  bl, ah
bios:E778		  and	  bl, 0E0h
bios:E77B		  mov	  cl, 4
bios:E77D		  shr	  bl, cl
bios:E77F		  xor	  bh, bh
bios:E781		  mov	  cx, cs:comm_parameters[bx]
bios:E786		  mov	  al, ch
bios:E788		  out	  dx, al			      ;	out comm_addr+1, ??
bios:E789		  mov	  al, cl
bios:E78B		  dec	  dx
bios:E78C		  out	  dx, al			      ;	out comm_addr, ??
bios:E78D		  mov	  al, ah
bios:E78F		  and	  al, 1Fh
bios:E791		  add	  dx, 3
bios:E794		  out	  dx, al			      ;	out comm_addr+3, ??
bios:E795		  sub	  dx, 3
bios:E798		  inc	  dx
bios:E799		  xor	  al, al
bios:E79B		  out	  dx, al			      ;	out comm_addr+1, ??
bios:E79C		  dec	  dx
bios:E79D		  jmp	  near ptr int_14_03_handler
bios:E79D int_14_00_handler endp
bios:E79D
bios:E7A0
bios:E7A0 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E7A0
bios:E7A0 ;
bios:E7A0 ;	Sends one character to the specified serial port.
bios:E7A0 ;
bios:E7A0 ;	   On entry:	  AH	     01h
bios:E7A0 ;			  AL	     Character
bios:E7A0 ;			  DX	     Serial port number	(0 - COM1, 1 - COM2, etc.)
bios:E7A0 ;
bios:E7A0 ;	   Returns:	  AH	     Line status (see Service 03h)
bios:E7A0
bios:E7A0 int_14_01_handler proc far				      ;	CODE XREF: int_14_handler:jump_to_subsrvj
bios:E7A0							      ;	DATA XREF: int_14_handler+2Ao
bios:E7A0		  mov	  ah, al
bios:E7A2		  mov	  al, 3
bios:E7A4		  add	  dx, 4
bios:E7A7		  out	  dx, al
bios:E7A8		  inc	  dx
bios:E7A9		  inc	  dx
bios:E7AA		  xor	  bx, bx
bios:E7AC
bios:E7AC loc_FE7AC:						      ;	CODE XREF: int_14_01_handler+2Dj
bios:E7AC							      ;	int_14_01_handler+2Fj
bios:E7AC		  in	  al, dx
bios:E7AD		  test	  al, 30h
bios:E7AF		  jz	  short	loc_FE7CC
bios:E7B1		  xor	  bx, bx
bios:E7B3		  dec	  dx
bios:E7B4
bios:E7B4 loc_FE7B4:						      ;	CODE XREF: int_14_01_handler+1Aj
bios:E7B4							      ;	int_14_01_handler+1Cj
bios:E7B4		  in	  al, dx
bios:E7B5		  test	  al, 20h
bios:E7B7		  jnz	  short	loc_FE7C0
bios:E7B9		  dec	  bx
bios:E7BA		  jnz	  short	loc_FE7B4
bios:E7BC		  loop	  loc_FE7B4
bios:E7BE		  jmp	  short	loc_FE7D2
bios:E7C0 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E7C0
bios:E7C0 loc_FE7C0:						      ;	CODE XREF: int_14_01_handler+17j
bios:E7C0		  sub	  dx, 5
bios:E7C3		  mov	  al, ah
bios:E7C5		  out	  dx, al
bios:E7C6		  xchg	  ah, al
bios:E7C8		  xor	  ah, ah
bios:E7CA		  jmp	  short	int_14_pop_and_iret
bios:E7CC ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E7CC
bios:E7CC loc_FE7CC:						      ;	CODE XREF: int_14_01_handler+Fj
bios:E7CC		  dec	  bx
bios:E7CD		  jnz	  short	loc_FE7AC
bios:E7CF		  loop	  loc_FE7AC
bios:E7D1		  dec	  dx
bios:E7D2
bios:E7D2 loc_FE7D2:						      ;	CODE XREF: int_14_01_handler+1Ej
bios:E7D2		  in	  al, dx
bios:E7D3		  or	  al, 80h
bios:E7D5		  xchg	  ah, al
bios:E7D7		  and	  ah, 9Eh
bios:E7DA		  jmp	  short	int_14_pop_and_iret
bios:E7DA int_14_01_handler endp
bios:E7DA
bios:E7DC
bios:E7DC ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E7DC
bios:E7DC ;
bios:E7DC ;	Receives one character at the specified	serial port.
bios:E7DC ;
bios:E7DC ;	   On entry:	  AH	     02h
bios:E7DC ;			  DX	     Serial port number	(0 - COM1, 1 - COM2, etc.)
bios:E7DC ;
bios:E7DC ;	   Returns:	  AL	     Character
bios:E7DC ;			  AH	     Line status (See service 03h)
bios:E7DC ;
bios:E7DC
bios:E7DC int_14_02_handler proc far				      ;	CODE XREF: int_14_handler:jump_to_subsrvj
bios:E7DC							      ;	DATA XREF: int_14_handler+2Co
bios:E7DC		  mov	  al, 1
bios:E7DE		  add	  dx, 4
bios:E7E1		  out	  dx, al
bios:E7E2		  sub	  dx, 4
bios:E7E5		  xor	  bx, bx
bios:E7E7
bios:E7E7 loc_FE7E7:						      ;	CODE XREF: int_14_02_handler+17j
bios:E7E7							      ;	int_14_02_handler+19j
bios:E7E7		  add	  dx, 6
bios:E7EA		  in	  al, dx
bios:E7EB		  sub	  dx, 6
bios:E7EE		  test	  al, 20h
bios:E7F0		  jnz	  short	loc_FE7F9
bios:E7F2		  dec	  bx
bios:E7F3		  jnz	  short	loc_FE7E7
bios:E7F5		  loop	  loc_FE7E7
bios:E7F7		  jmp	  short	loc_FE813
bios:E7F9 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E7F9
bios:E7F9 loc_FE7F9:						      ;	CODE XREF: int_14_02_handler+14j
bios:E7F9		  xor	  bx, bx
bios:E7FB
bios:E7FB loc_FE7FB:						      ;	CODE XREF: int_14_02_handler+33j
bios:E7FB							      ;	int_14_02_handler+35j
bios:E7FB		  add	  dx, 5
bios:E7FE		  in	  al, dx
bios:E7FF		  sub	  dx, 5
bios:E802		  test	  al, 1
bios:E804		  jz	  short	loc_FE80E
bios:E806		  mov	  ah, al
bios:E808		  and	  ah, 1Eh
bios:E80B		  in	  al, dx
bios:E80C		  jmp	  short	int_14_pop_and_iret
bios:E80E ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E80E
bios:E80E loc_FE80E:						      ;	CODE XREF: int_14_02_handler+28j
bios:E80E		  dec	  bx
bios:E80F		  jnz	  short	loc_FE7FB
bios:E811		  loop	  loc_FE7FB
bios:E813
bios:E813 loc_FE813:						      ;	CODE XREF: int_14_02_handler+1Bj
bios:E813		  xor	  ah, ah
bios:E815		  add	  dx, 5
bios:E818		  in	  al, dx
bios:E819		  or	  al, 80h
bios:E81B		  xchg	  ah, al
bios:E81D		  or	  ah, 9Eh
bios:E820		  jmp	  short	int_14_pop_and_iret
bios:E820 int_14_02_handler endp
bios:E820
bios:E822
bios:E822 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E822
bios:E822 ;
bios:E822 ;	Returns	line status and	modem status information for a specified
bios:E822 ;	serial port.
bios:E822 ;
bios:E822 ;	   On entry:	  AH	     03h
bios:E822 ;			  DX	     Serial port number	(0 - COM1, 1 - COM2, etc.)
bios:E822 ;
bios:E822 ;	   Returns:	  AX	     Line and Modem status
bios:E822
bios:E822 int_14_03_handler proc far				      ;	CODE XREF: int_14_handler:jump_to_subsrvj
bios:E822							      ;	int_14_00_handler+31j
bios:E822							      ;	DATA XREF: ...
bios:E822		  add	  dx, 5
bios:E825		  in	  al, dx
bios:E826		  mov	  ah, al
bios:E828		  inc	  dx
bios:E829		  in	  al, dx
bios:E82A
bios:E82A int_14_pop_and_iret:					      ;	CODE XREF: int_14_handler+20j
bios:E82A							      ;	int_14_handler:errorj ...
bios:E82A		  jmp	  near ptr pop_regs_and_iret
bios:E82A int_14_03_handler endp
bios:E82A
bios:E82A ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E82D		  db 0FFh
bios:E82E
bios:E82E ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E82E
bios:E82E
bios:E82E int_16_handler  proc far				      ;	DATA XREF: bios:FF0Fo
bios:E82E
bios:E82E ; FUNCTION CHUNK AT bios:E898	SIZE 00000009 BYTES
bios:E82E
bios:E82E		  sti
bios:E82F		  push	  bx
bios:E830		  push	  cx
bios:E831		  push	  si
bios:E832		  push	  di
bios:E833		  push	  ds
bios:E834		  pushf
bios:E835		  mov	  di, 6
bios:E838		  nop
bios:E839		  call	  convert_ah_to_di_idx
bios:E83C		  jnb	  short	loc_FE843
bios:E83E		  sub	  ah, 2
bios:E841		  jmp	  short	exit
bios:E843 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E843
bios:E843 loc_FE843:						      ;	CODE XREF: int_16_handler+Ej
bios:E843		  jmp	  word ptr cs:jump_tbl[di]
bios:E843 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E848 jump_tbl:						      ;	DATA XREF: int_16_handler:loc_FE843r
bios:E848		  dw offset int_16_00_handler
bios:E84A		  dw offset int_16_01_handler
bios:E84C		  dw offset int_16_02_handler
bios:E84E ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E84E
bios:E84E exit:							      ;	CODE XREF: int_16_handler+13j
bios:E84E		  jmp	  short	int_16_pop_and_exit
bios:E84E int_16_handler  endp
bios:E84E
bios:E850 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E850		  nop
bios:E851
bios:E851 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E851
bios:E851 ;
bios:E851 ;	Returns	the next character in the keyboard buffer; if no character is
bios:E851 ;	available, this	service	waits until one	is available.
bios:E851 ;
bios:E851 ;	   On entry:	  AH	     00h
bios:E851 ;
bios:E851 ;	   Returns:	  AL	     ASCII character code
bios:E851 ;			  AH	     Scan code
bios:E851 ;
bios:E851
bios:E851 int_16_00_handler proc far				      ;	CODE XREF: int_16_handler:loc_FE843j
bios:E851							      ;	int_16_00_handler+26j
bios:E851							      ;	DATA XREF: ...
bios:E851		  cli
bios:E852		  mov	  si, ds:1Ah
bios:E856		  cmp	  si, ds:1Ch
bios:E85A		  jz	  short	loc_FE871
bios:E85C		  mov	  ax, [si]
bios:E85E		  inc	  si
bios:E85F		  inc	  si
bios:E860		  cmp	  si, ds:82h
bios:E864		  jb	  short	loc_FE86A
bios:E866		  mov	  si, ds:80h
bios:E86A
bios:E86A loc_FE86A:						      ;	CODE XREF: int_16_00_handler+13j
bios:E86A		  mov	  ds:1Ah, si
bios:E86E		  sti
bios:E86F		  jmp	  short	int_16_pop_and_exit
bios:E871 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E871
bios:E871 loc_FE871:						      ;	CODE XREF: int_16_00_handler+9j
bios:E871		  sti
bios:E872		  mov	  cx, 19h
bios:E875
bios:E875 loc_FE875:						      ;	CODE XREF: int_16_00_handler:loc_FE875j
bios:E875		  loop	  loc_FE875
bios:E877		  jmp	  short	near ptr int_16_00_handler
bios:E877 int_16_00_handler endp
bios:E877
bios:E879
bios:E879 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E879
bios:E879 ;
bios:E879 ;	Checks to see if a character is	available in the buffer.
bios:E879 ;
bios:E879 ;	   On entry:	  AH	     01h
bios:E879 ;
bios:E879 ;	   Returns:	  Zero	     0,	if character is	available
bios:E879 ;				     1,	if character is	not available
bios:E879 ;			  AL	     ASCII character code (if character	is
bios:E879 ;				     available)
bios:E879 ;			  AH	     Scan code (if character is	available)
bios:E879 ;
bios:E879
bios:E879 int_16_01_handler proc far				      ;	CODE XREF: int_16_handler:loc_FE843j
bios:E879							      ;	DATA XREF: int_16_handler+1Co
bios:E879		  popf
bios:E87A		  xor	  bx, bx
bios:E87C		  cli
bios:E87D		  mov	  si, ds:1Ah
bios:E881		  cmp	  si, ds:1Ch
bios:E885		  sti
bios:E886		  jz	  short	loc_FE890
bios:E888		  mov	  ax, [si]
bios:E88A		  cmp	  bx, 1
bios:E88D		  jmp	  short	loc_FE893
bios:E88F ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E88F		  nop
bios:E890
bios:E890 loc_FE890:						      ;	CODE XREF: int_16_01_handler+Dj
bios:E890		  cmp	  bx, 0
bios:E893
bios:E893 loc_FE893:						      ;	CODE XREF: int_16_01_handler+14j
bios:E893		  jmp	  short	int_16_exit
bios:E893 int_16_01_handler endp
bios:E893
bios:E895
bios:E895 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E895
bios:E895 ;
bios:E895 ;	Returns	the current keyboard shift status.
bios:E895 ;
bios:E895 ;	   On entry:	  AH	     02h
bios:E895 ;
bios:E895 ;	   Returns:	  AL	     Shift status
bios:E895 ;
bios:E895
bios:E895 int_16_02_handler proc far				      ;	CODE XREF: int_16_handler:loc_FE843j
bios:E895							      ;	DATA XREF: int_16_handler+1Eo
bios:E895		  mov	  al, ds:p400.keyb_status_flags_1     ;	get keyboard status flags
bios:E895 int_16_02_handler endp
bios:E895
bios:E898 ; START OF FUNCTION CHUNK FOR	int_16_handler
bios:E898
bios:E898 int_16_pop_and_exit:					      ;	CODE XREF: int_16_handler:exitj
bios:E898							      ;	int_16_00_handler+1Ej
bios:E898		  popf
bios:E899
bios:E899 int_16_exit:						      ;	CODE XREF: int_16_01_handler:loc_FE893j
bios:E899		  pop	  ds
bios:E89A		  assume ds:nothing
bios:E89A		  pop	  di
bios:E89B		  pop	  si
bios:E89C		  pop	  cx
bios:E89D		  pop	  bx
bios:E89E		  retf	  2
bios:E89E ; END	OF FUNCTION CHUNK FOR int_16_handler
bios:E89E ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E8A1		  db 0E6h dup(0FFh)
bios:E987
bios:E987 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:E987
bios:E987 ;  The keyboard generates an INT 9 every time	a key is pushed	or
bios:E987 ;	released.
bios:E987 ;
bios:E987 ;	   Notes:	  This is a hardware interrupt (IRQ 1) activated by
bios:E987 ;			  the make or break of every keystroke.
bios:E987 ;
bios:E987 ;	The default INT	9 handler in the ROM reads the make and	break scan
bios:E987 ;	codes from the keyboard	and converts them into actions or key codes as
bios:E987 ;	follows:
bios:E987 ;
bios:E987 ;	     .	 For ASCII keys, when a	make code is encountered, the ASCII code
bios:E987 ;		 and the scan code for the key are placed in the 32-byte keyboard
bios:E987 ;		 buffer, which is located at 0:41Eh. The ASCII code and	scan code
bios:E987 ;		 are placed in the buffer at the location addressed by the
bios:E987 ;		 Keyboard Buffer Tail Pointer (0:041Ch). The Keyboard Buffer Tail
bios:E987 ;		 Pointer is then incremented by	2, and if it points past the end
bios:E987 ;		 of the	buffer,	it is adjusted so that it points to the	beginning
bios:E987 ;		 of the	buffer.
bios:E987 ;
bios:E987 ;	     .	 If Ctrl, Alt, or Shift	has been pressed, the Shift Status
bios:E987 ;		 (0:0417h) and Extended	Shift Status (0:0418h) bytes are updated.
bios:E987 ;
bios:E987 ;	     .	 If the	Ctrl-Alt-Del combination has been pressed, the Reset
bios:E987 ;		 Flag (0:0472h)	is set to 1234h	and control is given to	the
bios:E987 ;		 power-on self test (POST). Because the	Reset Flag is 1234h, the
bios:E987 ;		 POST routine bypasses the memory test.
bios:E987 ;
bios:E987 ;	     .	 If the	Pause key sequence has been entered, this interrupt
bios:E987 ;		 enters	an indefinite loop. The	loop is	broken as soon as a valid
bios:E987 ;		 ASCII keystroke is entered. (The PC Convertible issues	an INT
bios:E987 ;		 15h, Service 41h (Wait	on External Event), to execute its pause
bios:E987 ;		 loop.)
bios:E987 ;
bios:E987 ;	     .	 If the	Print Screen key sequence is entered, an INT 05h (Print
bios:E987 ;		 Screen) is executed.
bios:E987 ;
bios:E987 ;	     .	 If the	Control-Break key sequence is entered, an INT 1Bh
bios:E987 ;		 (Control-Break) is executed.
bios:E987 ;
bios:E987 ;	     .	 For XTs dated 1/10/86 and after, ATs, XT-286s,	and PC
bios:E987 ;		 Convertibles, the INT 9h handler generates an INT 15h,	function
bios:E987 ;		 91h (Interrupt	Complete) to signal that a keystroke is
bios:E987 ;		 available. Also, on these machines, a make or break of	the Sys
bios:E987 ;		 Req key generates an INT 15h, function	85h (System Request Key
bios:E987 ;		 Pressed).
bios:E987 ;
bios:E987 ;	     .	 For ATs dated 6/10/85 and after, XT-286s, and PC Convertibles,
bios:E987 ;		 an INT	15h, function 4Fh (Keyboard Intercept) is executed after
bios:E987 ;		 the scan code has been	read from the keyboard port (60h). This
bios:E987 ;		 allows	the user to redefine or	remove a keystroke.
bios:E987 ;
bios:E987 ;	INT 16 provides	a standard way to read characters from the keyboard
bios:E987 ;	buffer that have been placed there by the INT 9	handler	in ROM.
bios:E987
bios:E987 int_09_handler  proc far				      ;	DATA XREF: bios:FEF5o
bios:E987		  call	  push_regs
bios:E98A		  push	  ax
bios:E98B		  mov	  ax, 40h ; '@'
bios:E98E		  mov	  ds, ax			      ;	ds = 40h
bios:E990		  assume ds:nothing
bios:E990		  mov	  ch, ds:p400.keyb_status_flags_1     ;	keyboard status	flags 1
bios:E994		  mov	  cl, ds:p400.keyb_status_flags_2     ;	keyboard status	flags 2
bios:E998		  mov	  dx, 60h ; '`'
bios:E99B		  in	  al, dx			      ;	in al, 60h - Read keyboard
bios:E99C		  push	  ax
bios:E99D		  in	  al, 61h			      ;	Port B.	Read Write
bios:E99F		  or	  al, 80h			      ;	bit 7: 1=Keyboard clear
bios:E9A1		  out	  61h, al			      ;	out 61h, 80h
bios:E9A3		  and	  al, 7Fh			      ;	bit 7: 1=Keyboard clear, 0=Keyboard not	clear (?)
bios:E9A5		  out	  61h, al			      ;	out 61h, orig &	7fh.
bios:E9A5							      ;	This sequence of outs to port 61h seems	to be
bios:E9A5							      ;	the standard way to set	the keyboard ready again
bios:E9A7		  pop	  ax
bios:E9A8		  cmp	  al, 0FFh			      ;	unsupported scancode ?
bios:E9AA		  jnz	  short	l0
bios:E9AC		  call	  play_bell_sound
bios:E9AF		  jmp	  update_status_flags_and_exit
bios:E9B2 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E9B2
bios:E9B2 l0:							      ;	CODE XREF: int_09_handler+23j
bios:E9B2		  mov	  ah, al			      ;	ah = scancode (either break code or make code)
bios:E9B4		  and	  al, 7Fh ; ''                       ; al = make code (convert possible break code to make code)
bios:E9B6		  cmp	  al, 1Dh			      ;	scan code for left Ctrl
bios:E9B8		  jnz	  short	l1
bios:E9BA		  jmp	  ctrl_pressed
bios:E9BD ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E9BD
bios:E9BD l1:							      ;	CODE XREF: int_09_handler+31j
bios:E9BD		  cmp	  al, 2Ah ; '*'                       ; scan code for left Shift
bios:E9BF		  jnz	  short	l2
bios:E9C1		  jmp	  left_shift_pressed
bios:E9C4 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E9C4
bios:E9C4 l2:							      ;	CODE XREF: int_09_handler+38j
bios:E9C4		  cmp	  al, 36h ; '6'                       ; scan code for right Shift
bios:E9C6		  jnz	  short	l3
bios:E9C8		  jmp	  right_shift_pressed
bios:E9CB ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E9CB
bios:E9CB l3:							      ;	CODE XREF: int_09_handler+3Fj
bios:E9CB		  cmp	  al, 38h ; '8'                       ; scan code for left Alt (only one Alt in Tandy 1000HX)
bios:E9CD		  jnz	  short	l4
bios:E9CF		  jmp	  alt_pressed
bios:E9D2 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E9D2
bios:E9D2 l4:							      ;	CODE XREF: int_09_handler+46j
bios:E9D2		  cmp	  al, 3Ah ; ':'                       ; scan code for Caps lock
bios:E9D4		  jnz	  short	l5
bios:E9D6		  jmp	  test_caps_lock
bios:E9D9 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E9D9
bios:E9D9 l5:							      ;	CODE XREF: int_09_handler+4Dj
bios:E9D9		  cmp	  al, 45h ; 'E'                       ; scan code for Num Lock
bios:E9DB		  jnz	  short	l6
bios:E9DD		  jmp	  test_num_lock
bios:E9E0 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E9E0
bios:E9E0 l6:							      ;	CODE XREF: int_09_handler+54j
bios:E9E0		  cmp	  al, 46h ; 'F'                       ; scan code for Scroll lock and Hold (?)
bios:E9E2		  jnz	  short	l7
bios:E9E4		  jmp	  test_hold
bios:E9E7 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E9E7
bios:E9E7 l7:							      ;	CODE XREF: int_09_handler+5Bj
bios:E9E7		  cmp	  al, 55h ; 'U'                       ; scan code for keypad: + / insert
bios:E9E9		  jnz	  short	l8
bios:E9EB		  mov	  al, ah			      ;	move scancode to al (scancode boths in ah and al)
bios:E9ED		  jmp	  short	l10
bios:E9EF ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E9EF
bios:E9EF l8:							      ;	CODE XREF: int_09_handler+62j
bios:E9EF		  mov	  al, ah			      ;	al = scan code
bios:E9F1		  test	  cl, 1000b			      ;	paused ?
bios:E9F4		  jz	  short	l10
bios:E9F6		  cmp	  al, 9Dh ; ''                       ; 9d = 80 + 1d = ctrl released ?
bios:E9F8		  jnz	  short	l9
bios:E9FA		  and	  ch, 11111011b			      ;	ctrl released
bios:E9FD		  jmp	  short	update_and_exit_5
bios:E9FF ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:E9FF
bios:E9FF l9:							      ;	CODE XREF: int_09_handler+71j
bios:E9FF		  cmp	  al, 0				      ;	scancode 0 (?)
bios:EA01		  jl	  short	update_and_exit_5
bios:EA03		  and	  cl, 1000b			      ;	filter everything, except pause	key
bios:EA06
bios:EA06 update_and_exit_5:					      ;	CODE XREF: int_09_handler+76j
bios:EA06							      ;	int_09_handler+7Aj
bios:EA06		  call	  out_20_20
bios:EA09		  jmp	  update_status_flags_and_exit2
bios:EA0C ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EA0C
bios:EA0C l10:							      ;	CODE XREF: int_09_handler+66j
bios:EA0C							      ;	int_09_handler+6Dj
bios:EA0C		  cmp	  al, 0D5h ; 'Õ'                      ; 0d5h - 80h = 55h. Keypad + / insert released ?
bios:EA0E		  jnz	  short	l11
bios:EA10		  jmp	  alt_shift_and_numlock_test
bios:EA13 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EA13
bios:EA13 l11:							      ;	CODE XREF: int_09_handler+87j
bios:EA13		  cmp	  al, 0				      ;	scancode 0 (?)
bios:EA15		  jge	  short	l12
bios:EA17		  jmp	  update_status_flags_and_exit
bios:EA1A ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EA1A
bios:EA1A l12:							      ;	CODE XREF: int_09_handler+8Ej
bios:EA1A		  cmp	  al, 47h ; 'G'                       ; scancode for keypad: 7 / \
bios:EA1C		  jl	  short	l13
bios:EA1E		  jmp	  loc_FEC5C
bios:EA21 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EA21
bios:EA21 l13:							      ;	CODE XREF: int_09_handler+95j
bios:EA21		  mov	  byte ptr ds:p400.alt_keypad_entry, 0
bios:EA26		  cmp	  al, 37h ; '7'                       ; print screen ?
bios:EA28		  jnz	  short	use_scancode_tbl_default
bios:EA2A		  test	  ch, 11b			      ;	any shift pressed ?
bios:EA2D		  jz	  short	use_scancode_tbl_default
bios:EA2F		  jmp	  print_screen_pressed
bios:EA32 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EA32
bios:EA32 use_scancode_tbl_default:				      ;	CODE XREF: int_09_handler+A1j
bios:EA32							      ;	int_09_handler+A6j
bios:EA32		  lea	  bx, tbl_scancode_to_ascii_default
bios:EA36		  test	  ch, 1000000b			      ;	caps lock locked ?
bios:EA39		  jz	  short	l16
bios:EA3B		  cmp	  al, 10h			      ;	q ?
bios:EA3D		  jl	  short	l16
bios:EA3F		  cmp	  al, 1Ah			      ;	[{ ?
bios:EA41		  jl	  short	use_scancode_tbl_shift
bios:EA43		  cmp	  al, 1Eh			      ;	a ?
bios:EA45		  jl	  short	l16
bios:EA47		  cmp	  al, 27h ; '''                       ; :; ?
bios:EA49		  jl	  short	use_scancode_tbl_shift
bios:EA4B		  cmp	  al, 2Ch ; ','                       ; z ?
bios:EA4D		  jl	  short	l16
bios:EA4F		  cmp	  al, 33h ; '3'                       ; ,< ?
bios:EA51		  jge	  short	l16
bios:EA53
bios:EA53 use_scancode_tbl_shift:				      ;	CODE XREF: int_09_handler+BAj
bios:EA53							      ;	int_09_handler+C2j
bios:EA53		  lea	  bx, tbl_scancode_to_ascii_shift
bios:EA57
bios:EA57 l16:							      ;	CODE XREF: int_09_handler+B2j
bios:EA57							      ;	int_09_handler+B6j ...
bios:EA57		  test	  ch, 11b			      ;	any shift pressed ?
bios:EA5A		  jz	  short	l18
bios:EA5C		  cmp	  bx, offset tbl_scancode_to_ascii_shift
bios:EA60		  jnz	  short	use_scancode_tbl_shift_2
bios:EA62		  lea	  bx, tbl_scancode_to_ascii_default
bios:EA66		  jmp	  short	l18
bios:EA68 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EA68
bios:EA68 use_scancode_tbl_shift_2:				      ;	CODE XREF: int_09_handler+D9j
bios:EA68		  lea	  bx, tbl_scancode_to_ascii_shift
bios:EA6C
bios:EA6C l18:							      ;	CODE XREF: int_09_handler+D3j
bios:EA6C							      ;	int_09_handler+DFj
bios:EA6C		  test	  ch, 1000b			      ;	alt key	pressed	?
bios:EA6F		  jz	  short	l19
bios:EA71		  lea	  bx, tbl_scancode_to_ascii_alt
bios:EA75		  jmp	  short	do_keypad_scancode_to_ascii_2
bios:EA77 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EA77
bios:EA77 l19:							      ;	CODE XREF: int_09_handler+E8j
bios:EA77		  test	  ch, 100b			      ;	ctrl key pressed ?
bios:EA7A		  jz	  short	do_keypad_scancode_to_ascii_2
bios:EA7C		  lea	  bx, tbl_scancode_to_ascii_ctrl
bios:EA80
bios:EA80 do_keypad_scancode_to_ascii_2:			      ;	CODE XREF: int_09_handler+EEj
bios:EA80							      ;	int_09_handler+F3j
bios:EA80		  call	  scancode_to_ascii
bios:EA83		  cmp	  al, 0FFh			      ;	al = ascii value
bios:EA85		  jnz	  short	l21
bios:EA87		  jmp	  short	update_status_flags_and_exit
bios:EA89 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EA89		  nop
bios:EA8A
bios:EA8A l21:							      ;	CODE XREF: int_09_handler+FEj
bios:EA8A		  cmp	  ah, 29h ; ')'                       ; up arrow ?
bios:EA8D		  jz	  short	pre_put_ax_in_keyb_buffer
bios:EA8F		  cmp	  ah, 2Bh ; '+'                       ; left arrow ?
bios:EA92		  jz	  short	pre_put_ax_in_keyb_buffer
bios:EA94		  cmp	  ah, 3Ah ; ':'                       ; caps ?
bios:EA97		  jg	  short	pre_put_ax_in_keyb_buffer
bios:EA99		  test	  ch, 100b			      ;	ctrl key pressed ?
bios:EA9C		  jz	  short	loc_FEAD5
bios:EA9E		  cmp	  ah, 1				      ;	esc ?
bios:EAA1		  jz	  short	try_intl_xlat
bios:EAA3		  cmp	  ah, 7				      ;	5 ^ ?
bios:EAA6		  jz	  short	try_intl_xlat
bios:EAA8		  cmp	  ah, 0Bh			      ;	0 ) ?
bios:EAAB		  jbe	  short	pre_put_ax_in_keyb_buffer
bios:EAAD		  cmp	  ah, 0Dh			      ;	= + ?
bios:EAB0		  jz	  short	pre_put_ax_in_keyb_buffer
bios:EAB2		  cmp	  ah, 0Fh			      ;	tab ?
bios:EAB5		  jz	  short	pre_put_ax_in_keyb_buffer
bios:EAB7		  cmp	  ah, 27h ; '''                       ; ;: ?
bios:EABA		  jz	  short	pre_put_ax_in_keyb_buffer
bios:EABC		  cmp	  ah, 28h ; '('                       ; '" ?
bios:EABF		  jz	  short	pre_put_ax_in_keyb_buffer
bios:EAC1		  cmp	  ah, 33h ; '3'                       ; , < ?
bios:EAC4		  jz	  short	pre_put_ax_in_keyb_buffer
bios:EAC6		  cmp	  ah, 34h ; '4'                       ; . > ?
bios:EAC9		  jz	  short	pre_put_ax_in_keyb_buffer
bios:EACB		  cmp	  ah, 35h ; '5'                       ; / ?  ?
bios:EACE		  jz	  short	pre_put_ax_in_keyb_buffer
bios:EAD0		  cmp	  ah, 37h ; '7'                       ; print screen ?
bios:EAD3		  jz	  short	pre_put_ax_in_keyb_buffer
bios:EAD5
bios:EAD5 loc_FEAD5:						      ;	CODE XREF: int_09_handler+115j
bios:EAD5		  test	  ch, 1000b			      ;	alt pressed ?
bios:EAD8		  jz	  short	loc_FEAE1
bios:EADA		  cmp	  ah, 39h ; '9'                       ; space bar ?
bios:EADD		  jz	  short	try_intl_xlat
bios:EADF		  jmp	  short	pre_put_ax_in_keyb_buffer
bios:EAE1 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EAE1
bios:EAE1 loc_FEAE1:						      ;	CODE XREF: int_09_handler+151j
bios:EAE1		  cmp	  ah, 0Fh			      ;	tab ?
bios:EAE4		  jnz	  short	loc_FEAEA
bios:EAE6		  cmp	  al, 0Fh			      ;	tab ?
bios:EAE8		  jz	  short	pre_put_ax_in_keyb_buffer
bios:EAEA
bios:EAEA loc_FEAEA:						      ;	CODE XREF: int_09_handler+15Dj
bios:EAEA		  test	  ch, 1000b			      ;	alt pressed ?
bios:EAED		  jz	  short	try_intl_xlat
bios:EAEF
bios:EAEF pre_put_ax_in_keyb_buffer:				      ;	CODE XREF: int_09_handler+106j
bios:EAEF							      ;	int_09_handler+10Bj ...
bios:EAEF		  mov	  ah, al			      ;	ascii to ah
bios:EAF1		  xor	  al, al			      ;	al = 0 (scancode)
bios:EAF3
bios:EAF3 try_intl_xlat:					      ;	CODE XREF: int_09_handler+11Aj
bios:EAF3							      ;	int_09_handler+11Fj ...
bios:EAF3		  mov	  bx, p400.keyb_intl_support
bios:EAF6		  mov	  dx, [bx]
bios:EAF8		  or	  dx, [bx+2]			      ;	is intl_support	== 0 ?
bios:EAFB		  jz	  short	put_ax_in_keyb_buffer
bios:EAFD		  call	  dword	ptr [bx]		      ;	calls intl_support callback to handle input ?
bios:EAFF		  jb	  short	update_status_flags_and_exit
bios:EB01
bios:EB01 put_ax_in_keyb_buffer:				      ;	CODE XREF: int_09_handler+174j
bios:EB01		  call	  put_char_in_keyb_buffer
bios:EB04
bios:EB04 update_status_flags_and_exit:				      ;	CODE XREF: int_09_handler+28j
bios:EB04							      ;	int_09_handler+90j ...
bios:EB04		  call	  out_20_20
bios:EB07
bios:EB07 update_status_flags_and_exit2:			      ;	CODE XREF: int_09_handler+82j
bios:EB07		  mov	  ds:p400.keyb_status_flags_1, ch
bios:EB0B		  mov	  ds:p400.keyb_status_flags_2, cl
bios:EB0F
bios:EB0F pop_and_exit:						      ;	CODE XREF: int_09_handler+256j
bios:EB0F							      ;	int_09_handler:exit_1j
bios:EB0F		  pop	  ax
bios:EB10		  jmp	  near ptr pop_regs_and_iret
bios:EB13 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EB13
bios:EB13 ctrl_pressed:						      ;	CODE XREF: int_09_handler+33j
bios:EB13		  cmp	  ah, 1Dh			      ;	ctrl ?
bios:EB16		  jnz	  short	ctrl_released
bios:EB18		  or	  ch, 100b			      ;	ctrl pressed
bios:EB1B		  and	  ch, 11111100b			      ;	left/right shift released
bios:EB1E		  jmp	  short	update_status_flags_and_exit
bios:EB20 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EB20
bios:EB20 ctrl_released:					      ;	CODE XREF: int_09_handler+18Fj
bios:EB20		  and	  ch, 11111011b
bios:EB23		  jmp	  short	update_status_flags_and_exit
bios:EB25 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EB25
bios:EB25 left_shift_pressed:					      ;	CODE XREF: int_09_handler+3Aj
bios:EB25		  cmp	  ah, 2Ah ; '*'                       ; left shift pressed ?
bios:EB28		  jnz	  short	left_shift_released
bios:EB2A		  or	  ch, 10b
bios:EB2D		  jmp	  short	update_status_flags_and_exit
bios:EB2F ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EB2F
bios:EB2F left_shift_released:					      ;	CODE XREF: int_09_handler+1A1j
bios:EB2F		  and	  ch, 11111101b
bios:EB32		  jmp	  short	update_status_flags_and_exit
bios:EB34 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EB34
bios:EB34 right_shift_pressed:					      ;	CODE XREF: int_09_handler+41j
bios:EB34		  cmp	  ah, 36h ; '6'                       ; right shift ?
bios:EB37		  jnz	  short	right_shift_released
bios:EB39		  or	  ch, 1
bios:EB3C		  jmp	  short	update_status_flags_and_exit
bios:EB3E ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EB3E
bios:EB3E right_shift_released:					      ;	CODE XREF: int_09_handler+1B0j
bios:EB3E		  and	  ch, 11111110b
bios:EB41		  jmp	  short	update_status_flags_and_exit
bios:EB43 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EB43
bios:EB43 alt_pressed:						      ;	CODE XREF: int_09_handler+48j
bios:EB43		  cmp	  ah, 38h ; '8'                       ; alt ?
bios:EB46		  jnz	  short	alt_released
bios:EB48		  or	  ch, 1000b
bios:EB4B		  mov	  byte ptr ds:p400.alt_keypad_entry, 0
bios:EB50		  and	  ch, 11111100b			      ;	left/right shifts released
bios:EB53		  jmp	  short	update_status_flags_and_exit
bios:EB55 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EB55
bios:EB55 alt_released:						      ;	CODE XREF: int_09_handler+1BFj
bios:EB55		  and	  ch, 11110111b			      ;	alt key	released
bios:EB58		  cmp	  byte ptr ds:p400.alt_keypad_entry, 0
bios:EB5D		  jz	  short	update_and_exit_3
bios:EB5F		  xor	  ax, ax
bios:EB61		  mov	  al, ds:p400.alt_keypad_entry	      ;	get value from Alt_buffer, when	alt key	is released
bios:EB64		  jmp	  short	try_intl_xlat
bios:EB66 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EB66
bios:EB66 update_and_exit_3:					      ;	CODE XREF: int_09_handler+1D6j
bios:EB66		  jmp	  short	update_status_flags_and_exit
bios:EB68 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EB68
bios:EB68 test_caps_lock:					      ;	CODE XREF: int_09_handler+4Fj
bios:EB68		  cmp	  ah, 3Ah ; ':'                       ; caps lock
bios:EB6B		  jnz	  short	caps_lock_released
bios:EB6D		  test	  cl, 1000000b			      ;	caps lock pressed ?
bios:EB70		  jnz	  short	update_and_exit_4
bios:EB72		  or	  cl, 1000000b			      ;	caps lock pressed
bios:EB75		  test	  ch, 1000000b			      ;	caps lock locked ?
bios:EB78		  jnz	  short	caps_lock_unlocked
bios:EB7A		  or	  ch, 1000000b			      ;	caps lock locked
bios:EB7D
bios:EB7D update_and_exit_4:					      ;	CODE XREF: int_09_handler+1E9j
bios:EB7D		  jmp	  short	update_status_flags_and_exit
bios:EB7F ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EB7F
bios:EB7F caps_lock_unlocked:					      ;	CODE XREF: int_09_handler+1F1j
bios:EB7F		  and	  ch, 10111111b			      ;	caps lock unlocked
bios:EB82		  jmp	  short	update_status_flags_and_exit
bios:EB84 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EB84
bios:EB84 caps_lock_released:					      ;	CODE XREF: int_09_handler+1E4j
bios:EB84		  and	  ch, 10111111b			      ;	caps lock unlocked
bios:EB87		  and	  cl, 10111111b			      ;	caps lock released
bios:EB8A		  jmp	  update_status_flags_and_exit
bios:EB8D ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EB8D
bios:EB8D test_num_lock:					      ;	CODE XREF: int_09_handler+56j
bios:EB8D		  cmp	  ah, 45h ; 'E'                       ; num lock ?
bios:EB90		  jnz	  short	num_lock_released
bios:EB92		  test	  ch, 100b
bios:EB95		  jz	  short	num_lock_pressed
bios:EB97		  jmp	  update_status_flags_and_exit
bios:EB9A ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EB9A
bios:EB9A num_lock_pressed:					      ;	CODE XREF: int_09_handler+20Ej
bios:EB9A		  or	  cl, 100000b			      ;	num lock pressed
bios:EB9D		  test	  ch, 100000b			      ;	num lock locked	?
bios:EBA0		  jnz	  short	num_lock_unlocked
bios:EBA2		  or	  ch, 100000b			      ;	num lock locked
bios:EBA5		  jmp	  update_status_flags_and_exit
bios:EBA8 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EBA8
bios:EBA8 num_lock_unlocked:					      ;	CODE XREF: int_09_handler+219j
bios:EBA8		  and	  ch, 11011111b			      ;	num lock unlocked
bios:EBAB		  jmp	  update_status_flags_and_exit
bios:EBAE ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EBAE
bios:EBAE num_lock_released:					      ;	CODE XREF: int_09_handler+209j
bios:EBAE		  and	  ch, 11011111b			      ;	num lock unlocked
bios:EBB1		  and	  cl, 11011111b			      ;	num lock released
bios:EBB4		  jmp	  update_status_flags_and_exit
bios:EBB7 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EBB7
bios:EBB7 test_hold:						      ;	CODE XREF: int_09_handler+5Dj
bios:EBB7		  cmp	  ah, 46h ; 'F'                       ; hold ? (freeze display)
bios:EBBA		  jnz	  short	left_alt_released
bios:EBBC		  test	  cl, 10b			      ;	left alt pressed ?
bios:EBBF		  jnz	  short	update_and_exit_0
bios:EBC1		  or	  cl, 10b			      ;	left alt pressed
bios:EBC4		  xor	  cl, 1000b			      ;	toggle pause key
bios:EBC7		  call	  out_20_20
bios:EBCA		  mov	  ds:p400.keyb_status_flags_1, ch
bios:EBCE		  mov	  ds:p400.keyb_status_flags_2, cl
bios:EBD2
bios:EBD2 wait_for_pause_key_released:				      ;	CODE XREF: int_09_handler+253j
bios:EBD2		  test	  byte ptr ds:p400.keyb_status_flags_2,	1000b
bios:EBD7		  jz	  short	exit_0
bios:EBD9		  sti					      ;	enable (keyboard) interrupts
bios:EBDA		  jmp	  short	wait_for_pause_key_released
bios:EBDC ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EBDC
bios:EBDC exit_0:						      ;	CODE XREF: int_09_handler+250j
bios:EBDC		  cli
bios:EBDD		  jmp	  pop_and_exit
bios:EBE0 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EBE0
bios:EBE0 left_alt_released:					      ;	CODE XREF: int_09_handler+233j
bios:EBE0		  and	  cl, 11111101b			      ;	left alt released
bios:EBE3
bios:EBE3 update_and_exit_0:					      ;	CODE XREF: int_09_handler+238j
bios:EBE3		  jmp	  update_status_flags_and_exit
bios:EBE6 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EBE6
bios:EBE6 alt_shift_and_numlock_test:				      ;	CODE XREF: int_09_handler+89j
bios:EBE6		  test	  ch, 100000b			      ;	num lock locked	?
bios:EBE9		  jnz	  short	loc_FEBF6
bios:EBEB		  test	  ch, 1111b			      ;	any shift or any alt pressed ?
bios:EBEE		  jnz	  short	update_and_exit_1
bios:EBF0
bios:EBF0 insert_released:					      ;	CODE XREF: int_09_handler+272j
bios:EBF0		  and	  cl, 1111111b			      ;	Insert key released
bios:EBF3		  jmp	  update_status_flags_and_exit
bios:EBF6 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EBF6
bios:EBF6 loc_FEBF6:						      ;	CODE XREF: int_09_handler+262j
bios:EBF6		  test	  ch, 11b			      ;	any shift pressed ?
bios:EBF9		  jnz	  short	insert_released
bios:EBFB
bios:EBFB update_and_exit_1:					      ;	CODE XREF: int_09_handler+267j
bios:EBFB		  jmp	  update_status_flags_and_exit
bios:EBFB ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EBFE		  db 5Bh dup(0FFh)
bios:EC59 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EC59
bios:EC59 int_13_handler:					      ;	DATA XREF: bios:FF09o
bios:EC59		  jmp	  near ptr int_13_main
bios:EC5C ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EC5C
bios:EC5C loc_FEC5C:						      ;	CODE XREF: int_09_handler+97j
bios:EC5C		  test	  ch, 100b			      ;	ctrl pressed ?
bios:EC5F		  jz	  short	loc_FEC7B
bios:EC61		  cmp	  al, 54h ; 'T'                       ; break scan code ?
bios:EC63		  jnz	  short	loc_FEC68
bios:EC65		  jmp	  ctrl_break_pressed
bios:EC68 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EC68
bios:EC68 loc_FEC68:						      ;	CODE XREF: int_09_handler+2DCj
bios:EC68		  cmp	  al, 53h ; 'S'                       ; keypad - / delete pressed?
bios:EC6A		  jnz	  short	loc_FEC74
bios:EC6C		  test	  ch, 1000b			      ;	alt key	pressed	?
bios:EC6F		  jz	  short	loc_FEC74
bios:EC71		  jmp	  ctrl_alt_del_pressed
bios:EC74 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EC74
bios:EC74 loc_FEC74:						      ;	CODE XREF: int_09_handler+2E3j
bios:EC74							      ;	int_09_handler+2E8j
bios:EC74		  lea	  bx, keypad_scancode_to_ascii_ctrl
bios:EC78		  jmp	  do_keypad_scancode_to_ascii
bios:EC7B ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EC7B
bios:EC7B loc_FEC7B:						      ;	CODE XREF: int_09_handler+2D8j
bios:EC7B		  test	  ch, 1000b
bios:EC7E		  jz	  short	loc_FECFC
bios:EC80		  cmp	  al, 53h ; 'S'                       ; keypad - / delete ?
bios:EC82		  jnz	  short	loc_FEC8C
bios:EC84		  test	  ch, 100b
bios:EC87		  jz	  short	loc_FEC8C
bios:EC89		  jmp	  ctrl_alt_del_pressed
bios:EC8C ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EC8C
bios:EC8C loc_FEC8C:						      ;	CODE XREF: int_09_handler+2FBj
bios:EC8C							      ;	int_09_handler+300j
bios:EC8C		  cmp	  al, 4Ah ; 'J'                       ; down arrow ?
bios:EC8E		  jz	  short	use_keypad_scancode_tbl_alt
bios:EC90		  cmp	  al, 4Eh ; 'N'                       ; right arrow ?
bios:EC92		  jz	  short	use_keypad_scancode_tbl_alt
bios:EC94		  cmp	  al, 54h ; 'T'                       ; break ?
bios:EC96		  jz	  short	loc_FECCB
bios:EC98		  cmp	  al, 53h ; 'S'                       ; keypad - / delete ?
bios:EC9A		  jge	  short	use_keypad_scancode_tbl_alt
bios:EC9C		  cmp	  al, 4Eh ; 'N'                       ; right arrow ?
bios:EC9E		  jz	  short	update_and_exit_2
bios:ECA0		  mov	  dx, ax
bios:ECA2		  xor	  ax, ax
bios:ECA4		  mov	  al, ds:p400.alt_keypad_entry
bios:ECA7		  shl	  ax, 1
bios:ECA9		  push	  ax
bios:ECAA		  shl	  ax, 1
bios:ECAC		  shl	  ax, 1
bios:ECAE		  pop	  bx
bios:ECAF		  add	  ax, bx
bios:ECB1		  push	  ax
bios:ECB2		  mov	  ax, dx
bios:ECB4		  lea	  bx, keypad_scancode_to_ascii_default
bios:ECB8		  sub	  al, 70
bios:ECBA		  call	  scancode_to_ascii
bios:ECBD		  sub	  al, 30h ; '0'                       ; ascii value
bios:ECBF		  xor	  ah, ah
bios:ECC1		  pop	  dx
bios:ECC2		  add	  dx, ax
bios:ECC4		  mov	  ds:p400.alt_keypad_entry, dl
bios:ECC8
bios:ECC8 update_and_exit_2:					      ;	CODE XREF: int_09_handler+317j
bios:ECC8		  jmp	  update_status_flags_and_exit
bios:ECCB ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:ECCB
bios:ECCB loc_FECCB:						      ;	CODE XREF: int_09_handler+30Fj
bios:ECCB		  cmp	  al, 54h ; 'T'                       ; break ?
bios:ECCD		  jnz	  short	loc_FECE3
bios:ECCF		  or	  cl, 10000b			      ;	scroll lock pressed
bios:ECD2		  test	  ch, 10000b			      ;	scroll lock locked ?
bios:ECD5		  jnz	  short	loc_FECDD
bios:ECD7		  or	  ch, 10000b			      ;	scroll lock locked
bios:ECDA		  jmp	  update_status_flags_and_exit
bios:ECDD ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:ECDD
bios:ECDD loc_FECDD:						      ;	CODE XREF: int_09_handler+34Ej
bios:ECDD		  and	  ch, 11101111b			      ;	scroll lock unlocked
bios:ECE0		  jmp	  update_status_flags_and_exit
bios:ECE3 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:ECE3
bios:ECE3 loc_FECE3:						      ;	CODE XREF: int_09_handler+346j
bios:ECE3		  and	  cl, 11101111b			      ;	scroll lock released
bios:ECE6		  jmp	  update_status_flags_and_exit
bios:ECE9 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:ECE9
bios:ECE9 use_keypad_scancode_tbl_alt:				      ;	CODE XREF: int_09_handler+307j
bios:ECE9							      ;	int_09_handler+30Bj ...
bios:ECE9		  lea	  bx, keypad_scancode_to_ascii_alt
bios:ECED		  sub	  al, 70
bios:ECEF		  call	  scancode_to_ascii
bios:ECF2		  cmp	  al, 0FFh			      ;	ascii value
bios:ECF4		  jnz	  short	pre_do_intl_xlat_2
bios:ECF6		  jmp	  update_status_flags_and_exit
bios:ECF9 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:ECF9
bios:ECF9 pre_do_intl_xlat_2:					      ;	CODE XREF: int_09_handler+36Dj
bios:ECF9		  jmp	  pre_put_ax_in_keyb_buffer
bios:ECFC ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:ECFC
bios:ECFC loc_FECFC:						      ;	CODE XREF: int_09_handler+2F7j
bios:ECFC		  test	  ch, 100000b			      ;	num lock locked	?
bios:ECFF		  jnz	  short	loc_FED35
bios:ED01		  cmp	  al, 4Ah ; 'J'                       ; down arrow ?
bios:ED03		  jz	  short	loc_FED0F
bios:ED05		  cmp	  al, 4Eh ; 'N'                       ; right arrow ?
bios:ED07		  jz	  short	loc_FED0F
bios:ED09		  cmp	  al, 58h ; 'X'                       ; home ?
bios:ED0B		  jge	  short	loc_FED0F
bios:ED0D		  jmp	  short	loc_FED16
bios:ED0F ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:ED0F
bios:ED0F loc_FED0F:						      ;	CODE XREF: int_09_handler+37Cj
bios:ED0F							      ;	int_09_handler+380j ...
bios:ED0F		  test	  ch, 11b
bios:ED12		  jnz	  short	use_keypad_scancode_tbl_shift
bios:ED14		  jmp	  short	use_keypad_scancode_tbl_default
bios:ED16 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:ED16
bios:ED16 loc_FED16:						      ;	CODE XREF: int_09_handler+386j
bios:ED16		  test	  ch, 11b
bios:ED19		  jnz	  short	use_keypad_scancode_tbl_default
bios:ED1B
bios:ED1B use_keypad_scancode_tbl_shift:			      ;	CODE XREF: int_09_handler+38Bj
bios:ED1B							      ;	int_09_handler+3B1j
bios:ED1B		  lea	  bx, keypad_scancode_to_ascii_shift
bios:ED1F		  cmp	  al, 55h ; 'U'                       ; keypad + / insert
bios:ED21		  jnz	  short	do_keypad_scancode_to_ascii
bios:ED23		  or	  cl, 10000000b			      ;	insert pressed
bios:ED26		  test	  ch, 10000000b			      ;	insert locked ?
bios:ED29		  jnz	  short	loc_FED30
bios:ED2B		  or	  ch, 10000000b			      ;	insert locked
bios:ED2E		  jmp	  short	do_keypad_scancode_to_ascii
bios:ED30 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:ED30
bios:ED30 loc_FED30:						      ;	CODE XREF: int_09_handler+3A2j
bios:ED30		  and	  ch, 1111111b			      ;	insert unlocked
bios:ED33		  jmp	  short	do_keypad_scancode_to_ascii
bios:ED35 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:ED35
bios:ED35 loc_FED35:						      ;	CODE XREF: int_09_handler+378j
bios:ED35		  test	  ch, 11b			      ;	any shift pressed ?
bios:ED38		  jnz	  short	use_keypad_scancode_tbl_shift
bios:ED3A
bios:ED3A use_keypad_scancode_tbl_default:			      ;	CODE XREF: int_09_handler+38Dj
bios:ED3A							      ;	int_09_handler+392j
bios:ED3A		  lea	  bx, keypad_scancode_to_ascii_default
bios:ED3E
bios:ED3E do_keypad_scancode_to_ascii:				      ;	CODE XREF: int_09_handler+2F1j
bios:ED3E							      ;	int_09_handler+39Aj ...
bios:ED3E		  sub	  al, 70
bios:ED40		  call	  scancode_to_ascii
bios:ED43		  cmp	  al, 0FFh			      ;	al = ascii code
bios:ED45		  jnz	  short	test_ascii_intl_xlat
bios:ED47		  jmp	  update_status_flags_and_exit
bios:ED4A ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:ED4A
bios:ED4A test_ascii_intl_xlat:					      ;	CODE XREF: int_09_handler+3BEj
bios:ED4A		  cmp	  bx, offset keypad_scancode_to_ascii_default
bios:ED4E		  jnz	  short	test_ascii_intl_xlat_2
bios:ED50		  cmp	  al, 50h ; 'P'
bios:ED52		  jz	  short	pre_put_ax_in_keyb_buffer_2
bios:ED54		  cmp	  al, 4Dh ; 'M'
bios:ED56		  jz	  short	pre_put_ax_in_keyb_buffer_2
bios:ED58		  cmp	  al, 0
bios:ED5A		  jz	  short	pre_put_ax_in_keyb_buffer_2
bios:ED5C		  cmp	  al, 47h ; 'G'
bios:ED5E		  jz	  short	pre_put_ax_in_keyb_buffer_2
bios:ED60		  cmp	  al, 98h ; '˜'
bios:ED62		  jz	  short	pre_put_ax_in_keyb_buffer_2
bios:ED64		  cmp	  al, 99h ; '™'
bios:ED66		  jz	  short	pre_put_ax_in_keyb_buffer_2
bios:ED68
bios:ED68 try_intl_xlat_0:					      ;	CODE XREF: int_09_handler+3E6j
bios:ED68							      ;	int_09_handler+3EAj ...
bios:ED68		  jmp	  try_intl_xlat
bios:ED6B ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:ED6B
bios:ED6B test_ascii_intl_xlat_2:				      ;	CODE XREF: int_09_handler+3C7j
bios:ED6B		  cmp	  al, 5Ch ; '\'
bios:ED6D		  jz	  short	try_intl_xlat_0
bios:ED6F		  cmp	  al, 7Ch ; '|'
bios:ED71		  jz	  short	try_intl_xlat_0
bios:ED73		  cmp	  al, 7Eh ; '~'
bios:ED75		  jz	  short	try_intl_xlat_0
bios:ED77		  cmp	  al, 60h ; '`'
bios:ED79		  jz	  short	try_intl_xlat_0
bios:ED7B		  cmp	  al, 0Dh
bios:ED7D		  jz	  short	try_intl_xlat_0
bios:ED7F		  cmp	  al, 5Eh ; '^'
bios:ED81		  jz	  short	try_intl_xlat_0
bios:ED83		  cmp	  al, 3Ch ; '<'
bios:ED85		  jz	  short	try_intl_xlat_0
bios:ED87		  cmp	  al, 23h ; '#'
bios:ED89		  jz	  short	try_intl_xlat_0
bios:ED8B		  cmp	  al, 7Bh ; '{'
bios:ED8D		  jz	  short	try_intl_xlat_0
bios:ED8F		  cmp	  al, 7Dh ; '}'
bios:ED91		  jz	  short	try_intl_xlat_0
bios:ED93		  cmp	  al, 0Ah
bios:ED95		  jz	  short	try_intl_xlat_0
bios:ED97
bios:ED97 pre_put_ax_in_keyb_buffer_2:				      ;	CODE XREF: int_09_handler+3CBj
bios:ED97							      ;	int_09_handler+3CFj ...
bios:ED97		  jmp	  pre_put_ax_in_keyb_buffer
bios:ED9A ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:ED9A
bios:ED9A ctrl_alt_del_pressed:					      ;	CODE XREF: int_09_handler+2EAj
bios:ED9A							      ;	int_09_handler+302j
bios:ED9A		  mov	  bx, p400.POST_reset_flag
bios:ED9D		  mov	  word ptr [bx], 1234h		      ;	ctrl + alt + del pressed
bios:EDA1		  call	  out_20_20
bios:EDA4		  jmp	  reset_vector
bios:EDA7 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EDA7
bios:EDA7 ctrl_break_pressed:					      ;	CODE XREF: int_09_handler+2DEj
bios:EDA7		  mov	  ax, ds:p400.keyb_buffer_start_offset_ptr
bios:EDAA		  mov	  ds:p400.keyb_buffer_head_ptr,	ax
bios:EDAD		  mov	  ds:p400.keyb_buffer_tail_ptr,	ax
bios:EDB0		  push	  ds
bios:EDB1		  mov	  ax, 40h ; '@'
bios:EDB4		  mov	  ds, ax			      ;	ds = 40h
bios:EDB6		  assume ss:nothing
bios:EDB6		  mov	  bx, p400.ctrl_break_flag
bios:EDB9		  mov	  byte ptr [bx], 10000000b	      ;	set break pressed
bios:EDBC		  pop	  ds
bios:EDBD		  assume ds:nothing
bios:EDBD		  int	  1Bh				      ;	CTRL-BREAK KEY
bios:EDBF		  xor	  ax, ax			      ;	0 in keyb buffer
bios:EDC1		  call	  put_char_in_keyb_buffer
bios:EDC4		  jmp	  update_status_flags_and_exit
bios:EDC7 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EDC7
bios:EDC7 print_screen_pressed:					      ;	CODE XREF: int_09_handler+A8j
bios:EDC7		  call	  out_20_20
bios:EDCA		  call	  get_keyb_buffer_next_slot
bios:EDCD		  jb	  short	exit_1
bios:EDCF		  int	  5				      ;	 - PRINT-SCREEN	KEY
bios:EDCF							      ;	automatically called by	keyboard scanner when print-screen key is pressed
bios:EDD1
bios:EDD1 exit_1:						      ;	CODE XREF: int_09_handler+446j
bios:EDD1		  jmp	  pop_and_exit
bios:EDD1 int_09_handler  endp
bios:EDD1
bios:EDD4
bios:EDD4 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:EDD4
bios:EDD4 ;	Entry:
bios:EDD4 ;	    AL = scancode to store in keyboard buffer
bios:EDD4 ;	    AH = ascii to store	in keyboard buffer
bios:EDD4
bios:EDD4 put_char_in_keyb_buffer proc near			      ;	CODE XREF: int_09_handler:put_ax_in_keyb_bufferp
bios:EDD4							      ;	int_09_handler+43Ap
bios:EDD4		  cli
bios:EDD5		  call	  get_keyb_buffer_next_slot
bios:EDD8		  jb	  short	buffer_full
bios:EDDA		  mov	  si, ds:p400.keyb_buffer_tail_ptr
bios:EDDE		  mov	  [si],	ax
bios:EDE0		  inc	  si
bios:EDE1		  inc	  si
bios:EDE2		  cmp	  si, ds:p400.keyb_buffer_end_offset_ptr
bios:EDE6		  jb	  short	l0
bios:EDE8		  mov	  si, ds:p400.keyb_buffer_start_offset_ptr
bios:EDEC
bios:EDEC l0:							      ;	CODE XREF: put_char_in_keyb_buffer+12j
bios:EDEC		  mov	  ds:p400.keyb_buffer_tail_ptr,	si
bios:EDF0		  retn
bios:EDF1 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EDF1
bios:EDF1 buffer_full:						      ;	CODE XREF: put_char_in_keyb_buffer+4j
bios:EDF1		  sti
bios:EDF2		  call	  play_bell_sound
bios:EDF5		  retn
bios:EDF5 put_char_in_keyb_buffer endp
bios:EDF5
bios:EDF6
bios:EDF6 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:EDF6
bios:EDF6 ;	Returns:
bios:EDF6 ;	    SI = Keyboard buffer next slot
bios:EDF6 ;	    Carry = Set	if buffer is buffer is full, Clear otherwise
bios:EDF6
bios:EDF6 get_keyb_buffer_next_slot proc near			      ;	CODE XREF: int_09_handler+443p
bios:EDF6							      ;	put_char_in_keyb_buffer+1p
bios:EDF6		  mov	  si, ds:p400.keyb_buffer_tail_ptr
bios:EDFA		  inc	  si
bios:EDFB		  inc	  si
bios:EDFC		  cmp	  si, ds:p400.keyb_buffer_end_offset_ptr
bios:EE00		  jb	  short	l0
bios:EE02		  mov	  si, ds:p400.keyb_buffer_start_offset_ptr
bios:EE06
bios:EE06 l0:							      ;	CODE XREF: get_keyb_buffer_next_slot+Aj
bios:EE06		  cmp	  si, ds:p400.keyb_buffer_head_ptr
bios:EE0A		  jz	  short	full
bios:EE0C		  clc
bios:EE0D		  jmp	  short	end
bios:EE0F ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EE0F
bios:EE0F full:							      ;	CODE XREF: get_keyb_buffer_next_slot+14j
bios:EE0F		  stc
bios:EE10
bios:EE10 end:							      ;	CODE XREF: get_keyb_buffer_next_slot+17j
bios:EE10		  retn
bios:EE10 get_keyb_buffer_next_slot endp
bios:EE10
bios:EE11
bios:EE11 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:EE11
bios:EE11 ;	Entry:
bios:EE11 ;	    BX+AL: pointer to byte to translate
bios:EE11 ;	Returns:
bios:EE11 ;	    AL:	translated byte
bios:EE11
bios:EE11 scancode_to_ascii proc near				      ;	CODE XREF: int_09_handler:do_keypad_scancode_to_ascii_2p
bios:EE11							      ;	int_09_handler+333p ...
bios:EE11		  push	  ds
bios:EE12		  push	  ax
bios:EE13		  mov	  ax, cs
bios:EE15		  mov	  ds, ax			      ;	ds = cs	(tables	are in BIOS segment)
bios:EE17		  assume ds:nothing
bios:EE17		  pop	  ax
bios:EE18		  dec	  al				      ;	al - 1 (?)
bios:EE1A		  xlat					      ;	al = [ds:bx+al]
bios:EE1B		  pop	  ds
bios:EE1C		  assume ds:nothing
bios:EE1C		  retn
bios:EE1C scancode_to_ascii endp
bios:EE1C
bios:EE1D
bios:EE1D ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:EE1D
bios:EE1D
bios:EE1D out_20_20	  proc near				      ;	CODE XREF: int_09_handler:update_and_exit_5p
bios:EE1D							      ;	int_09_handler:update_status_flags_and_exitp ...
bios:EE1D		  cli
bios:EE1E		  mov	  al, 20h ; ' '
bios:EE20		  mov	  dx, 20h ; ' '
bios:EE23		  out	  dx, al			      ;	out 20,20; Tell	PIC to resume interrupts
bios:EE24		  retn
bios:EE24 out_20_20	  endp
bios:EE24
bios:EE24 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EE25 tbl_scancode_to_ascii_default	db 1Bh,	31h, 32h, 33h, 34h, 35h, 36h, 37h, 38h,	39h, 30h, 2Dh, 3Dh, 8, 9, 71h, 77h, 65h; field_0
bios:EE25							      ;	DATA XREF: int_09_handler:use_scancode_tbl_defaulto
bios:EE25							      ;	int_09_handler+DBo
bios:EE25		  db 72h, 74h, 79h, 75h, 69h, 6Fh, 70h,	5Bh, 5Dh, 0Dh, 0FEh, 61h, 73h, 64h, 66h, 67h, 68h; field_0
bios:EE25		  db 6Ah, 6Bh, 6Ch, 3Bh, 27h, 48h, 0FEh, 4Bh, 7Ah, 78h,	63h, 76h, 62h, 6Eh, 6Dh, 2Ch, 2Eh; field_0
bios:EE25		  db 2Fh, 0FEh,	10h, 0FEh, 20h,	0FEh, 3Bh, 3Ch,	3Dh, 3Eh, 3Fh, 40h, 41h, 42h, 43h, 44h;	field_0
bios:EE25		  db 2 dup(0FEh)			      ;	field_0
bios:EE6B tbl_scancode_to_ascii_shift db 1Bh, 21h, 40h,	23h, 24h, 25h, 5Eh, 26h, 2Ah, 28h, 29h,	5Fh, 2Bh, 8, 0Fh, 51h, 57h; field_0
bios:EE6B							      ;	DATA XREF: int_09_handler:use_scancode_tbl_shifto
bios:EE6B							      ;	int_09_handler+D5o ...
bios:EE6B		  db 45h, 52h, 54h, 59h, 55h, 49h, 4Fh,	50h, 7Bh, 7Dh, 0Dh, 0FFh, 41h, 53h, 44h, 46h, 47h; field_0
bios:EE6B		  db 48h, 4Ah, 4Bh, 4Ch, 3Ah, 22h, 85h,	0FFh, 87h, 5Ah,	58h, 43h, 56h, 42h, 4Eh, 4Dh, 3Ch; field_0
bios:EE6B		  db 3Eh, 3Fh, 0FFh, 0FEh, 0FFh, 20h, 0FFh, 54h, 55h, 56h, 57h,	58h, 59h, 5Ah, 5Bh, 5Ch; field_0
bios:EE6B		  db 5Dh, 0FFh,	0FEh			      ;	field_0
bios:EEB1 tbl_scancode_to_ascii_ctrl db	1Bh, 0E1h, 3, 0E3h, 0E4h, 0E5h,	1Eh, 0E7h, 0E8h, 0E9h, 0E0h, 1Fh, 0F5h,	7Fh, 8Dh; field_0
bios:EEB1							      ;	DATA XREF: int_09_handler+F5o
bios:EEB1		  db 11h, 17h, 5, 12h, 14h, 19h, 15h, 9, 0Fh, 10h, 1Bh,	1Dh, 0Ah, 0FFh,	1, 13h,	4, 6, 7; field_0
bios:EEB1		  db 8,	0Ah, 0Bh, 0Ch, 0F6h, 0F7h, 90h,	0FFh, 73h, 1Ah,	18h, 3,	16h, 2,	0Eh, 0Dh, 0F9h;	field_0
bios:EEB1		  db 0FAh, 0FBh, 0FFh, 72h, 0FFh, 20h, 0FFh, 5Eh, 5Fh, 60h, 61h, 62h, 63h, 64h,	65h, 66h; field_0
bios:EEB1		  db 67h, 0FFh,	0FEh			      ;	field_0
bios:EEF7 tbl_scancode_to_ascii_alt db 8Bh, 78h, 79h, 7Ah, 7Bh,	7Ch, 7Dh, 7Eh, 7Fh, 80h, 81h, 82h, 83h,	8Ch, 8Eh, 10h, 11h; field_0
bios:EEF7							      ;	DATA XREF: int_09_handler+EAo
bios:EEF7		  db 12h, 13h, 14h, 15h, 16h, 17h, 18h,	19h, 0EBh, 0F0h, 8Fh, 0FFh, 1Eh, 1Fh, 20h, 21h;	field_0
bios:EEF7		  db 22h, 23h, 24h, 25h, 26h, 0F8h, 0F1h, 91h, 0FFh, 92h, 2Ch, 2Dh, 2Eh, 2Fh, 30h, 31h;	field_0
bios:EEF7		  db 32h, 89h, 8Ah, 0F2h, 0FFh,	46h, 0FFh, 20h,	0FFh, 68h, 69h,	6Ah, 6Bh, 6Ch, 6Dh, 6Eh; field_0
bios:EEF7		  db 6Fh, 70h, 71h, 0FFh, 0FEh		      ;	field_0
bios:EF3D keypad_scancode_to_ascii_default db 37h, 38h,	39h, 50h, 34h, 35h, 36h, 4Dh, 31h, 32h,	33h, 30h, 2Dh, 0, 2Bh, 2Eh, 0Dh; field_0
bios:EF3D							      ;	DATA XREF: int_09_handler+32Do
bios:EF3D							      ;	int_09_handler:use_keypad_scancode_tbl_defaulto ...
bios:EF3D		  db 47h, 98h, 99h, 5Eh, 3Eh, 40h, 5Bh,	5Dh   ;	field_0
bios:EF56 keypad_scancode_to_ascii_shift db 5Ch, 7Eh, 49h, 86h,	7Ch, 0F3h, 0F4h, 88h, 4Fh, 60h,	51h, 9Bh, 53h, 0, 52h, 0A1h, 0Dh; field_0
bios:EF56							      ;	DATA XREF: int_09_handler:use_keypad_scancode_tbl_shifto
bios:EF56		  db 4Ah, 0A2h,	0A3h, 5Eh, 3Ch,	23h, 7Bh, 7Dh ;	field_0
bios:EF6F keypad_scancode_to_ascii_ctrl	db 93h,	94h, 84h, 96h, 95h, 0FCh, 0FDh,	74h, 75h, 9Ah, 76h, 9Ch, 9Dh, 0, 9Fh, 0A4h, 0Ah; field_0
bios:EF6F							      ;	DATA XREF: int_09_handler:loc_FEC74o
bios:EF6F		  db 77h, 0ACh,	0ADh, 0A7h, 0A8h, 0A9h,	0AAh, 0ABh; field_0
bios:EF88 keypad_scancode_to_ascii_alt db 3 dup(0FEh), 97h, 3 dup(0FEh), 0EAh, 4 dup(0FEh), 9Eh, 0FEh, 0A0h, 0A5h, 8Fh,	0A6h; field_0
bios:EF88							      ;	DATA XREF: int_09_handler:use_keypad_scancode_tbl_alto
bios:EF88		  db 0B6h, 0B7h, 0AEh, 0AFh, 45h, 4Ch, 4Eh    ;	field_0
bios:EFA1		  db 26h dup(0FFh)
bios:EFC7 diskette_params_values diskette_params <0CFh,	2, 25h,	2, 9, 2Ah, 0FFh, 50h, 0F6h, 19h, 4>
bios:EFC7							      ;	DATA XREF: bios:FF1Fo
bios:EFD2
bios:EFD2 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:EFD2
bios:EFD2
bios:EFD2 int_17_handler  proc far				      ;	DATA XREF: bios:FF11o
bios:EFD2		  call	  push_regs
bios:EFD5		  mov	  di, 6
bios:EFD8		  nop
bios:EFD9		  call	  convert_ah_to_di_idx
bios:EFDC		  jb	  short	exit
bios:EFDE		  mov	  bx, dx
bios:EFE0		  xor	  cx, cx
bios:EFE2		  mov	  cl, [bx+78h]
bios:EFE6		  shl	  bx, 1
bios:EFE8		  mov	  dx, [bx+8]
bios:EFEC		  or	  dx, dx
bios:EFEE		  jz	  short	loc_FF049
bios:EFF0		  jmp	  word ptr cs:jump_tbl[di]
bios:EFF0 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EFF5 jump_tbl:						      ;	DATA XREF: int_17_handler+1Er
bios:EFF5		  dw offset int_17_00_handler
bios:EFF7		  dw offset int_17_01_handler
bios:EFF9		  dw offset int_17_02_handler
bios:EFFB ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:EFFB
bios:EFFB exit:							      ;	CODE XREF: int_17_handler+Aj
bios:EFFB		  jmp	  short	loc_FF049
bios:EFFB int_17_handler  endp
bios:EFFB
bios:EFFD
bios:EFFD ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:EFFD
bios:EFFD ;
bios:EFFD ;	Sends one character to the specified parallel printer and returns the
bios:EFFD ;	current	status of the printer.
bios:EFFD ;
bios:EFFD ;	   On entry:	  AH	     00h
bios:EFFD ;			  AL	     Character to print
bios:EFFD ;			  DX	     Parallel printer number (0	- LPT1,	1 - LPT2,
bios:EFFD ;				     etc)
bios:EFFD ;
bios:EFFD ;	   Returns:	  AH	     Printer status (see Service 02h)
bios:EFFD
bios:EFFD int_17_00_handler proc far				      ;	CODE XREF: int_17_handler+1Ej
bios:EFFD							      ;	DATA XREF: int_17_handler:jump_tblo
bios:EFFD		  mov	  ah, al
bios:EFFF		  xor	  bx, bx
bios:F001		  inc	  dx
bios:F002
bios:F002 loc_FF002:						      ;	CODE XREF: int_17_00_handler+1Ej
bios:F002							      ;	int_17_00_handler+20j
bios:F002		  in	  al, dx
bios:F003		  test	  al, 80h
bios:F005		  jz	  short	loc_FF01A
bios:F007		  mov	  al, ah
bios:F009		  dec	  dx
bios:F00A		  out	  dx, al
bios:F00B		  inc	  dx
bios:F00C		  inc	  dx
bios:F00D		  pushf
bios:F00E		  cli
bios:F00F		  mov	  al, 0Dh
bios:F011		  out	  dx, al
bios:F012		  mov	  al, 0Ch
bios:F014		  out	  dx, al
bios:F015		  popf
bios:F016		  mov	  cl, ah
bios:F018		  jmp	  short	loc_FF036
bios:F01A ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F01A
bios:F01A loc_FF01A:						      ;	CODE XREF: int_17_00_handler+8j
bios:F01A		  dec	  bx
bios:F01B		  jnz	  short	loc_FF002
bios:F01D		  loop	  loc_FF002
bios:F01F		  mov	  ch, 1
bios:F021		  mov	  cl, ah
bios:F023		  jmp	  short	loc_FF03E
bios:F023 int_17_00_handler endp
bios:F023
bios:F025
bios:F025 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F025
bios:F025 ;
bios:F025 ;	Sends initialization control codes to the specified parallel printer
bios:F025 ;	and returns the	current	status of the printer.
bios:F025 ;
bios:F025 ;	   On entry:	  AH	     01h
bios:F025 ;			  DX	     Parallel printer number (0	= LPT1,	1 = LPT2,
bios:F025 ;				     etc.)
bios:F025 ;
bios:F025 ;	   Returns:	  AH	     Printer status (See service 02h)
bios:F025
bios:F025 int_17_01_handler proc far				      ;	CODE XREF: int_17_handler+1Ej
bios:F025							      ;	DATA XREF: int_17_handler+25o
bios:F025		  mov	  cl, al
bios:F027		  inc	  dx
bios:F028		  inc	  dx
bios:F029		  mov	  al, 8
bios:F02B		  out	  dx, al
bios:F02C		  push	  cx
bios:F02D		  mov	  cx, 32h ; '2'
bios:F030
bios:F030 loc_FF030:						      ;	CODE XREF: int_17_01_handler:loc_FF030j
bios:F030		  loop	  loc_FF030
bios:F032		  pop	  cx
bios:F033		  mov	  al, 0Ch
bios:F035		  out	  dx, al
bios:F036
bios:F036 loc_FF036:						      ;	CODE XREF: int_17_00_handler+1Bj
bios:F036		  dec	  dx
bios:F037		  xor	  ch, ch
bios:F039		  jmp	  short	loc_FF03E
bios:F039 int_17_01_handler endp
bios:F039
bios:F03B
bios:F03B ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F03B
bios:F03B ;
bios:F03B ;	Returns	status information about the specified parallel	printer.
bios:F03B ;
bios:F03B ;	   On entry:	  AH	     02h
bios:F03B ;			  DX	     Parallel printer number (0	= LPT1,	1 = LPT2,
bios:F03B ;				     etc.)
bios:F03B ;
bios:F03B ;	   Returns:	  AH	     Printer status
bios:F03B
bios:F03B int_17_02_handler proc far				      ;	CODE XREF: int_17_handler+1Ej
bios:F03B							      ;	DATA XREF: int_17_handler+27o
bios:F03B		  mov	  cl, al
bios:F03D		  inc	  dx
bios:F03E
bios:F03E loc_FF03E:						      ;	CODE XREF: int_17_00_handler+26j
bios:F03E							      ;	int_17_01_handler+14j
bios:F03E		  in	  al, dx
bios:F03F		  and	  al, 0F8h
bios:F041		  xor	  al, 48h
bios:F043		  mov	  ah, al
bios:F045		  or	  ah, ch
bios:F047		  mov	  al, cl
bios:F049
bios:F049 loc_FF049:						      ;	CODE XREF: int_17_handler+1Cj
bios:F049							      ;	int_17_handler:exitj
bios:F049		  jmp	  near ptr pop_regs_and_iret
bios:F049 int_17_02_handler endp
bios:F049
bios:F049 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F04C		  db 19h dup(0FFh)
bios:F065
bios:F065 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F065
bios:F065
bios:F065 int_10_handler  proc far				      ;	DATA XREF: bios:FF03o
bios:F065		  call	  push_regs
bios:F068		  cld
bios:F069		  mov	  di, 22h ; '"'                       ; max value for ah (22h / 2) == 11h
bios:F06C		  nop
bios:F06D		  call	  convert_ah_to_di_idx
bios:F070		  jb	  short	exit
bios:F072		  jmp	  word ptr cs:jump_tbl[di]
bios:F072 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F077 jump_tbl:						      ;	DATA XREF: int_10_handler+Dr
bios:F077		  dw offset int_10_00_handler		      ;	set video mode
bios:F079		  dw offset int_10_01_handler		      ;	set cursor size
bios:F07B		  dw offset int_10_02_handler		      ;	set cursor positions
bios:F07D		  dw offset int_10_03_handler		      ;	read cursor position and size
bios:F07F		  dw offset int_10_04_handler		      ;	read light-pen position
bios:F081		  dw offset int_10_05_handler		      ;	set active display page
bios:F083		  dw offset int_10_06_handler		      ;	scroll window up
bios:F085		  dw offset int_10_07_handler		      ;	scroll window down
bios:F087		  dw offset int_10_08_handler		      ;	read char and attribute	at cursor
bios:F089		  dw offset int_10_09_handler		      ;	write char and attribute at cursor
bios:F08B		  dw offset int_10_0a_handler		      ;	write char at cursor
bios:F08D		  dw offset int_10_0b_handler		      ;	set color palette
bios:F08F		  dw offset int_10_0c_handler		      ;	write pixel
bios:F091		  dw offset int_10_0d_handler		      ;	read pixel
bios:F093		  dw offset int_10_0e_handler		      ;	write char in TTY mode
bios:F095		  dw offset int_10_0f_handler		      ;	get current video mode
bios:F097		  dw offset int_10_10_handler		      ;	set palette registers
bios:F099 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F099
bios:F099 exit:							      ;	CODE XREF: int_10_handler+Bj
bios:F099		  jmp	  near ptr pop_regs_and_iret
bios:F099 int_10_handler  endp
bios:F099
bios:F099 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F09C		  db 8 dup(0FFh)
bios:F0A4 video_6845_init_tbl_e	db 38h,	28h, 2Dh, 8, 1Fh, 6, 19h, 1Ch, 2, 7, 6,	7, 4 dup(0); init_modes_0_1
bios:F0A4							      ;	DATA XREF: POST_init_ints_and_more+2E2o
bios:F0A4		  db 71h, 50h, 59h, 10h, 1Fh, 6, 19h, 1Ch, 2, 7, 6, 7, 4 dup(0); init_modes_2_3
bios:F0A4		  db 38h, 28h, 2Dh, 8, 7Fh, 6, 64h, 70h, 2, 1, 6, 7, 4 dup(0); init_modes_4_5_6_8
bios:F0A4		  db 61h, 50h, 52h, 0Fh, 19h, 6, 2 dup(19h), 2,	0Dh, 0Bh, 0Ch, 4 dup(0); init_mode_7
bios:F0A4		  db 71h, 50h, 59h, 10h, 3Fh, 6, 32h, 38h, 2, 3, 6, 7, 4 dup(0); init_modes_9_a
bios:F0F4 video_init_more_tbl video_init_some_vars <0, 2Ch, 28h, 8>   ;	DATA XREF: int_10_00_handler+78r
bios:F0F4							      ;	int_10_00_handler+7Dr ...
bios:F0F4							      ;	video mode 0
bios:F0F8		  video_init_some_vars <0, 28h,	28h, 8>	      ;	video mode 1
bios:F0FC		  video_init_some_vars <10h, 2Dh, 50h, 10h>   ;	video mode 2
bios:F100		  video_init_some_vars <10h, 29h, 50h, 10h>   ;	video mode 3
bios:F104		  video_init_some_vars <20h, 2Ah, 28h, 40h>   ;	video mode 4
bios:F108		  video_init_some_vars <20h, 2Eh, 28h, 40h>   ;	video mode 5
bios:F10C		  video_init_some_vars <20h, 1Eh, 50h, 40h>   ;	video mode 6
bios:F110		  video_init_some_vars <30h, 29h, 50h, 40h>   ;	video mode 7
bios:F114		  video_init_some_vars <20h, 2Ah, 14h, 40h>   ;	video mode 8
bios:F118		  video_init_some_vars <40h, 2Bh, 28h, 80h>   ;	video mode 9
bios:F11C		  video_init_some_vars <40h, 3Bh, 50h, 80h>   ;	video mode a
bios:F120
bios:F120 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F120
bios:F120 ;	Sets the video mode.
bios:F120 ;
bios:F120 ;	   On entry:	  AH	     00h
bios:F120 ;			  AL	     Video mode
bios:F120 ;
bios:F120 ;	   Returns:	  None
bios:F120
bios:F120 int_10_00_handler proc far				      ;	CODE XREF: int_10_handler+Dj
bios:F120							      ;	DATA XREF: int_10_handler:jump_tblo
bios:F120		  push	  ax
bios:F121		  and	  al, 7Fh			      ;	filter bit 7. when 1 ->	clear screen
bios:F123		  mov	  bx, ds:p400.installed_hardware
bios:F127		  and	  bl, 110000b
bios:F12A		  cmp	  bl, 110000b			      ;	is it 80x25 mono ?
bios:F12D		  jnz	  short	s0
bios:F12F		  mov	  al, 7				      ;	set 80x25 mono video mode, which is unsupported
bios:F131
bios:F131 s0:							      ;	CODE XREF: int_10_00_handler+Dj
bios:F131		  test	  byte ptr ds:p400.extra_status, 100000b ; external monochrome monitor installed ?
bios:F136		  jnz	  short	s1
bios:F138		  cmp	  al, 7				      ;	monochrome text	mode? Unsupported
bios:F13A		  jz	  short	exit
bios:F13C
bios:F13C s1:							      ;	CODE XREF: int_10_00_handler+16j
bios:F13C		  test	  byte ptr ds:p400.extra_status, 10000b	; external color video mode enabled?
bios:F141		  jz	  short	s2
bios:F143		  cmp	  al, 7				      ;	monochrome video mono? Unsupported
bios:F145		  jbe	  short	valid_video_mode
bios:F147		  jmp	  short	exit
bios:F149 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F149
bios:F149 s2:							      ;	CODE XREF: int_10_00_handler+21j
bios:F149		  cmp	  al, 0Ah			      ;	video modes must be 0xa	or lower
bios:F14B		  jbe	  short	valid_video_mode
bios:F14D
bios:F14D exit:							      ;	CODE XREF: int_10_00_handler+1Aj
bios:F14D							      ;	int_10_00_handler+27j
bios:F14D		  pop	  ax
bios:F14E		  jmp	  near ptr pop_regs_and_iret
bios:F151 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F151
bios:F151 valid_video_mode:					      ;	CODE XREF: int_10_00_handler+25j
bios:F151							      ;	int_10_00_handler+2Bj
bios:F151		  mov	  ds:p400.crt_mode, al		      ;	save video mode	with bit 7 off
bios:F154		  test	  byte ptr ds:p400.extra_status, 10000b	; external color video mode?
bios:F159		  jnz	  short	loc_FF169
bios:F15B		  push	  ax
bios:F15C		  mov	  dx, 3DAh
bios:F15F		  mov	  al, 3
bios:F161		  out	  dx, al			      ;	select Mode Control
bios:F162		  mov	  al, 0
bios:F164		  add	  dx, 4
bios:F167		  out	  dx, al			      ;	no border, no 16 colors, no 640x200 secondary
bios:F168		  pop	  ax
bios:F169
bios:F169 loc_FF169:						      ;	CODE XREF: int_10_00_handler+39j
bios:F169		  xor	  ah, ah
bios:F16B		  mov	  dx, 3D4h			      ;	set CRT	ctrl base address
bios:F16E		  cmp	  al, 7				      ;	monochrome video mode ?
bios:F170		  jnz	  short	is_color
bios:F172		  test	  byte ptr ds:p400.extra_status, 110000b ; external mono monitor or external color video ?
bios:F177		  jnz	  short	is_mono
bios:F179		  push	  ax				      ;	reaches	here when mode is 7 and	no external monitors. is that possible?
bios:F17A		  mov	  dx, 3DAh
bios:F17D		  mov	  al, 3
bios:F17F		  out	  dx, al			      ;	Select mode control
bios:F180		  add	  dx, 4
bios:F183		  mov	  al, 11b			      ;	??? Not	used in	Tandy color modes ?
bios:F185		  out	  dx, al
bios:F186		  pop	  ax
bios:F187
bios:F187 is_mono:						      ;	CODE XREF: int_10_00_handler+57j
bios:F187		  mov	  ah, 21h ; '!'
bios:F189		  mov	  dx, 3B4h			      ;	set CRT	ctrl base address
bios:F18C
bios:F18C is_color:						      ;	CODE XREF: int_10_00_handler+50j
bios:F18C		  push	  ax
bios:F18D		  push	  dx
bios:F18E		  xor	  ah, ah
bios:F190		  shl	  al, 1
bios:F192		  shl	  al, 1				      ;	al = al	* 4
bios:F194		  mov	  si, ax
bios:F196		  xor	  bx, bx
bios:F198		  mov	  bl, byte ptr cs:video_init_more_tbl.offset_to_6845_tbl[si]
bios:F19D		  mov	  cl, cs:video_init_more_tbl.value_for_3d8[si]
bios:F1A2		  xor	  ax, ax
bios:F1A4		  mov	  al, cs:video_init_more_tbl.nr_columns[si]
bios:F1A9		  mov	  ds:p400.crt_nr_cols, ax
bios:F1AC		  xor	  ax, ax
bios:F1AE		  mov	  ah, cs:video_init_more_tbl.video_page_size_256[si] ; f000:f0f7
bios:F1B3		  mov	  ds:p400.crt_page_len,	ax	      ;	video page size	in bytes
bios:F1B6		  pop	  dx
bios:F1B7		  pop	  ax
bios:F1B8		  mov	  ds:p400.crt_mode_set,	cl	      ;	current	setting	for reg. 3d8/3b8
bios:F1BC		  mov	  ds:p400.addr_6845, dx		      ;	CRT ctrl base address: color=3d4, mono=3b4
bios:F1C0		  add	  dx, 4
bios:F1C3		  mov	  al, ah
bios:F1C5		  out	  dx, al
bios:F1C6		  xor	  ax, ax
bios:F1C8		  mov	  es, ax			      ;	es = 0 (interrupt table)
bios:F1CA		  push	  dx
bios:F1CB		  test	  byte ptr ds:p400.extra_status, 10000b	; external color video mode ?
bios:F1D0		  jnz	  short	skip_non_internal_color_video
bios:F1D2		  cmp	  byte ptr ds:p400.crt_mode, 7	      ;	monochrome video mono?
bios:F1D7		  jnz	  short	internal_color_video
bios:F1D9		  test	  byte ptr ds:p400.extra_status, 100000b ; external mono monitor ?
bios:F1DE		  jz	  short	internal_color_video
bios:F1E0		  jmp	  short	skip_non_internal_color_video
bios:F1E2 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F1E2
bios:F1E2 internal_color_video:					      ;	CODE XREF: int_10_00_handler+B7j
bios:F1E2							      ;	int_10_00_handler+BEj
bios:F1E2		  mov	  al, 111111b			      ;	page register values:
bios:F1E2							      ;	  bit 0-2: CRT Page 0-2
bios:F1E2							      ;	  bit 3-5: Processor Page 0-2
bios:F1E2							      ;	  bit 6-7: Video Address mode  00 -> 40x25 or 80x25 alpha
bios:F1E4		  cmp	  byte ptr ds:p400.crt_mode, 9
bios:F1E9		  jb	  short	s3
bios:F1EB		  mov	  al, 11110110b			      ;	page register values:
bios:F1EB							      ;	  bit 0-2: CRT Page 0-2
bios:F1EB							      ;	  bit 3-5: Processor Page 0-2
bios:F1EB							      ;	  bit 6-7: Video Address mode  11 -> 320x200x16	or 640x200x4
bios:F1ED
bios:F1ED s3:							      ;	CODE XREF: int_10_00_handler+C9j
bios:F1ED		  mov	  dx, 3DFh			      ;	CRT/CPU	page register
bios:F1F0		  out	  dx, al
bios:F1F1		  mov	  ds:p400.video_page_data, al
bios:F1F4		  mov	  al, 0				      ;	CRT and	CPU Page addresses = 0
bios:F1F6		  cmp	  word ptr ds:p400.IO_channel_RAM_size,	384 ; 384k RAM?
bios:F1FC		  jz	  short	s4
bios:F1FE		  cmp	  word ptr ds:p400.IO_channel_RAM_size,	640 ; 640k RAM?
bios:F204		  jz	  short	s4
bios:F206		  mov	  al, 101000b			      ;	CRT Video Page address "17" = 1
bios:F206							      ;	CPU Page Address "17" =	1
bios:F206							      ;	Only when RAM is 384 or	above
bios:F208
bios:F208 s4:							      ;	CODE XREF: int_10_00_handler+DCj
bios:F208							      ;	int_10_00_handler+E4j
bios:F208		  mov	  dx, 3DDh			      ;	extended RAM page register
bios:F20B		  out	  dx, al
bios:F20C		  mov	  ds:p400.extended_ram,	al
bios:F20F
bios:F20F skip_non_internal_color_video:			      ;	CODE XREF: int_10_00_handler+B0j
bios:F20F							      ;	int_10_00_handler+C0j
bios:F20F		  mov	  si, 74h ; 't'
bios:F212		  mov	  di, es:[si]			      ;	int 1d.	offset to video	6845 init vars
bios:F215		  add	  di, bx			      ;	bx = offset to correct table for mode
bios:F217		  mov	  ax, es:[si+2]
bios:F21B		  mov	  es, ax
bios:F21D		  test	  byte ptr ds:p400.extra_status, 10000b	; external color video ?
bios:F222		  jz	  short	dont_use_default_bios_video_table
bios:F224		  cmp	  ax, 0F000h			      ;	in BIOS	segment	?
bios:F227		  jb	  short	dont_use_default_bios_video_table
bios:F229		  mov	  ax, cs			      ;	use BIOS video table if	not modified by	user or	internal color video
bios:F22B		  mov	  es, ax			      ;	es = 0xf000 (bios seg)
bios:F22D		  assume es:nothing
bios:F22D		  mov	  di, offset video_6845_init_tbl_a    ;	default	bios video table
bios:F230		  add	  di, bx			      ;	offset to correct table	for mode
bios:F232
bios:F232 dont_use_default_bios_video_table:			      ;	CODE XREF: int_10_00_handler+102j
bios:F232							      ;	int_10_00_handler+107j
bios:F232		  xor	  bh, bh
bios:F234		  xor	  cx, cx
bios:F236
bios:F236 l0:							      ;	CODE XREF: int_10_00_handler+128j
bios:F236		  mov	  dx, ds:p400.addr_6845		      ;	CRT ctrl base address: color=3d4, mono=3b4
bios:F23A		  mov	  al, cl			      ;	init the 16 registers of 3d4/3d5 pointed by es:di
bios:F23C		  out	  dx, al			      ;	prepare	value to by out	(3d4)
bios:F23D		  inc	  dx
bios:F23E		  mov	  bl, cl
bios:F240		  mov	  al, es:[bx+di]
bios:F243		  out	  dx, al			      ;	send value (0x3d5)
bios:F244		  inc	  cx
bios:F245		  cmp	  cx, 10h			      ;	init 16	registers
bios:F248		  jl	  short	l0
bios:F24A		  mov	  word ptr ds:p400.cursor_row_column, 607h ; cursor size: start	line=06, end line=07
bios:F250		  mov	  word ptr ds:p400.crt_current_page_offset, 0
bios:F256		  mov	  byte ptr ds:p400.active_display_page,	0 ; active page	= 0
bios:F25B		  mov	  byte ptr ds:p400.shadow_3d9_crt_palette, 110000b ; foreground	bright=on, palette=1
bios:F260		  pop	  dx
bios:F261		  pop	  ax
bios:F262		  push	  dx
bios:F263		  test	  al, 80h			      ;	clear screen ?
bios:F265		  jnz	  short	skip_clear_screen
bios:F267		  mov	  ax, 0B800h			      ;	video base address for color
bios:F26A		  mov	  cx, 2000h			      ;	0x2000 words (16k to clear)
bios:F26D		  cmp	  byte ptr ds:p400.crt_mode, 9
bios:F272		  jb	  short	s5
bios:F274		  mov	  cx, 4000h			      ;	0x4000 words (32k to clear)
bios:F277
bios:F277 s5:							      ;	CODE XREF: int_10_00_handler+152j
bios:F277		  mov	  bx, 720h
bios:F27A		  cmp	  byte ptr ds:p400.crt_mode, 7
bios:F27F		  jnz	  short	s6
bios:F281		  mov	  ax, 0B000h			      ;	video base address for monochrome
bios:F284		  mov	  cx, 800h			      ;	0x800 words (4k	to clear)
bios:F287		  jmp	  short	s7
bios:F289 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F289
bios:F289 s6:							      ;	CODE XREF: int_10_00_handler+15Fj
bios:F289		  cmp	  byte ptr ds:p400.crt_mode, 4
bios:F28E		  jl	  short	s7
bios:F290		  xor	  bx, bx
bios:F292
bios:F292 s7:							      ;	CODE XREF: int_10_00_handler+167j
bios:F292							      ;	int_10_00_handler+16Ej
bios:F292		  mov	  es, ax
bios:F294		  assume es:nothing
bios:F294		  xor	  di, di
bios:F296		  mov	  ax, bx
bios:F298		  rep stosw				      ;	and clear the screen
bios:F29A
bios:F29A skip_clear_screen:					      ;	CODE XREF: int_10_00_handler+145j
bios:F29A		  mov	  ax, ds
bios:F29C		  mov	  es, ax			      ;	ds = es	= 0x40
bios:F29E		  assume es:nothing
bios:F29E		  xor	  ax, ax
bios:F2A0		  lea	  di, ds:p400.cursor_row_col_in_pages
bios:F2A4		  mov	  cx, 8
bios:F2A7		  rep stosw				      ;	clear memory:0450h - 045fh: cursor pos in pages
bios:F2A9		  cmp	  byte ptr ds:p400.crt_mode, 7	      ;	hercules text video mode?
bios:F2AE		  jz	  short	skip_color_select
bios:F2B0		  mov	  al, 110000b			      ;	modes 0-5: palette 1 + foreground intensity
bios:F2B2		  cmp	  byte ptr ds:p400.crt_mode, 6	      ;	640x200x2 video	mode?
bios:F2B7		  jl	  short	color_select
bios:F2B9		  mov	  al, 111111b			      ;	mode 0xa: select all colors + palette 1
bios:F2BB		  cmp	  byte ptr ds:p400.crt_mode, 0Ah      ;	640x200x4 video	mode?
bios:F2C0		  jnz	  short	color_select
bios:F2C2		  mov	  al, 0				      ;	mode 8,9: off all colors
bios:F2C4
bios:F2C4 color_select:						      ;	CODE XREF: int_10_00_handler+197j
bios:F2C4							      ;	int_10_00_handler+1A0j
bios:F2C4		  mov	  dx, 3D9h
bios:F2C7		  out	  dx, al			      ;	update color register (colors +	palette	select)
bios:F2C8		  mov	  ds:p400.shadow_3d9_crt_palette, al  ;	update shadow variable
bios:F2CB
bios:F2CB skip_color_select:					      ;	CODE XREF: int_10_00_handler+18Ej
bios:F2CB		  test	  byte ptr ds:p400.extra_status, 10000b	; external color video?
bios:F2D0		  jnz	  short	skip_something
bios:F2D2		  cmp	  byte ptr ds:p400.crt_mode, 7	      ;	hercules text video mode?
bios:F2D7		  jz	  short	skip_something
bios:F2D9		  call	  video_init_palette
bios:F2DC
bios:F2DC skip_something:					      ;	CODE XREF: int_10_00_handler+1B0j
bios:F2DC							      ;	int_10_00_handler+1B7j
bios:F2DC		  pop	  dx
bios:F2DD		  mov	  al, ds:p400.crt_mode_set
bios:F2E0		  out	  dx, al
bios:F2E1		  jmp	  near ptr pop_regs_and_iret
bios:F2E1 int_10_00_handler endp
bios:F2E1
bios:F2E4
bios:F2E4 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F2E4
bios:F2E4 ; Adjusts the	size of	the cursor by setting its start	and end	lines.
bios:F2E4 ;
bios:F2E4 ;	   On entry:	  AH	     01h
bios:F2E4 ;			  CH	     Cursor start line (bits 4 to 0)
bios:F2E4 ;			  CL	     Cursor end	line   (bits 4 to 0)
bios:F2E4 ;
bios:F2E4 ;	   Returns:	  None
bios:F2E4
bios:F2E4 int_10_01_handler proc far				      ;	CODE XREF: int_10_handler+Dj
bios:F2E4							      ;	DATA XREF: int_10_handler+14o
bios:F2E4		  mov	  bh, 0Ah			      ;	reg. 0a	= cursor start register
bios:F2E6		  mov	  bl, 0Bh			      ;	reg. 0b	= cursor end register, cx=has value
bios:F2E8		  call	  set_pair_value_in_6845
bios:F2EB		  mov	  ds:p400.cursor_row_column, cx	      ;	0460h=cursor end line. 0461h=cursor start line
bios:F2EF		  jmp	  near ptr pop_regs_and_iret
bios:F2EF int_10_01_handler endp
bios:F2EF
bios:F2F2
bios:F2F2 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F2F2
bios:F2F2 ; Sets the cursor position (row and column) for a specified display
bios:F2F2 ;	page.
bios:F2F2 ;
bios:F2F2 ;	   On entry:	  AH	     02h
bios:F2F2 ;			  BH	     Display page number
bios:F2F2 ;			  DH	     Row
bios:F2F2 ;			  DL	     Column
bios:F2F2 ;
bios:F2F2 ;	   Returns:	  None
bios:F2F2
bios:F2F2 int_10_02_handler proc far				      ;	CODE XREF: int_10_handler+Dj
bios:F2F2							      ;	DATA XREF: int_10_handler+16o
bios:F2F2		  call	  set_cursor_pos
bios:F2F5		  jmp	  near ptr pop_regs_and_iret
bios:F2F5 int_10_02_handler endp
bios:F2F5
bios:F2F8
bios:F2F8 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F2F8
bios:F2F8 ;	Sets the cursor	position (row and column) for a	specified display
bios:F2F8 ;	page.
bios:F2F8 ;
bios:F2F8 ;	   On entry:	  AH	     02h
bios:F2F8 ;			  BH	     Display page number
bios:F2F8 ;			  DH	     Row
bios:F2F8 ;			  DL	     Column
bios:F2F8 ;
bios:F2F8 ;	   Returns:	  None
bios:F2F8
bios:F2F8 set_cursor_pos  proc near				      ;	CODE XREF: int_10_02_handlerp
bios:F2F8							      ;	int_10_0e_handler+85p ...
bios:F2F8		  cmp	  byte ptr ds:p400.crt_mode, 4
bios:F2FD		  jl	  short	s0
bios:F2FF		  xor	  bh, bh			      ;	page 0 for modes >=4 (graphics mode)
bios:F301
bios:F301 s0:							      ;	CODE XREF: set_cursor_pos+5j
bios:F301		  lea	  di, ds:p400.cursor_row_col_in_pages
bios:F305		  push	  bx
bios:F306		  mov	  bl, bh			      ;	offset to correct page
bios:F308		  xor	  bh, bh			      ;	offset = page number * 2
bios:F30A		  shl	  bx, 1
bios:F30C		  mov	  [bx+di], dx			      ;	update cursor_pos_in_pages var with new	row/column value
bios:F30E		  pop	  bx
bios:F30F		  cmp	  ds:p400.active_display_page, bh     ;	page to	update same as active page?
bios:F313		  jnz	  short	exit			      ;	no? exit, then
bios:F315		  call	  update_cursor_offset
bios:F318
bios:F318 exit:							      ;	CODE XREF: set_cursor_pos+1Bj
bios:F318		  retn
bios:F318 set_cursor_pos  endp
bios:F318
bios:F319
bios:F319 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F319
bios:F319 ; entry:
bios:F319 ;   dl = column
bios:F319 ;   dh = row
bios:F319 ; return:
bios:F319 ;   cx = cursor offset in page & 0xfffe
bios:F319
bios:F319 update_cursor_offset proc near			      ;	CODE XREF: set_cursor_pos+1Dp
bios:F319							      ;	int_10_05_handler+31p
bios:F319		  mov	  al, dh
bios:F31B		  mul	  byte ptr ds:p400.crt_nr_cols	      ;	al = row * total columns
bios:F31F		  xor	  dh, dh
bios:F321		  add	  ax, dx			      ;	ax: cursor_offset = (row * total_columns) + col
bios:F323		  mov	  cx, ax
bios:F325		  mov	  ax, ds:p400.crt_current_page_offset
bios:F328		  shr	  ax, 1				      ;	page_offset / 2	(get rid of attributes bytes)
bios:F32A		  add	  cx, ax			      ;	cx = page_offset + cursor_offset
bios:F32C		  mov	  bh, 0Eh			      ;	reg 0e = cursor	start address hi
bios:F32E		  mov	  bl, 0Fh			      ;	reg 0f = cursor	start address lo
bios:F330		  jmp	  set_pair_value_in_6845
bios:F330 update_cursor_offset endp
bios:F330
bios:F333
bios:F333 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F333
bios:F333 ;	Reports	the cursor position (row and column) and size for a specified
bios:F333 ;	display	page.
bios:F333 ;
bios:F333 ;	   On entry:	  AH	     03h
bios:F333 ;			  BH	     Display page number
bios:F333 ;
bios:F333 ;	   Returns:	  CH	     Cursor start line
bios:F333 ;			  CL	     Cursor end	line
bios:F333 ;			  DH	     Row
bios:F333 ;			  DL	     Column
bios:F333 ; Attributes:	bp-based frame
bios:F333
bios:F333 int_10_03_handler proc far				      ;	CODE XREF: int_10_handler+Dj
bios:F333							      ;	DATA XREF: int_10_handler+18o
bios:F333
bios:F333 arg_cursor_position= word ptr	 0Ah
bios:F333 arg_cursor_address_position= word ptr	 0Ch
bios:F333
bios:F333		  cmp	  byte ptr ds:p400.crt_mode, 4
bios:F338		  jl	  short	s0
bios:F33A		  xor	  bh, bh			      ;	page 0 for modes >=4 (graphics)
bios:F33C
bios:F33C s0:							      ;	CODE XREF: int_10_03_handler+5j
bios:F33C		  mov	  bl, bh
bios:F33E		  call	  get_cursor_row_col_for_page
bios:F341		  mov	  bp, sp			      ;	update stack arguments (who knew!)
bios:F343		  mov	  [bp+arg_cursor_position], dx
bios:F346		  mov	  cx, ds:p400.cursor_row_column
bios:F34A		  mov	  [bp+arg_cursor_address_position], cx
bios:F34D		  jmp	  near ptr pop_regs_and_iret
bios:F34D int_10_03_handler endp
bios:F34D
bios:F350
bios:F350 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F350
bios:F350 ;	Reports	the position and status	of the light pen.
bios:F350 ;
bios:F350 ;	   On entry:	  AH	     04h
bios:F350 ;
bios:F350 ;	   Returns:	  AH	     Status (0=not triggered, 1=triggered)
bios:F350 ;			  BX	     Pixel column number (0-319	or 0-639)
bios:F350 ;			  CH	     Raster line number	(0-199)
bios:F350 ;			  DH	     Character row number (0-24)
bios:F350 ;			  DL	     Character column number (0-39 or 0-79)
bios:F350 ;
bios:F350 ; Attributes:	bp-based frame
bios:F350
bios:F350 int_10_04_handler proc far				      ;	CODE XREF: int_10_handler+Dj
bios:F350							      ;	DATA XREF: int_10_handler+1Ao
bios:F350
bios:F350 arg_light_pen_row_col= word ptr  0Ah
bios:F350 arg_light_pen_row_in_pixels= byte ptr	 0Dh
bios:F350 arg_light_pen_col_in_pixels= word ptr	 0Eh
bios:F350
bios:F350		  mov	  dx, 3DAh			      ;	int: read light-pen pos
bios:F353		  in	  al, dx			      ;	Video status bits:
bios:F353							      ;	0: retrace.  1=display is in vert or horiz retrace.
bios:F353							      ;	1: 1=light pen is triggered; 0=armed
bios:F353							      ;	2: 1=light pen switch is open; 0=closed
bios:F353							      ;	3: 1=vertical sync pulse is occurring.
bios:F354		  mov	  ah, 0				      ;	ah = 0.	light pen not triggered
bios:F356		  test	  al, 2
bios:F358		  jnz	  short	light_pen_present
bios:F35A		  jmp	  exit
bios:F35D ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F35D
bios:F35D light_pen_present:					      ;	CODE XREF: int_10_04_handler+8j
bios:F35D		  mov	  dx, ds:p400.addr_6845
bios:F361		  mov	  al, 10h
bios:F363		  out	  dx, al			      ;	out 3d4, 10h (select read light	pen hi)
bios:F364		  inc	  dx
bios:F365		  in	  al, dx			      ;	al = light pen hi
bios:F366		  mov	  bh, al
bios:F368		  dec	  dx
bios:F369		  mov	  al, 11h			      ;	out 3d4, 11h (select light pen lo)
bios:F36B		  out	  dx, al
bios:F36C		  inc	  dx
bios:F36D		  in	  al, dx			      ;	al = light pen lo
bios:F36E		  mov	  ah, bh			      ;	ax = light pen (hi,lo)
bios:F370		  sub	  ax, 4
bios:F373		  mov	  dx, 3DBh
bios:F376		  out	  dx, al			      ;	Video: light pen latch reset.
bios:F376							      ;	Any OUT	clears the latch.
bios:F377		  mov	  bp, sp
bios:F379		  cmp	  byte ptr ds:p400.crt_mode, 4
bios:F37E		  jnb	  short	modes_4_and_up
bios:F380
bios:F380 modes_0_1_2_3:					      ;	dx = 0
bios:F380		  xor	  dx, dx
bios:F382		  mov	  bx, ds:p400.crt_nr_cols
bios:F386		  div	  bx				      ;	ax = current_row = light_pen_pos / nr_cols.
bios:F386							      ;	dx = cols
bios:F388		  mov	  dh, al			      ;	dh = current_row for light pen
bios:F38A		  mov	  [bp+arg_light_pen_row_col], dx      ;	dx = cols
bios:F38D		  mov	  cl, 3
bios:F38F		  shl	  al, cl			      ;	al = current_row * 8 (in pixels)
bios:F391		  mov	  [bp+arg_light_pen_row_in_pixels], al
bios:F394		  xor	  bx, bx			      ;	bx = 0
bios:F396		  mov	  bl, dl			      ;	bl = dl	(cols)
bios:F398		  shl	  bx, cl			      ;	bx = bx	* 8 (in	pixels)
bios:F39A		  mov	  [bp+arg_light_pen_col_in_pixels], bx
bios:F39D		  jmp	  exit_tirggered
bios:F3A0 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F3A0
bios:F3A0 modes_4_and_up:					      ;	CODE XREF: int_10_04_handler+2Ej
bios:F3A0		  xor	  dx, dx			      ;	dx = 0
bios:F3A2		  cmp	  byte ptr ds:p400.crt_mode, 9
bios:F3A7		  jnb	  short	modes_9_a
bios:F3A9		  add	  ax, 2				      ;	ax = light_pen pos + 2
bios:F3AC		  cmp	  ax, 4096
bios:F3AF		  jb	  short	s0
bios:F3B1		  sub	  ax, 4056			      ;	ax = ax	- 4056
bios:F3B4
bios:F3B4 s0:							      ;	CODE XREF: int_10_04_handler+5Fj
bios:F3B4		  mov	  bx, 40			      ;	ax = rows (pos / 40) (40 = cols)
bios:F3B7		  div	  bx				      ;	dx = cols
bios:F3B9		  shl	  ax, 1				      ;	rows = rows * 2	(modes 5, 6 & 8	have 2 interlaces)
bios:F3BB		  mov	  [bp+arg_light_pen_row_in_pixels], al
bios:F3BE		  shl	  dx, 1
bios:F3C0		  shl	  dx, 1				      ;	mode 8 = 160x200.
bios:F3C0							      ;	cols in	pixels = cols *	4. compesate for div(40) instead of div(20)
bios:F3C2		  cmp	  byte ptr ds:p400.crt_mode, 8
bios:F3C7		  jz	  short	mode_8
bios:F3C9		  shl	  dx, 1				      ;	mode 5 = 320x200
bios:F3C9							      ;	cols in	pixels = cols *	8
bios:F3CB		  cmp	  byte ptr ds:p400.crt_mode, 6
bios:F3D0		  jnz	  short	mode_8
bios:F3D2		  shl	  dx, 1				      ;	mode 6 = 640x200
bios:F3D2							      ;	cols in	pixels = cols *	16. compesate for div(40) instead of div(80)
bios:F3D4
bios:F3D4 mode_8:						      ;	CODE XREF: int_10_04_handler+77j
bios:F3D4							      ;	int_10_04_handler+80j
bios:F3D4		  mov	  [bp+arg_light_pen_col_in_pixels], dx
bios:F3D7		  jmp	  short	from_pixel_to_char
bios:F3D9 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F3D9
bios:F3D9 modes_9_a:						      ;	CODE XREF: int_10_04_handler+57j
bios:F3D9		  mov	  bx, 80			      ;	divide by 80 columns
bios:F3DC		  cmp	  ax, 12288
bios:F3DF		  jb	  short	s1
bios:F3E1		  sub	  ax, 12288
bios:F3E4		  div	  bx				      ;	ax = number of rows
bios:F3E4							      ;	dx = number of cols
bios:F3E6		  shl	  ax, 1
bios:F3E8		  shl	  ax, 1				      ;	ax = number of rows * 4	(modes 9 & a have 4 interlaces)
bios:F3EA		  add	  ax, 3				      ;	ax += 3	(to compensate?)
bios:F3ED		  jmp	  short	s4
bios:F3EF ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F3EF
bios:F3EF s1:							      ;	CODE XREF: int_10_04_handler+8Fj
bios:F3EF		  cmp	  ax, 8192
bios:F3F2		  jb	  short	s2
bios:F3F4		  sub	  ax, 8192
bios:F3F7		  div	  bx				      ;	ax = number of rows
bios:F3F7							      ;	dx = number of cols
bios:F3F9		  shl	  ax, 1				      ;	ax = number of rows * 4	(modes 9 & a have 4 interlaces)
bios:F3FB		  shl	  ax, 1
bios:F3FD		  add	  ax, 2				      ;	ax += 2	(to compensate?)
bios:F400		  jmp	  short	s4
bios:F402 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F402
bios:F402 s2:							      ;	CODE XREF: int_10_04_handler+A2j
bios:F402		  cmp	  ax, 4096
bios:F405		  jb	  short	s3
bios:F407		  sub	  ax, 4096
bios:F40A		  div	  bx				      ;	ax = number of rows
bios:F40A							      ;	dx = number of cols
bios:F40C		  shl	  ax, 1				      ;	ax = number of rows * 4	+ 1
bios:F40E		  shl	  ax, 1
bios:F410		  add	  ax, 1
bios:F413		  jmp	  short	s4
bios:F415 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F415
bios:F415 s3:							      ;	CODE XREF: int_10_04_handler+B5j
bios:F415		  div	  bx
bios:F417		  shl	  ax, 1
bios:F419		  shl	  ax, 1				      ;	ax = number of rows * 4	(modes 9 & a have 4 interlaces)
bios:F41B
bios:F41B s4:							      ;	CODE XREF: int_10_04_handler+9Dj
bios:F41B							      ;	int_10_04_handler+B0j ...
bios:F41B		  shl	  dx, 1
bios:F41D		  shl	  dx, 1				      ;	mode 9 = 320x200 16 colors
bios:F41D							      ;	cols in	pixels = cols *	4. compesate for div(80) instead of div(40)
bios:F41F		  cmp	  byte ptr ds:p400.crt_mode, 0Ah
bios:F424		  jnz	  short	s5
bios:F426		  shl	  dx, 1				      ;	mode a = 640x200 4 colors
bios:F426							      ;	cols in	pixels = cols *	8.
bios:F428
bios:F428 s5:							      ;	CODE XREF: int_10_04_handler+D4j
bios:F428		  mov	  [bp+arg_light_pen_row_in_pixels], al
bios:F42B		  mov	  [bp+arg_light_pen_col_in_pixels], dx
bios:F42E
bios:F42E from_pixel_to_char:					      ;	CODE XREF: int_10_04_handler+87j
bios:F42E		  mov	  al, [bp+arg_light_pen_row_in_pixels]
bios:F431		  mov	  cl, 3
bios:F433		  shr	  al, cl			      ;	al = row in chars
bios:F435		  mov	  dx, [bp+arg_light_pen_col_in_pixels]
bios:F438		  shr	  dx, cl			      ;	dl = col in chars
bios:F43A		  mov	  dh, al			      ;	dx = row/col in	chars
bios:F43C		  mov	  [bp+arg_light_pen_row_col], dx
bios:F43F
bios:F43F exit_tirggered:					      ;	CODE XREF: int_10_04_handler+4Dj
bios:F43F		  mov	  ah, 1				      ;	ah = 1.	light pen triggered
bios:F441
bios:F441 exit:							      ;	CODE XREF: int_10_04_handler+Aj
bios:F441		  jmp	  near ptr pop_regs_and_iret
bios:F441 int_10_04_handler endp
bios:F441
bios:F444
bios:F444 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F444
bios:F444 ;	Sets the active	display	page.
bios:F444 ;
bios:F444 ;	   On entry:	  AH	     05h
bios:F444 ;			  AL = 0-7   Display page number
bios:F444 ;			  AL = 80h   Read CRT/CPU page registers
bios:F444 ;			  AL = 81h   Set CPU page register to value in BL
bios:F444 ;			  AL = 82h   Set CRT page register to value in BH
bios:F444 ;			  AL = 83h   Set both CPU and CRT page registers to BL and BH
bios:F444 ;	   Returns:	  If bit 7 of AL = 1 upon entry,
bios:F444 ;			     BH	= contents of CRT page register
bios:F444 ;			     BL	= contents of CPU page register
bios:F444 ; Attributes:	bp-based frame
bios:F444
bios:F444 int_10_05_handler proc far				      ;	CODE XREF: int_10_handler+Dj
bios:F444							      ;	DATA XREF: int_10_handler+1Co
bios:F444
bios:F444 arg_CRT_CPU_pages= word ptr  0Eh
bios:F444
bios:F444		  test	  al, 10000000b
bios:F446		  jnz	  short	get_set_registers
bios:F448		  cmp	  byte ptr ds:p400.crt_mode, 4	      ;	is a text mode active (modes 0-3)?
bios:F44D		  jl	  short	s0			      ;	yes
bios:F44F		  jmp	  near ptr pop_regs_and_iret	      ;	exit if	not
bios:F452 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F452
bios:F452 s0:							      ;	CODE XREF: int_10_05_handler+9j
bios:F452		  mov	  ds:p400.active_display_page, al     ;	save active page
bios:F455		  mov	  ax, ds:p400.crt_page_len
bios:F458		  xor	  bh, bh
bios:F45A		  mov	  bl, ds:p400.active_display_page     ;	get active page
bios:F45E		  mul	  bx				      ;	ax = ax	* bx = page len	* page number
bios:F460		  mov	  ds:p400.crt_current_page_offset, ax ;	save page offset
bios:F463		  mov	  cx, ax
bios:F465		  sar	  cx, 1				      ;	cx  /= 2 (bc. page len counts attributes) ??
bios:F467		  mov	  bh, 0Ch			      ;	reg 0ch	= start	address	hi
bios:F469		  mov	  bl, 0Dh			      ;	reg 0dh	= start	address	low
bios:F46B		  call	  set_pair_value_in_6845
bios:F46E		  mov	  bl, ds:p400.active_display_page     ;	get active page
bios:F472		  call	  get_cursor_row_col_for_page
bios:F475		  call	  update_cursor_offset
bios:F478		  jmp	  near ptr pop_regs_and_iret
bios:F47B ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F47B
bios:F47B get_set_registers:					      ;	CODE XREF: int_10_05_handler+2j
bios:F47B		  test	  byte ptr ds:p400.extra_status, 10000b	; external color video enabled?
bios:F480		  jz	  short	s1
bios:F482
bios:F482 s_error:						      ;	CODE XREF: int_10_05_handler+48j
bios:F482		  jmp	  error
bios:F485 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F485
bios:F485 s1:							      ;	CODE XREF: int_10_05_handler+3Cj
bios:F485		  mov	  bp, sp
bios:F487		  mov	  ah, al			      ;	ah = page number
bios:F489		  cmp	  ah, 84h ; '„'
bios:F48C		  jnb	  short	s_error			      ;	jump to	error if page >= 0x84
bios:F48E		  cmp	  ah, 80h ; '€'
bios:F491		  jnz	  short	set_registers
bios:F493		  jmp	  short	get_registers
bios:F495 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F495
bios:F495 set_registers:					      ;	CODE XREF: int_10_05_handler+4Dj
bios:F495		  and	  bl, 7				      ;	registers can't be > 8
bios:F498		  and	  bh, 7
bios:F49B		  mov	  cl, 3
bios:F49D		  shl	  bl, cl			      ;	align it to video_page_data CPU	page data (bit 3)
bios:F49F		  mov	  al, ds:p400.video_page_data
bios:F4A2		  cmp	  ah, 81h ; ''                       ; set CPU page register
bios:F4A5		  jnz	  short	set_crt_register
bios:F4A7
bios:F4A7 set_cpu_register:					      ;	turn off CPU page data bits (bits 3-5)
bios:F4A7		  and	  al, 11000111b
bios:F4A9		  or	  al, bl			      ;	update it
bios:F4AB		  mov	  ds:p400.video_page_data, al
bios:F4AE		  mov	  dx, 3DFh			      ;	update CRT/CPU page register
bios:F4B1		  out	  dx, al
bios:F4B2		  mov	  bx, [bp+arg_CRT_CPU_pages]	      ;	???
bios:F4B5		  and	  bl, 1000b			      ;	CPU line 17 ?
bios:F4B8		  cmp	  word ptr ds:p400.IO_channel_RAM_size,	384
bios:F4BE		  jz	  short	s2
bios:F4C0		  cmp	  word ptr ds:p400.IO_channel_RAM_size,	640
bios:F4C6		  jz	  short	s2
bios:F4C8		  xor	  bl, 1000b			      ;	toggle bit 3 if	no extended RAM	(?)
bios:F4CB
bios:F4CB s2:							      ;	CODE XREF: int_10_05_handler+7Aj
bios:F4CB							      ;	int_10_05_handler+82j
bios:F4CB		  mov	  cl, 2
bios:F4CD		  shl	  bl, cl			      ;	align it to match CPU address lines in extended	RAM
bios:F4CF		  mov	  al, ds:p400.extended_ram
bios:F4D2		  and	  al, 10011111b			      ;	filter out CPU page addresses
bios:F4D4		  or	  al, bl			      ;	update contents
bios:F4D6		  mov	  ds:p400.extended_ram,	al
bios:F4D9		  mov	  dx, 3DDh			      ;	extended RAM page register
bios:F4DC		  out	  dx, al
bios:F4DD
bios:F4DD get_registers:					      ;	CODE XREF: int_10_05_handler+4Fj
bios:F4DD		  jmp	  short	s_get_registers
bios:F4DF ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F4DF		  nop
bios:F4E0
bios:F4E0 set_crt_register:					      ;	CODE XREF: int_10_05_handler+61j
bios:F4E0		  cmp	  ah, 82h ; '‚'
bios:F4E3		  jnz	  short	set_cpu_crt_registers
bios:F4E5		  and	  al, 11111000b			      ;	al = video page	data. only 3 LSB bits
bios:F4E7		  or	  al, bh			      ;	update it with CRT values
bios:F4E9		  mov	  ds:p400.video_page_data, al	      ;	set updated value to var
bios:F4EC		  mov	  dx, 3DFh			      ;	CRT/CPU	page register
bios:F4EF		  out	  dx, al
bios:F4F0		  mov	  bx, [bp+arg_CRT_CPU_pages]	      ;	???
bios:F4F3		  and	  bh, 1000b			      ;	CRT line 17 ?
bios:F4F6		  cmp	  word ptr ds:p400.IO_channel_RAM_size,	384
bios:F4FC		  jz	  short	s3
bios:F4FE		  cmp	  word ptr ds:p400.IO_channel_RAM_size,	640
bios:F504		  jz	  short	s3
bios:F506		  xor	  bh, 1000b			      ;	toggle bit if no extended RAM
bios:F509
bios:F509 s3:							      ;	CODE XREF: int_10_05_handler+B8j
bios:F509							      ;	int_10_05_handler+C0j
bios:F509		  mov	  al, ds:p400.extended_ram
bios:F50C		  and	  al, 11100111b			      ;	filter out CRT page addresses
bios:F50E		  or	  al, bl
bios:F510		  mov	  ds:p400.extended_ram,	al
bios:F513		  mov	  dx, 3DDh			      ;	Extended RAM page register
bios:F516		  out	  dx, al
bios:F517		  jmp	  short	s_get_registers
bios:F519 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F519
bios:F519 set_cpu_crt_registers:				      ;	CODE XREF: int_10_05_handler+9Fj
bios:F519		  and	  al, 11000000b			      ;	filter bits 0-5
bios:F51B		  or	  al, bl
bios:F51D		  or	  al, bh			      ;	update values
bios:F51F		  mov	  ds:p400.video_page_data, al	      ;	set updated value to var
bios:F522		  mov	  dx, 3DFh			      ;	CRT/CPU	page register
bios:F525		  out	  dx, al
bios:F526		  mov	  bx, [bp+arg_CRT_CPU_pages]	      ;	???
bios:F529		  and	  bh, 1000b			      ;	CRT line 17 only ?
bios:F52C		  and	  bl, 1000b			      ;	CPU line 17 only ?
bios:F52F		  cmp	  word ptr ds:p400.IO_channel_RAM_size,	384
bios:F535		  jz	  short	s4
bios:F537		  cmp	  word ptr ds:p400.IO_channel_RAM_size,	640
bios:F53D		  jz	  short	s4
bios:F53F		  xor	  bx, 100000001000b		      ;	toggle bits if no extended RAM ?
bios:F543
bios:F543 s4:							      ;	CODE XREF: int_10_05_handler+F1j
bios:F543							      ;	int_10_05_handler+F9j
bios:F543		  mov	  cl, 2
bios:F545		  shl	  bl, cl			      ;	align it to match registers in extended	mem var
bios:F547		  mov	  al, ds:p400.extended_ram
bios:F54A		  and	  al, 10000111b			      ;	filter out both	CRT and	RAM addresses
bios:F54C		  or	  al, bl			      ;	update
bios:F54E		  or	  al, bh			      ;	update
bios:F550		  mov	  ds:p400.extended_ram,	al
bios:F553		  mov	  dx, 3DDh			      ;	Extended RAM page register
bios:F556		  out	  dx, al
bios:F557
bios:F557 s_get_registers:					      ;	CODE XREF: int_10_05_handler:get_registersj
bios:F557							      ;	int_10_05_handler+D3j
bios:F557		  mov	  bp, sp
bios:F559		  mov	  al, ds:p400.video_page_data
bios:F55C		  and	  al, 111b			      ;	CRT registers only
bios:F55E		  mov	  bh, al			      ;	update BH with them
bios:F560		  mov	  al, ds:p400.extended_ram
bios:F563		  and	  al, 1000b			      ;	CRT address 17 only
bios:F565		  cmp	  word ptr ds:p400.IO_channel_RAM_size,	384
bios:F56B		  jz	  short	s5
bios:F56D		  cmp	  word ptr ds:p400.IO_channel_RAM_size,	640
bios:F573		  jz	  short	s5
bios:F575		  xor	  al, 1000b			      ;	toggle it if no	extended RAM
bios:F577
bios:F577 s5:							      ;	CODE XREF: int_10_05_handler+127j
bios:F577							      ;	int_10_05_handler+12Fj
bios:F577		  or	  bh, al			      ;	update BH with address 17
bios:F579		  mov	  al, ds:p400.video_page_data
bios:F57C		  mov	  cl, 3				      ;	move CPU register to bits 0-3
bios:F57E		  shr	  al, cl
bios:F580		  and	  al, 7				      ;	CPU registers only
bios:F582		  mov	  bl, al
bios:F584		  mov	  al, ds:p400.extended_ram	      ;	update var
bios:F587		  and	  al, 100000b			      ;	test CPU page address "17"
bios:F589		  mov	  cl, 2
bios:F58B		  shr	  al, cl			      ;	align it with bit 4
bios:F58D		  cmp	  word ptr ds:p400.IO_channel_RAM_size,	384
bios:F593		  jz	  short	s6
bios:F595		  cmp	  word ptr ds:p400.IO_channel_RAM_size,	640
bios:F59B		  jz	  short	s6
bios:F59D		  xor	  al, 1000b			      ;	toggle it if no	extended RAM ?
bios:F59F
bios:F59F s6:							      ;	CODE XREF: int_10_05_handler+14Fj
bios:F59F							      ;	int_10_05_handler+157j
bios:F59F		  or	  bl, al
bios:F5A1		  mov	  [bp+arg_CRT_CPU_pages], bx	      ;	update passed var
bios:F5A4		  clc
bios:F5A5		  jmp	  near ptr pop_regs_and_iret
bios:F5A8 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F5A8
bios:F5A8 error:						      ;	CODE XREF: int_10_05_handler:s_errorj
bios:F5A8		  stc
bios:F5A9		  jmp	  near ptr pop_regs_and_iret
bios:F5A9 int_10_05_handler endp
bios:F5A9
bios:F5AC
bios:F5AC ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F5AC
bios:F5AC ;	Scrolls	a specified window upward a specified number of	lines.
bios:F5AC ;
bios:F5AC ;	   On entry:	  AH	     06h
bios:F5AC ;			  AL	     Number of lines to	scroll (if 0, clear entire window)
bios:F5AC ;			  BH	     Attribute (alpha modes) or	color (graphics	modes) to be used on blank line
bios:F5AC ;			  CH	     Row number	of upper left corner
bios:F5AC ;			  CL	     Column number of upper left corner
bios:F5AC ;			  DH	     Row number	of lower right corner
bios:F5AC ;			  DL	     Column number of lower right corner
bios:F5AC ;
bios:F5AC ;	   Returns:	  None
bios:F5AC ; Attributes:	bp-based frame
bios:F5AC
bios:F5AC int_10_06_handler proc far				      ;	CODE XREF: int_10_handler+Dj
bios:F5AC							      ;	DATA XREF: int_10_handler+1Eo
bios:F5AC		  push	  ax
bios:F5AD		  mov	  bp, sp			      ;	bp = sp
bios:F5AF		  mov	  word ptr [bp+0], 0		      ;	0 = scroll up
bios:F5B4		  call	  scroll_up_or_down
bios:F5B7		  pop	  bx
bios:F5B8		  jmp	  near ptr pop_regs_and_iret
bios:F5B8 int_10_06_handler endp
bios:F5B8
bios:F5BB
bios:F5BB ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F5BB
bios:F5BB ;	Scrolls	a specified window upward/downward a specified number of lines.
bios:F5BB ;
bios:F5BB ;	   On entry:	  AH	     06h
bios:F5BB ;			  AL	     Number of lines to	scroll (if 0, clear entire
bios:F5BB ;				     window)
bios:F5BB ;			  BH	     Attribute (alpha modes) or	color (graphics	modes) to be used on blank line
bios:F5BB ;			  CH	     Row number	of upper left corner
bios:F5BB ;			  CL	     Column number of upper left corner
bios:F5BB ;			  DH	     Row number	of lower right corner
bios:F5BB ;			  DL	     Column number of lower right corner
bios:F5BB ;			  [BP+0]     Direction:	0=Upwards. 1=Downwards
bios:F5BB ;
bios:F5BB ;	   Returns:	  None
bios:F5BB ; Attributes:	bp-based frame bp==sp
bios:F5BB
bios:F5BB scroll_up_or_down proc near				      ;	CODE XREF: int_10_06_handler+8p
bios:F5BB							      ;	int_10_07_handler+8p
bios:F5BB
bios:F5BB arg_scroll_direction=	word ptr  4
bios:F5BB arg_row_bottom  = byte ptr  11h
bios:F5BB arg_col_left	  = byte ptr  12h
bios:F5BB arg_row_top	  = byte ptr  13h
bios:F5BB arg_char_attrib = byte ptr  15h
bios:F5BB
bios:F5BB		  mov	  ah, dl			      ;	column right
bios:F5BD		  sub	  ah, cl			      ;	ah = column right - column left	(number	of columns)
bios:F5BF		  inc	  ah				      ;	columns	+ 1
bios:F5C1		  cmp	  ah, 0
bios:F5C4		  ja	  short	s0			      ;	columns	>= 1, then start. else exit
bios:F5C6		  jmp	  exit
bios:F5C9 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F5C9
bios:F5C9 s0:							      ;	CODE XREF: scroll_up_or_down+9j
bios:F5C9		  mov	  bl, dh			      ;	bottom row
bios:F5CB		  sub	  bl, ch			      ;	bl = bottom row	- top row (number of rows)
bios:F5CD		  cmp	  al, bl			      ;	rows to	scroll bigger than window size ?
bios:F5CF		  jle	  short	s1
bios:F5D1		  xor	  al, al			      ;	if rows	to scroll bigger than window size, then	scroll 0
bios:F5D3
bios:F5D3 s1:							      ;	CODE XREF: scroll_up_or_down+14j
bios:F5D3		  call	  is_graphics_mode
bios:F5D6		  jnb	  short	is_text_mode		      ;	jump if	carry=0
bios:F5D8		  jmp	  scroll_graphics_up_or_down
bios:F5DB ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F5DB
bios:F5DB is_text_mode:						      ;	CODE XREF: scroll_up_or_down+1Bj
bios:F5DB		  cmp	  word ptr [bp+0], 0		      ;	direction: 0 up, 1 down
bios:F5DF		  jz	  short	s2
bios:F5E1		  mov	  dh, ch			      ;	up:
bios:F5E3
bios:F5E3 s2:							      ;	CODE XREF: scroll_up_or_down+24j
bios:F5E3		  mov	  bh, ds:p400.active_display_page     ;	get active page
bios:F5E7		  xor	  bl, bl			      ;	bl = 0.	use dx for row/column
bios:F5E9		  call	  get_screen_offset		      ;	ret = es:bx = screen offset for	dh/dl (row/column)
bios:F5EC		  inc	  bx
bios:F5ED		  inc	  bx
bios:F5EE		  push	  bx				      ;	bx = [bp+0] (see below): final source offset
bios:F5EF		  mov	  bp, sp			      ;	bp = sp
bios:F5F1		  xor	  ch, ch
bios:F5F3		  cmp	  [bp+arg_scroll_direction], 0
bios:F5F7		  jz	  short	s3			      ;	scroll up
bios:F5F9		  mov	  ch, [bp+arg_row_bottom]	      ;	scroll down
bios:F5FC		  sub	  ch, [bp+arg_row_top]		      ;	ch: rows to scroll
bios:F5FF
bios:F5FF s3:							      ;	CODE XREF: scroll_up_or_down+3Cj
bios:F5FF		  mov	  dx, word ptr [bp+arg_col_left]      ;	dh = row top, dl = col left
bios:F602		  add	  dh, ch			      ;	dh = bottom row?
bios:F604		  mov	  bh, ds:p400.active_display_page     ;	get active page
bios:F608		  xor	  bl, bl			      ;	bl = 0.	use dx for row/column
bios:F60A		  call	  get_screen_offset		      ;	ret = es:bx = screen offset for	dh/dl (row/column)
bios:F60D		  mov	  di, bx			      ;	di = destination offset	for scroll
bios:F60F		  mov	  dh, [bp+arg_row_bottom]
bios:F612		  sub	  dh, [bp+arg_row_top]
bios:F615		  cmp	  dh, 0
bios:F618		  jnz	  short	s4			      ;	window with more than 0	rows
bios:F61A		  jmp	  short	l1			      ;	window with 0 rows
bios:F61C ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F61C
bios:F61C s4:							      ;	CODE XREF: scroll_up_or_down+5Dj
bios:F61C		  mov	  dx, word ptr [bp+arg_col_left]      ;	dh = row top, dl = col left
bios:F61F		  add	  dh, ch			      ;	dh = top row + rows to scroll
bios:F621		  cmp	  [bp+arg_scroll_direction], 0
bios:F625		  jnz	  short	s5			      ;	scroll down
bios:F627		  add	  dh, al			      ;	dh += lines to scroll
bios:F629		  jmp	  short	s6
bios:F62B ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F62B
bios:F62B s5:							      ;	CODE XREF: scroll_up_or_down+6Aj
bios:F62B		  sub	  dh, al			      ;	dh -= lines to scroll
bios:F62D
bios:F62D s6:							      ;	CODE XREF: scroll_up_or_down+6Ej
bios:F62D		  mov	  bh, ds:p400.active_display_page     ;	get active page
bios:F631		  xor	  bl, bl
bios:F633		  call	  get_screen_offset		      ;	ret = es:bx screen offset for row/col (dh/dl)
bios:F636		  mov	  si, bx			      ;	si = source offset for scroll
bios:F638		  test	  byte ptr ds:p400.extra_status, 10000b	; external video color enabled?
bios:F63D		  jz	  short	s7
bios:F63F		  call	  disable_video_in_80x25_mode
bios:F642
bios:F642 s7:							      ;	CODE XREF: scroll_up_or_down+82j
bios:F642		  xor	  cx, cx
bios:F644		  cmp	  al, 0				      ;	lines to scroll	== 0 ?
bios:F646		  jz	  short	l1
bios:F648
bios:F648 l0:							      ;	CODE XREF: scroll_up_or_down+A5j
bios:F648		  push	  si				      ;	do the scroll
bios:F649		  push	  di
bios:F64A		  push	  ds
bios:F64B		  push	  ax
bios:F64C		  mov	  ax, es
bios:F64E		  mov	  ds, ax			      ;	ds = es	(screen	segment)
bios:F650		  pop	  ax
bios:F651		  mov	  cl, ah
bios:F653		  rep movsw
bios:F655		  pop	  ds
bios:F656		  cmp	  si, [bp+0]			      ;	final destination (see above)
bios:F659		  jz	  short	s8
bios:F65B		  pop	  di
bios:F65C		  pop	  si
bios:F65D		  call	  add_or_sub_bytes_per_row	      ;	di/si +/- = bytes per row
bios:F660		  jmp	  short	l0
bios:F662 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F662
bios:F662 s8:							      ;	CODE XREF: scroll_up_or_down+9Ej
bios:F662		  pop	  di
bios:F663		  pop	  si
bios:F664		  call	  add_or_sub_bytes_per_row
bios:F667
bios:F667 l1:							      ;	CODE XREF: scroll_up_or_down+5Fj
bios:F667							      ;	scroll_up_or_down+8Bj ...
bios:F667		  push	  si				      ;	clean the scren	with space + attribute
bios:F668		  push	  di
bios:F669		  mov	  cl, ah
bios:F66B		  push	  ax
bios:F66C		  mov	  al, 20h ; ' '                       ; space
bios:F66E		  mov	  ah, [bp+arg_char_attrib]	      ;	attribute to fill
bios:F671		  rep stosw
bios:F673		  pop	  ax
bios:F674		  cmp	  di, [bp+0]			      ;	final destination (see above)
bios:F677		  jz	  short	s9
bios:F679		  pop	  di
bios:F67A		  pop	  si
bios:F67B		  call	  add_or_sub_bytes_per_row
bios:F67E		  jmp	  short	l1
bios:F680 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F680
bios:F680 s9:							      ;	CODE XREF: scroll_up_or_down+BCj
bios:F680		  pop	  di
bios:F681		  pop	  si
bios:F682		  test	  byte ptr ds:p400.extra_status, 10000b	; external color video enabled ?
bios:F687		  jz	  short	s10
bios:F689		  call	  enable_video_in_80x25_mode
bios:F68C
bios:F68C s10:							      ;	CODE XREF: scroll_up_or_down+CCj
bios:F68C		  pop	  bx
bios:F68D
bios:F68D exit:							      ;	CODE XREF: scroll_up_or_down+Bj
bios:F68D		  retn
bios:F68D scroll_up_or_down endp
bios:F68D
bios:F68E
bios:F68E ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F68E
bios:F68E ; Scrolls a specified	window downward	a specified number of lines.
bios:F68E ;
bios:F68E ;	   On entry:	  AH	     07h
bios:F68E ;			  AL	     Number of lines to	scroll (if 0, clear entire
bios:F68E ;				     window)
bios:F68E ;			  BH	     Attribute (alpha modes) or	color (graphics	modes) to be used on blank line
bios:F68E ;			  CH	     Row number	of upper left corner
bios:F68E ;			  CL	     Column number of upper left corner
bios:F68E ;			  DH	     Row number	of lower right corner
bios:F68E ;			  DL	     Column number of lower right corner
bios:F68E ;
bios:F68E ;	   Returns:	  None
bios:F68E ; Attributes:	bp-based frame
bios:F68E
bios:F68E int_10_07_handler proc far				      ;	CODE XREF: int_10_handler+Dj
bios:F68E							      ;	DATA XREF: int_10_handler+20o
bios:F68E		  push	  ax
bios:F68F		  mov	  bp, sp
bios:F691		  mov	  word ptr [bp+0], 1		      ;	1 = scroll down
bios:F696		  call	  scroll_up_or_down
bios:F699		  pop	  bx
bios:F69A		  jmp	  near ptr pop_regs_and_iret
bios:F69A int_10_07_handler endp
bios:F69A
bios:F69D
bios:F69D ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F69D
bios:F69D ;	Read a character and its attribute or color at the current cursor position.
bios:F69D ;
bios:F69D ;	   On entry:	  AH	     08h
bios:F69D ;			  BH	     Display page number (text modes only)
bios:F69D ;
bios:F69D ;	   Returns:	  AH	     Attribute of character (text mode)
bios:F69D ;			  AL	     ASCII value of character
bios:F69D
bios:F69D int_10_08_handler proc far				      ;	CODE XREF: int_10_handler+Dj
bios:F69D							      ;	DATA XREF: int_10_handler+22o
bios:F69D		  call	  is_graphics_mode
bios:F6A0		  jnb	  short	text_mode
bios:F6A2		  xor	  bl, bl
bios:F6A4		  call	  get_cursor_row_col_for_page
bios:F6A7		  call	  gfx_get_ascii_value_for_row_col
bios:F6AA		  jmp	  short	exit
bios:F6AC ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F6AC
bios:F6AC text_mode:						      ;	CODE XREF: int_10_08_handler+3j
bios:F6AC		  mov	  bl, 1
bios:F6AE		  call	  get_screen_offset
bios:F6B1		  test	  byte ptr ds:p400.extra_status, 10000b
bios:F6B6		  jz	  short	skip_horiz_retrace
bios:F6B8		  call	  is_80x25_text_mode
bios:F6BB		  jnb	  short	skip_horiz_retrace
bios:F6BD		  mov	  dx, 3DAh
bios:F6C0
bios:F6C0 wait_horiz_refresh_finish:				      ;	CODE XREF: int_10_08_handler+26j
bios:F6C0		  in	  al, dx			      ;	Video status bits:
bios:F6C0							      ;	0: retrace.  1=display is in vert or horiz retrace.
bios:F6C0							      ;	1: 1=light pen is triggered; 0=armed
bios:F6C0							      ;	2: 1=light pen switch is open; 0=closed
bios:F6C0							      ;	3: 1=vertical sync pulse is occurring.
bios:F6C1		  shr	  al, 1
bios:F6C3		  jb	  short	wait_horiz_refresh_finish
bios:F6C5		  cli
bios:F6C6
bios:F6C6 wait_horiz_refresh_start:				      ;	CODE XREF: int_10_08_handler+2Cj
bios:F6C6		  in	  al, dx			      ;	Video status bits:
bios:F6C6							      ;	0: retrace.  1=display is in vert or horiz retrace.
bios:F6C6							      ;	1: 1=light pen is triggered; 0=armed
bios:F6C6							      ;	2: 1=light pen switch is open; 0=closed
bios:F6C6							      ;	3: 1=vertical sync pulse is occurring.
bios:F6C7		  shr	  al, 1
bios:F6C9		  jnb	  short	wait_horiz_refresh_start
bios:F6CB
bios:F6CB skip_horiz_retrace:					      ;	CODE XREF: int_10_08_handler+19j
bios:F6CB							      ;	int_10_08_handler+1Ej
bios:F6CB		  mov	  ax, es:[bx]			      ;	get ascii value	+ attribute
bios:F6CE		  sti
bios:F6CF
bios:F6CF exit:							      ;	CODE XREF: int_10_08_handler+Dj
bios:F6CF		  jmp	  near ptr pop_regs_and_iret
bios:F6CF int_10_08_handler endp
bios:F6CF
bios:F6D2
bios:F6D2 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F6D2
bios:F6D2 ;	Displays a specified character with a specified	attribute a specified
bios:F6D2 ;	number of times.
bios:F6D2 ;
bios:F6D2 ;	   On entry:	  AX	     09h
bios:F6D2 ;			  AL	     ASCII value of character
bios:F6D2 ;			  BH	     Display page (text	mode only)
bios:F6D2 ;			  BL	     Attribute of character (for alpha modes) or color of character
bios:F6D2 ;				     (for graphics modes; if bit 7 of BL is set, the color of the character is XOR'ed with the color value)
bios:F6D2 ;			  CX	     Number of times to	write character
bios:F6D2 ;
bios:F6D2 ;	   Returns:	  None
bios:F6D2
bios:F6D2 int_10_09_handler proc far				      ;	CODE XREF: int_10_handler+Dj
bios:F6D2							      ;	DATA XREF: int_10_handler+24o
bios:F6D2		  xor	  dl, dl			      ;	dl = 0:	write with attribute
bios:F6D4		  jmp	  short	display_chars
bios:F6D4 int_10_09_handler endp
bios:F6D4
bios:F6D6
bios:F6D6 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F6D6
bios:F6D6 ;
bios:F6D6 ;	Displays a specified character a specified number of times.
bios:F6D6 ;
bios:F6D6 ;	   On entry:	  AH	     0Ah
bios:F6D6 ;			  AL	     ASCII character to	write
bios:F6D6 ;			  BL	     color of character	(graphics mode)
bios:F6D6 ;			  BH	     display page number (valid	for alpha modes	only
bios:F6D6 ;			  CX	     number of characters to write
bios:F6D6 ;
bios:F6D6 ;	   Returns:	  None
bios:F6D6 ; Attributes:	bp-based frame
bios:F6D6
bios:F6D6 int_10_0a_handler proc far				      ;	CODE XREF: int_10_handler+Dj
bios:F6D6							      ;	DATA XREF: int_10_handler+26o
bios:F6D6		  mov	  dl, 0FFh
bios:F6D8
bios:F6D8 display_chars:					      ;	CODE XREF: int_10_09_handler+2j
bios:F6D8		  or	  cx, cx			      ;	nothing	to write?
bios:F6DA		  jz	  short	exit
bios:F6DC		  mov	  ah, bl
bios:F6DE		  call	  is_graphics_mode
bios:F6E1		  jnb	  short	display_chars_text_mode
bios:F6E3		  xor	  bl, bl
bios:F6E5		  call	  get_cursor_row_col_for_page
bios:F6E8		  call	  gfx_print_char
bios:F6EB		  jmp	  short	exit
bios:F6ED ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F6ED
bios:F6ED display_chars_text_mode:				      ;	CODE XREF: int_10_0a_handler+Bj
bios:F6ED		  push	  dx
bios:F6EE		  mov	  bp, sp
bios:F6F0		  mov	  bl, 1
bios:F6F2		  call	  get_screen_offset
bios:F6F5		  mov	  di, bx
bios:F6F7		  mov	  bl, al
bios:F6F9		  cmp	  byte ptr [bp+0], 0		      ;	[bp+0] = dx. 0=write with attribute. 255=write only ascii
bios:F6FD		  jnz	  short	write_ascii_only
bios:F6FF
bios:F6FF write_ascii_and_attribute:				      ;	CODE XREF: int_10_0a_handler+47j
bios:F6FF		  test	  byte ptr ds:p400.extra_status, 10000b
bios:F704		  jz	  short	skip_horizontal_retrace
bios:F706		  call	  is_80x25_text_mode
bios:F709		  jnb	  short	skip_horizontal_retrace
bios:F70B		  mov	  dx, 3DAh
bios:F70E
bios:F70E wait_horizontal_refresh_finish:			      ;	CODE XREF: int_10_0a_handler+3Bj
bios:F70E		  in	  al, dx			      ;	Video status bits:
bios:F70E							      ;	0: retrace.  1=display is in vert or horiz retrace.
bios:F70E							      ;	1: 1=light pen is triggered; 0=armed
bios:F70E							      ;	2: 1=light pen switch is open; 0=closed
bios:F70E							      ;	3: 1=vertical sync pulse is occurring.
bios:F70F		  shr	  al, 1
bios:F711		  jb	  short	wait_horizontal_refresh_finish
bios:F713		  cli
bios:F714
bios:F714 wait_horizontal_refresh_start:			      ;	CODE XREF: int_10_0a_handler+41j
bios:F714		  in	  al, dx			      ;	Video status bits:
bios:F714							      ;	0: retrace.  1=display is in vert or horiz retrace.
bios:F714							      ;	1: 1=light pen is triggered; 0=armed
bios:F714							      ;	2: 1=light pen switch is open; 0=closed
bios:F714							      ;	3: 1=vertical sync pulse is occurring.
bios:F715		  shr	  al, 1
bios:F717		  jnb	  short	wait_horizontal_refresh_start
bios:F719
bios:F719 skip_horizontal_retrace:				      ;	CODE XREF: int_10_0a_handler+2Ej
bios:F719							      ;	int_10_0a_handler+33j
bios:F719		  mov	  al, bl
bios:F71B		  stosw
bios:F71C		  sti
bios:F71D		  loop	  write_ascii_and_attribute
bios:F71F		  jmp	  short	pop_and_exit
bios:F721 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F721
bios:F721 write_ascii_only:					      ;	CODE XREF: int_10_0a_handler+27j
bios:F721							      ;	int_10_0a_handler+6Aj
bios:F721		  test	  byte ptr ds:p400.extra_status, 10h
bios:F726		  jz	  short	skip_horizontal_retrace_bis
bios:F728		  call	  is_80x25_text_mode
bios:F72B		  jnb	  short	skip_horizontal_retrace_bis
bios:F72D		  mov	  dx, 3DAh
bios:F730
bios:F730 wait_horizontal_refresh_finish_bis:			      ;	CODE XREF: int_10_0a_handler+5Dj
bios:F730		  in	  al, dx			      ;	Video status bits:
bios:F730							      ;	0: retrace.  1=display is in vert or horiz retrace.
bios:F730							      ;	1: 1=light pen is triggered; 0=armed
bios:F730							      ;	2: 1=light pen switch is open; 0=closed
bios:F730							      ;	3: 1=vertical sync pulse is occurring.
bios:F731		  shr	  al, 1
bios:F733		  jb	  short	wait_horizontal_refresh_finish_bis
bios:F735		  cli
bios:F736
bios:F736 wait_horizontal_refresh_start_bis:			      ;	CODE XREF: int_10_0a_handler+63j
bios:F736		  in	  al, dx			      ;	Video status bits:
bios:F736							      ;	0: retrace.  1=display is in vert or horiz retrace.
bios:F736							      ;	1: 1=light pen is triggered; 0=armed
bios:F736							      ;	2: 1=light pen switch is open; 0=closed
bios:F736							      ;	3: 1=vertical sync pulse is occurring.
bios:F737		  shr	  al, 1
bios:F739		  jnb	  short	wait_horizontal_refresh_start_bis
bios:F73B
bios:F73B skip_horizontal_retrace_bis:				      ;	CODE XREF: int_10_0a_handler+50j
bios:F73B							      ;	int_10_0a_handler+55j
bios:F73B		  mov	  al, bl			      ;	al = ASCII to write to screen
bios:F73D		  stosb					      ;	write char to screen
bios:F73E		  sti					      ;	enable interrupts
bios:F73F		  inc	  di
bios:F740		  loop	  write_ascii_only
bios:F742
bios:F742 pop_and_exit:						      ;	CODE XREF: int_10_0a_handler+49j
bios:F742		  pop	  bx
bios:F743
bios:F743 exit:							      ;	CODE XREF: int_10_0a_handler+4j
bios:F743							      ;	int_10_0a_handler+15j
bios:F743		  jmp	  near ptr pop_regs_and_iret
bios:F743 int_10_0a_handler endp
bios:F743
bios:F746
bios:F746 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F746
bios:F746 ; Select the color palette.
bios:F746 ;
bios:F746 ; Entry Conditions:	    AH = 11
bios:F746 ;			    BH = 0 Set background color	(0-15) to color	value in BL.
bios:F746 ;			    BL = color value (0	= black	/ 1 = blue / 2 = green / 3 = cyan / 4 =	red / 5	= magenta / 6 =	yellow / 7 = gray /
bios:F746 ;				 8 = dark gray / 9 = light blue	/ 10 = light green / 11	= light	cyan / 12 = light red /	13 = light magenta /
bios:F746 ;				 14 = light yellow /15 = white)
bios:F746 ;				 or
bios:F746 ;			    BH = 1 Set default palette to the number (0	or 1) in BL.
bios:F746 ;
bios:F746 ; In black and white modes:
bios:F746 ;			    BL = 0: 1 for white
bios:F746 ;			    BL = 1: 1 for black
bios:F746 ; In 4 color graphics	modes:
bios:F746 ;			    BL = 0 (1 =	green/2	= red/3	= yellow)
bios:F746 ;			    BL = 1 (1 =	cyan / 2 = magenta / 3 = white)
bios:F746 ; In 16 color	graphics modes:
bios:F746 ;			    (1 = blue /	2 = green / 3 =	cyan / 4 = red / 5 = magenta / 6 = yellow / 7 =	light gray / 8 = dark gray / 9 = light blue /
bios:F746 ;			     10	= light	green /	11 = light cyan	/ 12 = light red / 13 =	light magenta /	14 = yellow / 15 = white)
bios:F746 ; Note: For alpha modes palette entry	0 indicates the	border color. For graphics mode	palette	entry 0	indicates the border and the background	color.
bios:F746
bios:F746 int_10_0b_handler proc far				      ;	CODE XREF: int_10_handler+Dj
bios:F746							      ;	DATA XREF: int_10_handler+28o
bios:F746		  mov	  dx, 3D9h
bios:F749		  mov	  al, ds:p400.shadow_3d9_crt_palette
bios:F74C		  cmp	  bh, 0				      ;	bh==0: bl=background/border color
bios:F74F		  jnz	  short	set_default_palette
bios:F751		  cmp	  byte ptr ds:p400.crt_mode, 7	      ;	hercules text video mode?
bios:F756		  jz	  short	s0
bios:F758		  test	  byte ptr ds:p400.extra_status, 10000b	; external video ? treat it as mode 7
bios:F75D		  jz	  short	s1
bios:F75F
bios:F75F s0:							      ;	CODE XREF: int_10_0b_handler+10j
bios:F75F		  jmp	  short	s4
bios:F761 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F761
bios:F761 s1:							      ;	CODE XREF: int_10_0b_handler+17j
bios:F761		  cmp	  byte ptr ds:p400.crt_mode, 8	      ;	160x200x16 mode?
bios:F766		  jb	  short	s2
bios:F768		  mov	  bh, bl			      ;	bh = color to set
bios:F76A		  mov	  bl, 0				      ;	palette	idx = 0
bios:F76C		  call	  set_palette_color
bios:F76F		  mov	  bl, bh
bios:F771
bios:F771 s2:							      ;	CODE XREF: int_10_0b_handler+20j
bios:F771		  cmp	  byte ptr ds:p400.crt_mode, 6	      ;	640x200x2 mode?
bios:F776		  jz	  short	s3
bios:F778		  mov	  dx, 3DAh
bios:F77B		  mov	  al, 2				      ;	set border color same as background for	modes 0-5
bios:F77D		  out	  dx, al			      ;	out 3da,2 (select border color)
bios:F77E		  mov	  al, bl
bios:F780		  add	  dx, 4
bios:F783		  out	  dx, al			      ;	out 3de, bl (set border	color)
bios:F784		  xor	  al, al
bios:F786		  sub	  dx, 4
bios:F789		  out	  dx, al			      ;	out 3da, 0
bios:F78A
bios:F78A s3:							      ;	CODE XREF: int_10_0b_handler+30j
bios:F78A		  mov	  dx, 3D9h
bios:F78D		  mov	  al, ds:p400.shadow_3d9_crt_palette
bios:F790
bios:F790 s4:							      ;	CODE XREF: int_10_0b_handler:s0j
bios:F790		  and	  al, 11100000b			      ;	filter everything except palette select
bios:F792		  and	  bl, 11111b
bios:F795		  or	  al, bl			      ;	update color
bios:F797		  jmp	  short	s5
bios:F799 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F799
bios:F799 set_default_palette:					      ;	CODE XREF: int_10_0b_handler+9j
bios:F799		  and	  al, 11011111b			      ;	filter color select
bios:F79B		  cmp	  bl, 0				      ;	palette	0 or 1 ?
bios:F79E		  jz	  short	s5
bios:F7A0		  or	  al, 100000b			      ;	using palette 1
bios:F7A2
bios:F7A2 s5:							      ;	CODE XREF: int_10_0b_handler+51j
bios:F7A2							      ;	int_10_0b_handler+58j
bios:F7A2		  cmp	  byte ptr ds:p400.crt_mode, 0Ah
bios:F7A7		  jnz	  short	s6
bios:F7A9		  mov	  al, 0				      ;	mode 0xa: crt color select = everything	off
bios:F7AB
bios:F7AB s6:							      ;	CODE XREF: int_10_0b_handler+61j
bios:F7AB		  out	  dx, al			      ;	out 3d9, value
bios:F7AC		  mov	  ds:p400.shadow_3d9_crt_palette, al  ;	update shadow variable
bios:F7AF		  cmp	  byte ptr ds:p400.crt_mode, 0Ah
bios:F7B4		  jnz	  short	s9
bios:F7B6		  cmp	  bl, 0				      ;	palette	0 or 1 ?
bios:F7B9		  jz	  short	set_cga_palette_0
bios:F7BB
bios:F7BB set_cga_palette_1:					      ;	color 3	(cyan) for idx 1
bios:F7BB		  mov	  bx, 301h
bios:F7BE		  call	  set_palette_color
bios:F7C1		  mov	  bx, 502h			      ;	color 5	(magenta) for idx 2
bios:F7C4		  call	  set_palette_color
bios:F7C7		  mov	  bx, 0F03h			      ;	color 15 (white) for idx 3
bios:F7CA		  call	  set_palette_color
bios:F7CD		  jmp	  short	s8
bios:F7CF ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F7CF
bios:F7CF set_cga_palette_0:					      ;	CODE XREF: int_10_0b_handler+73j
bios:F7CF		  mov	  bx, 201h			      ;	color 2	(green)	for idx	1
bios:F7D2		  call	  set_palette_color
bios:F7D5		  mov	  bx, 402h			      ;	color 4	(red) for idx 2
bios:F7D8		  call	  set_palette_color
bios:F7DB		  mov	  bx, 603h			      ;	color 6	(brown)	for idx	3
bios:F7DE		  call	  set_palette_color
bios:F7E1
bios:F7E1 s8:							      ;	CODE XREF: int_10_0b_handler+87j
bios:F7E1		  mov	  dx, 3DAh
bios:F7E4		  xor	  al, al
bios:F7E6		  out	  dx, al			      ;	out 3da, 0
bios:F7E7
bios:F7E7 s9:							      ;	CODE XREF: int_10_0b_handler+6Ej
bios:F7E7		  jmp	  near ptr pop_regs_and_iret
bios:F7E7 int_10_0b_handler endp
bios:F7E7
bios:F7EA
bios:F7EA ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F7EA
bios:F7EA ;	Writes a pixel dot of a	specified color	at a specified screen
bios:F7EA ;	coordinate.
bios:F7EA ;
bios:F7EA ;	   On entry:	  AH	     0Ch
bios:F7EA ;			  AL	     Pixel color (When bit 7 of	AL is set, the resultant color
bios:F7EA ;				     value of the dot is the exclusive OR of the current dot color
bios:F7EA ;				     value and the value in AL.)
bios:F7EA ;			  CX	     Horizontal	position of pixel
bios:F7EA ;			  DX	     Vertical position of pixel
bios:F7EA ;
bios:F7EA ;	   Returns:	  None
bios:F7EA
bios:F7EA int_10_0c_handler proc far				      ;	CODE XREF: int_10_handler+Dj
bios:F7EA							      ;	DATA XREF: int_10_handler+2Ao
bios:F7EA		  call	  get_pixel_addr_and_mask
bios:F7ED		  jb	  short	error
bios:F7EF		  cmp	  byte ptr ds:p400.crt_mode, 8	      ;	160x200	16 colors
bios:F7F4		  jz	  short	mode_8_9
bios:F7F6		  cmp	  byte ptr ds:p400.crt_mode, 9	      ;	320x200	16 colors
bios:F7FB		  jz	  short	mode_8_9
bios:F7FD		  cmp	  byte ptr ds:p400.crt_mode, 0Ah      ;	640x200	4 colors
bios:F802		  jz	  short	mode_a
bios:F804
bios:F804 s0:							      ;	CODE XREF: int_10_0c_handler+39j
bios:F804		  mov	  ah, al			      ;	al = number of bits to mask
bios:F806		  and	  al, dl
bios:F808		  shl	  al, cl			      ;	cl bit number
bios:F80A		  test	  ah, 10000000b			      ;	perform	Xor ?
bios:F80D		  jnz	  short	do_xor
bios:F80F		  rol	  dh, cl			      ;	update pixel
bios:F811		  and	  es:[bx], dh
bios:F814		  or	  es:[bx], al
bios:F817		  jmp	  near ptr pop_regs_and_iret
bios:F81A ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F81A
bios:F81A do_xor:						      ;	CODE XREF: int_10_0c_handler+23j
bios:F81A		  xor	  es:[bx], al
bios:F81D
bios:F81D error:						      ;	CODE XREF: int_10_0c_handler+3j
bios:F81D		  jmp	  near ptr pop_regs_and_iret
bios:F820 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F820
bios:F820 mode_8_9:						      ;	CODE XREF: int_10_0c_handler+Aj
bios:F820							      ;	int_10_0c_handler+11j
bios:F820		  mov	  dx, 1111000000001111b		      ;	mask for modes 8 and 9
bios:F823		  jmp	  short	s0
bios:F825 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F825
bios:F825 mode_a:						      ;	CODE XREF: int_10_0c_handler+18j
bios:F825		  mov	  dx, 1111111000000001b		      ;	mask for mode a
bios:F828		  mov	  ah, al
bios:F82A		  and	  al, dl
bios:F82C		  shl	  al, cl
bios:F82E		  test	  ah, 10000000b			      ;	do xor ?
bios:F831		  jnz	  short	do_xor_mode_a
bios:F833		  rol	  dh, cl
bios:F835		  and	  es:[bx], dh
bios:F838		  or	  es:[bx], al
bios:F83B		  jmp	  short	s1
bios:F83D ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F83D
bios:F83D do_xor_mode_a:					      ;	CODE XREF: int_10_0c_handler+47j
bios:F83D		  xor	  es:[bx], al
bios:F840
bios:F840 s1:							      ;	CODE XREF: int_10_0c_handler+51j
bios:F840		  mov	  al, ah			      ;	do smth	similar	for the	following pixel. mmm...	why?
bios:F842		  shr	  al, 1
bios:F844		  and	  al, dl
bios:F846		  shl	  al, cl
bios:F848		  test	  ah, 10000000b			      ;	do xor ?
bios:F84B		  jnz	  short	do_xor_mode_a_bis
bios:F84D		  and	  es:[bx+1], dh
bios:F851		  or	  es:[bx+1], al
bios:F855		  jmp	  near ptr pop_regs_and_iret
bios:F858 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F858
bios:F858 do_xor_mode_a_bis:					      ;	CODE XREF: int_10_0c_handler+61j
bios:F858		  xor	  es:[bx+1], al
bios:F85C		  jmp	  near ptr pop_regs_and_iret
bios:F85C int_10_0c_handler endp
bios:F85C
bios:F85F
bios:F85F ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F85F
bios:F85F ;	Reports	the color of the pixel at a specified screen coordinate.
bios:F85F ;
bios:F85F ;	   On entry:	  AH	     0Dh
bios:F85F ;			  CX	     Horizontal	position of pixel
bios:F85F ;			  DX	     Vertical position of pixel
bios:F85F ;
bios:F85F ;	   Returns:	  AL	     Color of pixel
bios:F85F
bios:F85F int_10_0d_handler proc far				      ;	CODE XREF: int_10_handler+Dj
bios:F85F							      ;	DATA XREF: int_10_handler+2Co
bios:F85F		  call	  get_pixel_addr_and_mask
bios:F862		  jb	  short	exit
bios:F864		  cmp	  byte ptr ds:p400.crt_mode, 8
bios:F869		  jz	  short	mode_8_9
bios:F86B		  cmp	  byte ptr ds:p400.crt_mode, 9
bios:F870		  jz	  short	mode_8_9
bios:F872		  cmp	  byte ptr ds:p400.crt_mode, 0Ah
bios:F877		  jz	  short	mode_a
bios:F879
bios:F879 get_and_exit:						      ;	CODE XREF: int_10_0d_handler+26j
bios:F879		  mov	  al, es:[bx]			      ;	get pixel value. returns multi-value
bios:F87C		  shr	  al, cl			      ;	shift right until value	is in LSB
bios:F87E		  and	  al, ah			      ;	mask rest of the byte, and return it
bios:F880
bios:F880 exit:							      ;	CODE XREF: int_10_0d_handler+3j
bios:F880		  jmp	  near ptr pop_regs_and_iret
bios:F883 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F883
bios:F883 mode_8_9:						      ;	CODE XREF: int_10_0d_handler+Aj
bios:F883							      ;	int_10_0d_handler+11j
bios:F883		  mov	  ah, 0Fh			      ;	mask: get 4 LSB	bits
bios:F885		  jmp	  short	get_and_exit
bios:F887 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F887
bios:F887 mode_a:						      ;	CODE XREF: int_10_0d_handler+18j
bios:F887		  mov	  ah, 1
bios:F889		  mov	  al, es:[bx]
bios:F88C		  shr	  al, cl
bios:F88E		  and	  al, ah
bios:F890		  mov	  dl, es:[bx+1]
bios:F894		  shr	  dl, cl
bios:F896		  and	  dl, ah
bios:F898		  shl	  dl, 1
bios:F89A		  or	  al, dl
bios:F89C		  jmp	  near ptr pop_regs_and_iret
bios:F89C int_10_0d_handler endp
bios:F89C
bios:F89F
bios:F89F ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F89F
bios:F89F ;	Writes one character at	the current cursor location and	advances the
bios:F89F ;	cursor.
bios:F89F ;
bios:F89F ;	   On entry:	  AH	     0Eh
bios:F89F ;			  AL	     Character to write
bios:F89F ;			  BL	     Foreground	color (graphics	modes only)
bios:F89F ;	   Returns:	  None
bios:F89F
bios:F89F int_10_0e_handler proc far				      ;	CODE XREF: int_10_handler+Dj
bios:F89F							      ;	DATA XREF: int_10_handler+2Eo
bios:F89F
bios:F89F ; FUNCTION CHUNK AT bios:F94A	SIZE 00000003 BYTES
bios:F89F
bios:F89F		  push	  ax
bios:F8A0		  mov	  cl, bl
bios:F8A2		  call	  get_active_display_page
bios:F8A5		  call	  get_cursor_row_col_for_page
bios:F8A8		  cmp	  al, 7				      ;	7 = ascii bell
bios:F8AA		  jnz	  short	no_bell
bios:F8AC		  call	  play_bell_sound
bios:F8AF		  jmp	  exit
bios:F8B2 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F8B2
bios:F8B2 no_bell:						      ;	CODE XREF: int_10_0e_handler+Bj
bios:F8B2		  cmp	  al, 0Dh			      ;	0xd = carriage return
bios:F8B4		  jnz	  short	no_cr
bios:F8B6		  xor	  dl, dl			      ;	col = 0
bios:F8B8		  jmp	  short	update_cursor_position
bios:F8BA ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F8BA
bios:F8BA no_cr:						      ;	CODE XREF: int_10_0e_handler+15j
bios:F8BA		  cmp	  al, 8				      ;	8 = backspace
bios:F8BC		  jnz	  short	no_backspace
bios:F8BE		  dec	  dl				      ;	backspace: col--
bios:F8C0		  jge	  short	s0
bios:F8C2		  cmp	  dh, 0				      ;	row == 0?
bios:F8C5		  jg	  short	s1
bios:F8C7		  xor	  dl, dl			      ;	col = 0
bios:F8C9
bios:F8C9 s0:							      ;	CODE XREF: int_10_0e_handler+21j
bios:F8C9		  jmp	  short	update_cursor_position
bios:F8CB ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F8CB
bios:F8CB s1:							      ;	CODE XREF: int_10_0e_handler+26j
bios:F8CB		  dec	  dh				      ;	row--
bios:F8CD		  add	  dl, ds:p400.crt_nr_cols	      ;	cols +=	nr of cols
bios:F8D1		  jmp	  short	update_cursor_position
bios:F8D3 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F8D3
bios:F8D3 no_backspace:						      ;	CODE XREF: int_10_0e_handler+1Dj
bios:F8D3		  cmp	  al, 0Ah			      ;	line feed
bios:F8D5		  jnz	  short	no_linefeed
bios:F8D7		  cmp	  dh, 24			      ;	last row?
bios:F8DA		  jnz	  short	not_last_row
bios:F8DC
bios:F8DC l0:							      ;	CODE XREF: int_10_0e_handler+8Bj
bios:F8DC		  call	  is_graphics_mode
bios:F8DF		  jnb	  short	not_graphics
bios:F8E1		  mov	  ah, 0				      ;	color 0	for empty lines
bios:F8E3		  jmp	  short	do_scroll_up
bios:F8E5 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F8E5
bios:F8E5 not_graphics:						      ;	CODE XREF: int_10_0e_handler+40j
bios:F8E5		  mov	  bp, sp
bios:F8E7		  call	  get_active_display_page
bios:F8EA		  mov	  ah, 8
bios:F8EC		  int	  10h				      ;	- VIDEO	- READ ATTRIBUTES/CHARACTER AT CURSOR POSITION
bios:F8EC							      ;	BH = display page
bios:F8EC							      ;	Return:	AL = character
bios:F8EC							      ;	AH = attribute of character (alpha modes)
bios:F8EE
bios:F8EE do_scroll_up:						      ;	CODE XREF: int_10_0e_handler+44j
bios:F8EE		  mov	  bh, ah
bios:F8F0		  mov	  ah, 6
bios:F8F2		  mov	  al, 1
bios:F8F4		  xor	  cx, cx
bios:F8F6		  mov	  dl, ds:p400.crt_nr_cols	      ;	columns	on screen
bios:F8FA		  dec	  dl
bios:F8FC		  int	  10h				      ;	- VIDEO	- SCROLL PAGE UP
bios:F8FC							      ;	AL = number of lines to	scroll window (0 = blank whole window)
bios:F8FC							      ;	BH = attributes	to be used on blanked lines
bios:F8FC							      ;	CH,CL =	row,column of upper left corner	of window to scroll
bios:F8FC							      ;	DH,DL =	row,column of lower right corner of window
bios:F8FE		  jmp	  short	exit
bios:F900 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F900
bios:F900 not_last_row:						      ;	CODE XREF: int_10_0e_handler+3Bj
bios:F900		  inc	  dh
bios:F902		  jmp	  short	update_cursor_position
bios:F904 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F904
bios:F904 no_linefeed:						      ;	CODE XREF: int_10_0e_handler+36j
bios:F904		  mov	  ah, 0Ah
bios:F906		  mov	  bl, cl
bios:F908		  mov	  cx, 1
bios:F90B		  int	  10h				      ;	- VIDEO	- WRITE	CHARACTERS ONLY	AT CURSOR POSITION
bios:F90B							      ;	AL = character,	BH = display page - alpha mode
bios:F90B							      ;	BL = color of character	(graphics mode,	PCjr only)
bios:F90B							      ;	CX = number of times to	write character
bios:F90D		  inc	  dl
bios:F90F		  cmp	  dl, ds:p400.crt_nr_cols	      ;	columns	on screen
bios:F913		  jnz	  short	update_cursor_position
bios:F915		  xor	  dl, dl			      ;	col = 0
bios:F917		  cmp	  dh, 24			      ;	row = 24 ? (last row)
bios:F91A		  jnz	  short	s2
bios:F91C		  mov	  bp, sp
bios:F91E		  push	  ax
bios:F91F		  push	  cx
bios:F920		  push	  dx
bios:F921		  call	  get_active_display_page
bios:F924		  call	  set_cursor_pos
bios:F927		  pop	  dx
bios:F928		  pop	  cx
bios:F929		  pop	  ax
bios:F92A		  jmp	  short	l0
bios:F92C ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F92C
bios:F92C s2:							      ;	CODE XREF: int_10_0e_handler+7Bj
bios:F92C		  inc	  dh				      ;	row++
bios:F92E
bios:F92E update_cursor_position:				      ;	CODE XREF: int_10_0e_handler+19j
bios:F92E							      ;	int_10_0e_handler:s0j ...
bios:F92E		  mov	  bp, sp
bios:F930		  call	  get_active_display_page
bios:F933		  call	  set_cursor_pos
bios:F936
bios:F936 exit:							      ;	CODE XREF: int_10_0e_handler+10j
bios:F936							      ;	int_10_0e_handler+5Fj
bios:F936		  pop	  ax
bios:F937		  jmp	  short	int_10_0e_exit
bios:F937 int_10_0e_handler endp
bios:F937
bios:F939
bios:F939 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F939
bios:F939 ;	Reports	the current video mode,	the number of character	positions per
bios:F939 ;	line in	that video mode, and the current display page.
bios:F939 ;
bios:F939 ;	   On entry:	  AH	     0Fh
bios:F939 ;
bios:F939 ;	   Returns:	  AL	     Video mode
bios:F939 ;			  AH	     Number of character columns per line
bios:F939 ;			  BH	     Active display page number
bios:F939 ;
bios:F939 ; Attributes:	bp-based frame
bios:F939
bios:F939 int_10_0f_handler proc near				      ;	CODE XREF: int_10_handler+Dj
bios:F939							      ;	DATA XREF: int_10_handler+30o
bios:F939
bios:F939 arg_bx	  = word ptr  0Eh
bios:F939
bios:F939		  mov	  ax, ds:p400.crt_nr_cols	      ;	columns	on screen
bios:F93C		  mov	  ah, al			      ;	ah=number of character columns
bios:F93E		  mov	  al, ds:p400.crt_mode		      ;	al=video mode
bios:F941		  mov	  bh, ds:p400.active_display_page     ;	bh=active page
bios:F945		  mov	  bp, sp
bios:F947		  mov	  [bp+arg_bx], bx
bios:F947 int_10_0f_handler endp
bios:F947
bios:F94A ; START OF FUNCTION CHUNK FOR	int_10_0e_handler
bios:F94A
bios:F94A int_10_0e_exit:					      ;	CODE XREF: int_10_0e_handler+98j
bios:F94A		  jmp	  near ptr pop_regs_and_iret
bios:F94A ; END	OF FUNCTION CHUNK FOR int_10_0e_handler
bios:F94D
bios:F94D ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:F94D
bios:F94D ;	Sets the palette and border registers
bios:F94D ;
bios:F94D ;	   On entry:	  AH	     10h
bios:F94D ;			  AL	     Subservice
bios:F94D ;				     0 - Set palette register
bios:F94D ;					 BL	 Palette register (0-15)
bios:F94D ;					 BH	 Color value to	set
bios:F94D ;
bios:F94D ;				     1 - Set border color register
bios:F94D ;					 BH	 Color value to	set
bios:F94D ;
bios:F94D ;				     2 - Set palette registers and border register
bios:F94D ;					 ES:DX	 Pointer to 17-byte list
bios:F94D ;					 bytes 0-15 = values for palette registers 0-15
bios:F94D ;					 byte 16 = value for the border	register
bios:F94D
bios:F94D int_10_10_handler proc far				      ;	CODE XREF: int_10_handler+Dj
bios:F94D							      ;	DATA XREF: int_10_handler+32o
bios:F94D		  cmp	  byte ptr ds:p400.crt_mode, 7
bios:F952		  jz	  short	s0			      ;	palette	not supported in 80x25 mono
bios:F954		  test	  byte ptr ds:p400.extra_status, 10000b	; external color video enabled ?
bios:F959		  jnz	  short	s0			      ;	palette	not supported with external color video
bios:F95B		  cmp	  al, 3				      ;	al - 3
bios:F95D		  jb	  short	s1			      ;	error if subservice al >= 3
bios:F95F
bios:F95F s0:							      ;	CODE XREF: int_10_10_handler+5j
bios:F95F							      ;	int_10_10_handler+Cj
bios:F95F		  jmp	  error
bios:F962 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F962
bios:F962 s1:							      ;	CODE XREF: int_10_10_handler+10j
bios:F962		  cmp	  al, 0
bios:F964		  jnz	  short	subsrv_set_border_color
bios:F966		  cmp	  byte ptr ds:p400.crt_mode, 6
bios:F96B		  jnz	  short	s2
bios:F96D		  cmp	  bl, 1				      ;	if palette idx is 1, replace with 0xf. I guess because in 640x200 there	are only two colors?
bios:F970		  jnz	  short	set_palette
bios:F972		  mov	  bl, 0Fh
bios:F974		  jmp	  short	set_palette
bios:F976 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F976
bios:F976 s2:							      ;	CODE XREF: int_10_10_handler+1Ej
bios:F976		  jnb	  short	set_palette		      ;	modes 7-0xa don't need special requirements
bios:F978		  cmp	  byte ptr ds:p400.crt_mode, 4
bios:F97D		  jb	  short	set_palette		      ;	modes 0-3 don't need special requirements
bios:F97F		  mov	  al, ds:p400.shadow_3d9_crt_palette  ;	modes 4-5 DO need special requirements
bios:F982		  and	  al, 100000b			      ;	only color select
bios:F984		  jz	  short	s5
bios:F986		  cmp	  bl, 1				      ;	palette	idx == 1 ?
bios:F989		  jnz	  short	s3
bios:F98B		  mov	  bl, 0Bh			      ;	idx 1 replaced with 0xb
bios:F98D		  jmp	  short	set_palette
bios:F98F ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F98F
bios:F98F s3:							      ;	CODE XREF: int_10_10_handler+3Cj
bios:F98F		  cmp	  bl, 2				      ;	palette	idx == 2 ?
bios:F992		  jnz	  short	s4
bios:F994		  mov	  bl, 0Dh			      ;	idx 2 replaced with 0xd
bios:F996		  jmp	  short	set_palette
bios:F998 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F998
bios:F998 s4:							      ;	CODE XREF: int_10_10_handler+45j
bios:F998		  cmp	  bl, 3				      ;	palette	idx == 3?
bios:F99B		  jnz	  short	set_palette
bios:F99D		  mov	  bl, 0Fh			      ;	idx 3 replaced with idx	0xf
bios:F99F		  jmp	  short	set_palette
bios:F9A1 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F9A1
bios:F9A1 s5:							      ;	CODE XREF: int_10_10_handler+37j
bios:F9A1		  cmp	  bl, 1				      ;	palette	idx == 1 ?
bios:F9A4		  jnz	  short	s6
bios:F9A6		  mov	  bl, 0Ah			      ;	idx 1 replaced with idx	0xa
bios:F9A8		  jmp	  short	set_palette
bios:F9AA ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F9AA
bios:F9AA s6:							      ;	CODE XREF: int_10_10_handler+57j
bios:F9AA		  cmp	  bl, 2
bios:F9AD		  jnz	  short	s7
bios:F9AF		  mov	  bl, 0Ch			      ;	idx 2 replaced with idx	0xc
bios:F9B1		  jmp	  short	set_palette
bios:F9B3 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F9B3
bios:F9B3 s7:							      ;	CODE XREF: int_10_10_handler+60j
bios:F9B3		  cmp	  bl, 3				      ;	palette	idx == 3 ?
bios:F9B6		  jnz	  short	set_palette
bios:F9B8		  mov	  bl, 0Eh			      ;	idx 3 replaced with idx	0xe
bios:F9BA
bios:F9BA set_palette:						      ;	CODE XREF: int_10_10_handler+23j
bios:F9BA							      ;	int_10_10_handler+27j ...
bios:F9BA		  call	  set_palette_color
bios:F9BD		  jb	  short	error
bios:F9BF		  jmp	  short	pre_exit
bios:F9C1 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F9C1
bios:F9C1 subsrv_set_border_color:				      ;	CODE XREF: int_10_10_handler+17j
bios:F9C1		  push	  ax
bios:F9C2		  cmp	  byte ptr ds:p400.crt_mode, 7
bios:F9C7		  jnb	  short	s9
bios:F9C9		  push	  dx
bios:F9CA		  mov	  dx, 3DAh
bios:F9CD		  mov	  al, 3
bios:F9CF		  out	  dx, al			      ;	out 3da, 3 (Select mode	control)
bios:F9D0		  add	  dx, 4
bios:F9D3		  mov	  al, 100b
bios:F9D5		  out	  dx, al			      ;	out 3de, 4 (Enables border color)
bios:F9D6		  pop	  dx
bios:F9D7
bios:F9D7 s9:							      ;	CODE XREF: int_10_10_handler+7Aj
bios:F9D7		  pop	  ax
bios:F9D8		  cmp	  al, 1
bios:F9DA		  jnz	  short	subsrv_set_palette_and_border_color
bios:F9DC		  mov	  al, 2				      ;	set border color register
bios:F9DE		  mov	  dx, 3DAh
bios:F9E1		  out	  dx, al			      ;	out 3da, 2 (Select border color)
bios:F9E2		  mov	  al, bh			      ;	bh = border color to set
bios:F9E4		  add	  dx, 4
bios:F9E7		  out	  dx, al			      ;	out 3de, bh (border color to set)
bios:F9E8		  jmp	  short	pre_exit
bios:F9EA ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:F9EA
bios:F9EA subsrv_set_palette_and_border_color:			      ;	CODE XREF: int_10_10_handler+8Dj
bios:F9EA		  mov	  bl, 10h			      ;	first palette register (from 0x10 to 0x1f)
bios:F9EC		  mov	  si, dx			      ;	es:dx points to	list. si=dx
bios:F9EE		  mov	  dx, 3DAh
bios:F9F1		  mov	  cx, 10h			      ;	16 palette colors
bios:F9F4
bios:F9F4 l0:							      ;	CODE XREF: int_10_10_handler+CBj
bios:F9F4		  push	  dx
bios:F9F5		  mov	  dx, 3DAh
bios:F9F8
bios:F9F8 retrace_in_progress:					      ;	CODE XREF: int_10_10_handler+AEj
bios:F9F8		  in	  al, dx			      ;	Video status bits:
bios:F9F8							      ;	0: retrace.  1=display is in vert or horiz retrace.
bios:F9F8							      ;	1: 1=light pen is triggered; 0=armed
bios:F9F8							      ;	2: 1=light pen switch is open; 0=closed
bios:F9F8							      ;	3: 1=vertical sync pulse is occurring.
bios:F9F9		  test	  al, 8
bios:F9FB		  jnz	  short	retrace_in_progress
bios:F9FD		  cli					      ;	no interrupts
bios:F9FE
bios:F9FE wait_start_retrace:					      ;	CODE XREF: int_10_10_handler+B4j
bios:F9FE		  in	  al, dx			      ;	Video status bits:
bios:F9FE							      ;	0: retrace.  1=display is in vert or horiz retrace.
bios:F9FE							      ;	1: 1=light pen is triggered; 0=armed
bios:F9FE							      ;	2: 1=light pen switch is open; 0=closed
bios:F9FE							      ;	3: 1=vertical sync pulse is occurring.
bios:F9FF		  test	  al, 8
bios:FA01		  jz	  short	wait_start_retrace
bios:FA03		  pop	  dx
bios:FA04		  mov	  al, bl			      ;	bl = palette idx register
bios:FA06		  out	  dx, al			      ;	out 3da, palette_idx
bios:FA07		  mov	  al, es:[si]			      ;	get palette from list
bios:FA0A		  add	  dx, 4
bios:FA0D		  out	  dx, al			      ;	out 3de, [es:si] (color)
bios:FA0E		  sti					      ;	enable interrupts
bios:FA0F		  inc	  si				      ;	points to next palette color
bios:FA10		  sub	  dx, 4
bios:FA13		  xor	  al, al
bios:FA15		  out	  dx, al			      ;	out 3da, 0
bios:FA16		  inc	  bl				      ;	bl++ (pointer to palette idx register)
bios:FA18		  loop	  l0
bios:FA1A		  mov	  al, 2				      ;	2 = border color
bios:FA1C		  out	  dx, al			      ;	out 3da, 2 (Select border color)
bios:FA1D		  add	  dx, 4
bios:FA20		  mov	  al, es:[si]			      ;	fetch boder color from the last	element	in the list
bios:FA23		  out	  dx, al			      ;	out 3de, [es:si] (Border color)
bios:FA24
bios:FA24 pre_exit:						      ;	CODE XREF: int_10_10_handler+72j
bios:FA24							      ;	int_10_10_handler+9Bj
bios:FA24		  mov	  dx, 3DAh
bios:FA27		  xor	  al, al
bios:FA29		  out	  dx, al			      ;	out 3da, 0
bios:FA2A		  clc
bios:FA2B
bios:FA2B exit:							      ;	CODE XREF: int_10_10_handler+E2j
bios:FA2B		  jmp	  near ptr pop_regs_and_iret
bios:FA2E ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:FA2E
bios:FA2E error:						      ;	CODE XREF: int_10_10_handler:s0j
bios:FA2E							      ;	int_10_10_handler+70j
bios:FA2E		  stc
bios:FA2F		  jmp	  short	exit
bios:FA2F int_10_10_handler endp
bios:FA2F
bios:FA31
bios:FA31 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:FA31
bios:FA31
bios:FA31 get_active_display_page proc near			      ;	CODE XREF: int_10_0e_handler+3p
bios:FA31							      ;	int_10_0e_handler+48p ...
bios:FA31		  mov	  bl, ds:p400.active_display_page     ;	get active page
bios:FA35		  cmp	  byte ptr ds:p400.crt_mode, 4
bios:FA3A		  jl	  short	s0
bios:FA3C		  xor	  bl, bl
bios:FA3E
bios:FA3E s0:							      ;	CODE XREF: get_active_display_page+9j
bios:FA3E		  mov	  bh, bl
bios:FA40		  retn
bios:FA40 get_active_display_page endp
bios:FA40
bios:FA41
bios:FA41 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:FA41
bios:FA41 ; Returns:
bios:FA41 ;	Carry set if in	graphics mode
bios:FA41 ;	      clear if in text mode
bios:FA41
bios:FA41 is_graphics_mode proc	near				      ;	CODE XREF: scroll_up_or_down:s1p
bios:FA41							      ;	int_10_08_handlerp ...
bios:FA41		  cmp	  byte ptr ds:p400.crt_mode, 7	      ;	monochrome text	mode?
bios:FA46		  jz	  short	is_text_mode
bios:FA48		  cmp	  byte ptr ds:p400.crt_mode, 4	      ;	mode between 0-3 (text modes)
bios:FA4D		  jl	  short	is_text_mode
bios:FA4F
bios:FA4F is_graphics_mode_:
bios:FA4F		  stc
bios:FA50		  retn
bios:FA51 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:FA51
bios:FA51 is_text_mode:						      ;	CODE XREF: is_graphics_mode+5j
bios:FA51							      ;	is_graphics_mode+Cj
bios:FA51		  clc
bios:FA52		  retn
bios:FA52 is_graphics_mode endp
bios:FA52
bios:FA52 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:FA53		  db 1Bh dup(0FFh)
bios:FA6E charset_0_127	  db 8 dup(   0), 7Eh, 81h,0A5h, 81h,0BDh, 99h,	81h,2 dup( 7Eh),0FFh,0DBh,0FFh,0C3h,0E7h
bios:FA6E							      ;	DATA XREF: bios:int_44_44_tableo
bios:FA6E		  db 0FFh, 7Eh,	36h,3 dup( 7Fh), 3Eh, 1Ch,   8,	  0,   8, 1Ch, 3Eh, 7Fh, 3Eh, 1Ch,   8
bios:FA6E		  db	0, 1Ch,	3Eh, 1Ch,2 dup(	7Fh), 3Eh, 1Ch,	3Eh,2 dup(   8), 1Ch, 3Eh, 7Fh,	3Eh, 1Ch
bios:FA6E		  db  3Eh,2 dup(   0), 18h,2 dup( 3Ch),	18h,2 dup(   0),2 dup(0FFh),0E7h,2 dup(0C3h),0E7h
bios:FA6E		  db 2 dup(0FFh),   0, 3Ch, 66h,2 dup( 42h), 66h, 3Ch,	 0,0FFh,0C3h, 99h,2 dup(0BDh)
bios:FA6E		  db  99h,0C3h,0FFh, 0Fh,   7, 0Fh, 7Dh,3 dup(0CCh), 78h, 3Ch,3	dup( 66h), 3Ch,	18h, 7Eh
bios:FA6E		  db  18h, 30h,	3Ch, 33h,2 dup(	31h),2 dup( 70h),   0, 60h, 78h, 66h, 73h, 6Fh,0E3h,0E7h
bios:FA6E		  db	7, 99h,	5Ah, 3Ch,2 dup(0E7h), 3Ch, 5Ah,	99h, 40h, 70h, 7Ch, 7Fh, 7Ch, 70h, 40h
bios:FA6E		  db	0,   1,	  7, 1Fh, 7Fh, 1Fh,   7,   1,	0, 18h,	3Ch, 7Eh,2 dup(	18h), 7Eh, 3Ch
bios:FA6E		  db  18h,5 dup( 66h),	 0, 66h,   0, 7Fh,2 dup(0DBh), 7Bh,3 dup( 1Bh),	  0, 3Fh, 60h
bios:FA6E		  db  3Eh, 63h,	3Eh,   3, 7Eh,5	dup(   0),3 dup( 7Eh),	 0, 18h, 3Ch, 7Eh, 18h,	7Eh, 3Ch
bios:FA6E		  db  18h,0FFh,	18h, 3Ch, 7Eh,4	dup( 18h),   0,4 dup( 18h), 7Eh, 3Ch, 18h,2 dup(   0)
bios:FA6E		  db  0Ch,   6,	7Fh,   6, 0Ch,3	dup(   0), 18h,	30h, 7Fh, 30h, 18h,4 dup(   0),3 dup( 60h)
bios:FA6E		  db  7Fh,3 dup(   0), 24h, 66h,0FFh, 66h, 24h,3 dup(	0), 18h, 3Ch, 7Eh,2 dup(0FFh)
bios:FA6E		  db 3 dup(   0),2 dup(0FFh), 7Eh, 3Ch,	18h,0Ah	dup(   0), 18h,2 dup( 3Ch),2 dup( 18h)
bios:FA6E		  db	0, 18h,	  0,3 dup( 36h),5 dup(	 0),2 dup( 36h), 7Fh, 36h, 7Fh,2 dup( 36h),   0
bios:FA6E		  db  18h, 3Eh,	60h, 3Ch,   6, 7Ch, 18h,2 dup(	 0), 63h, 66h, 0Ch, 18h, 33h, 63h,   0
bios:FA6E		  db  1Ch, 36h,	1Ch, 3Bh, 6Eh, 66h, 3Bh,   0,2 dup( 18h), 30h,5	dup(   0), 0Ch,	18h,3 dup( 30h)
bios:FA6E		  db  18h, 0Ch,	  0, 30h, 18h,3	dup( 0Ch), 18h,	30h,2 dup(   0), 66h, 3Ch,0FFh,	3Ch, 66h
bios:FA6E		  db 3 dup(   0),2 dup(	18h), 7Eh,2 dup( 18h),7	dup(   0),2 dup( 18h), 30h,3 dup(   0)
bios:FA6E		  db  7Eh,9 dup(   0),2	dup( 18h),   0,	  3,   6, 0Ch, 18h, 30h, 60h,0C0h,   0,	3Eh, 63h
bios:FA6E		  db  67h, 6Fh,	7Bh, 73h, 3Eh,	 0, 18h, 38h,4 dup( 18h), 7Eh,	 0, 3Ch, 66h,	6, 1Ch
bios:FA6E		  db  30h, 66h,	7Eh,   0, 3Ch, 66h,   6, 1Ch,	6, 66h,	3Ch,   0, 0Eh, 1Eh, 36h, 66h, 7Fh
bios:FA6E		  db	6, 0Fh,	  0, 7Eh, 60h, 7Ch,2 dup(   6),	66h, 3Ch,   0, 1Ch, 30h, 60h, 7Ch,2 dup( 66h)
bios:FA6E		  db  3Ch,   0,	7Eh, 66h,   6, 0Ch,3 dup( 18h),	  0, 3Ch,2 dup(	66h), 3Ch,2 dup( 66h)
bios:FA6E		  db  3Ch,   0,	3Ch,2 dup( 66h), 3Eh,	6, 0Ch,	38h,2 dup(   0),2 dup( 18h),2 dup(   0)
bios:FA6E		  db 2 dup( 18h),2 dup(	  0),2 dup( 18h),2 dup(	  0),2 dup( 18h), 30h,	 6, 0Ch, 18h, 30h
bios:FA6E		  db  18h, 0Ch,	  6,3 dup(   0), 7Eh,	0, 7Eh,3 dup(	0), 30h, 18h, 0Ch,   6,	0Ch, 18h
bios:FA6E		  db  30h,   0,	3Ch, 66h,   6, 0Ch, 18h,   0, 18h,   0,	3Eh, 63h,3 dup(	6Fh), 60h, 3Ch
bios:FA6E		  db	0, 1Ch,	36h,2 dup( 63h), 7Fh,2 dup( 63h),   0, 7Eh,2 dup( 33h),	3Eh,2 dup( 33h)
bios:FA6E		  db  7Eh,   0,	1Eh, 33h,3 dup(	60h), 33h, 1Eh,	  0, 7Ch, 36h,3	dup( 33h), 36h,	7Ch,   0
bios:FA6E		  db  7Fh, 31h,	34h, 3Ch, 34h, 31h, 7Fh,   0, 7Fh, 31h,	34h, 3Ch, 34h, 30h, 78h,   0, 1Eh
bios:FA6E		  db  33h,2 dup( 60h), 67h, 33h, 1Fh,	0,3 dup( 66h), 7Eh,3 dup( 66h),	  0, 3Ch,5 dup(	18h)
bios:FA6E		  db  3Ch,   0,	0Fh,3 dup(   6),2 dup( 66h), 3Ch,   0, 73h, 33h, 36h, 3Ch, 36h,	33h, 73h
bios:FA6E		  db	0, 78h,3 dup( 30h), 31h, 33h, 7Fh,   0,	63h, 77h,2 dup(	7Fh), 6Bh,2 dup( 63h)
bios:FA6E		  db	0, 63h,	73h, 7Bh, 6Fh, 67h,2 dup( 63h),	  0, 3Eh,5 dup(	63h), 3Eh,   0,	7Eh,2 dup( 33h)
bios:FA6E		  db  3Eh,2 dup( 30h), 78h,   0, 3Eh,4 dup( 63h), 6Fh, 3Eh,   3, 7Eh,2 dup( 33h), 3Eh
bios:FA6E		  db  36h, 33h,	73h,   0, 3Ch, 66h, 70h, 38h, 0Eh, 66h,	3Ch,   0, 7Eh, 5Ah,4 dup( 18h)
bios:FA6E		  db  3Ch,   0,6 dup( 63h), 3Eh,   0,5 dup( 66h), 3Ch, 18h,   0,3 dup( 63h), 6Bh, 7Fh
bios:FA6E		  db  77h, 63h,	  0,2 dup( 63h), 36h,2 dup( 1Ch), 36h, 63h,   0,3 dup( 66h), 3Ch,2 dup(	18h)
bios:FA6E		  db  3Ch,   0,	7Fh, 63h, 46h, 0Ch, 19h, 33h, 7Fh,   0,	3Ch,5 dup( 30h), 3Ch,	0, 60h
bios:FA6E		  db  30h, 18h,	0Ch,   6,   3,	 1,   0, 3Ch,5 dup( 0Ch), 3Ch,	 0,   8, 1Ch, 36h,0Ch dup(   0)
bios:FA6E		  db 0FFh,2 dup( 18h), 0Ch,7 dup(   0),	3Ch,   6, 3Eh, 66h, 3Bh,   0, 70h, 30h,	3Eh,3 dup( 33h)
bios:FA6E		  db  6Eh,3 dup(   0), 3Ch, 66h, 60h, 66h, 3Ch,	  0, 0Eh,   6, 3Eh,3 dup( 66h),	3Bh,3 dup(   0)
bios:FA6E		  db  3Ch, 66h,	7Eh, 60h, 3Ch,	 0, 1Ch, 36h, 30h, 78h,2 dup( 30h), 78h,3 dup(	 0), 3Bh
bios:FA6E		  db 2 dup( 66h), 3Eh,	 6, 7Ch, 70h, 30h, 36h,	3Bh,2 dup( 33h), 73h,	0, 18h,	  0, 38h
bios:FA6E		  db 3 dup( 18h), 3Ch,	 0,   6,   0, 0Eh,2 dup(   6),2	dup( 66h), 3Ch,	70h, 30h, 33h
bios:FA6E		  db  36h, 3Ch,	36h, 73h,   0, 38h,5 dup( 18h),	3Ch,3 dup(   0),0E6h,2 dup( 7Fh), 6Bh
bios:FA6E		  db  63h,3 dup(   0), 6Eh,4 dup( 33h),3 dup(	0), 3Ch,3 dup( 66h), 3Ch,3 dup(	  0), 6Eh
bios:FA6E		  db 2 dup( 33h), 3Eh, 30h, 78h,2 dup(	 0), 3Bh,2 dup(	66h), 3Eh,   6,	0Fh,2 dup(   0)
bios:FA6E		  db  6Eh, 3Bh,	33h, 30h, 78h,3	dup(   0), 3Eh,	60h, 3Ch,   6, 7Ch,   0, 10h, 30h, 7Ch
bios:FA6E		  db 2 dup( 30h), 36h, 1Ch,3 dup(   0),4 dup( 66h), 3Bh,3 dup(	 0),3 dup( 66h), 3Ch, 18h
bios:FA6E		  db 3 dup(   0), 63h, 6Bh,2 dup( 7Fh),	36h,3 dup(   0), 63h, 36h, 1Ch,	36h, 63h,3 dup(	  0)
bios:FA6E		  db 3 dup( 66h), 3Eh,	 6, 7Ch,2 dup(	 0), 7Eh, 4Ch, 18h, 32h, 7Eh,	0, 0Eh,2 dup( 18h)
bios:FA6E		  db  70h,2 dup( 18h), 0Eh,   0,3 dup( 18h),   0,3 dup(	18h),	0, 70h,2 dup( 18h), 0Eh
bios:FA6E		  db 2 dup( 18h), 70h,	 0, 3Bh, 6Eh,7 dup(   0),   8, 1Ch, 36h,2 dup( 63h), 7Fh,   0
bios:FE6E ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:FE6E
bios:FE6E int_1a_handler:					      ;	DATA XREF: bios:FF17o
bios:FE6E		  jmp	  near ptr int_1a_main
bios:FE71
bios:FE71 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:FE71
bios:FE71 ;
bios:FE71 ;	Returns	a list of installed equipment on the system.
bios:FE71 ;
bios:FE71 ;	   On entry:	  No parameters
bios:FE71 ;
bios:FE71 ;	   Returns:	  AX	     Equipment code
bios:FE71
bios:FE71 int_11_handler  proc far				      ;	DATA XREF: bios:FF05o
bios:FE71		  push	  bx
bios:FE72		  push	  ds
bios:FE73		  mov	  ax, 40h ; '@'
bios:FE76		  mov	  ds, ax
bios:FE78		  assume ds:nothing
bios:FE78		  lea	  bx, ds:p400.installed_hardware
bios:FE7C		  mov	  ax, [bx]			      ;	returns	value from 0410h. list of installed equipment
bios:FE7E		  pop	  ds
bios:FE7F		  assume ds:nothing
bios:FE7F		  pop	  bx
bios:FE80		  iret
bios:FE80 int_11_handler  endp
bios:FE80
bios:FE81
bios:FE81 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:FE81
bios:FE81 ;
bios:FE81 ;	Reports	the number of contiguous 1K memory blocks in the system	(up to
bios:FE81 ;	640K).
bios:FE81 ;
bios:FE81 ;	   On entry:	  No parameters
bios:FE81 ;
bios:FE81 ;	   Returns:	  AX	     Memory size (up to	640K)
bios:FE81
bios:FE81 int_12_handler  proc far				      ;	DATA XREF: bios:FF07o
bios:FE81		  push	  bx
bios:FE82		  push	  ds
bios:FE83		  mov	  ax, 40h ; '@'
bios:FE86		  mov	  ds, ax
bios:FE88		  assume ds:nothing
bios:FE88		  lea	  bx, ds:p400.base_mem_kb
bios:FE8C		  mov	  ax, [bx]			      ;	returns	base memory size in Kb
bios:FE8E		  pop	  ds
bios:FE8F		  assume ds:nothing
bios:FE8F		  pop	  bx
bios:FE90		  iret
bios:FE90 int_12_handler  endp
bios:FE90
bios:FE91
bios:FE91 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:FE91
bios:FE91 ; Attributes:	bp-based frame
bios:FE91
bios:FE91 push_regs	  proc near				      ;	CODE XREF: int_13_mainp
bios:FE91							      ;	int_14_handlerp ...
bios:FE91
bios:FE91 arg_bx	  = word ptr  0Eh
bios:FE91
bios:FE91		  sti					      ;	enable interrupts
bios:FE92		  push	  cx				      ;	bp+c
bios:FE93		  push	  dx				      ;	bp+a
bios:FE94		  push	  si				      ;	bp+8
bios:FE95		  push	  di				      ;	bp+6
bios:FE96		  push	  bp				      ;	bp+4
bios:FE97		  push	  ds				      ;	bp+2
bios:FE98		  push	  es				      ;	bp+0
bios:FE99		  mov	  bp, sp
bios:FE9B		  push	  [bp+arg_bx]			      ;	cx ?
bios:FE9E		  mov	  [bp+arg_bx], bx		      ;	replace	with bx	? I don't understand
bios:FEA1		  retn
bios:FEA1 push_regs	  endp ; sp = -10h
bios:FEA1
bios:FEA1 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:FEA2		  db 0FFh
bios:FEA3		  db 0FFh
bios:FEA4		  db 0FFh
bios:FEA5 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:FEA5
bios:FEA5 int_08_handler:					      ;	DATA XREF: bios:int_08_1f_tableo
bios:FEA5		  jmp	  near ptr int_08_main
bios:FEA8
bios:FEA8 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:FEA8
bios:FEA8
bios:FEA8 pop_regs_and_iret proc far				      ;	CODE XREF: int_14_03_handler:int_14_pop_and_iretj
bios:FEA8							      ;	int_09_handler+189j ...
bios:FEA8		  pop	  es
bios:FEA9		  pop	  ds
bios:FEAA		  pop	  bp
bios:FEAB		  pop	  di
bios:FEAC		  pop	  si
bios:FEAD		  pop	  dx
bios:FEAE		  pop	  cx
bios:FEAF		  pop	  bx
bios:FEB0		  iret
bios:FEB0 pop_regs_and_iret endp ; sp =	 10h
bios:FEB0
bios:FEB1
bios:FEB1 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:FEB1
bios:FEB1 ;	Entry:
bios:FEB1 ;	    ah = value to convert
bios:FEB1 ;	    di = max value for ah
bios:FEB1 ;	Returns:
bios:FEB1 ;	    ds = 40h
bios:FEB1 ;	    di = ah * 2
bios:FEB1 ;	    carry: clear if Ok.	set on Error
bios:FEB1
bios:FEB1 convert_ah_to_di_idx proc near			      ;	CODE XREF: int_13_main+7p
bios:FEB1							      ;	int_14_handler+7p ...
bios:FEB1		  push	  ax
bios:FEB2		  mov	  al, ah
bios:FEB4		  xor	  ah, ah
bios:FEB6		  shl	  ax, 1
bios:FEB8		  cmp	  ax, di
bios:FEBA		  mov	  di, ax
bios:FEBC		  mov	  ax, 40h ; '@'
bios:FEBF		  mov	  ds, ax
bios:FEC1		  assume ds:nothing
bios:FEC1		  pop	  ax
bios:FEC2		  jnb	  short	error
bios:FEC4		  clc
bios:FEC5		  retn
bios:FEC6 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:FEC6
bios:FEC6 error:						      ;	CODE XREF: convert_ah_to_di_idx+11j
bios:FEC6		  stc
bios:FEC7		  retn
bios:FEC7 convert_ah_to_di_idx endp
bios:FEC7
bios:FEC7 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:FEC8		  db 2Bh dup(0FFh)
bios:FEF3 int_08_1f_table dw offset int_08_handler		      ;	DATA XREF: POST_init_ints_and_more+5Do
bios:FEF3							      ;	int 8
bios:FEF5		  dw offset int_09_handler		      ;	int 9
bios:FEF7		  dw offset int_unexpected_handler	      ;	int 0xa
bios:FEF9		  dw offset int_unexpected_handler	      ;	int 0xb
bios:FEFB		  dw offset int_unexpected_handler	      ;	int 0xc
bios:FEFD		  dw offset int_unexpected_handler	      ;	int 0xd
bios:FEFF		  dw offset int_0e_handler		      ;	int 0xe
bios:FF01		  dw offset int_unexpected_handler	      ;	int 0xf
bios:FF03		  dw offset int_10_handler		      ;	int 0x10
bios:FF05		  dw offset int_11_handler		      ;	int 0x11
bios:FF07		  dw offset int_12_handler		      ;	int 0x12
bios:FF09		  dw offset int_13_handler		      ;	int 0x13
bios:FF0B		  dw offset int_14_handler		      ;	int 0x14
bios:FF0D		  dw offset int_15_handler		      ;	int 0x15
bios:FF0F		  dw offset int_16_handler		      ;	int 0x16
bios:FF11		  dw offset int_17_handler		      ;	int 0x17
bios:FF13		  dw offset int_18_handler		      ;	int 0x18
bios:FF15		  dw offset int_19_handler		      ;	int 0x19
bios:FF17		  dw offset int_1a_handler		      ;	int 0x1a
bios:FF19		  dw offset int_do_nothing_handler	      ;	int 0x1b
bios:FF1B		  dw offset int_do_nothing_handler	      ;	int 0x1c
bios:FF1D		  dw offset video_6845_init_tbl_d	      ;	int 0x1d
bios:FF1F		  dw offset diskette_params_values	      ;	int 0x1e
bios:FF21		  dw offset charset_128_255		      ;	int 0x1f: charset 128-255
bios:FF23 int_00_07_table dw offset int_do_nothing_handler	      ;	DATA XREF: POST_init_ints_and_more+52o
bios:FF23							      ;	int 0
bios:FF25		  dw offset int_do_nothing_handler	      ;	int 1
bios:FF27		  dw offset int_do_nothing_handler	      ;	int 2
bios:FF29		  dw offset int_do_nothing_handler	      ;	int 3
bios:FF2B		  dw offset int_do_nothing_handler	      ;	int 4
bios:FF2D		  dw offset int_5_handler		      ;	int 5
bios:FF2F		  dw offset int_do_nothing_handler	      ;	int 6
bios:FF31		  dw offset int_do_nothing_handler	      ;	int 7
bios:FF33 int_44_44_table dw offset charset_0_127		      ;	DATA XREF: POST_init_ints_and_more+69o
bios:FF33							      ;	int 0x44: charset 0-127
bios:FF35 segment_40	  dw 40h				      ;	DATA XREF: int_1a_main+1r
bios:FF35							      ;	int_08_main+5r
bios:FF37		  db 1Ch dup(0FFh)
bios:FF53
bios:FF53 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:FF53
bios:FF53
bios:FF53 int_do_nothing_handler proc far			      ;	DATA XREF: bios:FF19o
bios:FF53							      ;	bios:FF1Bo ...
bios:FF53		  iret					      ;	int 0 and many other interrupts
bios:FF53 int_do_nothing_handler endp
bios:FF53
bios:FF54
bios:FF54 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:FF54
bios:FF54 ;	Prints the current screen contents to the first	parallel printer
bios:FF54 ;	(LPT1).
bios:FF54 ;
bios:FF54 ;	This interrupt can be called from within a program as well as by means
bios:FF54 ;	of the Shift-PrtSc key combination. The	service	returns	no register
bios:FF54 ;	values but sets	a status code at memory	location 0000:0500h. The
bios:FF54 ;	possible values	of this	status code, and their meanings, are as
bios:FF54 ;	follows:
bios:FF54 ;
bios:FF54 ;	     00h	  Print	Screen not called, or operation	completed
bios:FF54 ;
bios:FF54 ;	     01h	  Print	Screen currently in progress
bios:FF54 ;
bios:FF54 ;	     FFh	  Error	encountered during most	recent Print Screen
bios:FF54
bios:FF54 int_5_handler	  proc far				      ;	DATA XREF: bios:FF2Do
bios:FF54		  push	  ax
bios:FF55		  push	  bx
bios:FF56		  push	  cx
bios:FF57		  push	  dx
bios:FF58		  push	  ds
bios:FF59		  mov	  ax, 50h ; 'P'                       ; ds = 50h (to place error code)
bios:FF5C		  mov	  ds, ax
bios:FF5E		  assume ds:nothing
bios:FF5E		  xor	  bx, bx
bios:FF60		  cmp	  byte ptr [bx], 1		      ;	print screen currently in progress?
bios:FF63		  jz	  short	exit
bios:FF65		  mov	  byte ptr [bx], 1		      ;	print screen in	progress = true
bios:FF68		  sti
bios:FF69		  mov	  ah, 3
bios:FF6B		  int	  10h				      ;	- VIDEO	- READ CURSOR POSITION
bios:FF6B							      ;	BH = page number
bios:FF6B							      ;	Return:	DH,DL =	row,column, CH = cursor	start line, CL = cursor	end line
bios:FF6D		  push	  dx
bios:FF6E		  mov	  ah, 0Fh
bios:FF70		  int	  10h				      ;	- VIDEO	- GET CURRENT VIDEO MODE
bios:FF70							      ;	Return:	AH = number of columns on screen
bios:FF70							      ;	AL = current video mode
bios:FF70							      ;	BH = current active display page
bios:FF72		  mov	  cl, ah
bios:FF74		  call	  near ptr printer_output_new_line
bios:FF77		  xor	  dx, dx
bios:FF79
bios:FF79 l0:							      ;	CODE XREF: int_5_handler+3Cj
bios:FF79							      ;	int_5_handler+48j
bios:FF79		  mov	  ah, 2
bios:FF7B		  int	  10h				      ;	- VIDEO	- SET CURSOR POSITION
bios:FF7B							      ;	DH,DL =	row, column (0,0 = upper left)
bios:FF7B							      ;	BH = page number
bios:FF7D		  mov	  ah, 8
bios:FF7F		  int	  10h				      ;	- VIDEO	- READ ATTRIBUTES/CHARACTER AT CURSOR POSITION
bios:FF7F							      ;	BH = display page
bios:FF7F							      ;	Return:	AL = character
bios:FF7F							      ;	AH = attribute of character (alpha modes)
bios:FF81		  cmp	  al, 0
bios:FF83		  jnz	  short	s0
bios:FF85		  mov	  al, 20h ; ' '                       ; treat 0 as space for printing
bios:FF87
bios:FF87 s0:							      ;	CODE XREF: int_5_handler+2Fj
bios:FF87		  call	  printer_output_char
bios:FF8A		  jnz	  short	update_cursor_position
bios:FF8C		  inc	  dl
bios:FF8E		  cmp	  dl, cl
bios:FF90		  jnz	  short	l0
bios:FF92		  call	  near ptr printer_output_new_line
bios:FF95		  xor	  dl, dl
bios:FF97		  inc	  dh
bios:FF99		  cmp	  dh, 19h
bios:FF9C		  jnz	  short	l0
bios:FF9E		  mov	  cl, 0
bios:FFA0
bios:FFA0 update_cursor_position:				      ;	CODE XREF: int_5_handler+36j
bios:FFA0							      ;	printer_output_new_line+10j
bios:FFA0		  pop	  dx
bios:FFA1		  mov	  ah, 2
bios:FFA3		  int	  10h				      ;	- VIDEO	- SET CURSOR POSITION
bios:FFA3							      ;	DH,DL =	row, column (0,0 = upper left)
bios:FFA3							      ;	BH = page number
bios:FFA5		  mov	  [bx],	cl
bios:FFA7
bios:FFA7 exit:							      ;	CODE XREF: int_5_handler+Fj
bios:FFA7		  pop	  ds
bios:FFA8		  assume ds:nothing
bios:FFA8		  pop	  dx
bios:FFA9		  pop	  cx
bios:FFAA		  pop	  bx
bios:FFAB		  pop	  ax
bios:FFAC		  iret
bios:FFAC int_5_handler	  endp ; sp =  4
bios:FFAC
bios:FFAD
bios:FFAD ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:FFAD
bios:FFAD ;	Entry:
bios:FFAD ;	    AL = character to print
bios:FFAD ;	Returns:
bios:FFAD ;	    CL = 255 on	error
bios:FFAD ;	    Zero Flag =	0 if Ok. 1 on error
bios:FFAD
bios:FFAD printer_output_char proc near				      ;	CODE XREF: int_5_handler:s0p
bios:FFAD							      ;	printer_output_new_line+2p ...
bios:FFAD		  push	  dx
bios:FFAE		  xor	  ah, ah
bios:FFB0		  xor	  dx, dx
bios:FFB2		  int	  17h				      ;	PRINTER	- OUTPUT CHARACTER
bios:FFB2							      ;	AL = character,	DX = printer port (0-3)
bios:FFB2							      ;	Return:	AH = status bits
bios:FFB4		  and	  ah, 1001b
bios:FFB7		  cmp	  ah, 0
bios:FFBA		  jz	  short	s0
bios:FFBC		  mov	  cl, 0FFh			      ;	error
bios:FFBE
bios:FFBE s0:							      ;	CODE XREF: printer_output_char+Dj
bios:FFBE		  pop	  dx
bios:FFBF		  retn
bios:FFBF printer_output_char endp
bios:FFBF
bios:FFC0
bios:FFC0 ; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U	B R O U	T I N E	ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ
bios:FFC0
bios:FFC0
bios:FFC0 printer_output_new_line proc far			      ;	CODE XREF: int_5_handler+20p
bios:FFC0							      ;	int_5_handler+3Ep
bios:FFC0		  mov	  al, 0Dh			      ;	\r
bios:FFC2		  call	  printer_output_char
bios:FFC5		  jnz	  short	exit
bios:FFC7		  mov	  al, 0Ah			      ;	\n
bios:FFC9		  call	  printer_output_char
bios:FFCC		  jnz	  short	exit
bios:FFCE		  retn
bios:FFCF ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:FFCF
bios:FFCF exit:							      ;	CODE XREF: printer_output_new_line+5j
bios:FFCF							      ;	printer_output_new_line+Cj
bios:FFCF		  pop	  dx				      ;	pop IP
bios:FFD0		  jmp	  short	update_cursor_position
bios:FFD0 printer_output_new_line endp
bios:FFD0
bios:FFD0 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:FFD2		  db 1Eh dup(0FFh)
bios:FFF0 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:FFF0
bios:FFF0 reset_vector:						      ;	CODE XREF: int_09_handler+41Dj
bios:FFF0		  jmp	  POST_entry
bios:FFF0 ; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
bios:FFF5 a060187	  db '06/01/87'                               ; ROM release date
bios:FFFD		  db 0FFh
bios:FFFE unk_FFFFE	  db 0FFh				      ;	Model value. ff	= PC, early XT
bios:FFFF		  db 0FFh
bios:FFFF bios		  ends
bios:FFFF
bios:FFFF
bios:FFFF		  end
